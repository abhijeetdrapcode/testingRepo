let DATE_REGEX=/^[12]\d{3}(-(0[1-9]|1[0-2])(-(0[1-9]|[12][0-9]|3[01]))?)(T| )?(([01][0-9]|2[0-3]):[0-5]\d(:[0-5]\d(\.\d+)?)?(Z|[+-]\d{2}:\d{2})?)?$/,htmlRegex=/<(br|basefont|hr|input|source|frame|param|area|meta|!--|col|link|option|base|img|wbr|!DOCTYPE).*?>|<(a|abbr|acronym|address|applet|article|aside|audio|b|bdi|bdo|big|blockquote|body|button|canvas|caption|center|cite|code|colgroup|command|datalist|dd|del|details|dfn|dialog|dir|div|dl|dt|em|embed|fieldset|figcaption|figure|font|footer|form|frameset|head|header|hgroup|h1|h2|h3|h4|h5|h6|html|i|iframe|ins|kbd|keygen|label|legend|li|map|mark|menu|meter|nav|noframes|noscript|object|ol|optgroup|output|p|pre|progress|q|rp|rt|ruby|s|samp|script|section|select|small|span|strike|strong|style|sub|summary|sup|table|tbody|td|textarea|tfoot|th|thead|time|title|tr|track|tt|u|ul|var|video).*?<\/\2>/i,referenceType=["reference","multi_reference","belongsTo"],staticDynamicType=["static_option","dynamic_option"],referenceOptionType=[...staticDynamicType,...referenceType],referenceDynamicType=["dynamic_option",...referenceType],EQUALS="EQUALS",IS_NOT_NULL="IS_NOT_NULL",IS_NULL="IS_NULL",LIKE="LIKE",IN_LIST="IN_LIST",NOT_IN_LIST="NOT_IN_LIST",LESS_THAN="LESS_THAN",GREATER_THAN="GREATER_THAN",LESS_THAN_EQUALS_TO="LESS_THAN_EQUALS_TO",GREATER_THAN_EQUALS_TO="GREATER_THAN_EQUALS_TO",BETWEEN="BETWEEN",NOT_EQUAL="NOT_EQUAL",CURRENT_USER="currentLoggedInUser",CURRENT_USER_ROLE="currentLoggedInUserRole",CURRENT_TIME="CURRENT_TIME",CURRENT_DATE="currentDate",CURRENT_DATE_TIME="currentDateTime",COLLECTION="collection",IS_LOGGED_IN="IS_LOGGED_IN",IS_NOT_LOGGED_IN="IS_NOT_LOGGED_IN",COLLECTION_USER="user",COLLECTION_SURVEY_ANSWER="questionnaire_survey_answer",PARENT_COLLECTION_PROPAGATE_KEY="parentCollectionToPropagate",TENANT_ID_COOKIE_KEY="__dc_tId",CUSTOM_SEPARATOR="##@CUSTOM_SEPARATOR@##",APOSTROPHE_REPLACER="##@apos@##",LOGIN_WITH_TOKEN="LOGIN_WITH_TOKEN",LOGIN_WITH_XANO="LOGIN_WITH_XANO",LOGIN_WITH_BACKENDLESS="LOGIN_WITH_BACKENDLESS",LOGIN_USER="LOGIN_USER",LOGIN_ANONYMOUS_USER="LOGIN_ANONYMOUS_USER",MODAL_COLLECTION_ITEM_DATA="",DropzoneMap=new Map,optionTypes=["dynamic_option","static_option"],currentOptions=["CURRENT_USER","CURRENT_TENANT"],URL_STRATEGIES={CURRENT_OBJECT:"sendCurrentObjectID",PREVIOUS_STEP:"sendPreviousStepParentCollectionId",CURRENT_PAGE:"sendCurrentPageItemId",CURRENT_USER:"sendCurrentUserId",TARGET_ITEM:"sendTargetItemID",PAGE_REFERENCE:"sendCurrentPageReferenceItemId",BSL_ITEM:"sendBSLItemId"},ACTION_LOG_PREFIX=(new Date).getDate()+"."+(new Date).getMonth()+"."+(new Date).getFullYear()+" / "+(new Date).getHours()+":"+(new Date).getMinutes()+":"+(new Date).getSeconds()+" | Action log ~",capitalize=function(e,t){return v.capitalize(e,"TRUE"===t)},lowerCase=function(e){return v.lowerCase(e)},upperCase=function(e){return v.upperCase(e)},slugify=function(e){return v.slugify(e)},trim=function(e,t,a){return"LEFT"===a?v.trimLeft(e,t):"RIGHT"===a?v.trimRight(e,t):v.trim(e,t)},titleCase=function(e,t){return v.titleCase(e,[t])},truncate=function(e,t,a){return v.truncate(e,t,a)},substr=function(e,t,a){return v.substr(e,t,a)},strJoin=function(e,t,a,o){return t=t?t.replace(/##@@##@@##/g," "):" ",e=(e=Array.isArray(e)?e:[e]).filter(Boolean),""+(a?a.replace(/##@@##@@##/g," ")+t:"")+e.join(t)+(o?t+o.replace(/##@@##@@##/g," "):"")},markdownToHtml=function(e){return new showdown.Converter({tables:!0}).makeHtml(e)},splitString=(e,t,a,o)=>{if(!e)return"";t=t?t.replace(/##@@##@@##/g," "):" ";e=e.split(t);return"FIRST_ITEM"===a?o=0:"LAST_ITEM"===a?o=e.length-1:"NTH_ITEM"===a&&(o-=1),e[o]},evaluateCustomSentence=function(e,t,a,o,r,s,n,i){return e=e?getSpecialCharectorReplacedExpression(e):" ",replaceFieldsValueIntoExpression(e,t,a,o,r,s,n,i)},formatDataOnTable=(e,t,a,o,r,s,n,i)=>{if(!e||!e.length)return"";t=t?getSpecialCharectorReplacedExpression(t):"border-collapse: collapse; width: 100%",a=a?getSpecialCharectorReplacedExpression(a):"background-color: #f2f2f2; font-weight: bold;",o=o?getSpecialCharectorReplacedExpression(o):"background-color: #fff;",r=r?getSpecialCharectorReplacedExpression(r):"border-bottom: 1px solid #ddd;",s=s?getSpecialCharectorReplacedExpression(s):"padding: 8px; text-align: left; border: 1px solid #ddd;",n=n?getSpecialCharectorReplacedExpression(n):"padding: 8px; text-align: left; border: 1px solid #ddd;";var l=document.createElement("table"),t=(l.style.cssText=t,document.createElement("thead"));t.style.cssText=a;let c=document.createElement("tr"),d=(c.style.cssText=r,i.forEach(e=>{var t=document.createElement("th");t.style.cssText=n,t.innerHTML=e.header,c.appendChild(t)}),t.appendChild(c),l.appendChild(t),document.createElement("tbody"));return d.style.cssText=o,e.forEach(a=>{let o=document.createElement("tr");o.style.cssText=r,i.forEach(e=>{var t=document.createElement("td");t.style.cssText=s,t.innerHTML=a[e.field]||"",o.appendChild(t)}),d.appendChild(o)}),l.appendChild(d),l.outerHTML},getSpecialCharectorReplacedExpression=e=>e.replace(/##@@##@@##/g," ").replace(/##@@##@@@@/g,">").replace(/@@@@##@@@@/g,"<").replace(/U\+000A/g,"<br/>").replace(/U\+0022/g,'"').replace(/U\+0027/g,"'"),startsWithOne=(t,e)=>e.some(e=>t.startsWith(e)),endsWithOne=(t,e)=>e.some(e=>t.endsWith(e)),checkAndConvertNumber=e=>_.isNumber(e)?e:Number(e),validateNumbers=e=>e.map(e=>checkAndConvertNumber(e)),addition=function(e,{numbers:t}){try{t=(t=Array.isArray(t)?t:[t,0]).map(e=>isNaN(e)?0:e);var a=validateNumbers(t);return numeral(math.add(...a)).format(e||"00.00")}catch(e){return console.log("ðŸš€ ~ file: drapcode.js:166 ~ addition ~ error:",e),""}},average=function(e,{numbers:t}){try{t=(t=Array.isArray(t)?t:[t]).map(e=>isNaN(e)?0:e);var a=validateNumbers(t);return numeral(math.mean(...a)).format(e||"00.00")}catch(e){return console.log("ðŸš€ ~ file: drapcode.js:174 ~ average ~ error:",e),""}},multiply=function(e,{numbers:t}){try{t=(t=Array.isArray(t)?t:[t,1]).map(e=>isNaN(e)?1:e);var a=validateNumbers(t);return numeral(math.multiply(...a)).format(e||"00.00")}catch(e){return console.log("ðŸš€ ~ file: drapcode.js:182 ~ multiply ~ error:",e),""}},divide=function(e,{number1:t,number2:a}){try{var o=checkAndConvertNumber(t),r=checkAndConvertNumber(a);return numeral(math.divide(o,r)).format(e||"00.00")}catch(e){return console.log("ðŸš€ ~ file: drapcode.js:190 ~ divide ~ error:",e),""}},evaluateExpression=function(e,t,a,o,r,s,n,i,l){e=e?getSpecialCharectorReplacedExpression(e):" ";e=replaceFieldsValueIntoExpression(e,t,a,r,s,n,i,l);try{return numeral(math.evaluate(e)).format(o||"00.00")}catch(e){return""}},evaluateCurrency=function(e,t,a,o,r){try{t=t||0,r||0===r||(r=2);var s=Math.pow(10,r||0),n=Math.round(t*s)/s;switch(t=new Intl.NumberFormat(e,{minimumFractionDigits:r}).format(n),o){case"FRONT":return""+a+t;case"FRONT_WITH_SPACE":return a+" "+t;case"BACK":return""+t+a;case"BACK_WITH_SPACE":return t+" "+a;default:return""}}catch(e){return""}},evaluateJSLogic=function(e,t,a,o,r,s,n,i){e=e?getSpecialCharectorReplacedExpression(e):" ";e=replaceFieldsValueIntoExpression(e,t,a,o,r,s,n,i);try{return new Function(e.toString())()}catch(e){return""}},replaceFieldsValueIntoExpression=function(n,i={},l={},c=[],d=[],u=[],p,m,g=[],f=[],S=[],y={}){return(n.match(/{{(.*?)}}/g)?.map(e=>e.replace(/{{(.*?)}}/g,"$1")))?.forEach((a,e)=>{var t=`{{${a}}}`;a=v.trim(a);let o="";var r=["RF::","PC::","CC::","current_user_reference_field.","createdBy.","environment_variable.","current_session.","form_data_session."].some(e=>a.includes(e));if(a.includes("current_user"))if((a=a.replace("current_user.","")).startsWith("DF::")){let t=a.replace("DF::","");var s=S.find(e=>e.name===t);o=prepareFunction(s,l,c,d,f)}else 0<Object.keys(l).length&&(o=parseValueFromData(l,a));else if(a.startsWith("PAGE::")){s=a.replace("PAGE::","");o=parseValueFromData(y,s)}else if(a.startsWith("DF::")){let t=a.replace("DF::","");s=g.find(e=>e.name===t);o=prepareFunction(s,i,c,d,u)}else r?o=getArgsFromKey(a,i,l,c,d,u,p,m):0<Object.keys(i).length&&(o=parseValueFromData(i,a));console.log("replaceFieldsValueIntoExpression",t,o,n),n=replaceValueInExpression(t,o,n)}),console.log("expression",n),n},replaceValueInExpression=function(e,t,a){e=new RegExp(e,"ig");return a.replace(e,t=t||"")},substraction=function(e,{numbers1:t,numbers2:a}){try{var o=Array.isArray(t)?math.add(...t):t,r=Array.isArray(a)?math.add(...a):a;return numeral(math.subtract(o,r)).format(e||"00.00")}catch(e){return console.log("ðŸš€ ~ file: drapcode.js:343 ~ substraction ~ error:",e),""}},count=function(e,t,a,o,r){if(!optionTypes.includes(r))return!1;switch(t){case EQUALS:e=e.filter(e=>e[a].includes(o));break;case NOT_EQUAL:e=e.filter(e=>!e[a].includes(o))}return e.length},percentage=function(e,t,a,o,r,s){var n=e.length;return n?(e=(e=e.filter(e=>!!optionTypes.includes(r)&&(t===EQUALS?e[a].includes(o):t===NOT_EQUAL?!e[a].includes(o):void 0))).length,s.includes("%")?numeral(math.divide(e,n)).format(s):e+"/"+n):"0"},findRecord=function(e,t,a){return"FIRST_RECORD"===a?e[0][t]:"LAST_RECORD"===a?e[e.length-1][t]:void 0},formatDate=function(e,t,a,o,r=!1){let s=o&&"SEC"===o?moment(1e3*t):moment(t);return r&&(s=s.utcOffset(a)),"FROM_NOW"===e?t?s.fromNow():"":t?s.format(e):""},dateDifference=(e,t,a,o)=>{let r="",s=!t||!a,n=("CURRENT_DATE_TIME"===t?moment():moment(t)).utcOffset(o),i=("CURRENT_DATE_TIME"===a?moment():moment(a)).utcOffset(o),l=e.split(",");return l.forEach((e,t)=>{var a=n.diff(i,e);a<0?n.subtract(a,e):i.add(a,e),r+=`${Math.abs(s?0:a)} ${e.charAt(0).toUpperCase()+e.slice(1)}${t===l.length-1?"":","} `}),r},dateAdd=(e,t,a,o)=>{let r="";e="CURRENT_DATE_TIME"===e?moment():moment(e);return r=e.add(t,a),r="FROM_NOW"===o?r.fromNow():r.format(o)},beautifyList=(e,t,a,o)=>{if(a=Number(a),!e)return"";a=a||e.length,"FIRST"===t&&(e=e.slice(0,a)),"LAST"===t&&(e=e.slice(-a));let r="";return r="BADGES"===o?e.map(e=>`<span class="badge badge-primary bg-primary blist-badge">${e}</span>`).join(" "):"ORDERED_LIST"===o?`<ol class="blist-ol">${e.map(e=>`<li class="blist-li" >${e}</li>`).join("")}</ol>`:`<ul class="blist-ul">${e.map(e=>`<li class="blist-li" >${e}</li>`).join("")}</ul>`},parseValueFromData=(e,o,t,a,r)=>{let s="";var n;if(o&&o.includes("functionType"))return o=o.replaceAll("'",'"'),n=JSON.parse(""+o),s=(s=prepareFunction(n,e,t,a,r))&&"undefined"!=s&&"undefined"!==s?s:"";if(o&&o.includes(".")){var i=o.split(".");let t,a=e||"";for(let e=0;e<i.length;e++){if("userSettingId"===(t=i[e])&&Array.isArray(a.userSettingId)&&1<a.userSettingId.length){let t=fetchCurrentTenantJson();a.userSettingId=a.userSettingId.find(e=>e.tenantId[0]===t.uuid)||{}}Array.isArray(a)&&(a[t]=a.map(e=>{if(e[t])return e[t]})),a[t]||(a[t]=""),a=a[t]}s=a||"",Array.isArray(s)&&(s=s.filter(()=>!0))}else s=e?e[o]:"";return s&&Array.isArray(s)&&1===s.length?s[0]:s&&Array.isArray(s)&&"string"==typeof s[0]?s.join(","):s=s&&"undefined"!=s&&"undefined"!==s?s:0===s?"0":""},getIframeVideoUrlForYoutubeOrVimeo=(e,t,a)=>{var o;return"youtube"===a||"youtube-nocookie"===a?(o=t.match(/^.*(youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#\&\?]*).*/))&&o[2]?"youtube"===a?e.slice(0,30)+o[2]+e.slice(30):e.slice(0,39)+o[2]+e.slice(39):"":"vimeo"===a?(o=t.match(/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/))&&o[3]?e.slice(0,31)+o[3]+e.slice(31):"":void 0},createLoggerDateFormat=()=>moment().format("YYYY-MM-DD"),createLogsDateFormat=()=>moment().format("YYYY-MM-DDTHH:mm:ss.SSS"),nextDayDate=e=>(e=new Date(e),moment(e).add(1,"days").format("YYYY-MM-DD")),convertTimeStampToDate=(e,t=!1)=>{var a,o=+document.getElementById("project-timezone").innerText||0;return e?(a=10<e.length?"Do MMM YYYY, h:mm a":document.getElementById("dateTimeFormat").innerText,(t?moment(e,[a,"YYYY-MM-DDTHH:mm:ss"]).utcOffset(o):moment(e,[a,"YYYY-MM-DDTHH:mm:ss"])).format(a)):""},isEmpty=e=>0===Object.keys(e).length,getIPAddress=async()=>{var e=getCookie("userIPAddress");if(e)return e;try{var t=await fetch("https://api.ipify.org");return t.ok?(setCookie("userIPAddress",e=await t.text(),1,!1),e):(console.error(`HTTP error! Status: ${t.status} in getIPAddress`),"")}catch(e){return console.error("Failed to fetch IP address:",e),""}},getPageItemData=async()=>{let e={};var t={},a=(window.location.search,window.location.pathname.split("/")),o=a[a.length-2],a=a[a.length-1];let r="COLLECTION";var s=window.document.getElementById("project-page-external-api");return s&&initialiseExternalApiDataFromSpan(s,t),t.id&&(r="EXTERNAL_API"),e="EXTERNAL_API"===r?(console.log("processing for non-persistent item... "),await doProcessForNonPersistentData(a,o,t)):await doProcessForCollectionData(a,o)},searchQueryStringFromUrl=async function(){return new URL(window.location.href).search},isLoggedInUser=()=>!!localStorage.getItem("user"),isLoggedInTenant=()=>!!localStorage.getItem("tenant"),isLoggedInUserSetting=()=>!!localStorage.getItem("userSetting"),fetchLoggedInUser=()=>localStorage.getItem("user"),fetchCurrentTenant=()=>localStorage.getItem("tenant"),fetchCurrentUserSetting=()=>localStorage.getItem("userSetting"),isLoggedInUserRole=e=>localStorage.getItem("role")===e,searchQueryFromURL=async function(){var e=await searchQueryStringFromUrl();if(0<e.length){let o=new URLSearchParams(e);e=document.querySelectorAll("[data-gjs=page-search-form]");e&&e.forEach(e=>{for(var t of o.keys()){var a=e.querySelector("[name="+t+"]");a&&(a.value=o.get(t))}})}},renderAutoComplete=async(e,t,a,o)=>{t&&a&&(t=`collection-table/${t}/finder/${a}/items`,a=validateCookieToken())&&(a=a.headers,$("#"+e.id).select2({ajax:{url:SERVER_URL+t,dataType:"json",headers:a,data:function(e){return{[o]:e.term,offset:10*(e.page||0),limit:10}},processResults:function(e,t){let a=[];return 0<e.length&&e.forEach((e,t)=>{e&&(0<Object.keys(e).length?e.uuid?a.push({id:e.uuid,text:e[o]}):a.push({id:e[o],text:e[o]}):a.push({id:e,text:e}))}),t.page=t.page||0,{results:a,pagination:{more:10*t.page<a.length}}},cache:!0},placeholder:"Search ...",minimumInputLength:2}))},renderAutoCompleteInput=async(t,e,o,r)=>{if(console.log("ðŸš€ ~ rendering AutoCompleteInput..."),e&&o&&r){e=`collection-table/${e}/finder/${o}/items`,o=await securedGetCall(e);if(o&&200===o.status){e=(o||"").data;let a=[];if(e&&0<e.length&&(e.forEach((e,t)=>{e&&0<Object.keys(e).length&&a.push(e[r])}),a)&&a.length){let e=t.querySelector('input[gjs-type="autocomplete-input"]');(e=e||t.querySelector("input"))&&autocompleteInput(e,a)}}}},renderPageListComponent=async e=>{console.log("*** rendering Page List component...");try{var t=createContentPlaceholder(1,e.id,e.className),a=(e.innerHTML=t,await securedGetCall("projects/pages"));if(a&&200===a.status){var o=(a||"").data;e.innerHTML="";let s=document.createElement("ul");o.map((e,t)=>{var{name:e,slug:a}=e,t=t+1,o=document.createElement("li"),r=(o.classList.add("page-nav-li","list-inline-item"),document.createElement("a"));r.href="/"+a,r.classList.add("page-nav-link"),r.classList.add("link-"+t),r.textContent=e,o.appendChild(r),s.appendChild(o)}),e.appendChild(s)}}catch(e){console.log("Error: ",e)}},addExternalQueryParamInUrl=(e,t,a)=>{var o=e.includes("?");let r="";o||(e+="?");var s,n=t.attributes,i=[];for(s in n){var l=n[s];"object"==typeof l&&l.name.includes("external-params-")&&i.push({[l.name.replace("external-params-","")]:l.value})}return i&&0<i.length&&i.forEach(e=>{var t=Object.keys(e),e=e[t];e&&a&&(e=a[e])&&(r+=`&${t}=`+e)}),e=o?""+e+r:""+e+r.substr(1,r.length+1)},loadDynamicFilterDataIntoElements=async(e=!1,t=!1)=>{let a=window.document.querySelectorAll("[data-filter-collection]"),r=(e&&(a=t?[]:document.querySelectorAll("[id^=modal-container] [data-filter-collection]")),await getPageItemData()).itemData;a.forEach(async e=>{var t=e.getAttribute("data-filter-id"),a=e.getAttribute("data-filter-collection"),o=`collection-table/${a}/finder/${t}/items`,o=addExternalQueryParamInUrl(o,e,r),a=(o=await addEntityQueryToUrl(o,a,t),await securedGetCall(o)),t=a.data;a&&"object"!=typeof t&&(e.textContent=t,e.style.display="block")})},loadDynamicSelectOptions=(e,t,a,o,r=!1,s="FILTER",n="",i=null,l="")=>{initializeSelect2(e);var c,d,{field:t,currentUserField:n}=loadCollectionFieldAndUserField(t,n),l=loadTenantField(l);let u="";n?u=n:l&&(u=l),referenceOptionType.includes(t.type)&&u&&(l=u.meta,c=l?.from,currentOptions.includes(c)&&(d=e.getAttribute("name")).startsWith(c+".")&&(d=d.split(c+".")[1],e.setAttribute("name",""+d)),t.isMultiSelect&&(l||e.setAttribute("name",t.fieldName+"[]"),e.setAttribute("multiple","multiple")),e.setAttribute("placeholder","Select "+t.fieldTitle.en)),r=r||!!e.closest("form").closest("div[id^=modal-container-]"),t&&("static_option"===t.type?o?applyWorkflowForStaticOptions(e,o,t,i,r):(c={field:t,select:e,isModal:r,collectionItemData:i,workflowData:"",dropdownDataFrom:s,currentUserField:n},staticOptions(c)):referenceDynamicType.includes(t.type)?(d={field:t,select:e,finderUuid:a,isModal:r,collectionItemData:i,queryParams:"",isRadioType:!1,isSetEmpty:!1,dropdownDataFrom:s,storageField:u},referenceAndDynamicOptions(d)):["template_option"].includes(t.type)&&tenantTemplateOptions(t,e))},loadCollectionFieldAndUserField=(e="",t="")=>{e=e?e.replaceAll("'",'"').replaceAll('\\"','"'):"",e=e?JSON.parse(e):"",t=t?t.replaceAll("'",'"').replaceAll('\\"','"'):"";return{field:e,currentUserField:t?JSON.parse(t):""}},loadTenantField=e=>{e=e?e.replaceAll("'",'"').replaceAll('\\"','"'):"";return e?JSON.parse(e):""},loadDynamicSelectOptionsForRadio=async(e,t,a,o,r=!1,s=null)=>{t=t?t.replaceAll("'",'"').replaceAll('\\"','"'):"",t=t?JSON.parse(t):"";t&&(r=r||!!e.closest("form").closest("div[id^=modal-container-]"),"static_option"===t.type?o?await applyWorkflowForStaticOptions(e,o,t,s,r):staticOptionsForRadio(t,e,r,s):referenceDynamicType.includes(t.type)?(o={field:t,select:e,finderUuid:a,isModal:r,collectionItemData:s,queryParams:"",isRadioType:!0,isSetEmpty:!0,dropdownDataFrom:"",storageField:""},referenceAndDynamicOptions(o)):"boolean"===t.type&&await booleanFieldValue(t,e,r,s))},loadSearchFormDynamicSelectOptions=(e,t,a,o="FILTER",r="",s="")=>{initializeSelect2(e);var t=t?JSON.parse(t):"",r=r?JSON.parse(r):"",s=loadTenantField(s);let n="";r?n=r:s&&(n=s),referenceOptionType.includes(t.type)&&e.setAttribute("placeholder","Select "+t.fieldTitle.en),t?"static_option"===t.type?(s={field:t,select:e,isModal:!1,collectionItemData:null,workflowData:"",dropdownDataFrom:o,currentUserField:r},staticOptions(s)):referenceDynamicType.includes(t.type)&&(r={field:t,select:e,finderUuid:a,isModal:!1,collectionItemData:null,queryParams:"",isRadioType:!1,isSetEmpty:!1,dropdownDataFrom:o,storageField:n},referenceAndDynamicOptions(r)):e&&0<e.length&&$("#"+e.id).select2({selectionCssClass:":all:",width:"resolve"}).val("").trigger("change")},staticOptionsForRadio=(e,l,t=0,a,o=null)=>{let r=[`<option value="">- Select ${e.fieldTitle.en} -</option>`];if(o){var{workflowRule:o,itemCurrentValue:s}=o;s&&(r=r.concat(`<option value="${s}">${s}</option>`)),o&&(r=r.concat(o.nextValue.map(e=>`<option value="${e.label}">${e.label}</option>`)))}else{let n=document.createElement("div");s=l.parentNode.getAttribute("id");let i=s||"radio";e.staticOptions.map(e=>{var t=l.parentNode.cloneNode(!0),a=(t.setAttribute("id",i+"-"+e),t.getElementsByTagName("input")),o=t.getElementsByTagName("label"),r=a[0].getAttribute("id"),s=o[0].getAttribute("id"),s=""===s&&s?s:"label-"+r+"-"+e;a[0].setAttribute("value",e),a[0].setAttribute("id",r+"-"+e),o[0].setAttribute("for",r+"-"+e),o[0].setAttribute("id",""+s),o[0].innerText=e,n.appendChild(t)}),l.parentNode.replaceWith(...n.childNodes)}},staticOptions=async({field:t,select:a,isModal:e,collectionItemData:o,workflowData:r,dropdownDataFrom:s})=>{let n=[`<option value="">- Select ${a&&a.hasAttribute("removeFieldnameInDropdownPlaceholder")?"":t.fieldTitle.en} -</option>`];if(r){var{workflowRule:r,itemCurrentValue:i}=r;i&&(n=n.concat(`<option value="${i}">${i}</option>`)),r&&(n=n.concat(r.nextValue.map(e=>`<option value="${e.label}">${e.label}</option>`)))}else if("NONE"!==s){a.removeAttribute("data-placeholder");let e="";i=a.dataset,r=(i&&i.hasOwnProperty("externalApiId")&&(e=i.externalApiId,console.log("ðŸš€ ~ External API:",e)),e?"EXTERNAL_API":"STATIC_OPTION");console.log("ðŸš€ ~ Loading Options From:",r),"EXTERNAL_API"==r?await loadOptionsFromExternalApiData(a,n):n=loadOptionsFromStaticData(n,t)}a.innerHTML=n.join(""),await setPredefinedValuesInSelect(a,t,e,o)},loadTenantRoleMappingSelectOptions=(e,a)=>{if(console.log("ðŸš€ ~ file: drapcode.js:1213 ~ loadTenantRoleMappingSelectOptions ~ select:",e),console.log("ðŸš€ ~ file: drapcode.js:1213 ~ loadTenantRoleMappingSelectOptions ~ isModal:",a),e){initializeSelect2(e);let o=[];a=e.dataset;console.log("ðŸš€ ~ file: drapcode.js:1221 ~ loadTenantRoleMappingSelectOptions ~ componentDataSet:",a),a&&Object.entries(a).length&&Object.entries(a).map(([e,t],a)=>{e.startsWith("role-")&&(e=e.replace(/role-(.*?)/g,"$1"),o.push({order:Number(e),value:t}))}),console.log("ðŸš€ ~ file: drapcode.js:1226 ~ loadTenantRoleMappingSelectOptions ~ roles:",o),e.setAttribute("placeholder","Select Tenant Role Mapping");let t=['<option value="">- Select Role -</option>'];o&&o.length&&o.sort((e,t)=>e.order-t.order).map(e=>{t=t.concat(`<option value="${e.value}">${e.value}</option>`)}),e.innerHTML=t.join(""),$("#"+e.id).select2({selectionCssClass:":all:",width:"resolve"}).val("").trigger("change");var r,a=document.getElementById(e.id);a&&(r=a.nextSibling,swapNodeElements(a,r),validateSelectElement(e))}},addDynamicDataIntoFormElements=async(t=null,a=!1,e="")=>{if(!t){let e={};t=(e=a?await getModalItemData(t):await getPageItemData()).itemData}let o=fetchLoggedInUserJson();var r=JSON.parse(sessionStorage.getItem("previousActionResponse")),s=JSON.parse(sessionStorage.getItem("previousActionFormData"));let n=fetchCurrentTenantJson(),i=fetchCurrentUserSettingsJson(),l="";l=a?(e||document).querySelectorAll("[id^=modal-container] form"):(e||document).querySelectorAll("form");var c="data-form-element-previous-action-response",d="data-form-element-previous-action-formdata",u="data-form-element-collection";let p="data-form-element-session";var m="data-form-element-browser-storage";let g="data-form-element-session-tenant",f="data-form-element-session-user-settings";var S,v="data-form-element-bsl";for(S of l){var y,h=S.querySelectorAll(`[${u}]`),A=S.querySelectorAll(`[${p}]`),E=S.querySelectorAll(`[${c}]`),I=S.querySelectorAll(`[${d}]`),b=S.querySelectorAll(`[${m}]`),w=S.querySelectorAll(`[${g}]`),T=S.querySelectorAll(`[${f}]`),C=S.querySelectorAll("[data-form-element-query-params]"),O=S.querySelectorAll(`[${v}]`);A.forEach(e=>{var t=e.getAttribute(p),t=o&&t?parseValueFromData(o,t):"";insertFormElementValue(t,e)});for(y of h){var R=y.getAttribute(u);let e=t&&R?parseValueFromData(t,R):"";e||"number"!==y.type||(e="0"),console.log(`fieldValue ${e} collectionFormElements`),e&&"undefined"!==e&&(insertFormElementValue(e,y),a)&&("SELECT"===y.tagName?setPredefinedValuesInSelect(y,"",a,t):(R=(R=y.getAttribute("data-collection-field")?y.getAttribute("data-collection-field"):"")?JSON.parse(R):"")&&"boolean"===R.type&&await booleanFieldValue(R,y,a,t))}w.forEach(e=>{var t=e.getAttribute(g),t=n&&t?parseValueFromData(n,t):"";console.log("I am culprit tenantFieldElems"),insertFormElementValue(t,e)}),T.forEach(e=>{var t=e.getAttribute(f),t=i&&t?parseValueFromData(i,t):"";console.log("I am culprit userSettingFieldElems"),insertFormElementValue(t,e)}),replaceSessionDataIntoForm(E,r,c),replaceSessionDataIntoForm(I,s,d),replaceBrowserStorageDataIntoForm(b,m),replaceQueryParamsDataIntoForm(C),renderBSLDataIntoFormElements(O,v,"data-form-element-bslp")}},replaceSessionDataIntoForm=(e,o,r)=>{e.forEach(t=>{var e=t.getAttribute(r),e=e?e.trim().split("|"):[];let a=!0;e.forEach(e=>{e&&a&&(e=o?_.get(o,e.trim()):"")&&"undefined"!==e&&"null"!==e&&(a=!1,insertFormElementValue(e,t))})})},replaceBrowserStorageDataIntoForm=(e,o)=>{e.forEach(e=>{var t=e.getAttribute(o),a=parseLSJSONStrToJSON(e.getAttribute("data-storage-key"));t&&(a=a?parseValueFromData(a,t.trim()):"")&&"undefined"!==a&&"null"!==a&&insertFormElementValue(a,e)})},replaceQueryParamsDataIntoForm=e=>{try{if(e&&e.length){let o=getURLParams();o&&e.forEach(e=>{var t,a=e.getAttribute("data-form-element-query-params");a?(a=a.trim())&&o.hasOwnProperty(a)?(t=o[a])&&"undefined"!==t&&"null"!==t?insertFormElementValue(t,e):console.warn("Param value is invalid:",t):console.warn("Param name not found in URL:",a):console.warn("Element does not have the expected data-form-element-query-params attribute.")})}else console.log("No queryParamsElements found.")}catch(e){console.error("Error in replaceQueryParamsDataIntoForm:",e)}},getURLParams=()=>{try{var e,t,a=new URLSearchParams(window.location.search),o={};for([e,t]of a.entries())o[e]=t;return o}catch(e){return console.error("Error while getting URL Params",e),null}},insertFormElementValue=(t,a)=>{let o="";if((e=!!a.closest("form").closest("[id^=modal-container]"))&&(r=a.getAttribute("data-collection-field")?a.getAttribute("data-collection-field"):"",o=r?JSON.parse(r):""),console.log("ðŸš€ ~ file: drapcode.js:1357 ~ insertFormElementValue ~ element:",a," ~ element.type:",a.type," ~ element.getAttribute(type):",a.getAttribute("type")," ~ isModal:",e),isCheckbox(a)){if((t=t&&Array.isArray(t)&&t.length&&"string"==typeof t[0]?t.join(","):t)&&!["boolean","object"].includes(typeof t)&&t.includes(",")){var r=t.split(",");r&&r.includes(a.value)&&(a.checked=!0)}else if(t&&truthyValues.includes(a.value)===t)a.checked=!0;else if(e&&o&&"reference"===o.type){let e=t.uuid;t&&Array.isArray(t)?(e=t.find(e=>e.uuid===a.value))&&a.value===e.uuid&&(a.checked=!0):e&&a.value===e&&(a.checked=!0)}}else if(isRadio(a)){if((t=t&&Array.isArray(t)&&1===t.length?t[0]:t)&&a.value===t)a.checked=!0;else if(e&&o&&"reference"===o.type){let e=t.uuid;t&&Array.isArray(t)?(e=t.find(e=>e.uuid===a.value))&&a.value===e.uuid&&(a.checked=!0):e&&a.value===e&&(a.checked=!0)}}else if("file"===a.type){var e,r=a.parentElement.getElementsByClassName("file-list-display")[0];t&&"object"==typeof t&&(r.innerHTML=t.originalName),t&&Array.isArray(t)&&(e=t.map(e=>e.originalName||""),r.innerHTML=e.join(",")),a.parentElement.querySelector(`input[name="${a.name}"][type='hidden']`).value="object"==typeof t?JSON.stringify(t):""}else if(["date","datetime-local"].includes(a.type))"date"===a.type&&(a.type="text"),a.value=t,addFlatPickerToElement(a);else if("SELECT"===a.tagName){let e=setSelectedOnDropdown(t);console.log("ðŸš€ ~ insertFormElementValue SELECT ~ value:",e,"~ field:",o);r={selectionCssClass:":all:",width:"resolve"};"search-form"===a.closest("form").getAttribute("data-gjs")?r.multiple=!1:o?r.multiple=o.isMultiSelect:"select-multiple"===a.type?r.multiple=!0:e&&Array.isArray(e)?r.multiple=1<e.length:e&&e.includes(",")&&Array.isArray(e.split(","))&&(r.multiple=0<e.split(",").length),console.log("ðŸš€ ~ insertFormElementValue ~ selectOptions['multiple']:",r.multiple),e=processSelectOptionValue(r.multiple,e),$(a).select2(r).val(e).trigger("change")}else"TEXTAREA"===a.tagName&&a.hasAttribute("data-show-editor")?$(a).summernote("code",t):"tel"===$(a).attr("type")?($(a).intlTelInput(),$(a).intlTelInput("setNumber",t)):"text"===a.getAttribute("type")&&"datetime-local"===a.getAttribute("flat-picker-date-type")?(a.type="datetime-local",a.value=t,addFlatPickerToElement(a)):"text"===a.getAttribute("type")&&"time_picker"===a.getAttribute("data-component-type")?(a.value=t,addTimePickerToElement(a,t)):a.value=t=t&&"undefined"!=t&&"undefined"!==t?t:0===t?0:""},renderBSLDataIntoFormElements=(e,r,s)=>{e&&e.forEach(t=>{if(!!!t.closest('[data-js="data-group"] ')){let e="";var a=t.getAttribute(r),o=t.getAttribute(s),a=getBSLData(a);(e=a?a&&o?_.get(a,o.trim()):"":e)&&"undefined"!==e&&"null"!==e&&insertFormElementValue(e,t)}})},collectionFormDetailForUpdate=(e,t)=>{e.method="put",e.setAttribute("action",e.getAttribute("action")+"/"+t.uuid)},isCheckbox=e=>"checkbox"===e.type,isRadio=e=>"radio"===e.type,isMultiSelect=e=>e.options&&e.multiple,timestampToDatetimeInputString=e=>new Date(e+_getTimeZoneOffsetInMs()).toISOString().slice(0,19),applyWorkflowForStaticOptions=async(e,a,t,o,r)=>{let s,n={},i=extractCollectionAndItemIdFromPath().collectionId;var l=await getPageItemData();let c=l.itemData;l=`collection-details/${i=(i=l.collectionId)||e.closest("form").getAttribute("data-form-collection")}/name`,await publicGetCall(l).then(e=>{var t;e.data&&e.data.workflows&&(e=e.data.workflows,s=e.filter(e=>e.uuid===a)[0])&&(e=(n.selectedWorkflow=s).workflowRules,(t=c&&c[s.keyField.value]?c[s.keyField.value].join(""):"")?fetchWorkflowRuleForItemValue(n,e,t):fetchWorkflowRuleForEmptyItemValue(n,e),n.itemCurrentValue=t)}),l={field:t,select:e,isModal:r,collectionItemData:o,workflowData:n,dropdownDataFrom:"",currentUserField:""};staticOptions(l)},fetchWorkflowRuleForItemValue=(e,t,a)=>{e.workflowRule=t.filter(e=>e.currentValue&&e.currentValue.label===a&&e.role&&isLoggedInUserRole(""+e.role.value))[0],e.workflowRule||(e.workflowRule=t.filter(e=>!e.role&&e.currentValue&&e.currentValue.label===a)[0])},fetchWorkflowRuleForEmptyItemValue=(e,t)=>{e.workflowRule=t.filter(e=>!e.currentValue&&e.role&&isLoggedInUserRole(""+e.role.value))[0],e.workflowRule||(e.workflowRule=t.filter(e=>!e.currentValue&&!e.role)[0])},extractCollectionAndItemIdFromPath=()=>{let e="";var t=window.location.pathname.split("/"),a=t[t.length-2];return{collectionItemId:e=(e=t[t.length-1])&&e.includes("_")?e.split("_")[1]:e,collectionId:a}},doProcessForCollectionData=async(t,a)=>{let o={};if(a&&t){t.includes("_")&&(t=t.split("_")[1]);let e={};var r;"reset-password"!==a&&(r=await getCollectionItemByIdDetailsPage(a,t,!0),e=r?{...r}:{}),o={itemData:e,collectionId:a,collectionItemId:t}}return o},doProcessForNonPersistentData=async(a,e,t)=>{let o={};var r;let s={};var n="external-api";let{id:i,uniqueKey:l,itemPath:c,responseMapping:d,requestMapping:u}=t;if(a){let t=e?a:uuidv4(16);t=replaceUnderscoreWithSlash(t),o.externalApiItem={id:t,uuid:t,_data_source_rest_api_primary_id:t,uniqueKey:l,pageCollectionName:e,nonPersistentCollectionItemId:t},u&&0<u.length&&u.forEach(e=>{"uuid"==e.value&&(o.externalApiItem[e.key]=t)})}t=getBrowserData(),console.log("ðŸš€ ~ file: drapcode.js:1802 ~ doProcessForNonPersistentData ~ browserData:",t),t={data:o,externalApiId:i,browserStorageDTO:t};console.log("URL :>> ",n),console.log("Body :>> ",t);try{if(r=await unSecuredPostCall(t,n),console.log("ðŸš€ ~ file: drapcode.js:1912 ~ doProcessForNonPersistentData ~ response:",r),(200===r.status||"success"==r.status)&&r.data){console.log("ðŸš€ ~ process for non-persistent itemPath:",c),console.log("ðŸš€ ~ process for non-persistent response data:",r.data);var p=_.has(r.data,c);console.log("ðŸš€ ~ process for non-persistent isItemPathExist:",p);let t=p?r.data[c]:r.data;if(t&&!Array.isArray(t)){let e=[];e.push(t),void 0===(s=e&&e.length?e.find(e=>e[l]==a):{})&&Object.keys(t).some(function(e){return t[e]&&"object"==typeof t[e]})&&(e=Object.keys(t).map(e=>t[e]||""),s=e&&e.length?e.find(e=>e[l]==a):{},console.log("==> itemData #1 :>> ",s)),void 0===s&&(s=e&&e.length?t:{},console.log("==> itemData #2 :>> ",s))}else s=t&&t.length?t.find(e=>e[l]==a):{}}}catch(e){console.log("%c==> error :>> ","color:red",e)}return{itemData:buildItemData(s,d,a,l),collectionId:e,collectionItemId:a}},initialiseExternalApiData=(e,t)=>{var{uuid:e,responseDataMapping:a,bodyDataFrom:o,collectionMapping:r}=e,s=(a||"").itemPath,n=(a||"").selectedMapping;let i="";n&&(i=n._data_source_rest_api_primary_id||""),t.id=e,t.uniqueKey=i||"id",t.itemPath=s,t.dataFrom=o,t.responseMapping=a,t.requestMapping=r},initialiseExternalApiDataFromSpan=(e,t)=>{let a="";let o="";var r,s=e.getAttribute("data-external-api-id")?e.getAttribute("data-external-api-id").trim():"",n=e.getAttribute("data-external-api-unique-key")?e.getAttribute("data-external-api-unique-key").trim():"",i=e.getAttribute("data-external-api-item-path")?e.getAttribute("data-external-api-item-path").trim():"",l=e.getAttribute("data-external-api-data-from")?e.getAttribute("data-external-api-data-from").trim():"";a=e.getAttribute("data-external-api-response-mapping")?e.getAttribute("data-external-api-response-mapping").trim():"",o=e.getAttribute("data-external-api-request-mapping")?e.getAttribute("data-external-api-request-mapping").trim():"",a=a?a.replace(/'/g,'"'):"",o=o?o.replace(/'/g,'"'):"",e=a?JSON.parse(a):"",r=o?JSON.parse(o):"",t.id=s,t.uniqueKey=n,t.itemPath=i,t.dataFrom=l,t.responseMapping=e,t.requestMapping=r},buildItemData=(n,a,e,t)=>{let i={},l=[];return a&&Object.keys(a).map(e=>{var t=e,e=a[e];e&&"object"==typeof e?l[t]?l[t].push(e):l[t]=e:l[e]?l[e].push(t):l[e]=[t]}),l?n&&(Object.keys(n).map(t=>{var e,a,o,r,s;l[t]&&((e=l[t])&&1<e.length?e.map(e=>{i[e]=n[t]}):e&&"object"==typeof e&&!Array.isArray(e)&&({dataSourceField:s,refCollectionField:a}=e||{},s)?(s=t+"."+s,r=_.has(n,s),o=_.has(n,t+"."+a),r?(r=n[t],i[t]=r,s=_.get(n,s),o||(r[a]=s,i[t]=r)):i[t]=""):i[e[0]]=n[t])}),Object.keys(l).filter(e=>e.includes(".")||e.includes("[")).map(a=>{var e,t=l[a];t&&1<t.length?t.map(e=>{var t=_.get(n,a);i[e]=t}):(e=_.get(n,a),i[t[0]]=e)})):i=n,i.uuid||(i.uuid=t&&n&&n.hasOwnProperty(t)?n[t]:e),i._data_source_rest_api_primary_id||(i._data_source_rest_api_primary_id=t&&n&&n.hasOwnProperty(t)?n[t]:e),i.isNonPersistentCollection||(i.isNonPersistentCollection=!0),i.nonPersistentCollectionResponseMapping||(i.nonPersistentCollectionResponseMapping=a),i},checkAndOverrideFieldForNonPersistentCollection=(e,t)=>(console.log("item data: ",e),console.log("field name #1: ",t),e.hasOwnProperty("isNonPersistentCollection")&&e.isNonPersistentCollection&&e.hasOwnProperty("nonPersistentCollectionResponseMapping")&&(e=e.nonPersistentCollectionResponseMapping[t])&&e.includes(".")&&(t=e),console.log("field name #2: ",t),t);async function loadOptionsFromExternalApiData(t,a){let o="",r="",i="";var l={};let s={},n={};var c={},d={},u={},t=t.dataset,t=(t&&t.hasOwnProperty("externalApiId")&&(o=t.externalApiId),t&&t.hasOwnProperty("externalApiField")&&(r=t.externalApiField),t&&t.hasOwnProperty("externalApiFieldLabel")&&(i=t.externalApiFieldLabel),console.log(`ðŸš€ ~ External API: ${o} ~ External API Field: ${r} ~ External API Field Label: `+i),"external-api"),p=await publicGetCall(t+"/id/"+o);if(p&&200===p.status){var p=p.data,m=sessionStorage.getItem("previousActionResponse"),m=(m&&(m=JSON.parse(m),0<Object.keys(m).length)&&(s=getFinalSessionValues(s,m,p,"current_session")),sessionStorage.getItem("previousActionFormData")),m=(m&&(m=JSON.parse(m),0<Object.keys(m).length)&&(n=getFinalSessionValues(n,m,p,"form_data_session")),{sessionStorageData:getBrowserStorageValuesForExternalAPI(c,p,"SESSION_STORAGE"),localStorageData:getBrowserStorageValuesForExternalAPI(d,p,"LOCAL_STORAGE"),cookiesData:getBrowserStorageValuesForExternalAPI(u,p,"COOKIES")}),c=(checkAndLoadNonPersistentItemIdForSelect(l,p,!1),{data:l,externalApiId:o,sessionValue:s,sessionFormValue:n,browserStorageDTO:m});console.log("%c==> loadOptionsFromExternalApiData ~ body:","color:cyan",c);let e=null;if((d=await unSecuredPostCall(c,t))&&200===d.status&&(e=d.data),console.log("ðŸš€ ~ loadOptionsFromExternalApiData ~ response data:",e),e){u=(p||{}).responseDataMapping,l=(u||{}).selectedMapping;let s=extractNameFromExternalApiResponseMapping(l,r),n=extractNameFromExternalApiResponseMapping(l,i);console.log("ðŸš€ ~ loadOptionsFromExternalApiData ~ mapped fieldLabelName:",n,"mapped fieldName:",s);m=Array.isArray(e);console.log("ðŸš€ ~ loadOptionsFromExternalApiData ~ isResponseInArray:",m),m?(c=_.has(e[0],s),console.log("ðŸš€ ~ loadOptionsFromExternalApiData ~ else isPropertyExist:",c),(t=c&&e&&e.length&&e.map(o=>{if(console.log("ðŸš€ loadOptionsFromExternalApiData ~ else item:",o),_.has(o,s)){var r=_.get(o,s);let e=r,t=r,a=e=i&&_.has(o,s)?_.get(o,n):e;if(r&&"string"==typeof r&&r.includes("::")&&(o=r.split("::"))&&2===o.length&&(t=o[0].trim(),a=o[1].trim()),a)return`<option value="${t}">${a}</option>`}}))&&t.length&&a.push(t)):(d=_.has(e[0],s),console.log("ðŸš€ ~ loadOptionsFromExternalApiData ~ isPropertyExist:",d),(p=d&&Object.values(e).map(o=>{if(_.has(o,s)){var r=_.get(o,s);let e=r,t=r,a=e=i&&_.has(o,s)?_.get(o,n):e;if(r&&"string"==typeof r&&r.includes("::")&&(o=r.split("::"))&&2===o.length&&(t=o[0].trim(),a=o[1].trim()),a)return`<option value="${t}">${a}</option>`}}))&&p.length&&a.push(p))}}}function loadOptionsFromStaticData(e,t){return e=e.concat(t.staticOptions.map(e=>{let t=e,a=e;return e&&e.includes("::")&&(e=e.split("::"))&&2===e.length&&(t=e[0].trim(),a=e[1].trim()),`<option value="${t}">${a}</option>`}))}function _getTimeZoneOffsetInMs(){return-60*(new Date).getTimezoneOffset()*1e3}let setPredefinedValuesInSelect=async(e,a,o=!1,r=null)=>{let s="",n=e.getAttribute("data-form-element-collection");var i=e.getAttribute("data-select-autocomplete"),l=e.dataset&&e.dataset.hasOwnProperty("externalApiId");if(console.log("ðŸš€ ~ Is ExternalAPI:",l),l&&e.dataset&&e.dataset.hasOwnProperty("externalApiField")&&(n=e.dataset.externalApiField),!i){a||(a=(l=e.getAttribute("data-collection-field")?e.getAttribute("data-collection-field"):"")?JSON.parse(l):"",i=e.getAttribute("data-user-collection-field")?e.getAttribute("data-user-collection-field"):"",s=i?JSON.parse(i):"");let t="";if(n){let e={};o?e.itemData=r||MODAL_COLLECTION_ITEM_DATA||"":e=await getPageItemData();l=MODAL_COLLECTION_ITEM_DATA||r||e.itemData,i=(l&&(t=a.fieldName?parseValueFromData(l,a.fieldName):"",["reference","multi_reference","belongsTo"].includes(a.type)?Array.isArray(t)?t=t?t.map(e=>e.uuid):"":"object"==typeof t&&(t=t?t.uuid:""):"static_option"!==a.type&&"dynamic_option"!==a.type||(t=processSelectOptionValue(a.isMultiSelect,t))),s||"").meta;!i||"CURRENT_USER"!==i.from||(localStorage.getItem("user")?localStorage.getItem("user"):"")||(t="")}var o=e.getAttribute("data-form-element-session"),i=(o&&(l=(r=fetchLoggedInUserJson())&&o?parseValueFromData(r,o):"",t=setSelectedOnDropdown(l)),e.getAttribute("data-form-element-session-tenant")),l=(i&&(o=(r=fetchCurrentTenantJson())&&i?parseValueFromData(r,i):"",t=setSelectedOnDropdown(o)),e.getAttribute("data-form-element-session-user-settings")),o=(l&&(i=(r=fetchCurrentUserSettingsJson())&&l?parseValueFromData(r,l):"",t=setSelectedOnDropdown(i)),{selectionCssClass:":all:",width:"resolve"}),{extraFieldSetting:r={}}=("search-form"===e.closest("form").getAttribute("data-gjs")?o.multiple=!1:a?o.multiple=a.isMultiSelect:"select-multiple"===e.type?o.multiple=!0:t&&Array.isArray(t)?o.multiple=1<t.length:t&&t.includes(",")&&Array.isArray(t.split(","))&&(o.multiple=0<t.split(",").length),a),l=Array.isArray(r.staticDefaultValue)?r.staticDefaultValue:[],i=((!Array.isArray(t)||0===t.length)&&0<l.length&&(t=l),$("#"+e.id).select2(o).val(t).trigger("change"),document.getElementById(e.id));i&&(a=i.nextSibling,swapNodeElements(i,a),validateSelectElement(e))}},setSelectedOnDropdown=e=>{console.log("ðŸš€ ~ setSelectedOnDropdown ~ data:",e);let t=[];var a;return e?Array.isArray(e)&&1<e.length?e.forEach(e=>{t=getSelectedDropdownData(e,t)}):"object"==typeof e?t=getSelectedDropdownData(e,t):"string"==typeof e&&e&&e.includes(",")?(a=e.split(","),t.push(...a)):t.push(e):t=[""],t},getSelectedDropdownData=(e,t)=>("object"!=typeof e||Array.isArray(e)||null===e?Array.isArray(e)?t=[...t,...e]:t.push(e):t.push(e?.uuid),t),swapNodeElements=(e,t)=>{var a=e.parentNode,o=e.nextSibling===t?e:e.nextSibling;t.parentNode.insertBefore(e,t),a.insertBefore(t,o)},validateSelectElement=t=>{t&&t.id&&$("#"+t.id).on("select2:select",function(e){document.getElementById(t.id+"-error")&&$("#"+t.id).valid()})},dependentDropDownPopulateOnChange=async a=>{var e,t,o,r,s,n,i=isActionEnabled(a);console.log("ðŸš€ ~ dependentDropDownPopulateOnChange ~ actionEnabled:",i),i&&(new Promise(function(e,t){e(a)}),{element:i,parameters:n}=a,{collection:e,onChangeElementName:t,valuesToChangeElementName:n,field:o}=n,s=(n=JSON.parse(n)).fieldName,r=$(i).closest("form"),s=(r=$(r[0]).find(`select[name='${s}[]']`)[0]||$(r[0]).find(`select[name='${s}']`)[0]).getAttribute("data-select-finder-id"),n={field:n,select:r,finderUuid:s,isModal:!1,collectionItemData:null,queryParams:o+"="+i.value,isRadioType:!1,isSetEmpty:!i.value,dropdownDataFrom:"",currentUserField:""},referenceAndDynamicOptions(n))},referenceAndDynamicOptions=async({field:a,select:o,finderUuid:e,isModal:r,collectionItemData:s,queryParams:t,isRadioType:n,isSetEmpty:i,dropdownDataFrom:l,storageField:c})=>{let d=o.getAttribute("data-select-external-params"),u=o.getAttribute("label-field"),p=(r&&!s&&(s=MODAL_COLLECTION_ITEM_DATA),await getItemDataForElement(o)).itemData,m="";p&&d&&0<d.length&&(d=d.split(",")).forEach(e=>{var t=o.getAttribute(e.toLowerCase()),t=parseValueFromData(p,t);m+=`&${e}=`+t});var g=a.refCollection,g=(g||"").collectionName;let f=`collection-table/${g}/`;e&&(f+=`finder/${e}/`),f+="items/",t&&m?f+="?"+t+m:t?f+="?"+t:m&&(f+="?"+m.substring(1,m.length)),f+=`${f.includes("?")?"&":"?"}max=2000`,f=await addEntityQueryToUrl(f,g,e),"NONE"!==l&&await publicGetCall(f).then(e=>{var t;n?referenceOptionsForRadio(o,a,e.data,p):(o.removeAttribute("data-placeholder"),c&&(t=c.meta,t)&&currentOptions.includes(t.from)&&(a.isMultiSelect=(t.hasOwnProperty("isMultiSelect")?t:a).isMultiSelect,a.isMultiSelect||o.removeAttribute("multiple")),t={field:a,itemOptions:i||l&&"NONE"===l?[]:e.data,storageField:c,labelField:u,select:o},o.innerHTML=referenceOptions(t),!r||(s=s||MODAL_COLLECTION_ITEM_DATA)?setPredefinedValuesInSelect(o,a,r,s):setPredefinedValuesInSelect(o,a,r))})},referenceOptionsForRadio=(l,c,e,d)=>{let u=document.createElement("div"),p=l.parentNode.getAttribute("id");e.map(t=>{var e=l.parentNode.cloneNode(!0),a=(e.setAttribute("id",p+"-"+t.uuid),e.getElementsByTagName("input")),o=e.getElementsByTagName("label"),r=a[0].getAttribute("id"),s=o[0].getAttribute("id");let n="";d?n=d[c.fieldName]:MODAL_COLLECTION_ITEM_DATA&&(n=MODAL_COLLECTION_ITEM_DATA[c.fieldName]);var s=s||"label-"+r+"-"+t.uuid,i=t[c.refCollection.collectionField];"dynamic_option"===c.type?(a[0].setAttribute("value",i),(isRadio(a[0])||isCheckbox(a[0]))&&n&&n.length&&n.includes(i)&&(a[0].checked=!0)):(a[0].setAttribute("value",t.uuid),n&&Array.isArray(n)&&(n=n.find(e=>e.uuid===t.uuid)),(isRadio(a[0])||isCheckbox(a[0]))&&n&&t.uuid===n.uuid&&(a[0].checked=!0)),a[0].setAttribute("id",r+"-"+t.uuid),o[0].setAttribute("for",r+"-"+t.uuid),o[0].setAttribute("id",""+s),o[0].innerText=i,u.appendChild(e)}),l.parentNode.replaceWith(...u.childNodes)},referenceOptions=({field:s,itemOptions:e,storageField:a,labelField:n,select:t})=>{let i=[];var o=(a||"").meta;let l=o&&currentOptions.includes(o.from);if(l){let t="";if("CURRENT_USER"===o.from?t="user":"CURRENT_TENANT"===o.from&&(t="tenant"),t){o=parseLSJSONStrToJSON(t),a=a.fieldName?a.fieldName.split("."):[];let e="";2===a.length?e=a[0]+".[0]."+a[1]:1===a.length&&(e=""+a[0]),i=getContentFromSessionObject(o,e)}}let r=[`<option value="">- Select ${t&&t.hasAttribute("removeFieldnameInDropdownPlaceholder")?"":s.fieldTitle.en} -</option>`];if(r=r.concat(Array.isArray(e)?e.map(t=>{let a="";var o;a=n?parseValueFromData(t,n):(o=s.refCollection.collectionField,o=getLvl1CollRefFieldName(s,t,o),_.get(t,o));let r="dynamic_option"===s.type?a:t.uuid;if(a&&r){if(!l){if("dynamic_option"!==s.type)return`<option value="${r}">${a}</option>`;{let e=a,t=r;return t&&t.includes("::")&&(o=t.split("::"))&&2===o.length&&(t=o[0].trim(),e=o[1].trim()),`<option value="${t}">${e}</option>`}}if(i&&Array.isArray(i)){let e="";return(e=(e=i.find(e=>e["dynamic_option"===s.type?s.refCollection.collectionField:"uuid"]===r))||i.includes(t.uuid))||i&&i.includes(r)?`<option value="${r}">${a}</option>`:void 0}}}):""),l){let t=[];r.forEach(e=>{e&&t.push(e)}),r=[...t]}return[...new Set(r)].filter(()=>!0).join("")},loadDropzoneField=async(E,I,b,w)=>{if(Dropzone.autoDiscover=!1,E&&E.id&&b){var T=getClosest(E,"[data-js=collection-form], [data-js=sign-up-form]"),C=!!T.closest("[id^=modal-container]");let l=T?T.getAttribute("data-form-collection"):"master";getClosest(E,"[data-js=sign-up-form]")&&(l="user");let c="",e="__ssr_dp_colId",t="__ssr_dp_colItemId",{name:a,title:d,validation:o,isPrivate:u,refCollection:p,refCollectionField:m,required:g,maxSize:f,requiredErrorMessage:S}=(C&&(e="__ssr_dm_colId",t="__ssr_dm_colItemId"),C=sessionStorage.getItem(e),O=sessionStorage.getItem(t),C&&O&&(O=await doProcessForCollectionData(O,C),C=(console.log("loadDropzoneField ~ collectionItemResult:",O),O||{}).itemData,console.log("loadDropzoneField ~ itemData:",C),C)&&Object.entries(C).length&&(c={...C},console.log("loadDropzoneField ~ collectionItems #2:",c)),b),{noAllowedFiles:v,allowedFileTypes:y}=o,h=a,A=1<(v=(v=Number(v))||1);y=y?y.split(","):"";var O=SERVER_URL,C=(O+=`file/upload/${l}/`+h,console.log("ðŸš€ ~ file: drapcode.js:2007 ~ loadDropzoneField ~ endpoint:",O),validateCookieToken());if(C){let e=(await getHeaderForServerForPublicRequest(C)||"").headers;b={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":!0,"Access-Control-Allow-Headers":"Content-Type, X-Requested-With, X-File-Name, Cache-Control","Access-Control-Allow-Methods":"PUT, POST, GET, OPTIONS"};delete e["Content-Type"],e={...e,...b},console.log("ðŸš€ ~ file: drapcode.js:1973 ~ loadDropzoneField ~ headers:",e);let o=document.createElement("input"),t=(o.type="hidden",o.id=h,o.name=h,o.value="",I.appendChild(o),document.createElement("div")),r=(t.className="text-danger mt-1",t.style.display="none",t.textContent=S||d+" is required",E.parentNode.appendChild(t),[]),s=new Dropzone("div#"+E.id,{url:O,paramName:"file",uploadMultiple:!1,parallelUploads:v,autoProcessQueue:!0,addRemoveLinks:!0,maxFilesize:f||500,maxFiles:v,headers:e,dictDefaultMessage:`
      <div class="d-flex flex-column justify-content-center align-items-center">
      <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-cloud-arrow-up-fill" viewBox="0 0 16 16">
      <path d="M8 2a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13h8.906C14.502 13 16 11.57 16 9.773c0-1.636-1.242-2.969-2.834-3.194C12.923 3.999 10.69 2 8 2zm2.354 5.146a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2z"/>
      </svg>
      
      <b>Drag ${d||"Files"} or Click to Browse</b>
      <p class="pt-2">Only ${y.join(", ")} files are supported</p>
      </div>
      `,accept:function(e,t){endsWithOne(e.name,y)?t():t(`Only ${y.join(", ")} files are allowed!`)}});C=`dz_${I.id}_`+E.id;DropzoneMap[C]=s,mockExistingFile(c,h,s,r,m);let a=".dropzone .dz-preview{width:min-content}.dropzone .dz-preview .dz-error-message{font-size:10px !important}.dropzone .dz-preview .dz-error-message::after{top:40px;border-bottom:none;border-top:6px solid #be2626}.dropzone .dz-preview .dz-error-message{top:0}.dropzone .dz-preview .dz-remove{text-align:left;word-wrap:anywhere}",n=(A&&(a+=`div[id="${E.id}"].dropzone.dz-started .dz-message {
      display: revert;}`),addStyle(a),s.on("success",e=>{r.push(e.xhr.response)}),!1),i=(!0===(n=0<r.length&&p?!0:n)&&r.splice(0,r.length),s.on("complete",e=>{updateDropzoneRemoveFileText(s,e.name),e._removeLink&&(e._removeLink.innerHTML=s.options.dictRemoveFile),t.style.display="none",E.classList.remove("form-control","error"),A?(o.name=h+"[]",o.setAttribute("multiple",!0),p?(o.setAttribute("data-file-upload-component",`[${r}]`),n&&o.setAttribute("ref-field-file-upload-component",h)):o.value=`[${r}]`):p?(o.setAttribute("data-file-upload-component",r),n&&o.setAttribute("ref-field-file-upload-component",h)):o.value=`[${r}]`,"true"===u&&"true"===w&&fileActivityTracker(e.name,"Upload",l,h)}),[]);s.on("removedfile",t=>{r.length;r=r.filter(e=>JSON.parse(e).originalName!==t.name);let a;if(!0===n){i.push(t.refFieldUuid);let e=c[h];e&&Array.isArray(e)&&(e=e.filter(e=>!i.includes(e.uuid))),a=e.map(e=>e.uuid)}A?(o.name=h+"[]",o.setAttribute("multiple",!0),p?(o.setAttribute("data-file-upload-component",`[${r}]`),n&&o.setAttribute("ref-field-file-upload-component",h),o.value=a):o.value=`[${r}]`):p?(o.setAttribute("data-file-upload-component",r),n&&o.setAttribute("ref-field-file-upload-component",h),o.value=a):o.value=`[${r}]`;let e=r.length;e=e?v-e:v,s.options.maxFiles=e,"true"===u&&"true"===w&&c&&fileActivityTracker(t.name,"Delete",l,h)}),T.querySelector("button[type=submit]").addEventListener("click",function(e){if("true"===g&&0===r.length)return e.preventDefault(),e.stopPropagation(),t.style.display="block",E.classList.add("form-control","error"),!1}),s.on("canceled",t=>{r=r.filter(e=>JSON.parse(e).originalName!==t.name),A&&(o.name=h+"[]",o.setAttribute("multiple",!0)),o.value=`[${r}]`}),s.on("queuecomplete",()=>{console.log("ðŸš€ ~ file: drapcode.js:2107 ~ loadDropzoneField ~ queuecomplete...")})}}},tenantTemplateOptions=(t,a)=>{publicGetCall("projects/templates/").then(e=>{a.innerHTML=templateOptions(t,e.data),$("#"+a.id).select2({selectionCssClass:":all:",width:"resolve"}).val("").trigger("change")})},templateOptions=(e,t)=>{let a=[`<option value="">- Select ${e.fieldTitle.en} -</option>`];return(a=a.concat(Array.isArray(t)?t.map(e=>{var t=e.name,e=e.uuid;if(t&&e)return`<option value="${e}">${t}</option>`}):"")).filter(()=>!0).join("")},saveTenantTemplate=async e=>{let t,a,o;e&&(t=e.target||e.srcElement,a=e.currentTarget,e.preventDefault(),o=t.id?$("#"+t.id):"");var r=isLoggedInUser()?fetchLoggedInUserJson():"",e=!e||"submit"!==e.type||o&&o.valid()&&0===o.validate().pendingRequest&&r&&0<r.tenantId.length;let s,n;o&&(s=o.find(":button[type=submit]"),n=s.html());var i={};if(e){s&&s.prop("disabled",!0),s&&s.empty().append("<i class='fa fa-spinner fa-spin'></i>");e=await serializeFormData(a.elements);e.tenants=[...r.tenantId];try{var l=await unSecuredPostCall(e,"projects/templates/create");i.data=l,i.status="success",s&&s.prop("disabled",!1),s&&s.html(n),resetCollectionForm(a),toastr.success("Created Template Successfully.","Success!")}catch(e){console.error("error",e),s&&s.prop("disabled",!1),s&&s.html(n),e.response&&(i.data=e.response,i.status="error",toastr.error(e.response.data.message,"Failed!"))}}else console.info("I am submit event and not valid"),toastr.error("You are not authorized to submit form.","Submission Denied!"),s&&s.prop("disabled",!1),s&&s.html(n);return i},replaceContentOfFileLinkElements=(r,s,e=null)=>{let t;t=e?s.getAttribute(e):s.getAttribute("data-text-content");var a,o,n,e=s.getAttribute("data-field-type");t&&(a=parseValueFromData(r,t),"file"===e)&&(n=o=e="","object"!=typeof a||Array.isArray(a)?a&&Array.isArray(a)&&(n=a.map(e=>{var t=e&&e.key?imageServerUrl()+e.key:"",a=e&&e.originalName?e.originalName:"",o=document.createElement("a");return!0===e.isPrivate?addDownloadAttributeForPrivateFiles(o,e,r.uuid):o.href=t,o.innerText=a||t,o.id=s.id,o.classList=s.classList,o}),s.replaceWith(...n)):(e=imageServerUrl()+a.key,o=a.originalName,!0===a.isPrivate?addDownloadAttributeForPrivateFiles(s,a,r.uuid):s.href=e||"",s.innerText=o||e))},getConjunctionSymbol=e=>"AND"===e?"&&":"OR"===e?"||":"",getCurrentUserStatementCode=(e,t)=>e.key===IS_LOGGED_IN?t+" isLoggedInUser()":t+" !isLoggedInUser()",getCurrentUserRoleStatementCode=(e,t)=>{var{key:e,value:a}=e;return e===EQUALS?t+` isLoggedInUserRole('${a}')`:t+` !isLoggedInUserRole('${a}')`},getKeySymbol=e=>e===EQUALS?"===":e===LESS_THAN?"<":e===LESS_THAN_EQUALS_TO?"<==":e===GREATER_THAN?">":e===GREATER_THAN_EQUALS_TO?">==":e===NOT_EQUAL?"!==":void 0,getCurrentDateStatementCode=(e,t,a)=>`${a} dateComparison(${e.key},value${t})`,checkDate=e=>(""+e).match(DATE_REGEX);function dateComparison(e,t){return checkDate(t)?e===EQUALS?moment().isSame(t):e===LESS_THAN?moment().isAfter(t):e===LESS_THAN_EQUALS_TO?moment().isSameOrAfter(t):e===GREATER_THAN?moment().isBefore(t):e===GREATER_THAN_EQUALS_TO?moment().isSameOrBefore(t):void NOT_EQUAL:(console.log("Not Valid date in elemnet"),"true")}let showAlertMessage=function(a){var e,t=isActionEnabled(a);if(console.log("ðŸš€ ~ showAlertMessage ~ actionEnabled:",t),t)return new Promise(function(e,t){e(a)}),t=a.response,((e={}).data=t)?201===t.status||200===t.status?(toastr.success(a.parameters.successMessage,"Success"),e.status="success"):(409===t.status?toastr.error(t.data||"Validation Failed","Error: "+t.status):404===t.status?toastr.error(t.data.error||"This collection does not found","Error: "+t.status):403===t.status?toastr.error(a.parameters.errorMessage||"Forbidden Access","Error: "+t.status):toastr.error(t.data.error||"Some Internal error","Error: "+t.status),e.status="error"):(toastr.error("Sorry, We are not able get response from previous actions","Error"),e.status="error"),e},exportCollectionItem=async a=>{var e,t,o,r,s=isActionEnabled(a);console.log("ðŸš€ ~ exportCollectionItem ~ actionEnabled:",s),s&&(new Promise(function(e,t){e(a)}),{collection:s,filterId:e,successMessage:t,errorMessage:o}=a.parameters,r=`collection-table/${s}/finder/${e}/export-data`,r=await addEntityQueryToUrl(r,s,e),await downloadFile(r))},importCollectionItem=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ importCollectionItem ~ actionEnabled:",e),e){new Promise(function(e,t){e(a)});let{parameters:e,element:o}=a,{collection:r,successMessage:s,errorMessage:n,collectionRequest:t}=e,i=!0;t&&"Open"!=t||(i=!1);o.file;Papa.parse(o.file.files[0],{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete(e){var{meta:e,errors:t,data:a}=e;0<t.length?toastr.error("Please check the file and try again!","CSV Import"):showCSVContentOnUI(e.fields,a,o,i,r,s,n)}})}},showCSVContentOnUI=(r,s,n,i,l,c,d)=>{let t="<tr>";for(let e=0;e<r.length;e++)t+="<th>"+r[e]+"</th>";t+="</tr>";let a="";for(let t=0;t<s.length;t++){a+="<tr>";for(let e=0;e<r.length;e++){var o=r[e];a+="<td>"+s[t][o]+"</td>"}a+="</tr>"}let u=bootbox.dialog({title:"Records",message:`<div style="overflow-y: scroll;max-height:400px;"><table class="table table-bordered table-striped">${t}${a}</table></div>`,size:"large",buttons:{cancel:{label:"Cancel",className:"btn-danger",callback:function(){n.reset(),u.modal("hide")}},ok:{label:"Upload Record",className:"btn-info",callback:function(){n.reset(),u.modal("hide");var e={fields:r,items:s};let t="collection-form/import-from-csv/"+l,a=e=>{e=e.data;e&&toastr.success(c||`Total ${e.insertedCount||"few"} records has been imported `,"CSV Imported")},o=()=>{toastr.error(d||"Failed to import item. Please contact Admin.","CSV Import")};i?(t=""+t,securedPostCall(e,t).then(e=>a(e)).catch(e=>o())):(t="open/"+t,unSecuredPostCall(e,t).then(e=>a(e)).catch(e=>o()))}}}})},saveCollection=async a=>{var e=isActionEnabled(a);return console.log("ðŸš€ ~ saveCollection ~ actionEnabled:",e),e?(new Promise(function(e,t){e(a)}),e=getFormElement(a),saveCollectionData(a,e,!1)):disabledActionResponse(a)},saveCollectionDraft=async a=>{var e=isActionEnabled(a);return console.log("ðŸš€ ~ saveCollectionDraft ~ actionEnabled:",e),e?(new Promise(function(e,t){e(a)}),e=getFormElement(a),saveCollectionData(a,e,!0)):disabledActionResponse(a)},saveUserWithCollectionReference=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ saveUserWithCollectionReference ~ actionEnabled",e),e){new Promise(function(e,t){e(a)});var{userRefField:e,userRole:o,successMessage:r,errorMessage:s,passPreviousActionFormData:n,collection:i,redirectUrl:l,formDataSessionKey:c,formDataBrowserStorageLocation:d,passPreviousActionResponse:u,responseDataSessionKey:p,responseDataSessionStorageLocation:m,enableLoginUser:g,enableConsoleLog:f,startConsoleLog:S,endConsoleLog:v}=a.parameters,y=getFormElement(a),S=(f&&logActionMessage(cleanConsoleLogArgs(S)),await serializeFormData(y.elements)),o=(S.userRoles=S.userRoles||[o],g&&(showErrorOnField(y,S,"userName","Please enter username"),showErrorOnField(y,S,"password","Please enter password")),await saveEmptyItemToCollection(i)).data,i=(S[e]=[o.uuid],clearDataForSessionStorage(S));!n||1!=n&&"true"!==n||(d&&c?setDataInSessionStorageLocation(d,c,i):(e=sessionStorage.getItem("previousActionFormData"))?(e=JSON.parse(e),sessionStorage.setItem("previousActionFormData",JSON.stringify({...e,...i}))):sessionStorage.setItem("previousActionFormData",JSON.stringify(i)));let t="";t=y.hasAttribute("action")?"open/"+(t=y.getAttribute("action")):"auth/user";var h,o={};try{h=await unSecuredPostCall(S,t),o.data=h,o.data.collectionSaveOrUpdateResponse=h,o.data.collectionFormData=i,o.status="success";var A=o.data.collectionSaveOrUpdateResponse,{config:E,data:I}=A;let e="";e=y.hasAttribute("action")?(e=(e=E.url).split("collection-form/")[1]).split("/items")[0]:"user";var b,w,T=I.uuid,C="collection_"+e,O={[C]:{uuid:T}};!u||1!=u&&"true"!==u?(b=sessionStorage.getItem("previousActionResponse"))?(b=JSON.parse(b),sessionStorage.setItem("previousActionResponse",JSON.stringify({...b,...O}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(O)):setDataInSessionStorageLocation(m,p,O),o.data={...o.data,...O},resetCollectionForm(y),r&&toastr.success(r,"Success"),g&&(S.password||(S.password="anonymous-login"),S.userName||(S.userName="anonymous-user-login"),w={userName:S.userName,password:S.password},S.hasOwnProperty("email")&&""!==S.email&&(w.email=S.email,validateLoginFormData(S,w)),await loginIntoApplication(w,l,null,null))}catch(e){console.log("error :>> ",e),e.response&&(o.data=e.response,o.data.collectionSaveOrUpdateResponse=e.response,o.status="error"),s?toastr.error(s,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}return f&&logActionMessage(cleanConsoleLogArgs(v)),o}return disabledActionResponse(a)},saveCollectionWithReferenceItems=async a=>{var t=isActionEnabled(a);if(console.log("ðŸš€ ~ saveCollectionWithReferenceItems ~ actionEnabled",t),!t)return disabledActionResponse(a);new Promise(function(e,t){e(a)});var t=getFormElement(a),o=await serializeFormData(t.elements),{constructor:r,createReferenceFields:s,collectionRefFields:n,passPreviousActionFormData:i,saveReferenceItemsToSession:e,successMessage:l,errorMessage:c,formDataSessionKey:d,formDataBrowserStorageLocation:u,passPreviousActionResponse:p,responseDataSessionKey:m,responseDataSessionStorageLocation:g,referenceItemSessionKey:f,referenceItemSessionStorageLocation:S,enableConsoleLog:v,startConsoleLog:y,endConsoleLog:h}=a.parameters,r={constructor:r,createReferenceFields:s,collectionRefFields:n,passPreviousActionFormData:i,saveReferenceItemsToSession:e,successMessage:l,errorMessage:c,formDataSessionKey:d,formDataBrowserStorageLocation:u,passPreviousActionResponse:p,responseDataSessionKey:m,responseDataSessionStorageLocation:g,referenceItemSessionKey:f,referenceItemSessionStorageLocation:S,enableConsoleLog:v,endConsoleLog:h};if(v&&logActionMessage(cleanConsoleLogArgs(y)),t.hasAttribute("action")){s="open/"+t.getAttribute("action");let e="";e=(e=(e=s).split("collection-form/")[1]).split("/items")[0];var{data:n,fields:i}=await saveEmptyItemToCollection(e,"",o);return resetCollectionForm(t),saveDataWithReferenceField(o,r,s,n,i)}},updateCollectionWithReferenceItems=async a=>{var o=isActionEnabled(a);if(console.log("ðŸš€ ~ updateCollectionWithReferenceItems ~ actionEnabled",o),!o)return disabledActionResponse(a);new Promise(function(e,t){e(a)});var o=getFormElement(a),r=await serializeFormData(o.elements),{constructor:s,createReferenceFields:n,collectionRefFields:i,passPreviousActionFormData:l,saveReferenceItemsToSession:c,successMessage:d,errorMessage:e,formDataSessionKey:t,formDataBrowserStorageLocation:u,passPreviousActionResponse:p,responseDataSessionKey:m,responseDataSessionStorageLocation:g,referenceItemSessionKey:f,referenceItemSessionStorageLocation:S,enableConsoleLog:v,startConsoleLog:y,endConsoleLog:h}=a.parameters,s={constructor:s,createReferenceFields:n,collectionRefFields:i,passPreviousActionFormData:l,saveReferenceItemsToSession:c,successMessage:d,errorMessage:e,formDataSessionKey:t,formDataBrowserStorageLocation:u,passPreviousActionResponse:p,responseDataSessionKey:m,responseDataSessionStorageLocation:g,referenceItemSessionKey:f,referenceItemSessionStorageLocation:S,enableConsoleLog:v,endConsoleLog:h};if(v&&logActionMessage(cleanConsoleLogArgs(y)),o.hasAttribute("action")){let e=o.getAttribute("action");n=(await checkAndUpdateItemId(o)).itemId;e="open/"+(e=n?getNewEndPointUrl(n,e):e);let t="";i=(t=e).split("collection-form/")[1],c=(t=i.split("/items/")[0],l=i.split("/items/")[1],await getCollectionItemById(t,l)),d=(resetCollectionForm(o),await getCollectionDetails(t)).fields;return saveDataWithReferenceField(r,s,e,c,d,"PUT")}},saveDataWithReferenceField=async(e,t,a,o={},r,s="POST")=>{var{constructor:t,createReferenceFields:n,collectionRefFields:i,passPreviousActionFormData:l,saveReferenceItemsToSession:c,successMessage:d,errorMessage:u,formDataSessionKey:p,formDataBrowserStorageLocation:m,passPreviousActionResponse:g,responseDataSessionKey:f,responseDataSessionStorageLocation:S,referenceItemSessionKey:v,referenceItemSessionStorageLocation:y,enableConsoleLog:h,endConsoleLog:A}=t,E=o&&o?.uuid?o.uuid:"",n=clearDataForSessionStorage(e=n?await setDataWithEmptyReferenceField(e,i,o,r,c,v,y):e);!l||1!=l&&"true"!==l||(m&&p?setDataInSessionStorageLocation(m,p,n):(i=sessionStorage.getItem("previousActionFormData"))?(i=JSON.parse(i),sessionStorage.setItem("previousActionFormData",JSON.stringify({...i,...n}))):sessionStorage.setItem("previousActionFormData",JSON.stringify(n)));let I="";(I=(I=(I=a).split("collection-form/")[1]).split("/items")[0])&&t&&(o=await getIPAddress(),r={},_.merge(r,window.navigator),c=(c=sessionStorage.getItem("previousActionResponse"))?JSON.parse(c):{},v=(v=sessionStorage.getItem("previousActionFormData"))?JSON.parse(v):{},y=getBrowserData(),console.log("ðŸš€ ~ file: drapcode.js:3708 ~ saveDataWithReferenceField ~ browserData:",y),e.constructorMetaObj={collectionName:I,constructorId:t,ipAddress:o??"",navigator:r,...y,previousActionResponse:c,previousActionFormData:v});l={};let b;try{"POST"===s?(a+="/"+E,b=await unSecuredPutCall(e,a)):"PUT"===s&&(b=await unSecuredPutCall(e,a)),l.data=b,l.data.collectionSaveOrUpdateResponse=b,l.data.collectionFormData=n,l.status="success";var w=l.data.collectionSaveOrUpdateResponse,T=w.data,C=saveItemsToPreviousActionResponse(I,T?.uuid,"uuid",g,f,S);l.data={...l.data,...C},d&&toastr.success(d,"Success")}catch(e){console.log("error :>> ",e),e.response&&(l.data=e.response,l.data.collectionSaveOrUpdateResponse=e.response,l.status="error"),u?toastr.error(u,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}return h&&logActionMessage(cleanConsoleLogArgs(A)),l},setDataWithEmptyReferenceField=async(r,e,s,n,i=!1,l,c)=>{e=e.map(async e=>{var[e,t]=e.split(":"),a=(await saveEmptyItemToCollection(t,s?.uuid)).data;return{field:e,collectionName:t,item:a}});return(await Promise.all(e)).forEach(({field:t,collectionName:e,item:a})=>{var o=n.find(e=>e.fieldName===t);a&&(o.isMultiSelect?(o=s[t].map(e=>e.uuid),r[t]=[...o,a.uuid]):r[t]=[a.uuid],i)&&saveItemsToPreviousActionResponse(e,a.uuid,"uuid",i,l,c)}),r},saveEmptyItemToCollection=async(e,a="",t={})=>{let o=["uuid","createdBy","isDeleted","updatedAt","createdAt","tenantId"],r=["reference","static_option","dynamic_option"],s={};var n=(await getCollectionDetails(e)).fields,i=(n.forEach(t=>{if(!o.includes(t.fieldName)){let e="";r.includes(t.type)?e=[]:"belongsTo"===t.type&&(e=a?[a]:[]),s[t.fieldName]=e}}),`open/collection-form/${e}/items/`);try{"user"===e&&(s.userName=t.userName,s.password=t.password,s.userRoles=t.userRoles);var l=(await unSecuredPostCall(s,i)).data;return{data:l,fields:n}}catch(e){console.log("\n error :>> ",e),e.response&&(response.data=e.response,response.data.collectionSaveOrUpdateResponse=e.response,response.status="error")}},saveItemsToPreviousActionResponse=(e,t,a,o,r,s)=>{e={["collection_"+e]:{[a]:t}};return!o||1!=o&&"true"!==o||(s&&r?setDataInSessionStorageLocation(s,r,e):(a=sessionStorage.getItem("previousActionResponse"))?(a=JSON.parse(a),sessionStorage.setItem("previousActionResponse",JSON.stringify({...a,...e}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(e))),e},sendDataToExternalApiAndFileDownload=async c=>{var d=isActionEnabled(c);if(console.log("ðŸš€ ~ sendDataToExternalApiAndFileDownload ~ actionEnabled:",d),d){new Promise(function(e,t){e(c)});var{parameters:d,targetElement:u}=c,{webhookId:d,passPreviousActionResponse:p,passPreviousActionFormData:m}=d;let s=u?u.getAttribute("data-item-id"):"";var g=c.response;s=s||"";let n={};var f,S,v={};let i={},l=!1;try{if(d){l=!!s;let e="external-api",t=((S=await publicGetCall(e+"/id/"+d))&&200===S.status&&(i=S.data),"noDynamicData"),a="";i&&(t=i.bodyDataFrom,a=i.requestDataJsonType),console.log("Body Data From :>> ",t),console.log("Request Data JSON Type :>> ",a),t&&["formData","NON_PERSISTENT_COLLECTION"].includes(t)&&u&&"FORM"===u.tagName&&(n=await serializeFormData(c.element.elements,!0)),t;var y,h,A,E,I,b=(i||!1).sendFormData;let o={},r={};s||((y=sessionStorage.getItem("previousActionResponse"))&&(y=JSON.parse(y),h=PARENT_COLLECTION_PROPAGATE_KEY,!s)&&y[h]&&(y[h].name,s=y[h].uuid),!s&&g&&(A=g.collectionSaveOrUpdateResponse,A)&&(E=A.data,s=E.uuid),s&&(l=!1)),!(t&&"collectionItem"!==t||!s||b)||s&&"NON_PERSISTENT_COLLECTION"===t&&["CUSTOM","FORM_DATA","FORM_URL_ENCODED"].includes(a)&&!b?e=e+"/"+s:s&&("collectionItemAndFormData"===t||"collectionItem"===t&&b)&&(e=e+"/"+s,I=await loadFormData(u,n,c),n=g.collectionFormData?{...I,...g.collectionFormData}:I);var w,T,C=sessionStorage.getItem("previousActionResponse"),O=(C&&(C=JSON.parse(C),0<Object.keys(C).length)&&(o=getFinalSessionValues(o,C,i,"current_session"),console.log("Session Value :>> ",o)),sessionStorage.getItem("previousActionFormData")),R=(O&&(O=JSON.parse(O),0<Object.keys(O).length)&&(r=getFinalSessionValues(r,O,i,"form_data_session"),console.log("Session Form Data Value :>> ",r)),checkAndLoadNonPersistentItemId(t,s,u,n,i,l),{data:n,externalApiId:d,sessionValue:o,sessionFormValue:r});if(console.log("URL :>> ",e),console.log("Body :>> ",R),(f=await downloadFile(e,R)).failed){v.status="error",v.data={...g,errorResponse:{...g.errorResponse,...f.data}},v.data.externalApiResponse=f.data;let e="Failed to process Request";f.data&&(e=f.data.message||f.data),toastr.error(e,"Error"),!p&&"true"!==p||((w=sessionStorage.getItem("previousActionResponse"))?(w=JSON.parse(w),sessionStorage.setItem("previousActionResponse",JSON.stringify({...w,errorResponse:{...w.errorResponse,...f.data}}))):sessionStorage.setItem("previousActionResponse",JSON.stringify({errorResponse:f.data}))),!m&&"true"!==m||((T=sessionStorage.getItem("previousActionFormData"))?(T=JSON.parse(T),sessionStorage.setItem("previousActionFormData",JSON.stringify({...T,...n}))):sessionStorage.setItem("previousActionFormData",JSON.stringify(n)))}else v.data={...g},v.status="success"}}catch(e){e.response&&(S=e.response.data,y=S?S.message||S:"Failed",toastr.error(y,"Error"),v.data=e.response,v.data.externalApiResponse=e.response,v.status="error")}return v}return disabledActionResponse(c)},getSessionValueFromString=(e,t,a,o)=>(e.match(/{{(.*?)}}/g)?.forEach(e=>{e=e.split(/{{(.*?)}}/g),e=e&&0<e.length&&e.filter(e=>!!e&&e.startsWith(o));e&&0<e.length&&e.forEach(e=>{(e=e.replace(/{{(.*?)}}/g,"$1")).startsWith(o)&&(e=e.replace(o+".",""),_.merge(t,_.zipObjectDeep([e],[_.get(a,e)])))})}),t),getSessionValueFromObject=(e,a,o,r)=>(e.forEach(e=>{let t=e.value;t&&(e=(e=t.split(/{{(.*?)}}/g))&&0<e.length&&e.filter(e=>!!e&&e.startsWith(r)))&&0<e.length&&e.forEach(e=>{t=e.replace(/{{(.*?)}}/g,"$1"),e.startsWith(r)&&(e=e.replace(r+".",""),_.merge(a,_.zipObjectDeep([e],[_.get(o,e)])))})}),a),getFinalSessionValues=(e,t,a,o)=>{var{bodyCustomJSON:a,bodyRawJSON:r,setting:{url:s,headers:n,params:i}}=a;return a&&(e=getSessionValueFromString(a,e,t,o)),r&&(e=getSessionValueFromString(r,e,t,o)),s&&(e=getSessionValueFromString(s,e,t,o)),n&&0<Object.keys(n).length&&(e=getSessionValueFromObject(n,e,t,o)),i&&0<Object.keys(i).length&&(e=getSessionValueFromObject(i,e,t,o)),console.log("ðŸš€ ~ file: drapcode.js:4140 ~ currentDataKey:",o),e},sendDataToExternalApi=async T=>{var C=isActionEnabled(T);if(console.log("ðŸš€ ~ sendDataToExternalApi ~ actionEnabled:",C),C){new Promise(function(e,t){e(T)});var{parameters:C,targetElement:O}=T;console.log("ðŸš€ ~ file: drapcode.js:4027 ~ sendDataToExternalApi ~ parameters:",C);let{webhookId:s,passPreviousActionResponse:e,passPreviousActionFormData:t,successMessage:n,overrideBrowserSessionValuesKey:a,overrideBrowserSessionFormDataValuesKey:r,overriddenSessionKeyRules:i,overriddenSessionFormDataKeyRules:l,overrideResponseDataKey:c,overrideFormDataKey:d,overriddenCustomJsonKey:u,overriddenFormCustomJsonKey:p,sendPreviousActionResponseItemId:m,formDataSessionKey:o,formDataBrowserStorageLocation:g,responseDataSessionKey:f,responseDataSessionStorageLocation:S,enableConsoleLog:v,startConsoleLog:y,endConsoleLog:h}=C,A=(v&&logActionMessage(cleanConsoleLogArgs(y)),O?O.getAttribute("data-item-id"):"");O&&"FORM"===O.tagName&&(C=O.getAttribute("action"),A=(A=C.split("collection-form/")[1])?A.split("/items/")[1]:"");C=T.response;A=A||"";let E={};var R={};let I={};var D;let b={},w=!1;try{if(s){w=!!A;let e="external-api",t=((D=await publicGetCall(e+"/id/"+s))&&200===D.status&&(b=D.data),"noDynamicData"),a="";var F,P=(b&&(t=b.bodyDataFrom,a=b.requestDataJsonType),console.log("%c==> sendDataToExternalApi bodyDataFrom :>> ","color:cyan",t),console.log("%c==> sendDataToExternalApi requestDataJsonType :>> ","color:cyan",a),t&&["formData","NON_PERSISTENT_COLLECTION"].includes(t)&&(F=O?O.closest("FORM"):"",console.log("%c==> sendDataToExternalApi targetElement :>> ","color:cyan",O),console.log("%c==> sendDataToExternalApi formElem :>> ","color:cyan",F),E=F&&"FORM"===F.tagName?await serializeFormData(F.elements):await loadFormData(O,E,T),console.log("%c==> sendDataToExternalApi data #1 :>> ","color:cyan",E)),t,b||!1).sendFormData;let o={},r={};var N,L,U,k,x,M,J,j={},V={},B={},$=(m&&C&&(console.log("%c==> Send Previous Action Response ItemId :>> ","color:yellow",m),N=C.collectionSaveOrUpdateResponse,N)&&(console.log("ðŸš€ ~ %c sendDataToExternalApi ~ collectionSaveOrUpdateResponse:","color:yellow;font-size:14px;",N),L=N.data,A=L.uuid,console.log("%ccollectionItemId :>> ","color:yellow",A)),A||(console.log("%cpreviousResponse :>> ","color:yellow",C),!A&&C&&(U=C.collectionSaveOrUpdateResponse,U)&&(k=U.data,A=k.uuid),console.log("%ccollectionItemId #1 :>> ","color:yellow",A),(x=sessionStorage.getItem("previousActionResponse"))&&(x=JSON.parse(x),M=PARENT_COLLECTION_PROPAGATE_KEY,!A&&x[M]&&(x[M].name,A=x[M].uuid),console.log("%ccollectionItemId #2 :>> ","color:yellow",A)),A&&(w=!1)),console.log("ðŸš€ ~ file: drapcode.js:4212 ~ sendDataToExternalApi ~ collectionItemId:",A),!(t&&"collectionItem"!==t||!A||P)||A&&"NON_PERSISTENT_COLLECTION"===t&&["CUSTOM","FORM_DATA","FORM_URL_ENCODED"].includes(a)&&!P?e=e+"/"+A:A&&("collectionItemAndFormData"===t||"collectionItem"===t&&P)&&(e=e+"/"+A,J=await loadFormData(O,E,T),E=C.collectionFormData?{...J,...C.collectionFormData}:J),sessionStorage.getItem("previousActionResponse")),G=($&&($=JSON.parse($),0<Object.keys($).length)&&(o=getFinalSessionValues(o,$,b,"current_session"),console.log("%c==> finalSessionValue #2 :>> ","color:yellow",o)),sessionStorage.getItem("previousActionFormData")),z=(G&&(G=JSON.parse(G),0<Object.keys(G).length)&&(r=getFinalSessionValues(r,G,b,"form_data_session"),console.log("%c==> previousFormData #2 :>> ","color:yellow",r)),j=getBrowserStorageValuesForExternalAPI(j,b,"SESSION_STORAGE"),V=getBrowserStorageValuesForExternalAPI(V,b,"LOCAL_STORAGE"),B=getBrowserStorageValuesForExternalAPI(B,b,"COOKIES"),console.log("ðŸš€ ~ file: drapcode.js:4188 ~ sendDataToExternalApi ~ cookiesValue:",B),console.log("ðŸš€ ~ file: drapcode.js:4188 ~ sendDataToExternalApi ~ localStorageValue:",V),console.log("ðŸš€ ~ file: drapcode.js:4188 ~ sendDataToExternalApi ~ sessionStorageValue:",j),console.log("ðŸš€ ~ file: drapcode.js:4188 ~ sendDataToExternalApi ~ finalSessionValue:",o),checkAndLoadNonPersistentItemId(t,A,O,E,b,w),{sessionStorageData:j,localStorageData:V,cookiesData:B}),H={data:E,externalApiId:s,sessionValue:o,sessionFormValue:r,browserStorageDTO:z};console.log("\n Body:",H),I=await unSecuredPostCall(H,e),R.data={...C,...I},R.data.externalApiResponse=I,R.status="success",n&&toastr.success(n,"Success")}if(e&&(1==e||"true"===e))if(S&&f)setDataInSessionStorageLocation(S,f,I&&I.data?{...I.data}:{});else{var W=sessionStorage.getItem("previousActionResponse");let o={};if(c&&u&&I.data?o[u.toString()]={...I.data}:o=I&&I.data?{...I.data}:{},a&&i&&I.data){let a=[];i.map(e=>{var t=c&&u?u.toString()+"."+e.originalSessionKey:e.originalSessionKey;addCustomKeyInObj(o,t,e.overriddenSessionKey),a.push(t)}),o=_.omit(o,a)}W?(W=JSON.parse(W),sessionStorage.setItem("previousActionResponse",JSON.stringify({...W,...o}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(o))}if(t&&(1==t||"true"===t))if(g&&o)setDataInSessionStorageLocation(g,o,E?{...E}:{});else{var q=sessionStorage.getItem("previousActionFormData");let o={};if(d&&p&&E?o[p.toString()]={...E}:o=E?{...E}:{},r&&l&&I.data){let a=[];l.map(e=>{var t=d&&p?p.toString()+"."+e.originalSessionKey:e.originalSessionKey;addCustomKeyInObj(o,t,e.overriddenSessionKey),a.push(t)}),o=_.omit(o,a)}q?(q=JSON.parse(q),sessionStorage.setItem("previousActionFormData",JSON.stringify({...q,...o}))):sessionStorage.setItem("previousActionFormData",JSON.stringify(o))}}catch(e){console.log("%c==> External API error :>> ","color:red",e),e.response&&(D=e.response.data,F=D?D.message||D:"Failed",toastr.error(F,"Error"),R.data=e.response,R.data.externalApiResponse=e.response,R.status="error")}return v&&logActionMessage(cleanConsoleLogArgs(h)),R}return disabledActionResponse(T)},triggerZap=async n=>{var i=isActionEnabled(n);if(console.log("ðŸš€ ~ triggerZap ~ actionEnabled:",i),i){new Promise(function(e,t){e(n)});var{parameters:i,targetElement:l}=n,{webhookId:i,passPreviousActionResponse:e,passPreviousActionFormData:a,sessionValue:c,successMessage:d}=i;let o=l?l.getAttribute("data-item-id"):"";var u=n.response;let t={};var p={};let r={};var m,g;let s={};try{if(i){let e="external-api";var f,S,v,y=await publicGetCall(e+"/id/"+i);if(!(!!(s=y&&200===y.status?y.data:s)&&s.setting.enabled))throw toastr.error("Zap is not Active"),Error("Zap is not Active");o?(e=e+"/"+o,t=(t=l&&l.hasAttribute("data-collection-item")?l.getAttribute("data-collection-item"):"")?JSON.parse(t):{}):u?(o=u.data.uuid)&&(e=e+"/"+o,t=u.data):t=await loadFormData(l,t,n);let a={};if(!o){let t=sessionStorage.getItem("previousActionResponse");t&&(t=JSON.parse(t),f=PARENT_COLLECTION_PROPAGATE_KEY,t[f]&&(t[f].name,o=t[f].uuid),c)&&0<Object.keys(t).length&&c.split(",").forEach(e=>a[e]=_.get(t,e)),!o&&u&&(S=u.collectionSaveOrUpdateResponse,S)&&(v=S.data,o=v.uuid)}if(c){let t=sessionStorage.getItem("previousActionResponse");t&&(t=JSON.parse(t),0<Object.keys(t).length)&&c.split(",").forEach(e=>a[e]=_.get(t,e))}var h={data:t,externalApiId:i,sessionValue:a},A=(r=await unSecuredPostCall(h,e),p.data={...u,...r},p.data.externalApiResponse=r,p.status="success",d&&toastr.success(d,"Success"),sessionStorage.getItem("previousActionFormData"));A?(A=JSON.parse(A),sessionStorage.setItem("previousActionFormData",JSON.stringify({...A,...t}))):sessionStorage.setItem("previousActionFormData",JSON.stringify(t))}!e||1!=e&&"true"!==e||((m=sessionStorage.getItem("previousActionResponse"))?(m=JSON.parse(m),sessionStorage.setItem("previousActionResponse",JSON.stringify({...m,...r.data}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(r.data))),!a||1!=a&&"true"!==a||((g=sessionStorage.getItem("previousActionFormData"))?(g=JSON.parse(g),sessionStorage.setItem("previousActionFormData",JSON.stringify({...g,...t}))):sessionStorage.setItem("previousActionFormData",JSON.stringify(t)))}catch(e){console.log("%c==> External API error :>> ","color:red",e),e.response&&(y=e.response.data,l=y?y.message||y:"Failed",toastr.error(l,"Error"),p.data=e.response,p.data.externalApiResponse=e.response,p.status="error")}return p}return disabledActionResponse(n)},startNewGptConversation=async a=>{var e=isActionEnabled(a);return console.log("ðŸš€ ~ startNewGptConversation ~ actionEnabled:",e),e?(new Promise(function(e,t){e(a)}),chatGPTConversation(a,!1)):disabledActionResponse(a)},continueGptConversation=async a=>{var e=isActionEnabled(a);return console.log("ðŸš€ ~ continueGptConversation ~ actionEnabled:",e),e?(new Promise(function(e,t){e(a)}),chatGPTConversation(a,!0)):disabledActionResponse(a)},chatGPTConversation=async(a,o=!1)=>{var{parameters:r,targetElement:s}=a,{chatGptId:n,collectionFields:i,conversationIdField:l,pageCollection:c,successMessage:d,passPreviousActionResponse:u,passPreviousActionFormData:p}=r;let m=r.getIdFrom,g=s?s.getAttribute("data-item-id"):"";var f=a.response;let S={};r={};let v={};var y={},h={},A={};try{if(n){if((D=await publicGetCall("external-api/id/"+n))&&200===D.status&&(v=D.data),m||(c?m="pageCollection":g?m="collectionUuid":f&&(m="previousResponse")),m)switch(m){case"previousResponse":(g=f.data.uuid)&&(S=f.data);break;case"pageCollection":var E=await getPageItemData();g=E.collectionItemId;break;default:S=g?(S=s&&s.hasAttribute("data-collection-item")?s.getAttribute("data-collection-item"):"")?JSON.parse(S):{}:(g=s?s.getAttribute("data-item-id"):"",await loadFormData(s,S,a))}let e={};var I=sessionStorage.getItem("previousActionResponse");I&&(I=JSON.parse(I),0<Object.keys(I).length)&&(e=getFinalSessionValues(e,I,v,"current_session"),console.log("%c==> finalSessionValue #2 :>> ","color:yellow",e));let t={};var b,w,T=sessionStorage.getItem("previousActionFormData"),C=(T&&(T=JSON.parse(T),0<Object.keys(T).length)&&(t=getFinalSessionValues(t,T,v,"form_data_session"),console.log("%c==> previousFormData #2 :>> ","color:yellow",t)),y=getBrowserStorageValuesForExternalAPI(y,v,"current_session"),y=getBrowserStorageValuesForExternalAPI(y,v,"form_data_session"),y=getBrowserStorageValuesForExternalAPI(y,v,"SESSION_STORAGE"),h=getBrowserStorageValuesForExternalAPI(h,v,"LOCAL_STORAGE"),A=getBrowserStorageValuesForExternalAPI(A,v,"COOKIES"),"assistant/chatGPT/prompt/"+g),O={data:S,eventData:{collectionFields:i,pageCollection:c,conversationIdField:l,continuePrompt:o},externalApiId:n,sessionValue:e,sessionFormValue:t,sessionStorageData:y,localStorageData:h,cookiesData:A},R=await unSecuredPostCall(O,C);r.data={...f,...R},r.data.externalApiResponse=R,r.status="success",d&&toastr.success(d,"Success"),!u||1!=u&&"true"!==u||((b=sessionStorage.getItem("previousActionResponse"))?(b=JSON.parse(b),sessionStorage.setItem("previousActionResponse",JSON.stringify({...b,...R.data}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(R.data))),!p||1!=p&&"true"!==p||((w=sessionStorage.getItem("previousActionFormData"))?(w=JSON.parse(w),sessionStorage.setItem("previousActionFormData",JSON.stringify({...w,...S}))):sessionStorage.setItem("previousActionFormData",JSON.stringify(S)))}}catch(t){if(console.log("%c==> External API error :>> ","color:red",t),t.response){let e=t.response.data;var D=e?e.message||e:"Failed";toastr.error(D,"Error"),r.data=t.response,r.data.externalApiResponse=t.response,r.status="error"}}return r},sendDataToExternalApiAndAuthorize=async a=>{var s=isActionEnabled(a);if(console.log("ðŸš€ ~ sendDataToExternalApiAndAuthorize ~ actionEnabled:",s),s){new Promise(function(e,t){e(a)});var{parameters:s,targetElement:n}=a,{webhookId:s,bodyDataFrom:i,sendFormData:l,userRole:c,successMessage:d,redirectUrl:u,sessionValue:p}=s;let o=n?n.getAttribute("data-item-id"):"";n=a.response;o=n?n.data.uuid:o;let r={};i&&"formData"===i&&(r=await serializeFormData(a.element.elements,!0));var e={};if(s&&c){let t=sessionStorage.getItem("previousActionResponse"),e=(t=t&&JSON.parse(t),"external-api");o||(t&&0<Object.keys(t).length&&(m=PARENT_COLLECTION_PROPAGATE_KEY,t[m])&&(t[m].name,o=t[m].uuid),!o&&n&&(m=n.collectionSaveOrUpdateResponse,m)&&(m=m.data,o=m.uuid)),i&&"collectionItem"!==i||!o||l?o&&("collectionItemAndFormData"===i||"collectionItem"===i&&l)&&(e=e+"/"+o,r=n.collectionFormData):e=e+"/"+o;let a={};p&&t&&0<Object.keys(t).length&&p.split(",").forEach(e=>a[e]=_.get(t,e));var m="/login/otp/"+e,i={};try{var g,f={data:r,externalApiId:s,userRole:c,userName:"sdsd",password:"csdcs",sessionValue:a},S=await axios.post(m,f,{}),v=S.data;S&&200===S.status&&((g=window.localStorage).setItem("token",v.token),setJsonInLocalStorage("user",v.userDetails),g.setItem("projectId",v.projectId),g.setItem("role",v.role),u&&(window.location=u),toastr.success(d,"Success"))}catch(e){e.response&&(i.data=e.response,i.status="error")}return i}return toastr.error("Issue with configuration contact owner","Error"),e}return disabledActionResponse(a)},sendDataToExternalSource=async u=>{console.log("ðŸš€ ~ sendDataToExternalSource ~ args:",u);var p=isActionEnabled(u);if(console.log("ðŸš€ ~ sendDataToExternalSource ~ actionEnabled:",p),p){new Promise(function(e,t){e(u)});var{parameters:p,targetElement:m,externalSource:a}=u,{webhookId:p,successMessage:g,sessionKey:o}=p;let s=m?m.getAttribute("data-item-id"):"",n="";m&&"FORM"===m.tagName&&(f=m.getAttribute("action"),s=(s=f.split("collection-form/")[1])?s.split("/items/")[1]:"");var f=u.response;s=s||"";let i={};var S={};let l={};var v;let c={},d=!1;try{if(p){d=!!s;let e="external-api",t=((v=await publicGetCall(e+"/id/"+p))&&200===v.status&&(c=v.data),"noDynamicData"),a="";var y,h,A,E,I,b,w,T,C,O,R=(c&&(t=c.bodyDataFrom,a=c.requestDataJsonType,{responseDataMapping:y,collectionName:h}=c||"",A=(y||"").selectedCollectionName,n=(n=A)||h),console.log("%c==> sendDataToExternalSource bodyDataFrom :>> ","color:cyan",t),console.log("%c==> sendDataToExternalSource requestDataJsonType :>> ","color:cyan",a),t&&["formData","NON_PERSISTENT_COLLECTION"].includes(t)&&(i=await loadFormData(m,i,u),console.log("%c==> sendDataToExternalSource targetElement :>> ","color:cyan",m),console.log("%c==> sendDataToExternalSource data #1 :>> ","color:cyan",i)),t,c||!1).sendFormData;let o={},r={};f&&(E=f.collectionSaveOrUpdateResponse,E)&&(console.log("ðŸš€ ~ %c sendDataToExternalSource ~ collectionSaveOrUpdateResponse:","color:yellow;font-size:14px;",E),I=E.data,s=I.uuid,console.log("%ccollectionItemId :>> ","color:yellow",s)),s||(console.log("%cpreviousResponse :>> ","color:yellow",f),!s&&f&&(b=f.collectionSaveOrUpdateResponse,b)&&(w=b.data,s=w.uuid),console.log("%ccollectionItemId #1 :>> ","color:yellow",s),(T=sessionStorage.getItem("previousActionResponse"))&&(T=JSON.parse(T),C=PARENT_COLLECTION_PROPAGATE_KEY,!s&&T[C]&&(T[C].name,s=T[C].uuid),console.log("%ccollectionItemId #2 :>> ","color:yellow",s)),s&&(d=!1)),!(!s||t&&"collectionItem"!==t||R)||s&&"NON_PERSISTENT_COLLECTION"===t&&["CUSTOM","FORM_DATA","FORM_URL_ENCODED"].includes(a)&&!R?e=e+"/"+s:s&&("collectionItemAndFormData"===t||"collectionItem"===t&&R)&&(e=e+"/"+s,O=await loadFormData(m,i,u),i=f.collectionFormData?{...O,...f.collectionFormData}:O);var D=sessionStorage.getItem("previousActionResponse"),F=(D&&(D=JSON.parse(D),0<Object.keys(D).length)&&(o=getFinalSessionValues(o,D,c,"current_session"),console.log("%c==> finalSessionValue #2 :>> ","color:yellow",o)),sessionStorage.getItem("previousActionFormData")),P=(F&&(F=JSON.parse(F),0<Object.keys(F).length)&&(r=getFinalSessionValues(r,F,c,"form_data_session"),console.log("%c==> previousFormData #2 :>> ","color:yellow",r)),checkAndLoadNonPersistentItemId(t,s,m,i,c,d),console.log("%c==> sendDataToExternalSource data #2 :>> ","color:cyan",i),{data:i,externalApiId:p,sessionValue:o,sessionFormValue:r});l=await unSecuredPostCall(P,e),S.data={...f,...l},S.data.externalApiResponse=l,S.status="success",g&&toastr.success(g,"Success")}console.log("ðŸš€ ~ sendDataToExternalSource ~ externalSource:",a);var r,N,L=o?a+"_"+o:a,U=(console.log("ðŸš€ ~ sendDataToExternalSource ~ externalSourceKey:",L),sessionStorage.getItem("previousActionResponse"));let e={};U?(U=JSON.parse(U),a?o?_.get(U,L)?e[L]=l&&l.data?{..._.get(U,L),...l.data}:{}:e[L]=l&&l.data?{...l.data}:{}:n?(r=a+"_"+n,_.get(U,r)?e[r]=l&&l.data?{..._.get(U,r),...l.data}:{}:e[r]=l&&l.data?{...l.data}:{}):_.get(U,a)?e[a]=l&&l.data?{..._.get(U,a),...l.data}:{}:e[a]=l&&l.data?{...l.data}:{}:e=l&&l.data?{...l.data}:{},sessionStorage.setItem("previousActionResponse",JSON.stringify({...U,...e}))):(a?o?e[L]=l&&l.data?{...l.data}:{}:n?(N=a+"_"+n,e[N]=l&&l.data?{...l.data}:{}):e[a]=l&&l.data?{...l.data}:{}:e=l&&l.data?{...l.data}:{},sessionStorage.setItem("previousActionResponse",JSON.stringify(e)));var k=sessionStorage.getItem("previousActionFormData");let t={};k?(k=JSON.parse(k),a?o?_.get(k,L)?t[L]=i?{..._.get(k,L),...i}:{}:t[L]=i?{...i}:{}:_.get(k,a)?t[a]=i?{..._.get(k,a),...i}:{}:t[a]=i?{...i}:{}:t=i?{...i}:{},sessionStorage.setItem("previousActionFormData",JSON.stringify({...k,...t}))):(a?t[L]=i?{...i}:{}:t=i?{...i}:{},sessionStorage.setItem("previousActionFormData",JSON.stringify(t)))}catch(e){console.log("%c==> External Source External API error :>> ","color:red",e),e.response&&(v=e.response.data,y=v?v.message||v:"Failed",toastr.error(y,"Error"),S.data=e.response,S.data.externalApiResponse=e.response,S.status="error")}return S}return disabledActionResponse(u)},authorizeWithExternalDataSource=async a=>{console.log("ðŸš€ ~ authorizeWithExternalDataSource ~ args:",a);var i=isActionEnabled(a);if(console.log("ðŸš€ ~ authorizeWithExternalDataSource ~ actionEnabled:",i),i){new Promise(function(e,t){e(a)});var{parameters:i,targetElement:e,externalSource:l}=a,{webhookId:c,bodyDataFrom:d,sendFormData:u,successMessage:p,redirectUrl:m,redirectRules:g,sessionKey:f}=i;console.log("ðŸš€ ~ authorizeWithExternalDataSource ~ parameters:",i);let r=i.userRole,s=e.getAttribute("data-item-id");i=a.response;s=i?i.data.uuid:s;let n={};d&&"formData"===d&&(n=await serializeFormData(a.element.elements,!0));e={};if(c){let e="external-api",t=sessionStorage.getItem("previousActionResponse");t=t&&JSON.parse(t),s||(t&&0<Object.keys(t).length&&(S=PARENT_COLLECTION_PROPAGATE_KEY,t[S])&&(t[S].name,s=t[S].uuid),!s&&i&&(S=i.collectionSaveOrUpdateResponse,S)&&(S=S.data,s=S.uuid)),d&&"collectionItem"!==d||!s||u?s&&("collectionItemAndFormData"===d||"collectionItem"===d&&u)&&(e=e+"/"+s,n=i.collectionFormData):e=e+"/"+s;var S=f?l+"_"+f:l;console.log("ðŸš€ ~ authorizeWithExternalDataSource ~ externalSourceKey:",S);let a={},o="SUPABASE"===l?[S+".access_token",S+".user.user_metadata.user_role"]:[];o&&t&&0<Object.keys(t).length&&o.forEach(e=>a=setNestedProp(a,e.split("."),_.get(t,e))),console.log("ðŸš€ ~ authorizeWithExternalDataSource ~ finalSessionValue:",a);"SUPABASE"===l&&(r=_.get(a,S+".user.user_metadata.user_role")),console.log(`ðŸš€ ~ authorizeWithExternalDataSource ~ externalSource: ${l} -> userRole:`,r);d="/login/otp/"+e,u={};try{var v,y={data:n,externalApiId:c,userRole:r,userName:"sdsd",password:"csdcs",sessionValue:a},h=(console.log("ðŸš€ ~ authorizeWithExternalDataSource ~ body:",y),await axios.post(d,y,{})),A=h.data;console.log("ðŸš€ ~ authorizeWithExternalDataSource ~ loggedInUser:",A),h&&200===h.status&&((v=window.localStorage).setItem("token",A.token),setJsonInLocalStorage("user",A.userDetails),v.setItem("projectId",A.projectId),v.setItem("role",A.role),toastr.success(p,"Success"),m&&(window.location=m),g)&&g.length&&handlePageRedirection(A,"",g)}catch(e){e.response&&(u.data=e.response,u.status="error")}return u}return toastr.error("Issue with configuration contact owner","Error"),e}return disabledActionResponse(a)},createLoanRepayments=async a=>{var e,t,o;return isActionEnabled(a)?(new Promise(function(e,t){e(a)}),{element:e,response:t}=a,o=a.element,sendToCreateRepayment(a,o)):disabledActionResponse(a)},sendToCreateRepayment=async(e,t)=>{var a,o=e.parameters,o=o.interestTypes,e=e.response.data,e={loanApplicationId:e.uuid,interestTypes:o},o={};try{a=await unSecuredPostCall(e,"loan-manage/generate-repayment"),o.data=a,o.data.collectionSaveOrUpdateResponse=a,o.status="success"}catch(e){console.log("\n error :>> ",e),e.response&&(o.data=e.response,o.status="error"),e.response.data&&toastr.error(e.response.data,"Error")}return o},updateCollection=async a=>{var e=isActionEnabled(a);return console.log("ðŸš€ ~ updateCollection ~ actionEnabled:",e),e?(new Promise(function(e,t){e(a)}),e=a.element,updateCollectionData(a,e,!1)):disabledActionResponse(a)},updateCollectionDraft=async a=>{var e=isActionEnabled(a);return console.log("ðŸš€ ~ updateCollectionDraft ~ actionEnabled:",e),e?(new Promise(function(e,t){e(a)}),e=getFormElement(a),updateCollectionData(a,e,!0)):disabledActionResponse(a)},getInputElement=e=>{var{element:e,targetElement:t}=e;let a=e;return a="INPUT"!==a.tagName?t?t.closest("INPUT"):e?e.closest("INPUT"):"":a},updateCellData=async a=>{var e=isActionEnabled(a);console.log("ðŸš€ ~ updateCollection ~ actionEnabled:",e),a.element;return e?(new Promise(function(e,t){e(a)}),e=getInputElement(a),updateCellCollectionData(a,e)):disabledActionResponse(a)},updateCellCollectionData=async(t,e)=>{var a=t.parameters,{collectionRequest:a,successMessage:o,errorMessage:r,collection:s}=a;let n=!0;!t.parameters||a&&"Open"!=a||(n=!1);var i,t=e.getAttribute("data-id"),a={};let l;var c=e.getAttribute("data-column-name"),d=(console.log(c),{});d[c]=e.value;try{t&&(i=`collection-form/${s}/items/`+t,l=n?await securedPutCall(d,i):await unSecuredPutCall(d,i)),a.data=l,a.data.collectionSaveOrUpdateResponse=l,a.status="success";var u=a.data.collectionSaveOrUpdateResponse,{config:p,data:m}=u;let e=p.url;console.log("collectionName updateCollection",e),e=e.split("/items")[0],console.log("collectionName updateCollection",e);var g=m.uuid,f="collection_"+e,S={[f]:{uuid:g}},v=sessionStorage.getItem("previousActionResponse");v?(v=JSON.parse(v),sessionStorage.setItem("previousActionResponse",JSON.stringify({...v,...S}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(S)),a.data={...a.data,...S},o&&toastr.success(o,"Success")}catch(e){console.log("\n error :>> ",e),e.response&&(a.data=e.response,a.data.collectionSaveOrUpdateResponse=e.response,a.status="error"),r?toastr.error(r,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}return a},updateCollectionData=async(t,a,e=!1)=>{console.log("ðŸš€ ~ file: drapcode.js:5619 ~ updateCollectionData ~ args:",t);var o=await serializeFormData(a.elements),r=t.parameters,{collectionRequest:r,successMessage:s,errorMessage:n,passPreviousActionFormData:i,constructor:l,collection:c,resetFormData:d,formDataSessionKey:u,formDataBrowserStorageLocation:p,passPreviousActionResponse:m,responseDataSessionKey:g,responseDataSessionStorageLocation:f,enableConsoleLog:S,startConsoleLog:v,endConsoleLog:y}=r;S&&logActionMessage(cleanConsoleLogArgs(v));let h=!0,A=(!t.parameters||r&&"Open"!=r||(h=!1),!i||1!=i&&"true"!==i||(p&&u?setDataInSessionStorageLocation(p,u,o):(v=sessionStorage.getItem("previousActionFormData"))?(v=JSON.parse(v),sessionStorage.setItem("previousActionFormData",JSON.stringify({...v,...o}))):sessionStorage.setItem("previousActionFormData",JSON.stringify(o))),c&&l&&(t=await getIPAddress(),r={},_.merge(r,window.navigator),i=(i=sessionStorage.getItem("previousActionResponse"))?JSON.parse(i):{},p=(p=sessionStorage.getItem("previousActionFormData"))?JSON.parse(p):{},u=getBrowserData(),console.log("ðŸš€ ~ file: drapcode.js:5795 ~ updateCollectionData ~ browserData:",u),o.constructorMetaObj={collectionName:c,constructorId:l,ipAddress:t??"",navigator:r,...u,previousActionResponse:i,previousActionFormData:p}),removeEmptyDropzoneFields(a,o),a.getAttribute("action"));var{itemId:v,parentItemId:c,parentItemCollection:l}=await checkAndUpdateItemId(a);let E=a.getAttribute("itemidfield");t={};let I;o.isDraft=e;try{if(v)A=getNewEndPointUrl(v,A),I=h?await securedPutCall(o,A):(A="open/"+A,await unSecuredPutCall(o,A));else if(E&&E.includes(".")){var b=(I=h?await securedPostCall(o,A):(A="open/"+A,await unSecuredPostCall(o,A))).data,w=`collection-form/${l}/items/`+c,T=E.split("."),C={[E=T[0]||""]:b.uuid};let e="";e=h?await securedPutCall(C,w):(w="open/"+w,await unSecuredPutCall(C,w))}else I=h?await securedPutCall(o,A):(A="open/"+A,await unSecuredPutCall(o,A));t.data=I,t.data.collectionSaveOrUpdateResponse=I,t.status="success";var O=t.data.collectionSaveOrUpdateResponse,{config:R,data:D}=O;let e=R.url;console.log("collectionName updateCollection",e),e=e.split("collection-form/")[1],console.log("collectionName updateCollection",e),e=e.split("/items")[0],console.log("collectionName updateCollection",e);var F,P=D.uuid,N="collection_"+e,L={[N]:{uuid:P}},U={refCollectionFile:{file:o.refFile||"",refField:o.refField||""}};!m||1!=m&&"true"!==m?(F=sessionStorage.getItem("previousActionResponse"))?(F=JSON.parse(F),sessionStorage.setItem("previousActionResponse",JSON.stringify({...F,...L,...U}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(L)):setDataInSessionStorageLocation(f,g,{...D,...L,...U}),t.data={...t.data,...L,...U},d&&resetCollectionForm(a),s&&toastr.success(s,"Success")}catch(e){console.log("\n error :>> ",e),e.response&&(t.data=e.response,t.data.collectionSaveOrUpdateResponse=e.response,t.status="error"),n?toastr.error(n,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}return S&&logActionMessage(cleanConsoleLogArgs(y)),t},bulkUpdateCollection=async o=>{var r=isActionEnabled(o);if(console.log("ðŸš€ ~ bulkUpdateCollection ~ actionEnabled:",r),r){new Promise(function(e,t){e(o)});var r=await serializeFormData(o.element.elements),e=o.element,{collectionRequest:s,successMessage:n,errorMessage:i,passPreviousActionFormData:l}=o.parameters;let t=!o.parameters||s&&"Open"!=s?!0:!1;!l||1!=l&&"true"!==l||((s=sessionStorage.getItem("previousActionFormData"))?(s=JSON.parse(s),sessionStorage.setItem("previousActionFormData",JSON.stringify({...s,...r}))):sessionStorage.setItem("previousActionFormData",JSON.stringify(r)));l=e.getAttribute("action"),s=(e.getAttribute("method"),l+="/bulk/update",e.getElementsByClassName("alert-message")[0],e.getElementsByClassName("success-message")[0],{});let a;try{a=t?await securedPutCall(r,l):(l="open/"+l,console.log("endpoint 4:>> ",l),await unSecuredPutCall(r,l)),s.data=a,s.data.collectionSaveOrUpdateResponse=a,s.status="success";var c=s.data.collectionSaveOrUpdateResponse,{config:d,data:u}=c;let e=d.url;e=(e=e.split("collection-form/")[1]).split("/items")[0];var p=u.uuid,m="collection_"+e,g={[m]:{uuid:p}},f=sessionStorage.getItem("previousActionResponse");f?(f=JSON.parse(f),sessionStorage.setItem("previousActionResponse",JSON.stringify({...f,...g}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(g)),s.data={...s.data,...g},n&&toastr.success(n,"Success")}catch(e){e.response&&(s.data=e.response,s.data.collectionSaveOrUpdateResponse=e.response,s.status="error"),i?toastr.error(i,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}return s}return disabledActionResponse(o)},updateCollectionOnPageLoad=async p=>{var m=isActionEnabled(p);if(console.log("ðŸš€ ~ updateCollectionOnPageLoad ~ actionEnabled:",m),m){new Promise(function(e,t){e(p)});var{parameters:m,response:g,targetElement:f,url_params:S}=p;let{collection:e,collectionUpdateFields:t,updateFindBy:a,updateFindByResponseKeyForValue:o,successMessage:r,errorMessage:s}=m,n=g?g.data:"";m=g?g.collectionSaveOrUpdateResponse:"";let i="",l=sessionStorage.getItem("previousActionResponse"),c=sessionStorage.getItem("previousActionFormData");switch(l=l&&JSON.parse(l),c=c&&JSON.parse(c),a){case"collectionUuid":(i=f?f.getAttribute("data-item-id"):"")||(v=f.querySelector("button[type=submit]"),i=v?v.getAttribute("data-item-id"):"");break;case"previousResponse":i=n?n.uuid:"";break;case"previousActionResponse":l&&(i=o?_.get(l,o):"");break;case"previousActionFormData":c&&(i=o?_.get(c,o):"");break;case"SESSION_STORAGE":case"LOCAL_STORAGE":case"COOKIES":var v=getBSLData(a);v&&(i=v&&o?_.get(v,o.trim()):"");break;case"currentLoggedInUser":isLoggedInUser()&&(v=fetchLoggedInUserJson(),i=o?_.get(v,o):v?v.uuid:"");break;case"currentLoggedInUserTenant":isLoggedInUser()&&(v=fetchCurrentTenantJson(),i=o?_.get(v,o):v?v.uuid:"")}let d={};var y,h,A,E,I,g={};let u;try{console.log("ðŸš€ ~ file: drapcode.js:3513 ~ updateCollectionOnPageLoad ~ itemId:",i),i&&(y=`collection-table/${e}/item/`+i,I=await securedGetCall(y))&&200===I.status&&(u=I.data)&&(h=u.uuid,t.forEach(e=>{switch(e.valueFrom){case"previousActionResponse":l&&processFieldValueData(e,e.value&&l?_.get(l,e.value):"",u,d);break;case"browserSessionFormData":c&&processFieldValueData(e,e.value&&c?_.get(c,e.value):"",u,d);break;case"derived-field":processFieldValueData(e,n?getDerivedFieldData(e.value,n):u?getDerivedFieldData(e.value,u):"",u,d);break;case"currentLoggedInUser":isLoggedInUser()?(t=fetchLoggedInUserJson(),processFieldValueData(e,e.value&&t?_.get(t,e.value):"",u,d)):d[e.key]="";break;case"currentLoggedInUserTenant":isLoggedInUser()?(t=fetchCurrentTenantJson(),processFieldValueData(e,e.value&&t?_.get(t,e.value):"",u,d)):d[e.key]="";break;case"SESSION_STORAGE":case"LOCAL_STORAGE":case"COOKIES":var t=getBSLData(e.valueFrom);t&&(i=t&&o?_.get(t,o.trim()):"",processFieldValueData(e,e.value&&t?_.get(t,e.value):"",u,d));break;default:processFieldValueData(e,e.value,u,d)}}),console.log("ðŸš€ ~ file: drapcode.js:3644 ~ collectionUpdateFields.forEach ~ data:",d),S&&S.token?(A=`collection-form/${e}/items/`+S.id,console.log("ðŸš€ ~ file: drapcode.js:3703 ~ updateCollectionOnPageLoad ~ endpoint:",A),g.data=await securedPutCallWithToken(d,A,S.token)):(E="collection-form/"+e+"/items/"+h,console.log("ðŸš€ ~ file: drapcode.js:3703 ~ updateCollectionOnPageLoad ~ endpoint #1:",E),E="open/"+E,g.data=await unSecuredPutCall(d,E)),m&&(g.data={...g.data,...m}),g.status="success",r)&&toastr.success(r,"Success")}catch(e){e.response&&(g.data=e.response,g.status="error"),s?toastr.error(s,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}return console.log("ðŸš€ ~ file: drapcode.js:3940 ~ updateCollectionOnPageLoad ~ response:",g),g}return disabledActionResponse(p)},swalAlert=async(e,t="Delete",a=!1,o=!0,r="Cancel")=>Swal.fire({text:e,icon:"warning",showCancelButton:!0,confirmButtonText:t,cancelButtonText:r,confirmButtonColor:"#ff0055",cancelButtonColor:"#999999",reverseButtons:!1,focusConfirm:a,focusCancel:o}),deleteCollectionItem=async l=>{var c=isActionEnabled(l);if(console.log("ðŸš€ ~ deleteCollectionItem ~ actionEnabled:",c),c){new Promise(function(e,t){e(l)});let t=l.targetElement.getAttribute("data-item-id"),{collection:a,confirmationMessage:e,successMessage:o,collectionRequest:r,errorMessage:s}=l.parameters,n=!(!r||"Open"===r),i={};c=e||"Are you sure about deleting this item?";return await swalAlert(c).then(async e=>{if(e.isConfirmed){e=`collection-form/${a}/items/`+t;try{n?i.data=await securedDeleteCall(e):(e="open/"+e,i.data=await unSecuredDeleteCall(e)),200===i.data.status&&toastr.success(o||"Poof! Your item been deleted!","Success"),i.status="success"}catch(e){e.response&&(i.data=e.response,i.status="error",toastr.error(s||"This item could not be deleted right now.","Error"))}}else i.status="error"}),i}return disabledActionResponse(l)},resetTextArea=e=>{e=$(e).find(".textarea");e.length&&e.each(function(){var e=$(this);e[0].hasAttribute("data-show-editor")&&e.summernote("reset")})},resetDropzone=e=>{var t=$(e).find(".dropzone");let a=e?e.id:"";t&&t.length&&a&&t.each(function(){var e=$(this),e=e[0]?e[0].id:"";e&&(e=`dz_${a}_`+e,e=DropzoneMap[e])&&e.removeAllFiles()})},resetTimeslot=e=>{var t=$(e).find("[data-timeslot]"),e=(console.log("ðŸš€ ~ file: drapcode.js:4951 ~ resetTimeslot ~ timeslotElem:",t),e?e.id:""),a=t&&t.length;console.log("ðŸš€ ~ file: drapcode.js:4954 ~ resetTimeslot ~ isTimeslotFieldExist:",a),a&&e&&t.each(function(){$(this).remove()})},resetCollectionForm=e=>{e&&e.hasAttribute("persistdata")||(e.reset(),Array.from(e.getElementsByClassName("file-list-display")).forEach(function(e){e.innerHTML="Select file"}),$(e).find(".select").val("").trigger("change"),resetTextArea(e),resetDropzone(e),resetTimeslot(e))},addToCollectionItem=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ addToCollectionItem ~ actionEnabled:",e),e){new Promise(function(e,t){e(a)});var e=await serializeFormData(a.element.elements),t=a.element,o=a.parameters.collectionRequest,{itemId:r,dataItemId:s}=e,{formElementCollection:n,formElementCollectionId:i,formParentCollection:l,itemId:c}=a.element.dataset,o=!(!o||"Open"===o),d={},n=(d[n]=s||c,s||(e.dataItemId=c),Object.assign(e,d),`collection-form/${l}/items/${r}/fields/`+i),s=(t.getAttribute("method"),{});try{o?s.data=await securedPostCall(e,n):(n="open/"+n,s.data=await unSecuredPostCall(e,n)),s.status="success",s.data.forNextStep="ADD",resetCollectionForm(t)}catch(e){e.response&&(s.data=e.response,s.status="error")}return s}return disabledActionResponse(a)},removeFromCollectionItem=async n=>{var e=isActionEnabled(n);if(console.log("ðŸš€ ~ removeFromCollectionItem ~ actionEnabled:",e),e){new Promise(function(e,t){e(n)});let t=await serializeFormData(n.element.elements),a=n.element;var{collectionRequest:e,confirmationMessage:i}=n.parameters,{itemId:l,dataItemId:c}=t,{formElementCollection:d,formElementCollectionId:u,formParentCollection:p,itemId:m}=n.element.dataset;let o=!(!e||"Open"===e);e={};e[d]=c||m,c||(t.dataItemId=m),Object.assign(t,e);let r=`collection-form/${p}/items/${l}/fields/`+u;a.getAttribute("method");let s={};d=i||"Are you sure about removing this item?";return await swalAlert(d).then(async e=>{if(e.isConfirmed)try{o?s.data=await securedPutCall(t,r):(r="open/"+r,s.data=await unSecuredPutCall(t,r)),s.status="success",s.data.forNextStep="REMOVE",resetCollectionForm(a)}catch(e){e.response&&(s.data=e.response,s.status="error")}else s.data=e,s.status="cancel"}),s}return disabledActionResponse(n)},checkAndLoadNonPersistentItemId=(r,s,n,i,l,c=!1)=>{if("NON_PERSISTENT_COLLECTION"===r){let e=s,t="",a="";console.log("ðŸš€ ~ checkAndLoadNonPersistentItemId element:",n),(n&&!n.getAttribute("data-item-id")||!s)&&(r=window.location.pathname.split("/"),e=r[r.length-1],t=r[r.length-2],s=n?n.closest("div[id^=modal-container]"):"",a=s?s.querySelector("[id=project-modal-external-api]"):"")&&(r=n.querySelector("button[type=submit]"),s=n.querySelector("button[data-gjs=action-submit]"),r?e=r?r.getAttribute("data-item-id"):"":s&&(e=s?s.getAttribute("data-item-id"):""));var n=a||getExternalAPISpan(),r={},{requestMapping:s,uniqueKey:l}=(l?initialiseExternalApiData(l,r):n&&initialiseExternalApiDataFromSpan(n,r),r);let o=t?e:e||uuidv4(16);console.log("ðŸš€ ~ checkAndLoadNonPersistentItemId non-persistent item Id:",e," ~ item Id:",o),o=replaceUnderscoreWithSlash(o),i.externalApiItem={id:o,uuid:o,_data_source_rest_api_primary_id:o,nonPersistentCollectionItemId:o,pageCollectionName:t,uniqueKey:l||"id",fromTargetElem:c},s&&0<s.length&&s.forEach(e=>{"uuid"==e.value&&(i.externalApiItem[e.key]=o)})}},checkAndLoadNonPersistentItemIdForSelect=(t,e,a=!1)=>{var o=(e||{}).bodyDataFrom;if(o&&"NON_PERSISTENT_COLLECTION"===o){var o={},{requestMapping:e,uniqueKey:o}=(e&&initialiseExternalApiData(e,o),o);const r=uuidv4(16);r=replaceUnderscoreWithSlash(r),t.externalApiItem={id:r,uuid:r,_data_source_rest_api_primary_id:r,nonPersistentCollectionItemId:r,pageCollectionName:"",uniqueKey:o||"id",fromTargetElem:a},e&&0<e.length&&e.forEach(e=>{"uuid"==e.value&&(t.externalApiItem[e.key]=r)})}},loadFormData=async(e,t,a)=>t=e&&"FORM"===e.tagName?await serializeFormData(a.element.elements,!0):t,logoutUser=async function(a){var e=isActionEnabled(a);if(console.log("ðŸš€ ~ logoutUser ~ actionEnabled:",e),!e)return disabledActionResponse(a);new Promise(function(e,t){e(a)});e=a.parameters.redirectUrl;await processLogoutUser(e)},processLogoutUser=async t=>{console.log("processLogoutUser afterLogoutRedirectUrl send to login page:>> ",t);try{let e=fetchLoggedInUser();e=e&&JSON.parse(e);var a,o,r=validateCookieToken();r&&(a=await getHeaderForServerForPublicRequest(r),o=await axios.post("/logout",{},a),extractCookieToken(o.headers),200===o.status)&&(window.localStorage.clear(),await loginActivityTracker("Logout",e?.userName,e?.tenant?.uuid),removeCookie(TENANT_ID_COOKIE_KEY),removeCookie("oAuthAccessToken"),window.location=t)}catch(e){console.log("e logout",e)}},saveCollectionData=async(e,t,a=!1)=>{var o=e.parameters,{constructor:o,collectionRequest:r,successMessage:s,errorMessage:n,passPreviousActionFormData:i,resetFormData:l,collection:c,formDataSessionKey:d,formDataBrowserStorageLocation:u,passPreviousActionResponse:p,responseDataSessionKey:m,responseDataSessionStorageLocation:g,enableConsoleLog:f,startConsoleLog:S,endConsoleLog:v}=o;f&&logActionMessage(cleanConsoleLogArgs(S));let y=await serializeFormData(t.elements),h=(c===COLLECTION_SURVEY_ANSWER&&(console.log("*** Going to submit survey answer..."),S=(new Date).getTime()+"-"+uuidv4(),y.batch_id=S,y.answers=[],y)&&"undefined"!==y&&Object.keys(y).forEach(async e=>{e.startsWith("ans-")&&(e={question:e.split("ans-")[1],answer:y[e]},y.answers.push(e))}),!0);!e.parameters||r&&"Open"!=r||(h=!1),!i||1!=i&&"true"!==i||(u&&d?setDataInSessionStorageLocation(u,d,y):(S=sessionStorage.getItem("previousActionFormData"))?(S=JSON.parse(S),sessionStorage.setItem("previousActionFormData",JSON.stringify({...S,...y}))):sessionStorage.setItem("previousActionFormData",JSON.stringify(y))),c&&o&&(e=await getIPAddress(),r={},_.merge(r,window.navigator),i=(i=sessionStorage.getItem("previousActionResponse"))?JSON.parse(i):{},u=(u=sessionStorage.getItem("previousActionFormData"))?JSON.parse(u):{},d=getBrowserData(),console.log("ðŸš€ ~ file: drapcode.js:6706 ~ saveCollectionData ~ browserData:",d),y.constructorMetaObj={collectionName:c,constructorId:o,ipAddress:e??"",navigator:r,...d,previousActionResponse:i,previousActionFormData:u});S=t.getAttribute("action")+"/constructor/"+o,c={};let A;y.isDraft=a;try{A=h?await securedPostCall(y,S):(S="open/"+S,await unSecuredPostCall(y,S)),c.data=A,c.data.collectionSaveOrUpdateResponse=A,c.data.collectionFormData=y,c.status="success";var E=c.data.collectionSaveOrUpdateResponse,{config:I,data:b}=E;let e=I.url;e=(e=e.split("collection-form/")[1]).split("/items")[0];var w,T=b.uuid,C="collection_"+e,O={[C]:{uuid:T}},R={refCollectionFile:{file:y.refFile||"",refField:y.refField||""}};!p||1!=p&&"true"!==p?(w=sessionStorage.getItem("previousActionResponse"))?(w=JSON.parse(w),sessionStorage.setItem("previousActionResponse",JSON.stringify({...w,...O,...R}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(O)):setDataInSessionStorageLocation(g,m,{...b,...O,...R}),c.data={...c.data,...O,...R},(!a||l)&&resetCollectionForm(t),s&&toastr.success(s,"Success")}catch(e){e.response&&(c.data=e.response,c.data.collectionSaveOrUpdateResponse=e.response,c.status="error"),n?toastr.error(n,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}return f&&logActionMessage(cleanConsoleLogArgs(v)),c};async function loginUser(a){var e=isActionEnabled(a),{element:t,parameters:o}=(console.log("ðŸš€ ~ loginUser ~ actionEnabled:",e),a),{authErrorMessage:r,notFoundErrorMessage:s,othersErrorMessage:n}=o,r={authErrorMessage:r||"",notFoundErrorMessage:s||"",othersErrorMessage:n||""};if(!e)return disabledActionResponse(a);new Promise(function(e,t){e(a)});s=t,n=await serializeFormData(s.elements),e=s.getElementsByClassName("alert-message")[0];(n.hasOwnProperty("email")&&""!==n.email||n.hasOwnProperty("phone_number")&&""!==n.phone_number)&&validateLoginFormData(n,n),a.response&&201!==a.response.status?a.response.data.status:await loginIntoApplication(n,null,e,o.redirectRules,LOGIN_USER,r)}let loginWithOAuth2=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ loginWithOAuth2 ~ actionEnabled:",e),!e)return disabledActionResponse(a);new Promise(function(e,t){e(a)});e=a.parameters,e={type:"LOGIN",successRedirectRules:e.successRedirectRules||"",errorRedirectUrl:e.errorRedirectUrl||"",successMessage:e.successMessage||"",errorMessage:e.errorMessage||""};sendOAuth2Call(e)},signUpWithOAuth2=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ signUpWithOAuth2 ~ actionEnabled:",e),!e)return disabledActionResponse(a);new Promise(function(e,t){e(a)});e=a.parameters,e={type:"SIGNUP",role:e.userRole||"",successRedirectUrl:e.successRedirectUrl||"",errorRedirectUrl:e.errorRedirectUrl||"",successMessage:e.successMessage||"",errorMessage:e.errorMessage||""};sendOAuth2Call(e)},sendOAuth2Call=e=>{e=JSON.stringify(e);e=btoa(e);window.open("/login-oauth2/?params="+e,"_self")},loginWithFacebook=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ loginWithFacebook ~ actionEnabled:",e),!e)return disabledActionResponse(a);new Promise(function(e,t){e(a)});var e=a.parameters,{successRedirectRules:e="",errorRedirectUrl:t="",successMessage:o="",errorMessage:r=""}=e,e={type:"LOGIN",successRedirectRules:e,errorRedirectUrl:t,successMessage:o,errorMessage:r};sendSocialLoginOauthCall(e,"facebook")},signUpWithFacebook=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ signUpWithFacebook ~ actionEnabled:",e),!e)return disabledActionResponse(a);new Promise(function(e,t){e(a)});var e=a.parameters,{userRole:e="",successRedirectUrl:t="",errorRedirectUrl:o="",successMessage:r="",errorMessage:s=""}=e,e={type:"SIGNUP",role:e,successRedirectUrl:t,errorRedirectUrl:o,successMessage:r,errorMessage:s};sendSocialLoginOauthCall(e,"facebook")},loginWithTwitter=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ loginWithTwitter ~ actionEnabled:",e),!e)return disabledActionResponse(a);new Promise(function(e,t){e(a)});var e=a.parameters,{successRedirectRules:e="",errorRedirectUrl:t="",successMessage:o="",errorMessage:r=""}=e,e={type:"LOGIN",successRedirectRules:e,errorRedirectUrl:t,successMessage:o,errorMessage:r};sendSocialLoginOauthCall(e,"twitter")},signUpWithTwitter=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ signUpWithTwitter ~ actionEnabled:",e),!e)return disabledActionResponse(a);new Promise(function(e,t){e(a)});var e=a.parameters,{userRole:e="",successRedirectUrl:t="",errorRedirectUrl:o="",successMessage:r="",errorMessage:s=""}=e,e={type:"SIGNUP",role:e,successRedirectUrl:t,errorRedirectUrl:o,successMessage:r,errorMessage:s};sendSocialLoginOauthCall(e,"twitter")},sendSocialLoginOauthCall=(e,t)=>{t="/auth/"+t,e=JSON.stringify(e),e=btoa(e),t=t+"/?params="+e;window.open(t,"_self")};async function loginUserWithXano(a){var e=isActionEnabled(a);if(console.log("ðŸš€ ~ loginUserWithXano ~ actionEnabled:",e),!e)return disabledActionResponse(a);new Promise(function(e,t){e(a)});var e=a.element,t=e.getElementsByClassName("alert-message")[0],e={userName:e.elements.userName.value,password:e.elements.password.value};a.response&&201!==a.response.status?a.response.data.status:await loginIntoApplication(e,null,t,a.parameters.redirectRules,LOGIN_WITH_XANO)}async function loginUserWithBackendless(a){var e=isActionEnabled(a);if(console.log("ðŸš€ loginUserWithBackendless ~ actionEnabled:",e),!e)return disabledActionResponse(a);new Promise(function(e,t){e(a)});var e=a.element,t=e.getElementsByClassName("alert-message")[0],e={userName:e.elements.userName.value,password:e.elements.password.value};a.response&&201!==a.response.status?a.response.data.status:await loginIntoApplication(e,null,t,a.parameters.redirectRules,LOGIN_WITH_BACKENDLESS)}let loginUserWithToken=async function(a){var e=isActionEnabled(a);if(console.log("ðŸš€ ~ loginUserWithToken ~ actionEnabled:",e),!e)return disabledActionResponse(a);new Promise(function(e,t){e(a)});e={token:a.url_params.token};await loginIntoApplication(e,null,null,a.parameters.redirectRules,LOGIN_WITH_TOKEN)},signUpUser=async function(a){var t=isActionEnabled(a);if(console.log("ðŸš€ signUpUser ~ actionEnabled:",t),t){new Promise(function(e,t){e(a)});var o,r,{element:t,parameters:s}=a,n=await serializeFormData(t.elements),i=(n.userRoles=s.userRole,await fetchInstalledPluginByCode("MULTI_TENANT_SAAS")),i=await fetchUserSettingCollection(i);n.tenantId&&i&&(o={tenantId:n.tenantId},r=`open/collection-form/${i.collectionName}/items/`,(o=await unSecuredPostCall(o,r)).data.uuid)&&(n.userSettingId=[o.data.uuid]);let e={};return n.hasOwnProperty("password")&&""===n.password?((r=t.elements.password).classList.add("error"),(o=document.createElement("label")).setAttribute("id",r.id+"-error"),o.setAttribute("class","error"),o.setAttribute("for",""+r.id),o.innerHTML=r.placeholder||"Please enter password",r.insertAdjacentElement("afterend",o),e.data=r.placeholder||"Please enter password",e.status="error"):(n.hasOwnProperty("password")||n.password||(n.password=Math.floor(1e5+9e5*Math.random()).toString()),(e=await processSignUpUser(n,"auth/user",t,s)).data.data.uuid&&(e.data.userSignupId=e.data.data.uuid,propagateCollectionItemIdInSession(e.data.data.uuid,COLLECTION_USER),n.userSettingId)&&(o={userId:e.data.data.uuid},r=`open/collection-form/${i.collectionName}/items/`+n.userSettingId,await unSecuredPutCall(o,r))),e}return disabledActionResponse(a)},processSignUpUser=async function(e,t,a,o){var a=a.getElementsByClassName("alert-message")[0],{successMessage:o,errorMessage:r}=o,s={};try{s.data=await publicPostCall(e,t),s.status="success",a&&(a.style.display="none"),o&&toastr.success(o,"Success")}catch(e){a?(r?a.innerHTML=r:e.response&&e.response.data?a.innerHTML=e.response.data:a.innerHTML="Username or Email already exists",a.style.display="block",a.classList.add("mt-3")):r?toastr.error(r,"Error"):e.response&&e.response.data?toastr.error(e.response.data,"Error"):toastr.error("Username or Email already exists","Error"),e.response&&(s.data=e.response,s.status="error")}return s},signUpUserWithXano=async function(a){var e,t,o=isActionEnabled(a);return console.log("ðŸš€ ~ signUpUserWithXano ~ actionEnabled:",o),o?(new Promise(function(e,t){e(a)}),{element:o,parameters:e}=a,(t=await serializeFormData(o.elements)).userRoles=e.userRole,await processSignUpUser(t,"auth/user/xano",o,e)):disabledActionResponse(a)},signUpUserWithBackendless=async function(a){var e,t,o=isActionEnabled(a);return console.log("ðŸš€ ~ signUpUserWithBackendless ~ actionEnabled:",o),o?(new Promise(function(e,t){e(a)}),{element:o,parameters:e}=a,(t=await serializeFormData(o.elements)).userRoles=e.userRole,await processSignUpUser(t,"auth/user/backendless",o,e)):disabledActionResponse(a)},showErrorOnField=(e,t,a,o)=>{t.hasOwnProperty(a)&&""===t[a]&&((t=e.elements[a]).classList.add("error"),(e=document.createElement("label")).setAttribute("id",t.id+"-error"),e.setAttribute("class","error"),e.setAttribute("for",""+t.id),e.innerHTML=t.placeholder||o,t.insertAdjacentElement("afterend",e))},signupAndLoginAnonymousUser=async function(a){var t=isActionEnabled(a);if(console.log("ðŸš€ ~ signupAndLoginAnonymousUser ~ actionEnabled:",t),t){new Promise(function(e,t){e(a)});var t=a.element,e=await serializeFormData(t.elements),{userRole:o,redirectUrl:r}=a.parameters,o=(e.userRoles=o,showErrorOnField(t,e,"userName","Please enter username"),showErrorOnField(t,e,"password","Please enter password"),e.password||(e.password="anonymous-login"),e.userName||(e.userName="anonymous-user-login"),{userName:e.userName,password:e.password}),t=(e.hasOwnProperty("email")&&""!==e.email&&(o.email=e.email,validateLoginFormData(e,o)),{});try{t.data=await publicPostCall(e,"auth/anonymous-user");var s=clearDataForSessionStorage(e);t.data.data.uuid&&(t.data.userSignupId=t.data.data.uuid,o.userName=t.data.data.userName,t.data.collectionSaveOrUpdateResponse=t.data),t.data.collectionFormData=s,await loginIntoApplication(o,r,null,a.parameters.redirectRules,LOGIN_ANONYMOUS_USER)}catch(e){e.response&&(t.data=e.response,t.status="error",e.response.data?toastr.error(e.response.data,"Error"):toastr.error("Username or Email already exists","Error"))}return t}return disabledActionResponse(a)},signupAndLoginUser=async function(a){var e=isActionEnabled(a);if(console.log("ðŸš€ ~ signupAndLoginUser ~ actionEnabled:",e),!e)return disabledActionResponse(a);new Promise(function(e,t){e(a)});var e=a.element,t=await serializeFormData(e.elements),{userRole:o,redirectUrl:r}=a.parameters;t.userRoles=o;if(!t.hasOwnProperty("password")||""!==t.password){t.hasOwnProperty("password")||t.password||(t.password=Math.floor(1e5+9e5*Math.random()).toString());var o={userName:t.userName,password:t.password},s=(t.hasOwnProperty("email")&&""!==t.email&&(o.email=t.email,validateLoginFormData(t,o)),{});try{s.data=await publicPostCall(t,"auth/user");var n=clearDataForSessionStorage(t);s.data.data.uuid&&(s.data.userSignupId=s.data.data.uuid,s.data.collectionSaveOrUpdateResponse=s.data),s.data.collectionFormData=n,await loginIntoApplication(o,r,null,a.parameters.redirectRules,LOGIN_USER)}catch(e){e.response&&(s.data=e.response,s.status="error",e.response.data?toastr.error(e.response.data,"Error"):toastr.error("Username or Email already exists","Error"))}return s}(t=e.elements.password).classList.add("error"),(n=document.createElement("label")).setAttribute("id",t.id+"-error"),n.setAttribute("class","error"),n.setAttribute("for",""+t.id),n.innerHTML=t.placeholder||"Please enter password",t.insertAdjacentElement("afterend",n)},resetNewPassword=async function(a){var t=isActionEnabled(a);if(console.log("ðŸš€ ~ resetNewPassword ~ actionEnabled:",t),!t)return disabledActionResponse(a);new Promise(function(e,t){e(a)});var t=a.element,o=a.parameters,r=t.getElementsByClassName("alert-message")[0],s=t.getElementsByClassName("success-message")[0],{password:o,confirmPassword:e}=o,o={password:o?t.elements[o]?t.elements[o].value:"":t.elements.password.value,confirmPassword:o?t.elements[e]?t.elements[e].value:"":t.elements.confirmPassword.value};if(""===o.password&&""===o.confirmPassword)toastr.error("Please fill this field","Error");else if(o.password!==o.confirmPassword)r.innerHTML="password and confirm password does not match",s.style.display="none",r.style.display="block",r.classList.add("mt-3");else try{var n=Object.fromEntries(new URLSearchParams(window.location.search));let e=n.token||"";n.token||(e=(e=localStorage.getItem("token"))?e.split(" ")[1].trim():""),await securedPostCallWithToken(o,"auth/reset-password/",e),t.reset(),s.innerHTML="Your password has been successfully updated",s.style.display="block",s.classList.add("mt-3"),r.style.display="none",window.location="/login"}catch(e){401===e.response.status&&(r.innerHTML=e.response.data.message,s.style.display="none",r.style.display="block",r.classList.add("mt-3"),window.location="/forget-password")}},chnageOldPassword=async function(a){var e=isActionEnabled(a);if(console.log("ðŸš€ ~ chnageOldPassword ~ actionEnabled:",e),!e)return disabledActionResponse(a);new Promise(function(e,t){e(a)});var e=a.element,t=a.parameters,o=e.getElementsByClassName("alert-message")[0],r=e.getElementsByClassName("success-message")[0],{oldPassword:t,password:s,confirmPassword:n}=t,t={oldPassword:s?e.elements[t]?e.elements[t].value:"":e.elements.oldPassword.value,password:s?e.elements[s]?e.elements[s].value:"":e.elements.password.value,confirmPassword:s?e.elements[n]?e.elements[n].value:"":e.elements.confirmPassword.value};if(""===t.password&&""===t.confirmPassword)toastr.error("Please fill this field","Error");else if(t.password!==t.confirmPassword)o.innerHTML="Password and Confirm password does not match",r.style.display="none",o.style.display="block",o.classList.add("mt-3");else try{await securedPostCall(t,"auth/change-passoword/");e.reset(),r.innerHTML="Your password has been successfully updated",r.style.display="block",r.classList.add("mt-3"),o.style.display="none"}catch(e){401===e.response.status&&(o.innerHTML=e.response.data.message,r.style.display="none",o.style.display="block",o.classList.add("mt-3"))}},handlePageRedirection=(e,t,a)=>{var o=window.localStorage,{token:r,projectId:s,role:n,userDetails:i,tenant:l,userSetting:c}=e||"";o.setItem("token",r),setJsonInLocalStorage("user",i),o.setItem("projectId",s),o.setItem("role",n),removeCookie(TENANT_ID_COOKIE_KEY),l?(setJsonInLocalStorage("tenant",l),setCookie(TENANT_ID_COOKIE_KEY,l.uuid,1)):o.removeItem("tenant"),console.log("loggedInUser drapcode.js ln 7968",e),c?(console.log("userSetting in drapcode.js ln 7970",c),setJsonInLocalStorage("userSetting",c)):o.removeItem("userSetting");let d=(i||{}).userRoles;a&&(r=a.find(e=>Array.isArray(d)?d.includes(e.role):e.role===d),console.log("redirectUrl :>> ",r),t=r?r.page:""),console.log("redirectPage:>>"+t),t&&(console.log("Redirecting to"+t),window.location.href=""+t)};async function verifyTwoFactorAuthentication(a){var t=isActionEnabled(a),{element:o,parameters:r}=(console.log("ðŸš€ ~ verifyTwoFactorAuthentication ~ actionEnabled:",t),a);if(t){new Promise(function(e,t){e(a)});t=o,o=await serializeFormData(t.elements),t=t.getElementsByClassName("alert-message")[0],r=r.redirectRules;try{var e,s={},n=await axios.post("/authorize-secret-code",o,s),i=n.data;if(console.log("loggedInUser",i),n&&200===n.status){console.log("Handling redirect"),await loginActivityTracker("Login",i?.userDetails?.userName,i?.tenant?.uuid),await handlePageRedirection(i,null,r);let t=(i.userDetails||{}).userRoles;r&&(e=r.find(e=>Array.isArray(t)?t.includes(e.role):e.role===t))&&e.successMessage&&toastr.success(e.successMessage,"Success")}}catch(e){o=e.response;if(o){var{status:s,data:n}=o;let e="";e=(e=n&&({message:i,error:r}=n,i||r)?i||r:e)||(403===s?"Verification Code is wrong. Please try again":404===s||400===s?"This user does not exists.":"Some Internal error. Please contact support."),t?(t.style.display="block",t.classList.add("mt-3"),t.innerHTML=e):toastr.error(e,"Error")}}}}let loginIntoApplication=async function(a,o,r=null,s=null,n=LOGIN_USER,i={}){try{let e="",t={};if(n===LOGIN_WITH_TOKEN){var l=validateCookieToken();if(!l)return;t=await getHeaderForSeverForSecuredRequestWithToken(a.token,l),e="/login-with-token"}else e=n===LOGIN_WITH_XANO?"/login/xano":n===LOGIN_WITH_BACKENDLESS?"/login/backendless":n===LOGIN_ANONYMOUS_USER?"/login?authType=anonymous":"/login";var c,d=await axios.post(e,a,t),u=d.data;if(console.log("loggedInUser :>> ",JSON.stringify(u)),console.log("redirectRules :>> ",JSON.stringify(s)),d&&200===d.status)if(console.log("1=>1"),await loginActivityTracker("Login",u?.userDetails?.userName,u?.tenant?.uuid),console.log("1=>2"),u.redirectTo){console.log("1=>3");var p,m=s.find(e=>"TWO_FACTOR_AUTH"===e.role);console.log("redirectUrlForAuth",m),"VERIFY"===u.redirectTo?window.location="/verification-step":"REGISTER"===u.redirectTo&&(p=(u||"").userDetails,setJsonInLocalStorage("user",p),window.location=m.registerTwoFactorAuthPage)}else{console.log("1"),await handlePageRedirection(u,o,s),console.log("2");let t=(u.userDetails||{}).userRoles;console.log("3"),s&&(console.log("4"),c=s.find(e=>(console.log("5"),Array.isArray(t)?(console.log("6"),t.includes(e.role)):(console.log("7"),e.role===t))),console.log("8",c),c)&&c.successMessage&&(console.log("9"),toastr.success(c.successMessage,"Success"))}}catch(e){l=e.response;if(l){let{status:e,data:t}=l,a="";t&&({message:n,error:d}=t,(n||d)&&(a=n||d),handleLoginErrorMessage(r,a,e,i))}}},handleLoginErrorMessage=(e,t,a,o={})=>{var{authErrorMessage:o,notFoundErrorMessage:r,othersErrorMessage:s}=o;let n=o||r||s?401===a?o||"":404===a||400===a?r||"":s||"":"";n=n||t||(401===a?"Username or password does not match. Please try again":404===a||400===a?"This user does not exists.":"Some Internal error. Please contact support."),e?(e.style.display="block",e.classList.add("mt-3"),e.innerHTML=n):toastr.error(n,"Error")},urlFromCurrentPageRef=async(e,t)=>{var a,o;return t&&(a=(await getPageItemData()).itemData,[t,o]=t.split(":"),e+=`/${o}/`+parseValueFromData(a,t+".uuid")),e},buildCollectionUrlSegment=(e,t)=>e&&t?`/${e}/`+t:"",handleCurrentObjectUrl=e=>{if(!e||"undefined"===e)return{};var{status:t,data:a,collectionSaveOrUpdateResponse:o,externalApiResponse:r,userSignupId:s}=e;if("error"===t)return{error:e};t=(o||r||e).config;let n=t.url.split("collection-form/")[1]?.split("/items")[0]||"",i=a.uuid;return!n&&s?(n=COLLECTION_USER,i=s):!i&&n&&(o=JSON.parse(sessionStorage.getItem("previousActionResponse")||"{}"),i=o["collection_"+n]?.uuid),{collectionName:n,itemId:i}},handlePreviousStepUrl=(e,t)=>{if(!e||"undefined"===e)return{};e=JSON.parse(sessionStorage.getItem("previousActionResponse")||"{}");let a=e[PARENT_COLLECTION_PROPAGATE_KEY]?.name,o=e[PARENT_COLLECTION_PROPAGATE_KEY]?.uuid;return a&&o||(a=t?.getAttribute("data-collection-id"),o=t?.getAttribute("data-item-id")),{collectionName:a,itemId:o}},updateSessionStorage=(e,t)=>{t={[PARENT_COLLECTION_PROPAGATE_KEY]:{uuid:t,name:e}},e=JSON.parse(sessionStorage.getItem("previousActionResponse")||"{}");sessionStorage.setItem("previousActionResponse",JSON.stringify({...e,...t}))},buildRedirectUrl=async e=>{var{parameters:{sendItemIdFrom:t,destination:a,referenceField:o,bslCollection:r,browserStorageLocation:s,itemIdBSLKey:n,sendExternalApiMiddlewareId:i},response:l,targetElement:c}=e;let d=a;if(t)switch(t){case URL_STRATEGIES.CURRENT_OBJECT:var{collectionName:u,itemId:p,error:m}=handleCurrentObjectUrl(l);if(m)return{error:m};u&&p&&(updateSessionStorage(u,p),d+=buildCollectionUrlSegment(u,p));break;case URL_STRATEGIES.PREVIOUS_STEP:var{collectionName:m,itemId:u}=handlePreviousStepUrl(l,c);m&&u&&(d+=buildCollectionUrlSegment(m,u));break;case URL_STRATEGIES.CURRENT_PAGE:d=urlFromCurrentPage(d);break;case URL_STRATEGIES.CURRENT_USER:p=fetchLoggedInUserJson();p?.uuid&&(d+=buildCollectionUrlSegment(COLLECTION_USER,p.uuid));break;case URL_STRATEGIES.TARGET_ITEM:m=c?.getAttribute("data-collection-id"),u=c?.getAttribute("data-item-id");d+=buildCollectionUrlSegment(m,u);break;case URL_STRATEGIES.PAGE_REFERENCE:d=await urlFromCurrentPageRef(d,o);break;case URL_STRATEGIES.BSL_ITEM:p=getBSLData(s),m=p&&n?_.get(p,n.trim()):"";r&&m&&(d+=buildCollectionUrlSegment(r,m))}else if(l&&"undefined"!==l){var{status:a,data:t}=l;if("error"===a)return{error:l};i&&(a=t.externalApiMiddlewareId,d+="?externalId="+a),!0===e.parameters.sendCurrentObjectID||"true"===e.parameters.sendCurrentObjectID?({collectionName:i,itemId:t}=handleCurrentObjectUrl(l),i&&t&&(updateSessionStorage(i,t),d+=buildCollectionUrlSegment(i,t))):!0===e.parameters.sendPreviousStepParentCollectionId||"true"===e.parameters.sendPreviousStepParentCollectionId?({collectionName:a,itemId:i}=handlePreviousStepUrl(l,c),a&&i&&(d+=buildCollectionUrlSegment(a,i))):!0===e.parameters.sendCurrentUserId||"true"===e.parameters.sendCurrentUserId?(t=fetchLoggedInUserJson())?.uuid&&(d+=buildCollectionUrlSegment(COLLECTION_USER,t.uuid)):!0===e.parameters.sendCurrentPageItemId||"true"===e.parameters.sendCurrentPageItemId?d=urlFromCurrentPage(d):!0===e.parameters.sendCurrentPageReferenceItemId||"true"===e.parameters.sendCurrentPageReferenceItemId?d=await urlFromCurrentPageRef(d,o):!0!==e.parameters.sendTargetItemID&&"true"!==e.parameters.sendTargetItemID||(a=c?.getAttribute("data-collection-id"),i=c?.getAttribute("data-item-id"),a&&i&&(d+=buildCollectionUrlSegment(a,i)))}else!0===e.parameters.sendCurrentUserId||"true"===e.parameters.sendCurrentUserId?(t=fetchLoggedInUserJson())?.uuid&&(d+=buildCollectionUrlSegment(COLLECTION_USER,t.uuid)):!0===e.parameters.sendCurrentPageItemId||"true"===e.parameters.sendCurrentPageItemId?d=urlFromCurrentPage(d):!0===e.parameters.sendCurrentPageReferenceItemId||"true"===e.parameters.sendCurrentPageReferenceItemId?d=await urlFromCurrentPageRef(d,o):!0!==e.parameters.sendTargetItemID&&"true"!==e.parameters.sendTargetItemID||(a=c?.getAttribute("data-collection-id"),i=c?.getAttribute("data-item-id"),a&&i&&(d+=buildCollectionUrlSegment(a,i)));return{url:d}},goToPage=async a=>{if(!isActionEnabled(a))return disabledActionResponse(a);try{new Promise(e=>e(a));let{url:e,error:t}=await buildRedirectUrl(a);if(t)return t;console.log("ðŸš€ ~ goToPage ~ urlToRedirect:",e);var{isNewTab:o}=a.parameters;o?setTimeout(()=>{window.open(e,"_blank").focus()}):window.location=e}catch(e){return console.error("Error in goToPage:",e),{status:"error",message:e.message}}},dynamicPageRedirect=async s=>{var n=isActionEnabled(s);if(console.log("ðŸš€ ~ dynamicPageRedirect ~ actionEnabled:",n),!n)return disabledActionResponse(s);{new Promise(function(e,t){e(s)});let{element:e,parameters:d,response:u,targetElement:p}=s||"",m=e&&"FORM"===e.tagName?e:"",{collectionFrom:g,fieldName:t,redirectRules:a,collectionName:o}=d,f=e.dataset.collectionItem?JSON.parse(e.dataset.collectionItem):{},r={};"collections"===g?(f&&Object.keys(f).length||!m||(n=(n=m.querySelector("button[type=submit]"))?n.getAttribute("data-item-id"):"")&&(n=await getCollectionItemById(o,n))&&(f={...n}),r=f):"collectionForm"===g?(f=u&&u.collectionSaveOrUpdateResponse?u.collectionSaveOrUpdateResponse.data:{},r=f):"page"===g?(n=(await getPageItemData()).itemData,r=n):"session"===g&&(n=fetchLoggedInUserJson(),r=n||{});let S="",v=(S="sessionActionResponse"===g?(S=parseSessionObject(t))&&S.toString():parseValueFromData(r,t),""),y=!0;if(await Promise.all(a.map(async a=>{new Promise(function(e,t){e(a)});var{fieldValue:o,page:r,pathField:s,seoField:n,target:i,fieldCollectionSource:l}=a;if(o===S){let e="",t="",a="";if(s){var c,o=await getUrlWithSeoAndPathField(s,null,g,f,d,p);switch(e=o.pathId,t=o.pathCollection,l){case"formCollection":m&&(c=u&&u.collectionSaveOrUpdateResponse?u.collectionSaveOrUpdateResponse.data:"",e=c?c.uuid:"",t=m.dataset.formCollection);break;case"cmsCollection":e=m?(c=m.querySelector("button[type=submit]"),t=c?c.getAttribute("data-collection-id"):"",c?c.getAttribute("data-item-id"):""):(t=p?p.getAttribute("data-collection-id"):"",p?p.getAttribute("data-item-id"):"")}}n&&(a=await getUrlWithSeoAndPathField(null,n,g,f,d,p)),v="/"+r,(v=e&&t?`${v}/${t}/`+(a||"")+e:v)&&(y=!1),i?setTimeout(()=>{window.open(v,"_blank").focus()}):window.location=v}})),y){let t=["null","NULL","DEFAULT","EMPTY"];var i,n=a&&a.length?a.find(e=>t.includes(e.fieldValue.trim())):"";n&&({page:n,target:i}=n,v="/"+n,i?setTimeout(()=>{window.open(v,"_blank").focus()}):window.location=v)}}},getUrlWithSeoAndPathField=async(e,t,a,o,r,s)=>{let{fieldFrom:n,collectionName:i,fieldName:l}=e?JSON.parse(e):JSON.parse(t);var r=(r??"").collectionName;let c={};return"eventCollection"===n&&"page"===a?(a=(await getPageItemData()).itemData,c=a):"eventCollection"===n?c=o:"session"===n&&("PAGE_COLLECTION"===i?({itemData:a,collectionId:o}=await getPageItemData(),c=a,i=o,l="uuid"):(a=fetchLoggedInUserJson(),c=a)),e?("previousStepCollectionItemId"===n?(i=r,o=parseSessionObject("collection_"+i),pathId=(pathId=o?o.uuid:"")||(s?s.getAttribute("data-item-id"):"")):"currentCollectionItem"===n&&"PARENT_COLLECTION"===i?(a=s&&"FORM"===s.tagName?s:"",pathId=a?(e=a.querySelector("button[type=submit]"),i=e?e.getAttribute("data-collection-id"):"",e?e.getAttribute("data-item-id"):""):(i=s?s.getAttribute("data-collection-id"):"",s?s.getAttribute("data-item-id"):""),l="uuid"):pathId=parseValueFromData(c,l),{pathId:pathId,pathCollection:i}):t?(r=parseValueFromData(c,l),slugify(r)):void 0},reloadPage=e=>{var t=isActionEnabled(e);if(console.log("ðŸš€ ~ reloadPage ~ actionEnabled:",t),!t)return disabledActionResponse(e);window.location.reload()},refreshSection=async function(a){var o=isActionEnabled(a);if(console.log("ðŸš€ ~ refreshSection ~ actionEnabled:",o),!o)return disabledActionResponse(a);new Promise(function(e,t){e(a)});var o=a.parameters.refreshComponent,r=a.parameters.refreshComponentPosition,s=o.split(":")[0],o=o.split(":")[1],n=document.getElementById(o);if(n&&n.attributes.getNamedItem("data-js")&&n.attributes["data-js"].value===s){let e={},t={};paginationDataMap.get("pdata_"+o)&&(e=paginationDataMap.get("pdata_"+o));var n=dataTablePaginationDataMap.get("ptdata_"+o);"End"===r||"Beginning"===r?await appendPrepend(n,a.response,r):(n&&(t=n).fieldName&&(console.log("Loading Page Item Data 1"),s=(await getPageItemData()).itemData,o=parseValueFromData(s,t.fieldName),o=Array.isArray(o)?o:0<Object.keys(o).length?[o]:[],t.itemIds=o),e&&void 0!==e.replacedElement&&(r=e.numberPerPage,n=e.currentPage,e.fieldName&&(console.log("Loading Page Item Data 2"),s=(await getPageItemData()).itemData,o=parseValueFromData(s,e.fieldName),o=Array.isArray(o)?o:0<Object.keys(o).length?[o]:[],e.itemIds=o),modifyPaginationDataForRefresh(e),loadGroupData(e),resetPaginationData(e,r,n)),t&&void 0!==t.dataTable&&loadDataList(t))}},updateCurrentLoggedInUserData=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ updateCurrentLoggedInUserData ~ actionEnabled:",e),e){new Promise(function(e,t){e(a)});var t,o,r,s,n,{element:e,parameters:i}=a||"",e=(e||"").elements,e=await serializeFormData(e),{successMessage:i,errorMessage:l,constructor:c}=i||"",d=COLLECTION_USER,c=(d&&c&&(u=await getIPAddress(),t={},_.merge(t,window.navigator),o=(o=sessionStorage.getItem("previousActionResponse"))?JSON.parse(o):{},r=(r=sessionStorage.getItem("previousActionFormData"))?JSON.parse(r):{},s=getBrowserData(),console.log("ðŸš€ ~ file: drapcode.js:8211 ~ updateCurrentLoggedInUserData ~ browserData:",s),e.constructorMetaObj={collectionName:d,constructorId:c,ipAddress:u??"",navigator:t,...s,previousActionResponse:o,previousActionFormData:r}),{});if(isLoggedInUser()){var u=`collection-form/${d}/items/`+fetchLoggedInUserJson().uuid;try{n=await securedPutCall(e,u),c.data=n,c.data.collectionSaveOrUpdateResponse=n,c.status="success";var p=c.data.collectionSaveOrUpdateResponse,m=p.data,g=m.uuid,f={["collection_"+d]:{uuid:g}},S=sessionStorage.getItem("previousActionResponse");S?(S=JSON.parse(S),sessionStorage.setItem("previousActionResponse",JSON.stringify({...S,...f}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(f)),c.data={...c.data,...f},await resetCurrentUserInLocalStorage(),i&&toastr.success(i,"Success")}catch(e){e.response&&(c.data=e.response,c.data.collectionSaveOrUpdateResponse=e.response,c.status="error"),l?toastr.error(l,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}}else toastr.error(l||"User not logged in!","Error");return c}return disabledActionResponse(a)},updateCurrentTenantData=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ updateCurrentTenantData ~ actionEnabled:",e),e){new Promise(function(e,t){e(a)});var t,o,r,s,n,{element:e,parameters:i}=a||"",e=(e||"").elements,e=await serializeFormData(e),{successMessage:i,errorMessage:l,constructor:c}=i||"",d=(await fetchMultiTenantCollection(await fetchInstalledPluginByCode("MULTI_TENANT_SAAS"))).collectionName,c=(d&&c&&(u=await getIPAddress(),t={},_.merge(t,window.navigator),o=(o=sessionStorage.getItem("previousActionResponse"))?JSON.parse(o):{},r=(r=sessionStorage.getItem("previousActionFormData"))?JSON.parse(r):{},s=getBrowserData(),console.log("ðŸš€ ~ file: drapcode.js:8310 ~ updateCurrentTenantData ~ browserData:",s),e.constructorMetaObj={collectionName:d,constructorId:c,ipAddress:u??"",navigator:t,...s,previousActionResponse:o,previousActionFormData:r}),{});if(isLoggedInTenant()){var u=`collection-form/${d}/items/`+fetchCurrentTenantJson().uuid;try{n=await securedPutCall(e,u),c.data=n,c.data.collectionSaveOrUpdateResponse=n,c.status="success";var p=c.data.collectionSaveOrUpdateResponse,m=p.data,g=m.uuid,f={["collection_"+d]:{uuid:g}},S=sessionStorage.getItem("previousActionResponse");S?(S=JSON.parse(S),sessionStorage.setItem("previousActionResponse",JSON.stringify({...S,...f}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(f)),c.data={...c.data,...f},await resetCurrentTenantInLocalStorage(),i&&toastr.success(i,"Success")}catch(e){e.response&&(c.data=e.response,c.data.collectionSaveOrUpdateResponse=e.response,c.status="error"),l?toastr.error(l,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}}else toastr.error(l||"Tenant not logged in!","Error");return c}return disabledActionResponse(a)},updateCurrentUserSettingData=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ updateCurrentUserSettingData ~ actionEnabled:",e),e){new Promise(function(e,t){e(a)});var t,o,r,s,n,{element:e,parameters:i}=a||"",e=(e||"").elements,e=await serializeFormData(e),{successMessage:i,errorMessage:l,constructor:c}=i||"",d=(await fetchUserSettingCollection(await fetchInstalledPluginByCode("MULTI_TENANT_SAAS"))).collectionName,c=(d&&c&&(u=await getIPAddress(),t={},_.merge(t,window.navigator),o=(o=sessionStorage.getItem("previousActionResponse"))?JSON.parse(o):{},r=(r=sessionStorage.getItem("previousActionFormData"))?JSON.parse(r):{},s=getBrowserData(),console.log("ðŸš€ ~ file: drapcode.js:8408 ~ updateCurrentUserSettingData ~ browserData:",s),e.constructorMetaObj={collectionName:d,constructorId:c,ipAddress:u??"",navigator:t,...s,previousActionResponse:o,previousActionFormData:r}),{});if(isLoggedInUserSetting()){var u=`collection-form/${d}/items/`+fetchCurrentUserSettingsJson().uuid;try{n=await securedPutCall(e,u),c.data=n,c.data.collectionSaveOrUpdateResponse=n,c.status="success";var p=c.data.collectionSaveOrUpdateResponse,m=p.data,g=m.uuid,f={["collection_"+d]:{uuid:g}},S=sessionStorage.getItem("previousActionResponse");S?(S=JSON.parse(S),sessionStorage.setItem("previousActionResponse",JSON.stringify({...S,...f}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(f)),c.data={...c.data,...f},await resetCurrentTenantInLocalStorage(),i&&toastr.success(i,"Success")}catch(e){e.response&&(c.data=e.response,c.data.collectionSaveOrUpdateResponse=e.response,c.status="error"),l?toastr.error(l,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}}else toastr.error(l||"Tenant not logged in!","Error");return c}return disabledActionResponse(a)},addUserToTenant=async a=>{var o=isActionEnabled(a);if(console.log("ðŸš€ ~ addUserToTenant ~ actionEnabled:",o),o){new Promise(function(e,t){e(a)});var{element:o,parameters:d}=a;let{successMessage:n,errorMessage:t,confirmationMessage:e}=d,i=a.targetElement.getAttribute("data-item-id");d=o&&"FORM"===o.tagName?o:"";let l=d?await serializeFormData(d.elements):"",c={};if(isLoggedInUser())try{var u=await fetchInstalledPluginByCode("MULTI_TENANT_SAAS");if(u){let o=fetchLoggedInUserJson();var p=fetchCurrentTenantJson();let r="",s=await fetchUserSettingCollection(u);p?r=p.uuid:toastr.error("Tenant not found!","Error");var m=`collection-table/${COLLECTION_USER}/items/`,g=await securedGetCall(m);if(200===g.status){var f=g.data;let a="uuid";if(d&&l&&(l.hasOwnProperty("userName")?a="userName":l.hasOwnProperty("email")&&(a="email")),a){let t="";(t=d&&l?f&&f.find(e=>e[a]===l[a]):f&&f.find(e=>e[a]===i))&&await fetchMultiTenantCollection(u)&&(e?await swalAlert(e,"Proceed",!0,!1).then(async e=>(e.isConfirmed?(c=await addTenantReferenceToUser(void 0,c,o,t,r,s,n)).confirmation=e:(c.confirmation=e,c.status="cancel"),c)):c=await addTenantReferenceToUser(void 0,c,o,t,r,s,n))}}}else toastr.error("Multi Tenant SaaS plugin not found!","Error")}catch(e){e.response&&(c.data=e.response,c.data.collectionSaveOrUpdateResponse=e.response,c.status="error"),t?toastr.error(t,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}else toastr.error(t||"User not logged in!","Error");return c}return disabledActionResponse(a)},addNewUserToTenant=async f=>{var S=isActionEnabled(f);if(console.log("ðŸš€ ~ addNewUserToTenant ~ actionEnabled:",S),S){new Promise(function(e,t){e(f)});var{element:S,parameters:v,targetElement:y}=f;let{successMessage:l,errorMessage:t,userRole:e,confirmationMessage:c,userSettings:d,passPreviousActionFormData:a,formDataSessionKey:o,formDataBrowserStorageLocation:r,passPreviousActionResponse:s,responseDataSessionKey:n,responseDataSessionStorageLocation:i}=v,u=y.getAttribute("data-item-id");var h=S&&"FORM"===S.tagName?S:"";let p=h?await serializeFormData(h.elements):"";var A=clearDataForSessionStorage(p);!a||1!=a&&"true"!==a||r&&o&&setDataInSessionStorageLocation(r,o,A);let m={};if(u||(A=y.querySelector("button[type=submit]"),u=A?A.getAttribute("data-item-id"):""),isLoggedInUser())try{var E=await fetchInstalledPluginByCode("MULTI_TENANT_SAAS");if(E){let s=fetchLoggedInUserJson();var I=fetchCurrentTenantJson();let n="",i=await fetchUserSettingCollection(E);I?n=I.uuid:toastr.error("Tenant not found!","Error");var b=`collection-table/${COLLECTION_USER}/items/`,w=await securedGetCall(b);if(200===w.status){var T=w.data;let a="uuid",o=!1,r="";if(h&&p&&(p.hasOwnProperty("userName")?a="userName":p.hasOwnProperty("email")&&(a="email"),p.hasOwnProperty("tenantRoleMapping"))&&(o=!0,r=p.tenantRoleMapping),a){let t="";h&&p&&p[a]?(t=T&&T.find(e=>e[a]===p[a]),console.log("ðŸš€ ~ file: drapcode.js:6495 ~ addNewUserToTenant ~ selectedUser:",t)):t=T&&T.find(e=>e[a]===u),t?await fetchMultiTenantCollection(E)&&(c?await swalAlert(c,"Proceed",!0,!1).then(async e=>(e.isConfirmed?(m=await addTenantReferenceToUser(void 0,m,s,t,n,d?i:null,l,o,r)).confirmation=e:(m.confirmation=e,m.status="cancel"),m)):m=await addTenantReferenceToUser(void 0,m,s,t,n,d?i:null,l,o,r)):m=await createUserWithTenantReference(S,v,m,e,p,n,d?i:null,c)}}}else toastr.error("Multi Tenant SaaS plugin not found!","Error")}catch(e){e.response&&(m.data=e.response,m.data.collectionSaveOrUpdateResponse=e.response,m.status="error"),t?toastr.error(t,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}else toastr.error(t||"User not logged in!","Error");let g=m;return g?.data&&(g=g.data)?.data&&(g=g.data),!s||1!=s&&"true"!==s||setDataInSessionStorageLocation(i,n,g),m}return disabledActionResponse(f)},removeUserFromTenant=async a=>{var o=isActionEnabled(a);if(console.log("ðŸš€ ~ removeUserFromTenant ~ actionEnabled:",o),o){new Promise(function(e,t){e(a)});var{element:o,parameters:c,targetElement:r}=a;let{successMessage:s,errorMessage:t,confirmationMessage:e}=c,n=a.targetElement.getAttribute("data-item-id");c=o&&"FORM"===o.tagName?o:"";let i=c?await serializeFormData(c.elements):"",l={};if(n||(o=r.querySelector("button[type=submit]"),n=o?o.getAttribute("data-item-id"):""),isLoggedInUser())try{var d=await fetchInstalledPluginByCode("MULTI_TENANT_SAAS");if(d){let o=fetchLoggedInUserJson();var u=fetchCurrentTenantJson();let r="";u?r=u.uuid:toastr.error("Tenant not found!","Error");var p=`collection-table/${COLLECTION_USER}/items/`,m=await securedGetCall(p);if(200===m.status){var g=m.data;let a="uuid";if(c&&i&&(i.hasOwnProperty("userName")?a="userName":i.hasOwnProperty("email")&&(a="email")),a){let t="";c&&i&&i[a]?(t=g&&g.find(e=>e[a]===i[a]),console.log("ðŸš€ ~ file: drapcode.js:6637 ~ removeUserFromTenant ~ selectedUser:",t)):t=g&&g.find(e=>e[a]===n),t&&await fetchMultiTenantCollection(d)&&(e?await swalAlert(e,"Proceed",!0,!1).then(async e=>(e.isConfirmed?(l=await removeTenantReferenceFromUser(t,r,void 0,l,o,s)).confirmation=e:(l.confirmation=e,l.status="cancel"),l)):l=await removeTenantReferenceFromUser(t,r,void 0,l,o,s))}}}else toastr.error("Multi Tenant SaaS plugin not found!","Error")}catch(e){e.response&&(l.data=e.response,l.data.collectionSaveOrUpdateResponse=e.response,l.status="error"),t?toastr.error(t,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}else toastr.error(t||"User not logged in!","Error");return l}return disabledActionResponse(a)},appendPrepend=async(a,o,r)=>{if(o&&0!==Object.keys(o).length){let{data:e,forNextStep:t}=o;if(t){if("REMOVE"===t){o=e.dataItemId;if(o){let e=document.querySelector(`tr>td>form[data-item-id="${o}"]`).parentNode;"TR"===e.nodeName?e.remove():"TR"!==(e=e.parentNode).nodeName&&"TR"!==(e=e.parentNode).nodeName||e.remove()}}else if("ADD"===t){o=e.itemData;if(a&&"undefined"!==a){var{fieldName:s,dataTable:n}=a;let t=e[s][0];n&&n.innerHTML&&n.innerHTML.includes(t)||(e=o[s].find(e=>e.uuid===t),await processPrependAndAppend(e,a,r))}}}else await processPrependAndAppend(e,a,r)}else console.log("No response came from server")},processPrependAndAppend=async(e,t,a)=>{var{firstRowElements:t,columnsMap:o,tbodyElement:r,dataTable:s}=t,e=getTableColumns(e,o,t),o="TR"===t.tagName?t:"";let n="";o&&(t=o.cloneNode(!0),n=elementAttribute(o,"id"),applyUserDefinedStyles(t,o,dataTableStylesMap));t=`<tr ${setIdAttribute(n)}>${e}</tr>`,o=r.innerHTML,r.innerHTML="","End"===a?r.innerHTML=o+t:"Beginning"===a&&(r.innerHTML=t+o),e=s.getAttribute("id"),a=document.getElementById(e);$(a).find(".no-record-data-table").remove()},modifyPaginationDataForRefresh=async function(e){e.numberPerPage=e.currentPage*e.numberPerPage,e.currentPage=1;var t=createContentPlaceholder(e.replacedElement.childElementCount||1,e.dataGroupChildren[0].id,e.dataGroupChildren[0].className);e.replacedElement.innerHTML=t},SERVER_URL=(resetPaginationData=async function(e,t,a){e.numberPerPage=t,e.currentPage=a},getBackendServerUrl()),localStorage=window.localStorage,getHeaderForSeverForSecuredRequest=async e=>{var t=localStorage.getItem("token"),a=localStorage.getItem("projectId"),o=isLoggedInUser()?fetchCurrentTenantJson():"",o=o?o.uuid:"",r=await getIPAddress(),{status:s,message:n}=await checkTokenExpiry(t);if(console.log("Message: ",n),200===s)return n={headers:{"Content-Type":"application/json","x-project-id":a,JSESSIONID:e,authorization:t,"x-user-ip":r}},o&&(n.headers["x-tenant-id"]=o),n},getHeaderForSeverForSecuredRequestWithToken=async(e,t)=>{var a=await checkTokenExpiry(e),o=await getIPAddress(),{status:a,message:r}=a;if(console.log("Message: ",r),200===a)return{headers:{"Content-Type":"application/json",authorization:"Bearer "+e,JSESSIONID:t,"x-user-ip":o}}},getHeaderForServerForPublicRequest=async e=>{var t=localStorage.getItem("projectId"),a=localStorage.getItem("token"),o=isLoggedInUser()?fetchCurrentTenantJson():"",o=o?o.uuid:"",t={headers:{"Content-Type":"application/json","x-project-id":t,JSESSIONID:e,"x-user-ip":await getIPAddress()}};if(a)try{var{status:r,message:s}=await checkTokenExpiry(a);console.log("Message: ",s),200===r&&(t.headers.authorization=a,o)&&(t.headers["x-tenant-id"]=o)}catch(e){console.log("error: ",e)}return t},headerMultipartFormDataForPublicRequest=async e=>{var t=await getIPAddress();return{headers:{"Content-Type":"multipart/form-data","x-hostname":window.location.hostname,JSESSIONID:e,"x-user-ip":t}}},headerJsonDataForPublicRequest=async e=>{var t=await getIPAddress();return{headers:{"Content-Type":"application/json","x-hostname":window.location.hostname,JSESSIONID:e,"x-user-ip":t}}},fetchValidCookie=()=>{var e=("; "+document.cookie).split("; JSESSIONID=");if(2===e.length)return e.pop().split(";").shift()},validateCookieToken=()=>{var e=fetchValidCookie();return e||(toastr.error("Failed to authorize request. Please reload the page.","Error"),"")},saveCookieToken=e=>{var t=new Date;t.setTime(t.getTime()+18e5),document.cookie=`JSESSIONID=${e}; expires=${t.toUTCString()}; path=/`},extractCookieToken=e=>{e=e.jsessionid;e&&saveCookieToken(e)},publicPostCall=async(e,t)=>{var a=validateCookieToken();if(a)return a=await headerJsonDataForPublicRequest(a),t=await axios.post(getBackendServerUrl()+t,e,a),extractCookieToken(t.headers),t},publicGetCall=async t=>{try{var e,a,o=validateCookieToken();if(o)return console.log("I don't have token, don't make call"),e=await getHeaderForServerForPublicRequest(o),a=await axios.get(getBackendServerUrl()+t,e),extractCookieToken(a.headers),a}catch(e){if(e.response){o=e.response.status;if(401==o&&t.includes("finder"))return{data:t.includes("count")?0:[],_$isPrivateFilter:!0}}throw Error(e)}},unSecuredPostCall=async(e,t)=>{var a=validateCookieToken();if(a)return a=await getHeaderForServerForPublicRequest(a),t=await axios.post(SERVER_URL+t,e,a),extractCookieToken(t.headers),t},securedPostCall=async(e,t)=>{var a=validateCookieToken();if(a)return a=await getHeaderForSeverForSecuredRequest(a),t=await axios.post(SERVER_URL+t,e,a),extractCookieToken(t.headers),t},securedGetCall=async t=>{try{var e,a,o=validateCookieToken();if(o)return e=await getHeaderForSeverForSecuredRequest(o),a=await axios.get(SERVER_URL+t,e),extractCookieToken(a.headers),a}catch(e){if(e.response){o=e.response.status;if(401==o&&t.includes("finder"))return{data:t.includes("count")?0:[],_$isPrivateFilter:!0}}throw Error(e)}},securedPutCall=async(e,t)=>{var a=validateCookieToken();if(a)return a=await getHeaderForSeverForSecuredRequest(a),t=await axios.put(SERVER_URL+t,e,a),extractCookieToken(t.headers),t},unSecuredPutCall=async(e,t)=>{var a=validateCookieToken();if(a)return a=await getHeaderForServerForPublicRequest(a),t=await axios.put(SERVER_URL+t,e,a),extractCookieToken(t.headers),t},securedDeleteCall=async e=>{var t=validateCookieToken();if(t)return t=await getHeaderForSeverForSecuredRequest(t),e=await axios.delete(SERVER_URL+e,t),extractCookieToken(e.headers),e},unSecuredDeleteCall=async e=>{var t=validateCookieToken();if(t)return t=await getHeaderForServerForPublicRequest(t),e=await axios.delete(SERVER_URL+e,t),extractCookieToken(e.headers),e},multipartFormDataPublicCall=async(e,t)=>{var a=validateCookieToken();if(a)return await headerMultipartFormDataForPublicRequest(a),a=await axios.post(SERVER_URL+t,e),extractCookieToken(a.headers),a},multipartFormDataSecuredCall=async(e,t)=>{var a=validateCookieToken();if(a)return a=await headerMultipartFormDataForPublicRequest(a),t=await axios.post(SERVER_URL+t,e,a),extractCookieToken(t.headers),t},getCall=async e=>{var t=validateCookieToken();if(t)return t=await getHeaderForSeverForSecuredRequest(t),e=await axios.get(SERVER_URL+e,t),extractCookieToken(e.headers),e},downloadFile=async(t,a={})=>{var o=validateCookieToken();if(o){var r,s,n,i,l,o=await getHeaderForServerForPublicRequest(o);try{let e=null;return(e=0<Object.keys(a).length?await axios({url:""+SERVER_URL+t,method:"POST",data:a,responseType:"blob",headers:o.headers}):await axios({url:""+SERVER_URL+t,method:"POST",responseType:"blob",headers:o.headers}))&&({data:r,headers:s}=e,extractCookieToken(s),s["content-disposition"]?(n=s["content-disposition"].replace(/\w+; filename="(.*)"/,"$1"),r&&(i=window.URL.createObjectURL(new Blob([r],{type:s["content-type"]})),(l=document.createElement("a")).href=i,l.setAttribute("download",n),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i))):toastr.warning("Export data setting is not configured.","Configuration required!")),{failed:!1,data:{message:"PDF Downloaded Successfully",status:200}}}catch(t){if(t.response){let e=t.response.data;return console.log("%c error.response.data.type","color:red",t.response.data.type),"blob"===t.request.responseType&&t.response.data instanceof Blob&&(console.log("%c inside if condition","color:blue"),e=await t.response.data.text(),t.response.data.type)&&-1!=t.response.data.type.toLowerCase().indexOf("json")&&(e=JSON.parse(e)),console.log("%c errorString","color:red",e),{failed:!0,data:{message:e,status:t.response.status}}}return{failed:!0,data:{message:t.message,status:t.status}}}}},securedPostCallWithToken=async(e,t,a)=>{var o=validateCookieToken();if(o)return a=await getHeaderForSeverForSecuredRequestWithToken(a,o),o=await axios.post(SERVER_URL+t,e,a),extractCookieToken(o.headers),o},securedPutCallWithToken=async(e,t,a)=>{var o=validateCookieToken();if(o)return a=await getHeaderForSeverForSecuredRequestWithToken(a,o),o=await axios.put(SERVER_URL+t,e,a),extractCookieToken(o.headers),o},system_show_component=async function(a){var e=isActionEnabled(a);if(console.log("ðŸš€ ~ system_show_component ~ actionEnabled:",e),e){new Promise(function(e,t){e(a)});e=a.parameters.showComponents.split(":")[1],e=document.getElementById(e);if(!e)return null;e.classList.contains("d-none")&&e.classList.remove("d-none");var t=e.style.display;e.style.display=t&&"none"!==t?t:"block",e.style.visibility="visible"}},system_hide_component=async function(a){var e=isActionEnabled(a);if(console.log("ðŸš€ ~ system_hide_component ~ actionEnabled:",e),e){new Promise(function(e,t){e(a)});e=a.parameters.hideComponents.split(":")[1],e=document.getElementById(e);if(!e)return null;e.classList.contains("d-none")||e.classList.add("d-none"),e.style.display="none",e.style.visibility="hidden"}},getFormDataOfElement=e=>{let a={};return Object.values(e.elements).map(e=>{var t;e.name&&("hidden"!==e.type&&"SELECT"===e.tagName?(t=[...e.selectedOptions].map(e=>e.value),a[e.name]=1===t.length?t.join(""):t):a[e.name]=e.value)}),a},serializeFormData=async(a=[],o=!1)=>{var r={};for(let t=0;t<a.length;t++){var s,n=a[t];let e;e="file"===n.type&&o?(s=n.files,(s=await createFileInServerLocal(s,n,e))?s.path||"":n.value||""):"radio"===n.type||"checkbox"===n.type&&"select"===$(n).attr("data-component-type")?n.checked?n.value:"":"checkbox"===n.type?n.checked:"SELECT"===n.tagName?1===(s=[...n.selectedOptions].map(e=>e.value)).length?s.join(""):s.filter(e=>""!==e):"tel"===$(n).attr("type")?$(n).intlTelInput("getNumber"):"number"===n.type?""===n.value?"":Number(n.value):"datetime-local"===$(n).attr("flat-picker-date-type")?(e=n.value?flatpickr.parseDate(n.value,"Z"):"",moment(e).isValid()?moment(e).format("YYYY-MM-DDTHH:mm:ss"):""):"text"===n.type&&n.hasAttribute("data-component-type")&&"time_picker"===n.getAttribute("data-component-type")?n.value&&(n.value.includes("AM")||n.value.includes("PM"))?(e=n.value?moment(n.value,"hh:mm A"):"",moment(e).isValid()?moment(e).format("HH:mm"):""):trim(n.value):"hidden"===n.type&&n.hasAttribute("data-file-upload-component")?(r.refFile=JSON.parse(n.getAttribute("data-file-upload-component")),n.hasAttribute("ref-field-file-upload-component")&&(r.refField=n.getAttribute("ref-field-file-upload-component")),n.value?trim(n.value).split(","):r.refFile.length?"":[]):trim(n.value),"file"===n.type&&e.includes("fakepath")&&(e="");n=n.getAttribute("name");if(n){var i=n.split(".");let t="",a=r;for(let e=0;e<i.length-1;e++)(t=i[e]).includes("[")&&(t=t.replace("[]","")),a[t]||(a[t]={}),a=a[t];(t=i[i.length-1]).includes("[")&&(t=t.replace("[]","")),a[t]?(n=a[t]+","+e,a[t]=e?n.split(","):a[t]):a[t]=e}}return console.log("ðŸš€ ~ file: drapcode.js:8577 ~ serializeFormData ~ data:",r),r},findFieldValueFromFormData=(e,t)=>{let a={};return Object.values(e.elements).map(e=>{var t;e.name&&("hidden"!==e.type&&"SELECT"===e.tagName?(t=[...e.selectedOptions].map(e=>e.value),a[e.name]=1===t.length?t.join(""):t):a[e.name]=e.value)}),a},sortTableColumn=(c,d)=>{if(console.log("*** Sorting Table Column :>> ",c,"Id :>>",d),d){var u=document.getElementById(d);let a,o,r,s,n,e=0,t=!0,i=!1,l="ascending";for(;t;){for(t=!1,o=u.rows,a=o[0].getElementsByTagName("TH")[c],r=1;r<o.length-1;r++){i=!1,s=o[r].getElementsByTagName("TD")[c],n=o[r+1].getElementsByTagName("TD")[c];let e=s.textContent.toLowerCase(),t=n.textContent.toLowerCase();if(e&&!isNaN(e)&&(e=Number(e)),t&&!isNaN(t)&&(t=Number(t)),"ascending"==l){if(a.children[0].classList.remove("sortable-desc"),a.children[0].classList.add("sortable-asc"),e>t){i=!0;break}}else if("descending"==l&&(a.children[0].classList.remove("sortable-asc"),a.children[0].classList.add("sortable-desc"),e<t)){i=!0;break}}i?(o[r].parentNode.insertBefore(o[r+1],o[r]),t=!0,e++):0==e&&"ascending"==l&&(l="descending",t=!0)}}},customPageRedirect=a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ customPageRedirect ~ actionEnabled:",e),e){new Promise(function(e,t){e(a)});var{redirectValueFrom:t,destination:o,responseDataSessionKey:r,responseDataSessionStorageLocation:s}=a.parameters;let e=o;switch(t){case"SESSION":(e="SESSION"===t?customPageRedirectFromSessionValue(o,e):e)&&(window.location=e);break;case"BASE64_FORM_SUBMIT_SESSION_VALUE":customPageRedirectBase64SessionValue(o);break;case"FORM_SUBMIT_SESSION_VALUE":customPageRedirectHtmlSessionValue(o);break;case"BROWSER_STORAGE":(e=getValueFromBrowserStorage(s,r,o))&&(window.location=e);break;default:e&&(window.location=e)}}},getContentFromSessionObject=(e,t)=>_.get(e,t),createFileInServerLocal=async(e,t,a)=>{var o=new FormData;let r="";return e&&0<e.length&&(o.append("file",e[0]),e=(await multipartFormDataSecuredCall(o,"file/upload/local")).data,r=e||""),r},registerServiceWorker=async()=>{console.log("Checking to enable PWA...");var e=await getProjectDetail();if(e){e=e.enablePWA;if(e&&"serviceWorker"in navigator)try{var t=await navigator.serviceWorker.register("/serviceWorker.js",{scope:"./"});t.installing?console.log("%c==> Service worker installing","color:yellow"):t.waiting?console.log("%c==> Service worker installed","color:cyan"):t.active&&console.log("%c==> Service worker active","color: yellowGreen")}catch(e){console.error("%c==> Registration failed with "+e,"color:red")}}},getProjectDetail=async()=>{var e,t=getHostnameShort();let a=JSON.parse(sessionStorage.getItem("__projD_"+t));return a||(e=(await publicGetCall("projects/detail/")).data,a={...e},sessionStorage.setItem("__projD_"+t,JSON.stringify(e)),populateBrowserStorageKeyToReset("__projD_"+t)),!localStorage.getItem("projectId")&&a&&localStorage.setItem("projectId",a.uuid),a},getCollectionDetails=async e=>{var t=`collection-details/${e}/name`;let a=JSON.parse(sessionStorage.getItem("__colD_"+e));return a||(t=(await publicGetCall(t)).data,a={...t},sessionStorage.setItem("__colD_"+e,JSON.stringify(t)),populateBrowserStorageKeyToReset("__colD_"+e)),a},getCollectionDetailsById=async e=>{var t=`collection-details/${e}/id`;let a=JSON.parse(sessionStorage.getItem("__colD_"+e));return a||(t=(await publicGetCall(t)).data,a={...t},sessionStorage.setItem("__colD_"+e,JSON.stringify(t)),populateBrowserStorageKeyToReset("__colD_"+e)),a},getCollectionItems=async e=>{var t=`items/${e}/collection`;let a=JSON.parse(sessionStorage.getItem("__colItems_"+e));return a||(t=(await publicGetCall(t)).data,a={...t},sessionStorage.setItem("__colItems_"+e,JSON.stringify(t)),populateBrowserStorageKeyToReset("__colItems_"+e)),a},getCollectionItemById=async(t,a,o=!1)=>{var r=`collection-table/${t}/item/`+a;let s=JSON.parse(sessionStorage.getItem(`__colItem_${t}_`+a));if(!s){let e="";e=o?(o=(await securedGetCall(r)).data,{...o}):(o=(await publicGetCall(r)).data,{...o}),s={...e},sessionStorage.setItem(`__colItem_${t}_`+a,JSON.stringify(e)),populateBrowserStorageKeyToReset(`__colItem_${t}_`+a)}return s},getCollectionItemByIdDetailsPage=async(t,a,o=!1)=>{var r=`collection-table/${t}/item/`+a;let s=JSON.parse(sessionStorage.getItem(`__dp_colItem_${t}_`+a));if(!s){let e="";e=o?(o=(await securedGetCall(r)).data,{...o}):(o=(await publicGetCall(r)).data,{...o}),s={...e},sessionStorage.setItem(`__dp_colItem_${t}_`+a,JSON.stringify(e)),populateBrowserStorageKeyToReset(`__dp_colItem_${t}_`+a,!0)}return s},parseSessionObject=(e,t="previousActionResponse")=>{let a="";t=sessionStorage.getItem(t);return t&&(t=JSON.parse(t),a=getContentFromSessionObject(t,e)),a},customPageRedirectFromSessionValue=(e,t)=>{e=parseSessionObject(e);return e||""},customPageRedirectBase64SessionValue=e=>{var e=parseSessionObject(e);e&&(e=window.atob(e),e=URL.createObjectURL(new Blob([e],{type:"text/html"})),window.open(e,"_self","width=800,height=400,screenX=200,screenY=200"))},customPageRedirectHtmlSessionValue=e=>{var e=parseSessionObject(e);e&&(e=URL.createObjectURL(new Blob([e],{type:"text/html"})),window.open(e,"_self","width=800,height=400,screenX=200,screenY=200"))},getValueFromBrowserStorage=(e,t,a)=>{if(!e)return"";if(!t)return"";let o="";switch(e){case"LOCAL_STORAGE":o=localStorage.getItem(t);break;case"COOKIES":o=getCookie(t),o=decodeURIComponent(o);break;default:o=sessionStorage.getItem(t)}return o=a?getBrowserStorageValue(o,a):o},getBrowserStorageValue=(e,t)=>{let a="";return e&&(e=JSON.parse(e),a=getContentFromSessionObject(e,t)),a},toggleAllDataTableItems=(e,t)=>{var a=e.target;if(a&&t){var o=document.getElementById(t).querySelectorAll("[data-gjs=dt-item-check]");for(let e=0;e<o.length;e++)"checkbox"==o[e].type&&(o[e].checked=a.checked)}},renderSurveySubmissionForm=async(o,e)=>{let r=o.querySelector("[class*=form-container]"),s=r.lastElementChild;o=window.location.pathname.split("/");o[o.length-2];let t=o[o.length-1],n=t=t&&t.includes("_")?t.split("_")[1]:t,a=e,i=`collection-table/${a}/item/`+n,l=await securedGetCall(i),c=l.data;if(l&&200===l.status&&c&&"object"==typeof c){let e=await securedGetCall("collection-table/questionnaire_survey_field/items"),t=e.data;if(e&&200===e.status){o=t&&t.length?t.filter(e=>e.questionnaire_survey.every(e=>e.uuid===n)):[];let a=[];[{name:"Batch Id",slug:"batch_id",fieldName:"batch_id",fieldTitle:{en:"Batch Id"},placeholder:{en:"Batch Id"},value:"",type:"hidden",isHidden:!0},{name:"Questionnaire Survey",slug:"questionnaire_survey",fieldName:"questionnaire_survey",fieldTitle:{en:"Questionnaire Survey"},placeholder:{en:"Questionnaire Survey"},value:n||"",type:"hidden",isHidden:!0}].forEach(e=>{a.push(e)}),o&&o.forEach((e,t)=>{t={name:"Answer "+ ++t,slug:"ans-"+e.slug,fieldName:"ans-"+e.uuid,fieldTitle:{en:""+e.name},placeholder:{en:"Answer "+t},value:"",type:e.type[0]?e.type[0].toLowerCase():"text"};a.push(t)}),a.map(async(e,t)=>{e=await createSurveySubmissionFormElement(e);return r.insertBefore(e,s)})}}},createSurveySubmissionFormElement=async e=>{var t,a,o;if("text"===e.type||"hidden"===e.type)return e.isHidden?((t=document.createElement("input")).type=e.type,t.name=e.fieldName,t.value=e.value,t.placeholder=e.placeholder.en,t.classList.add("input"),t.classList.add("form-control"),t):((t=document.createElement("div")).classList.add("form-group"),t.classList.add("col-12"),t.classList.add("col-md-12"),(a=document.createElement("label")).for=e.fieldName,a.innerText=e.fieldTitle.en,(o=document.createElement("input")).type=e.type,o.name=e.fieldName,o.value="",o.placeholder=e.placeholder.en,o.classList.add("input"),o.classList.add("form-control"),t.appendChild(a),t.appendChild(o),t)},setModalCollectionItemData=(e=null,t=!1)=>{resetModalCollectionItemData(),e&&t&&(MODAL_COLLECTION_ITEM_DATA=Object.assign({},e))},resetModalCollectionItemData=()=>{MODAL_COLLECTION_ITEM_DATA=""},booleanFieldValue=async(e,t,a=!1,o=null)=>{if(o||(a=(a?"":await getPageItemData()).itemData,a?o=a:MODAL_COLLECTION_ITEM_DATA&&(o=MODAL_COLLECTION_ITEM_DATA)),isCheckbox(t)){let e=!1;var a=t.name,r=t.getAttribute("data-form-element-collection");a&&o&&(e=a!==r&&r.includes(".")?parseValueFromData(o,r):parseValueFromData(o,a),e=(!Array.isArray(e)||0!==e.length)&&e),e&&(t.checked=!0)}},validateLoginFormData=(e,t)=>{(!e.hasOwnProperty("userName")||e.hasOwnProperty("userName")&&""===e.userName)&&(e.email?(t.userName=e.email,t.queryType="OR"):e.phone_number&&(t.userName=e.phone_number,t.queryType="OR"))},resetFormFields=o=>{var e=isActionEnabled(o);if(console.log("ðŸš€ ~ resetFormFields ~ actionEnabled:",e),e){new Promise(function(e,t){e(o)});var{element:e,targetElement:r,parameters:s}=o,{enableResetForm:s,formComponent:n,overrideResetWaitTime:i}=s||"",n=n?n.split(":")[1]:"";let t="",a=(t=s?n?document.getElementById(n):"":r?r.closest("FORM"):e?e.closest("FORM"):"")?t.elements:"";if(t)if(r){for(let e=0;e<2;e++)resetFormFieldElements(a,t);t.reset()}else setTimeout(()=>{for(let e=0;e<2;e++)resetFormFieldElements(a,t);t.reset()},i||500)}},resetFormFieldElements=(e,t)=>{if(e)for(i=0;i<e.length;i++){var a=e[i];switch(e[i].type.toLowerCase()){case"text":case"password":case"textarea":case"hidden":e[i].value="",resetTextArea(t);break;case"radio":case"checkbox":e[i].checked&&(e[i].checked=!1);break;case"select-one":case"select-multi":case"select-multiple":var o=a.id;o&&$("#"+o).val(null).trigger("change")}}},getExternalAPISpan=()=>{let e="";var t=window.document.getElementById("project-page-external-api"),a=window.document.getElementById("project-modal-external-api");return t?e=t:a&&(e=a),e},submitSelectedForm=a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ submitSelectedForm ~ actionEnabled:",e),e){new Promise(function(e,t){e(a)});var{element:e,targetElement:o,parameters:r}=a,{enableSubmitForm:r,formComponent:s,overrideSubmitWaitTime:n}=r||"",s=s?s.split(":")[1]:"";let t="";if(t=r?s?document.getElementById(s):"":o?o.closest("FORM"):e?e.closest("FORM"):""){let e=t.querySelector("[type=submit]");e&&(o?e.click():setTimeout(()=>{e.click()},n||500))}}},showConfirmationMessage=async s=>{var n=isActionEnabled(s);if(console.log("ðŸš€ ~ showConfirmationMessage ~ actionEnabled:",n),n){new Promise(function(e,t){e(s)});var{parameters:n,previousActionResponse:i}=s;let{confirmationMessage:e,confirmBtnText:t,cancelBtnText:a,destinationAfterCancel:o}=n||"",r={};i&&(r.data=i);n=e||"Are you sure?";await swalAlert(n,t||"Proceed",!0,!1,a||"Cancel").then(async e=>e.isConfirmed?(r.confirmation=e,r.status="success",r):(r.confirmation=e,r.status="cancel",window.location.href=o,Promise.reject(r)))}},clearBrowserSessionData=a=>{var e,t,o,r,s=isActionEnabled(a);console.log("ðŸš€ ~ clearBrowserSessionData ~ actionEnabled:",s),s&&(new Promise(function(e,t){e(a)}),s=a.parameters,isEmpty(s)||({clearAllResponseData:s,clearAllFormData:t,clearResponseSelectedKeys:e,clearFormSelectedKeys:o}=s,r=JSON.parse(sessionStorage.getItem("previousActionResponse")),JSON.parse(sessionStorage.getItem("previousActionFormData"))&&(t&&sessionStorage.removeItem("previousActionFormData"),o)&&(t=JSON.parse(sessionStorage.getItem("previousActionFormData")))&&(t=t,o=o.split(","),t=_.omit(t,o),sessionStorage.setItem("previousActionFormData",JSON.stringify(t))),r&&(s&&sessionStorage.removeItem("previousActionResponse"),e)&&(r=JSON.parse(sessionStorage.getItem("previousActionResponse")))&&(o=r,e.split(","),o=_.omit(o,responseKeysArr),sessionStorage.setItem("previousActionResponse",JSON.stringify(o)))))},refreshCurrentLoggedInUser=async e=>{e=isActionEnabled(e);console.log("ðŸš€ ~ refreshCurrentLoggedInUser ~ actionEnabled:",e),e&&await resetCurrentUserInLocalStorage()},refreshCurrentTenant=async e=>{e=isActionEnabled(e);console.log("ðŸš€ ~ refreshCurrentTenant ~ actionEnabled:",e),e&&await resetCurrentTenantInLocalStorage()},refreshCurrentUserSettings=async e=>{e=isActionEnabled(e);console.log("ðŸš€ ~ refreshCurrentUserSettings ~ actionEnabled:",e),e&&await resetCurrentTenantInLocalStorage()},switchLocalizationLang=a=>{var t=isActionEnabled(a);if(console.log("ðŸš€ ~ switchLocalizationLang ~ actionEnabled:",t),t){new Promise(function(e,t){e(a)});t=a.parameters,t=t.language;if(t){localStorage.setItem("lang",t);let e=window.location.href;var o,r=window.location.search;r&&r.includes("lang=")?(0<(r=new URL(e).search).length&&(r="lang="+new URLSearchParams(r).get("lang"),o="lang="+t,e=replaceValueInExpression(r,o,e)),window.location=e):window.location=e+"?lang="+t}}},switchUserTenant=async o=>{var r=isActionEnabled(o);if(console.log("ðŸš€ ~ switchUserTenant ~ actionEnabled:",r),!r)return disabledActionResponse(o);{new Promise(function(e,t){e(o)});var{parameters:r,targetElement:s}=o;let{confirmationMessage:e,successMessage:u,errorMessage:t,skipPageReload:p,redirectRules:m}=r,a="";if(s&&(s.hasAttribute("data-tenant-id")?a=s.getAttribute("data-tenant-id"):s.hasAttribute("data-item-id")&&(a=s.getAttribute("data-item-id"))),isLoggedInUser()){let l="";r=fetchLoggedInUserJson();r.tenantId&&r.tenantId.length&&a&&(l=(l=r.tenantId.find(e=>e.uuid===a))?l.uuid:"");let c=fetchCurrentTenantJson(),d=fetchCurrentUserSettingsJson();if(console.log("loggedInUserSetting drapcode.js ln 10862",d),e){let i={};await swalAlert(e,"Proceed",!0,!1).then(async e=>{if(e.isConfirmed){if(l)try{var t,a,o,r,s,n="/switch-tenant/"+l;(i=await axios.get(n,{}))&&200===i.status&&({tenant:a,userDetails:o,userSetting:r}=((t=i.data).userDetails&&(delete t.userDetails._id,setJsonInLocalStorage("user",t.userDetails)),t||""),console.log("userObj drapcode.js ln 10882",t),a&&(delete a._id,setJsonInLocalStorage("tenant",{...c,...a})),r&&(delete r._id,s={...d,...r},console.log("newUserSettingObj drapcode.js ln 10891",s),setJsonInLocalStorage("userSetting",s)),u&&toastr.success(u,"Success"),a&&o&&o.hasOwnProperty("tenantRoleMapping")&&m&&m.length?handlePageRedirection(t,"",m):p||setTimeout(()=>{window.location.reload()},500))}catch(e){console.log("ðŸš€ ~ file: drapcode.js:8207 ~ switchUserTenant ~ error:",e),e.response&&(i.data=e.response,i.status="error")}return i.confirmation=e,i}return i.confirmation=e,i.status="cancel",Promise.reject(i)})}else if(l)try{var n,i,g,f,S,v="/switch-tenant/"+l;(response=await axios.get(v,{}))&&200===response.status&&({tenant:i,userDetails:g,userSetting:f}=((n=response.data).userDetails&&(delete n.userDetails._id,setJsonInLocalStorage("user",n.userDetails)),n||""),console.log("userObj drapcode.js ln 10940",n),i&&(delete i._id,setJsonInLocalStorage("tenant",{...c,...i})),f&&(delete f._id,S={...d,...f},console.log("newUserSettingObj drapcode.js ln 10949",S),setJsonInLocalStorage("userSetting",S)),u&&toastr.success(u,"Success"),i&&g&&g.hasOwnProperty("tenantRoleMapping")&&m&&m.length?handlePageRedirection(n,"",m):p||setTimeout(()=>{window.location.reload()},500))}catch(e){console.log("ðŸš€ ~ file: drapcode.js:8207 ~ switchUserTenant ~ error:",e),e.response&&(response.data=e.response,response.status="error")}}else toastr.error(t||"User not logged in!","Error")}},switchEntity=async a=>{var t=isActionEnabled(a);if(console.log("ðŸš€ ~ Switch Entity ~ actionEnabled:",t),t){new Promise(function(e,t){e(a)});var{parameters:t,response:o,targetElement:r}=a,{collection:t,updateEntityBy:s,storageCustomKey:n,page:i,successMessage:l,errorMessage:c,storageCustomKeyLocation:d}=t,u=o?o.data:"";let e="";var p,m=sessionStorage.getItem("previousActionResponse"),g=sessionStorage.getItem("previousActionFormData");switch(s){case"collectionUuid":(e=r?r.getAttribute("data-item-id"):"")||(p=r.querySelector("button[type=submit]"),e=p?p.getAttribute("data-item-id"):"");break;case"previousResponse":e=u?u.uuid:"";break;case"previousActionResponse":d?(p=getBSLData(d))&&(e=p&&n?_.get(p,n.trim()):""):m&&(m=JSON.parse(m),e=n?_.get(m,n):"");break;case"previousActionFormData":g&&(g=JSON.parse(g),e=n?_.get(g,n):"");break;case"currentLoggedInUser":isLoggedInUser()&&(p=fetchLoggedInUserJson(),e=n?_.get(p,n):p?p.uuid:"");break;case"currentLoggedInUserTenant":isLoggedInUser()&&(p=fetchCurrentTenantJson(),e=n?_.get(p,n):p?p.uuid:"")}var f,S,v,y,o={};try{console.log("ðŸš€ ~ file: drapcode.js:3513 ~ itemId:",e),e&&(S=`collection-table/${t}/item/`+e,y=await securedGetCall(S))&&200===y.status&&(v=y.data)&&(setJsonInLocalStorage("entity_"+t,v),l&&toastr.success(l,"Success"),(f=i?"/"+i:"")&&window.location.reload(),window.location=f)}catch(e){c&&toastr.error(c,"Error")}return o}return disabledActionResponse(a)},removeCollectionFieldData=async a=>{var o=isActionEnabled(a);if(console.log("ðŸš€ ~ removeCollectionFieldData ~ actionEnabled:",o),o){new Promise(function(e,t){e(a)});var{parameters:o,response:r,targetElement:s}=a,{collection:o,fields:n,successMessage:i,errorMessage:l}=o;let t={};var c,d={};let e="";if(e=s&&"FORM"===s.tagName?(c=s.getAttribute("action"),(e=c.split("collection-form/")[1])?e.split("/items/")[1]:""):s?s.getAttribute("data-item-id"):"",n&&n.forEach(e=>{t[e]=""}),o&&n&&e)try{var u="open/"+("collection-form/"+o+"/items/"+e),p=await unSecuredPutCall(t,u);d.data={...r,...p},d.status="success",i&&toastr.success(i,"Success")}catch(e){e.response&&(d.data=e.response,d.status="error"),l?toastr.error(l,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}else o?n?e?toastr.error("Unable to remove item data","Error"):toastr.error("Collection item id not found","Item missing!"):toastr.error("Please select a collection field in action","Field missing!"):toastr.error("Please select a collection in action","Collection missing!");return d}},setBrowserSessionData=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ setBrowserSessionData ~ actionEnabled:",e),!e)return disabledActionResponse(a);new Promise(function(e,t){e(a)});var t,e=a.parameters,e=e.customSessionKey,{itemData:o,collectionId:r}=await getPageItemData();r&&o&&(t=sessionStorage.getItem("previousActionResponse"),e=e||"collection_"+r,delete o._id,r={[e]:o},t?(t=JSON.parse(t),sessionStorage.setItem("previousActionResponse",JSON.stringify({...t,...r}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(r)))},actionSubmit=o=>{o.preventDefault();let a,r,s;if(o&&(a=o.target||o.srcElement,(r=o.currentTarget)||a)){s=r?r.closest("FORM"):a?a.closest("FORM"):"",console.log("ðŸš€ ~ actionSubmit ~ formElem:",s);var o=(r||{}).dataset,{itemId:o,createmethod:n,updatemethod:i,oncreate:l,onupdate:c}=(console.log("ðŸš€ ~ actionSubmit ~ dataset:",o),o||{}),d=!!o;console.log("ðŸš€ ~ actionSubmit ~ hasItemId:",d);let e="",t="";if(s){var u=s.attributes.action.value;let a=!1;d&&(a=u.includes(o)),console.log("ðŸš€ ~ file: drapcode.js:9678 ~ actionSubmit ~ hasValidItemId:",a),t=a?(e="return "+c,i):(e="return "+l,n),console.log("ðŸš€ ~ actionSubmit ~ onSubmitFormAction:",e),console.log("ðŸš€ ~ actionSubmit ~ onSubmitFormMethod:",t),a||(d=u.split("collection-form/")[1].split("/"))&&2<d.length&&(d.pop(),c="collection-form/"+d.join("/"),s.action=c),e&&s.setAttribute("onsubmit",e),t&&s.setAttribute("method",t);i=s.querySelector("[type=submit]");if(i)i.click();else{l=r.closest("div");let e=document.createElement("button"),t=(e.setAttribute("class","dc-button dc-btn--blue d-none"),e.setAttribute("type","submit"),o&&e.setAttribute("data-item-id",o),e.style.display="none",e.innerText=a?"Update":"Save",l.appendChild(e),r.innerHTML);r.setAttribute("disabled",!0),r.innerHTML=t+" <i class='fa fa-spinner fa-spin'></i>",setTimeout(()=>{e.click(),e.remove(),r.innerHTML=t,r.removeAttribute("disabled")},500)}}}},setBrowserStorageData=async a=>{var e,t,o,r,s,n,i=isActionEnabled(a);return console.log("ðŸš€ ~ setBrowserStorageData ~ actionEnabled:",i),i?(new Promise(function(e,t){e(a)}),{parameters:i,response:e}=a,isEmpty(i)||({browserStorageLocation:i,customJsonKey:t,customJsonValue:o,enableConsoleLog:r,startConsoleLog:s,endConsoleLog:n}=i,r&&logActionMessage(cleanConsoleLogArgs(s)),i&&t&&setDataInSessionStorageLocation(i,t,o||"",!1),r&&logActionMessage(cleanConsoleLogArgs(n))),e):disabledActionResponse(a)},clearBrowserStorageData=a=>{var e,t,o,r,s,n,i=isActionEnabled(a);if(console.log("ðŸš€ ~ clearBrowserStorageData ~ actionEnabled:",i),i)return new Promise(function(e,t){e(a)}),{parameters:i,response:e}=a,isEmpty(i)||({browserStorageLocation:i,removeAllData:t,removeSelectedKeys:o,enableConsoleLog:r,startConsoleLog:s,endConsoleLog:n}=i,r&&logActionMessage(cleanConsoleLogArgs(s)),t?clearAllBSLData(i):o&&removeBSLData(i,o?o.split(",").map(e=>e.trim()):[]),r&&logActionMessage(cleanConsoleLogArgs(n))),e},addCustomKeyInObj=(e,t,r)=>{let s=getContentFromSessionObject(e,t);var a={};if(t.includes(".")){let o=a;t.split(".").map((e,t,a)=>{o=t==a.length-1?o[r]=t==a.length-1?s:{}:o[e]=t==a.length-1?s:{}})}else a[r]=s;_.merge(e,a)},propagateCollectionItemIdInSession=(e,t)=>{e={[PARENT_COLLECTION_PROPAGATE_KEY]:{uuid:e,name:t}},t=sessionStorage.getItem("previousActionResponse");t?(t=JSON.parse(t),sessionStorage.setItem("previousActionResponse",JSON.stringify({...t,...e}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(e))};function fetchCurrentTenantJson(){let t=fetchCurrentTenant(),a=(t=t||"","");try{a=t?JSON.parse(t):""}catch(e){t=t?t.replaceAll("'",APOSTROPHE_REPLACER):"",a=t?JSON.parse(t.replace(/##@apos@##/g,"'")):""}return a}function fetchCurrentUserSettingsJson(){let t=fetchCurrentUserSetting(),a=(t=t||"","");try{a=t?JSON.parse(t):""}catch(e){t=t?t.replaceAll("'",APOSTROPHE_REPLACER):"",a=t?JSON.parse(t.replace(/##@apos@##/g,"'")):""}return a}function fetchLoggedInUserJson(){let t=fetchLoggedInUser(),a=(t=t||"","");try{a=t?JSON.parse(t):""}catch(e){t=t?t.replaceAll("'",APOSTROPHE_REPLACER):"",a=t?JSON.parse(t.replace(/##@apos@##/g,"'")):""}return a}async function fetchMultiTenantCollection(e){e=(e||"").setting,e=(e||"").multiTenantCollection;return e?await getCollectionDetailsById(e):""}async function fetchUserSettingCollection(e){e=(e||"").setting,e=(e||"").userSettingsCollection;return e?await getCollectionDetailsById(e):""}async function fetchInstalledPluginByCode(t){let e="";var a;return t&&(a=(a=await securedGetCall("plugins/"))?a.data:"",e=a&&a.find(e=>e.code===t)),e}function urlFromCurrentPage(e){var t=window.location.pathname.split("/"),a=t[t.length-2],t=t[t.length-1];return a&&t&&(e+=`/${a}/`+t),e}function isActionEnabled(t){var a=t.enabledEnvironments;let{defaultEnabled:o,actionLabel:e}=t,r=!0;if(!(o=void 0===o?!0:o)){let e=localStorage.getItem("environment");e||(t=document.getElementById("project-timezone"),e=t&&t.getAttribute("data-projectenv")),r=!!(a&&a.length&&a.includes(e)),console.log("ðŸš€ ~ isActionEnabled ~ Default Enabled:",o,"~ Action Enabled:",r,"~ Current Env:",e,"~ Enabled Environments:",a)}return e&&console.log(`ðŸš€ ~ ${e} ~ isActionEnabled:`,r),r}async function resetCurrentUserInLocalStorage(){if(isLoggedInUser()){var e=fetchLoggedInUserJson();if(e){let t={};try{var a;(t=await axios.get("/refresh-user",{}))&&200===t.status&&(a=(t.data||"").userDetails,a)&&(delete a._id,delete a.password,setJsonInLocalStorage("user",{...e,...a}))}catch(e){console.log("ðŸš€ ~ file: drapcode.js:5853 ~ resetCurrentUserInLocalStorage ~ error:",e),e.response&&(t.data=e.response,t.status="error")}return t}}}async function resetCurrentTenantInLocalStorage(){if(isLoggedInTenant()){var a=fetchLoggedInUserJson(),o=fetchCurrentTenantJson(),r=fetchCurrentUserSettingsJson();if(console.log("loggedInUserSetting drapcode.js ln 11577",r),o){var s=o.uuid;let e="",t=(r&&(e=r.uuid),{});try{var n,i,l,c,d,u=`/refresh-user-tenant/${s}/`+e;(t=await axios.get(u,{}))&&200===t.status&&({userDetails:i,tenant:l,userSetting:c}=(n=t.data)||"",console.log("userObj drapcode.js ln 11590",n),i&&(delete i._id,delete i.password,setJsonInLocalStorage("user",{...a,...i})),l&&(delete l._id,setJsonInLocalStorage("tenant",{...o,...l})),c)&&(delete c._id,d={...r,...c},console.log("newUserSettingObj drapcode.js ln 11605",d),setJsonInLocalStorage("userSetting",d))}catch(e){console.log("ðŸš€ ~ file: drapcode.js:5982 ~ resetCurrentTenantInLocalStorage ~ error:",e),e.response&&(t.data=e.response,t.status="error")}return t}}}function removeTenantFromLocalStorage(e){var t;isLoggedInUser()&&(t=fetchCurrentTenantJson())&&t.uuid===e&&localStorage.removeItem("tenant")}async function addTenantReferenceToUser(e,t,a,o,r,s,n,i=!1,l=""){let c=`collection-form/${COLLECTION_USER}/items/`+o.uuid,d=new Set;let u=new Set;console.log("ðŸš€ ~ file: drapcode.js:8515 ~ selectedUser:",o),o.tenantId&&o.tenantId.length&&o.tenantId.forEach(e=>{d.add(e.uuid)}),o.userSettingId&&o.userSettingId.length&&o.userSettingId.forEach(e=>{u.add(e.uuid)}),r&&d.add(r),p=[...d],[...u];var p={tenantId:p};if(r&&s&&o.uuid){var m={tenantId:r,userId:o.uuid};let e=`open/collection-form/${s.collectionName}/items/`,t=await unSecuredPostCall(m,e);t.data.uuid&&(p.userSettingId=[t.data.uuid])}if(i&&l){s=[{tenantId:r,role:l,createdAt:new Date}];if(o.tenantRoleMapping&&o.tenantRoleMapping.length){m=o.tenantRoleMapping.find(e=>e.tenantId===r);if(console.log("ðŸš€ ~ file: drapcode.js:8622 ~ hasTenantIdRoleMapping:",m),m){let t=[];o.tenantRoleMapping.map(e=>{e.tenantId===r&&(e.role=l,e.updatedAt=new Date),t.push(e)}),console.log("ðŸš€ ~ file: drapcode.js:8635 ~ selectedUser.tenantRoleMapping.map ~ updatedTenantRoleMapping:",t),p.tenantRoleMapping=[...t]}else p.tenantRoleMapping=[...o.tenantRoleMapping,...s]}else p.tenantRoleMapping=[...s]}console.log("ðŸš€ ~ file: drapcode.js:8569 ~ data:",p),e=await securedPutCall(p,c),t.data=e,t.data.collectionSaveOrUpdateResponse=e,t.status="success";i=t.data.collectionSaveOrUpdateResponse,m=i.data,s=m.uuid,p={["collection_"+COLLECTION_USER]:{uuid:s}},e=sessionStorage.getItem("previousActionResponse");return e?(e=JSON.parse(e),sessionStorage.setItem("previousActionResponse",JSON.stringify({...e,...p}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(p)),t.data={...t.data,...p},a&&a.uuid===o.uuid&&await resetCurrentUserInLocalStorage(),n&&toastr.success(n,"Success"),t}async function removeTenantReferenceFromUser(t,a,e,o,r,s){var n=await fetchInstalledPluginByCode("MULTIPLE_ROLES"),i=`collection-form/${COLLECTION_USER}/items/`+t.uuid;let l=[];t.tenantId&&t.tenantId.forEach(e=>{l.push(e.uuid)});var c={tenantId:l=a?l&&l.filter(e=>e!==a):l};if(n){let e=[];a&&t.hasOwnProperty("tenantRoleMapping")&&t.tenantRoleMapping&&(n=t.tenantRoleMapping,e=n&&n.filter(e=>e.tenantId!==a),console.log("ðŸš€ ~ file: drapcode.js:9054 ~ updatedTenantRoleMapping:",e)),c.tenantRoleMapping=[...e]}e=await securedPutCall(c,i),o.data=e,o.data.collectionSaveOrUpdateResponse=e,o.status="success";n=o.data.collectionSaveOrUpdateResponse,c=n.data,i=c.uuid,e={["collection_"+COLLECTION_USER]:{uuid:i}},n=sessionStorage.getItem("previousActionResponse");return n?(n=JSON.parse(n),sessionStorage.setItem("previousActionResponse",JSON.stringify({...n,...e}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(e)),o.data={...o.data,...e},r&&r.uuid===t.uuid&&(await resetCurrentUserInLocalStorage(),removeTenantFromLocalStorage(a)),s&&toastr.success(s,"Success"),o}async function createUserWithTenantReference(o,r,s,t,n,a,i,e){if(t?n.userRoles=t:toastr.error("Please provide a user role!","Error"),n.tenantId=[a],a&&i){t={tenantId:a},a=`open/collection-form/${i.collectionName}/items/`;let e=await unSecuredPostCall(t,a);e.data.uuid&&(n.userSettingId=[e.data.uuid])}return n.hasOwnProperty("password")&&""===n.password?((t=o.elements.password).classList.add("error"),(a=document.createElement("label")).setAttribute("id",t.id+"-error"),a.setAttribute("class","error"),a.setAttribute("for",""+t.id),a.innerHTML=t.placeholder||"Please enter password",t.insertAdjacentElement("afterend",a),s.data=t.placeholder||"Please enter password",s.status="error",s):(n.hasOwnProperty("password")||n.password||(n.password=Math.floor(1e5+9e5*Math.random()).toString()),e?swalAlert(e,"Proceed",!0,!1).then(async e=>{var t,a;return e.isConfirmed?((s=await processSignUpUser(n,"auth/user",o,r)).data.data.uuid&&(s.data.collectionSaveOrUpdateResponse=s.data,s.data.userSignupId=s.data.data.uuid,propagateCollectionItemIdInSession(s.data.data.uuid,COLLECTION_USER),n.userSettingId)&&(t={userId:s.data.data.uuid},a=`open/collection-form/${i.collectionName}/items/`+n.userSettingId,await unSecuredPutCall(t,a)),s.confirmation=e,s.status="success"):(s.confirmation=e,s.status="cancel"),s}):((s=await processSignUpUser(n,"auth/user",o,r)).data.data.uuid&&(s.data.collectionSaveOrUpdateResponse=s.data,s.data.userSignupId=s.data.data.uuid,propagateCollectionItemIdInSession(s.data.data.uuid,COLLECTION_USER),n.userSettingId)&&(a={userId:s.data.data.uuid},t=`open/collection-form/${i.collectionName}/items/`+n.userSettingId,await unSecuredPutCall(a,t)),s))}function disabledActionResponse(e){e=e.response;return e}function processFieldValueData(a,e,t,o){if(console.log("ðŸš€ ~ file: drapcode.js:8413 ~ processFieldValueData ~ is Multi Select:",a.fieldType&&!!a.isMultiSelect),a.fieldType&&a.isMultiSelect){var s=t[a.key];switch(a.fieldType){case"static_option":case"dynamic_option":let r=new Set;if(a.hasOwnProperty("valueAction")&&"APPEND"===a.valueAction&&s&&s.length&&s.forEach(e=>{r.add(e)}),e){let a=e,o=e;e&&!Array.isArray(e)&&e.includes(",")?(o=e.split(",")).forEach(e=>{var t;e&&e.includes("::")?((t=e.split("::"))&&2===t.length&&(o=t[0].trim(),a=t[1].trim()),r.add(o)):r.add(e)}):o&&Array.isArray(o)?o.forEach(e=>{var t;e&&e.includes("::")?((t=e.split("::"))&&2===t.length&&(o=t[0].trim(),a=t[1].trim()),r.add(o)):r.add(e)}):(o&&o.includes("::")&&(n=o.split("::"))&&2===n.length&&(o=n[0].trim(),a=n[1].trim()),r.add(o))}n=[...r],o[a.key]=n;break;default:let t=new Set;var n;a.hasOwnProperty("valueAction")&&"APPEND"===a.valueAction&&s&&s.length&&s.forEach(e=>{t.add(e.uuid)}),e&&t.add(e),n=[...t],o[a.key]=n}}else e&&Array.isArray(e)?e.forEach(e=>{o[a.key]=e}):o[a.key]=e}function removeEmptyDropzoneFields(e,o){if(e&&o){e=e.querySelectorAll('[data-gjs="collection-file-dropzone"]');if(e&&e.length){let t=[];if(e.forEach(e=>{t.push(e.getAttribute("name"))}),o&&Object.entries(o).length){let a=[];Object.entries(o).map(([e,t])=>{t||a.push(e)}),a&&Object.entries(a).length&&a.forEach(e=>{t.includes(e)&&delete o[e]})}}}}function clearDataForSessionStorage(e){var t={},t={...e};return e.password&&delete t.password,console.log("ðŸš€ ~ file: drapcode.js:8259 ~ clearDataForSessionStorage ~ cleanFormDataForSession:",t),t}function getFormElement(e){var{element:e,targetElement:t}=e;let a=e;return a="FORM"!==a.tagName?t?t.closest("FORM"):e?e.closest("FORM"):"":a}function mockExistingFile(t,a,r,s,n){if(t&&Object.keys(t).length){let e=t[a];n&&(e=e.flatMap(t=>t[n].map(e=>({...e,refFieldUuid:t.uuid})))),console.log("ðŸš€ ~ file: drapcode.js:8472 ~ mockExistingFile ~ fieldItem:",e),e&&(Array.isArray(e)||(e=[e],console.log("ðŸš€ ~ file: drapcode.js:10514 ~ mockExistingFile ~ fieldItem #2:",e)),e.length)&&(e.forEach(e=>{let t;t=!1===e.isPrivate&&["image/png","image/jpeg","image/gif","image/webp","image/heif","image/heic"].includes(e.mimeType)?imageServerUrl()+e.key:e.hasOwnProperty("smallIcon")?e.smallIcon:generateFileURL(e);var a=e.originalName,o={name:a,size:e.size};n&&(o.refFieldUuid=e.refFieldUuid);updateDropzoneRemoveFileText(r,a),r.displayExistingFile(o,t,null,!0,!1),s.push(JSON.stringify(e))}),t=e.length,console.log("ðŸš€ ~ file: drapcode.js:10560 ~ mockExistingFile ~ fileCountOnServer:",t),r.options.maxFiles=r.options.maxFiles-t,console.log("ðŸš€ ~ file: drapcode.js:10562 ~ mockExistingFile ~ myDropzone.options.maxFiles:",r.options.maxFiles))}}function getCookie(e,a=!1){let o={};return document.cookie.split(";").forEach(function(e){var[e,t]=e.split("=");o[e.trim()]=a&&t?atob(t.toString()):t}),o[e]}function setCookie(e,t,a,o=!0,r=!1){var s=new Date,a=(s.setTime(s.getTime()+24*a*60*60*1e3),"expires="+s.toUTCString());let n=t;o&&t?n=btoa(t.toString()):r&&t&&(n=encodeURIComponent(t.toString())),document.cookie=e+"="+n+";"+a+";path=/"}function removeCookie(e){getCookie(e)&&setCookie(e,"",-1)}function removeAllCookies(){var e;for(e of document.cookie.split(";")){var t=e.indexOf("="),t=-1<t?e.substr(0,t):e;document.cookie=t+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"}}function getLvl1CollRefFieldName(t,a,o){if(!!t.refCollection.collectionField&&t.refCollection.collectionField.includes(CUSTOM_SEPARATOR)){let e=t.refCollection.collectionField.split(CUSTOM_SEPARATOR);e=e[1].split(".");t=_.get(a,e[0]);o=t&&Array.isArray(t)?e.join(".0."):e[1]}return o}function autocompleteInput(s,n){var i;function a(e){if(e){for(var t=e,a=0;a<t.length;a++)t[a].classList.remove("autocomplete-active");e[i=(i=i>=e.length?0:i)<0?e.length-1:i].classList.add("autocomplete-active")}}function l(e){for(var t=document.getElementsByClassName("autocomplete-items"),a=0;a<t.length;a++)e!=t[a]&&e!=s&&t[a].parentNode.removeChild(t[a])}s.addEventListener("input",function(e){var t,a,o,r=this.value;if(l(),!r)return!1;for(i=-1,(t=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),t.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(t),o=0;o<n.length;o++)n[o].substr(0,r.length).toUpperCase()==r.toUpperCase()&&((a=document.createElement("DIV")).innerHTML="<strong>"+n[o].substr(0,r.length)+"</strong>",a.innerHTML+=n[o].substr(r.length),a.innerHTML+="<input type='hidden' value='"+n[o]+"'>",a.addEventListener("click",function(e){s.value=this.getElementsByTagName("input")[0].value,l()}),t.appendChild(a))}),s.addEventListener("keydown",function(e){var t=(t=document.getElementById(this.id+"autocomplete-list"))&&t.getElementsByTagName("div");40==e.keyCode?(i++,a(t)):38==e.keyCode?(i--,a(t)):13==e.keyCode&&(e.preventDefault(),-1<i)&&t&&t[i].click()}),document.addEventListener("click",function(e){l(e.target)})}async function checkAndUpdateItemId(e){var t=e.getAttribute("method"),a=e.getAttribute("getdataitemidfrom");let o=e.getAttribute("itemidfield");var r=e.getAttribute("data-tenant-collection"),s=e.getAttribute("data-user-settings-collection"),n=e.getAttribute("data-entity-key");let i,l,c="";if(t&&"PUT"===t.toUpperCase()&&a){switch(a){case"PARENT_COLLECTION":var d=(d=e.getAttribute("data-item"))?JSON.parse(d):{};c=e.getAttribute("data-collection-id"),o&&(o.includes(".")&&(u=o.split("."),o=u.join(".0.")),i=_.get(d,o)),l=_.get(d,"uuid");break;case"PAGE_COLLECTION":var{itemData:u,collectionId:d}=await getPageItemData();c=d,o&&(o.includes(".")&&(d=o.split("."),o=d.join(".0.")),i=_.get(u,o)),l=_.get(u,"uuid");break;case"CURRENT_USER_FIELD":c="user",isLoggedInUser()&&(d=fetchLoggedInUserJson(),o&&(o.includes(".")&&(u=o.split("."),o=u.join(".0.")),i=_.get(d,o)),l=_.get(d,"uuid"));break;case"CURRENT_USER_SETTINGS_FIELD":c=s,isLoggedInUserSetting()&&(u=fetchCurrentUserSettingsJson(),o&&(o.includes(".")&&(d=o.split("."),o=d.join(".0.")),i=_.get(u,o)),l=_.get(u,"uuid"));break;case"CURRENT_TENANT_FIELD":c=r,isLoggedInTenant()&&(d=fetchCurrentTenantJson(),o&&(o.includes(".")&&(u=o.split("."),o=u.join(".0.")),i=_.get(d,o)),l=_.get(d,"uuid"));break;case"BROWSER_SESSION_STORAGE":o&&(i=parseSessionObject(o));break;case"ENTITY_COLLECTION":u=parseLSJSONStrToJSON("entity_"+n);i=_.get(u,o)}console.log("ðŸš€ ~ file: drapcode.js:4438 ~ updateCollection ~ itemId:",i)}return{itemId:i,parentItemId:l,parentItemCollection:c}}let getNewEndPointUrl=(t,a)=>{if(t){let e=a.split("collection-form/")[1];e=e.split("/items")[1],console.log("ðŸš€ ~ file: drapcode.js:4438 ~ updateCollection ~ oldItemIdKey:",e);var o="/"+t;e?a=replaceValueInExpression(e,o,a):a+="/"+t}return console.log("ðŸš€ ~ file: drapcode.js:4416 ~ updateCollection ~ CURRENT_USER_FIELD ~ #2 endpoint:",a),a},setNestedProp=(e={},[t,...a],o)=>({...e,[t]:a.length?setNestedProp(e[t],a,o):o}),addTimePickerToElement=(e,t="")=>{var a=(e||{}).dataset,a=(console.log("*** add TimePicker to element ~ dataset:",a),a||{}).timeformat,a="24_HOURS"===a,o=a?"H:i":"h:i A";$(e).timepicker({timeFormat:o,interval:15,minTime:"00:00",maxTime:"23:59",defaultTime:t||"10:00",startTime:"00:00",dynamic:!1,dropdown:!0,scrollbar:!0,show2400:a})};function processSelectOptionValue(e=!1,t){return t=e?Array.isArray(t)?t&&0<t.length?t:[]:t?("string"==typeof t?t:t.toString()).split(","):[]:Array.isArray(t)?t&&0<t.length?t.join(""):"":t||""}function setJsonInLocalStorage(e,t,a=!0){e&&(t&&Object.keys(t).length&&a?(a=JSON.stringify(t).replace(/'/g,APOSTROPHE_REPLACER),localStorage.setItem(e,a.replace(/##@apos@##/g,"'"))):localStorage.setItem(e,JSON.stringify(t)))}function parseLSJSONStrToJSON(e){let a={};if(e){let t=localStorage.getItem(e)?localStorage.getItem(e):"";t=t||"";try{a=t?JSON.parse(t):{}}catch(e){t=t?t.replaceAll("'",APOSTROPHE_REPLACER):"",a=t?JSON.parse(t.replace(/##@apos@##/g,"'")):{}}}return a}function generateFileURL(e){e=(e||{}).mimeType;let t;switch(e){case"image/png":case"image/jpeg":case"image/gif":case"image/heif":case"image/webp":case"image/heic":t="https://drapcode-static.s3.amazonaws.com/img/placeholder-img.png";break;case"application/zip":t="https://drapcode-static.s3.amazonaws.com/img/zip.png";break;case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":case"application/vnd.ms-excel":t="https://drapcode-static.s3.amazonaws.com/img/excel.png";break;case"application/pdf":t="https://drapcode-static.s3.amazonaws.com/img/pdf-file.png";break;case"text/csv":t="https://drapcode-static.s3.amazonaws.com/img/csv.png";break;case"application/msword":case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":t="https://drapcode-static.s3.amazonaws.com/img/google-docs.png";break;case"text/plain":t="https://drapcode-static.s3.amazonaws.com/img/txt.png";break;case"application/rtf":t="https://drapcode-static.s3.amazonaws.com/img/rtf-file-symbol.png";break;case"text/html":t="https://drapcode-static.s3.amazonaws.com/img/html.png";break;case"audio/mpeg":t="https://drapcode-static.s3.amazonaws.com/img/placeholder-audio.png";break;case"video/mpeg":case"video/x-flv":case"video/x-msvideo":t="https://drapcode-static.s3.amazonaws.com/img/video.png";break;case"application/vnd.ms-powerpoint":case"application/vnd.openxmlformats-officedocument.presentationml.presentation":t="https://drapcode-static.s3.amazonaws.com/img/powerpoint.png";break;default:t="https://drapcode-static.s3.amazonaws.com/img/google-docs.png"}return t}function updateDropzoneRemoveFileText(e,t){e.options.dictRemoveFile=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16" style="cursor:pointer">
          <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708" style="cursor:pointer"/>
          </svg><span class="dz-remove-filename" style="cursor:pointer">
          ${truncateString(t,21,6,3)}</span>`}function truncateString(e,t=e.length,a=0,o=3){return e.length<=t+a?e:(t=e.slice(0,t),a=e.slice(-a),""+t+".".repeat(o)+a)}function loadElementChildList(e,t=[]){var a;if(e&&(e.tagName&&t.push(e),e.hasChildNodes()))for(a of e.childNodes)loadElementChildList(a,t);return t}let addStylesForSummerNoteEditor=()=>{var e=document.createElement("style");e.innerHTML=`
    .note-dropdown-menu {
        overflow-y: auto;
        max-height: 200px;
    }

    .note-dropdown-menu::-webkit-scrollbar {
        width: 8px;
    }

    .note-dropdown-menu::-webkit-scrollbar-track {
        background: #f1f1f1;
    }

    .note-dropdown-menu::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
    }

    .note-dropdown-menu::-webkit-scrollbar-thumb:hover {
        background: #555;
    }

    .note-icon-caret {
        display: none;
    }
`,document.head.appendChild(e)},containsHTML=e=>/<\/?[a-z][\s\S]*>/i.test(e);function isValidJSONString(e){let t=!1;try{var a;e&&JSON.parse(e)&&(a=JSON.parse(e))&&"object"==typeof a&&(t=!0)}catch(e){t=!1}return t}function prepareBSLDataJSON(e,t,a,o){try{var r;e?(r=JSON.parse(t))&&"object"==typeof r&&(a[o]=r):t&&"string"==typeof t&&(a[o]=t)}catch(e){}}let getBrowserLocalStorageData=(o=[])=>Object.keys(localStorage).reduce(function(e,t){var a=o.includes(t)?"":localStorage.getItem(t);return prepareBSLDataJSON(isValidJSONString(a),a,e,t),e},{}),getBrowserSessionStorageData=(o=["__resetK"])=>Object.keys(sessionStorage).reduce(function(e,t){var a=o.includes(t)?"":sessionStorage.getItem(t);return prepareBSLDataJSON(isValidJSONString(a),a,e,t),e},{}),getBrowserCookieData=(e=[])=>{let r={};return document.cookie.split(";").forEach(function(a){var[a,o]=a.split("=");if(!e.includes(a.trim())){let t="",e=!0;try{t=o?atob(o.toString()):"",e=!1}catch(e){}try{e&&(t=decodeURIComponent(o),e=!1)}catch(e){}try{prepareBSLDataJSON(isValidJSONString(t),t,r,a.trim())}catch(e){t=o,r[a.trim()]=t}}}),r},getBrowserStorageValuesForExternalAPI=(e,t,a)=>{var{bodyCustomJSON:t,bodyRawJSON:o,bodyCollectionMapping:r,setting:{url:s,headers:n,params:i}}=t;let l;switch(a){case"LOCAL_STORAGE":case"current_user":l=getBrowserLocalStorageData();break;case"COOKIES":l=getBrowserCookieData();break;default:l=getBrowserSessionStorageData()}return t&&(e=getSessionValueFromString(t,e,l,a)),o&&(e=getSessionValueFromString(o,e,l,a)),s&&(e=getSessionValueFromString(s,e,l,a)),n&&0<Object.keys(n).length&&(e=getSessionValueFromObject(n,e,l,a)),i&&0<Object.keys(i).length&&(e=getSessionValueFromObject(i,e,l,a)),r&&0<Object.keys(r).length&&(e=getSessionValueFromObject(r,e,l,a)),console.log("ðŸš€ ~ file: drapcode.js:11044 ~ getBrowserStorageValuesForExternalAPI ~ finalSessionValue:",e),e};function setDataInSessionStorageLocation(e,t,a,o=!0){var r=o?JSON.stringify(a):a;switch(e){case"LOCAL_STORAGE":localStorage.setItem(t,r);break;case"COOKIES":setCookie(t,r,1,!1,!0);break;default:sessionStorage.setItem(t,r)}}function removeBSLData(e,t){if(e)switch(e){case"LOCAL_STORAGE":t&&t.length&&t.forEach(e=>{localStorage.removeItem(e)});break;case"COOKIES":t&&t.length&&t.forEach(e=>{removeCookie(e)});break;default:t&&t.length&&t.forEach(e=>{sessionStorage.removeItem(e)})}}function clearAllBSLData(e){if(e)switch(e){case"LOCAL_STORAGE":localStorage.clear();break;case"COOKIES":removeAllCookies();break;default:sessionStorage.clear()}}function getBSLData(e){let t="";if(e)switch(e){case"LOCAL_STORAGE":t=getBrowserLocalStorageData();break;case"COOKIES":t=getBrowserCookieData();break;default:t=getBrowserSessionStorageData()}return t}function getBrowserData(){return{sessionStorageData:getBrowserSessionStorageData(),localStorageData:getBrowserLocalStorageData(),cookiesData:getBrowserCookieData()}}function actionLog(){var e=Array.prototype.slice.call(arguments);e.unshift(ACTION_LOG_PREFIX+" "),console.log.apply(console,e)}function logActionMessage(e,t,a){e.trim()&&(a?console.log(ACTION_LOG_PREFIX+" "+e,t):console.log(ACTION_LOG_PREFIX+" "+e))}function cleanConsoleLogArgs(e){e=e?e.replace(/<script\b[^>]*>([\s\S]*?)<\/script>/gm,""):"";return e?e.trim():""}function initializeSelect2(e){var t;e&&0<e.length&&(t={selectionCssClass:":all:",width:"resolve"},$("#"+e.id).select2(t).val(""))}let displayCustomComponent=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ displayCustomComponent ~ actionEnabled:",e),e){new Promise(function(e,t){e(a)});var{targetElement:e,parameters:t}=a,{pageCustomComponentComponents:t,customComponent:o}=t,t=t.split(":")[1],r=document.getElementById(t),o=o||"",t=createContentPlaceholder(1,t,r.className);if(r.innerHTML=t,o){t="custom-component/"+o;try{var s=await publicGetCall(t);s&&200===s.status&&s.data&&await renderCustomComponentIntoElem(s.data,r,e)}catch(e){console.log("Error: ",e)}}}},renderCustomComponentIntoElem=async(e,a,t)=>{let{content:{htmlContent:o,customCSS:r,customJS:s},customCssCdns:n,customJsCdns:i,collectionName:l}=e;e=await getComponentItem(a,t,l),t=fetchLoggedInUserJson();let c=[],d=[];var{constants:u,environments:p}=await getProjectDetail(),m=(l&&(m=await getCollectionDetails(l),c=m?.constants||[],d=m?.utilities||[]),await getCollectionDetails("user")),{constants:m,utilities:g}=m,f=(f=sessionStorage.getItem("previousActionResponse"))?JSON.parse(f):{},S=(S=sessionStorage.getItem("previousActionFormData"))?JSON.parse(S):{};let v={collectionItem:e,projectConstant:u,environments:p,collectionConstants:c,utilities:d,previousActionResponse:f,previousActionFormData:S,user:t,userCollectionConstants:m,userUtilities:g},y=replaceNbsps(o),h=(a.innerHTML="",[]);n&&n.length&&n.forEach(e=>{e.urlOrTag.startsWith("<link")?a.innerHTML+=e.urlOrTag:(e.urlOrTag.startsWith("http")||e.urlOrTag.startsWith("ftp"))&&(a.innerHTML+=`<link rel="stylesheet" href='${e.urlOrTag}' crossorigin/>`)}),i&&i.length&&i.forEach(e=>{var t;e.urlOrTag.startsWith("<script")?(t=/<script.*?src="(.*?)"/gim.exec(e.urlOrTag)[1]).startsWith("http")||t.startsWith("https")?h.push(t):(t=createScriptFromUrl(t),a.appendChild(t)):(e.urlOrTag.startsWith("http")||e.urlOrTag.startsWith("ftp"))&&h.push(e.urlOrTag)}),h&&h.length?Promise.all(h.map(e=>fetch(e))).then(e=>Promise.all(e.map(e=>e.text()))).then(e=>{e.forEach(e=>{e=createScriptFromText(e);a.appendChild(e)}),addComponentToElem(r,y,s,a,v)}):addComponentToElem(r,y,s,a,v)},createScriptFromUrl=e=>{var t=document.createElement("script");return t.setAttribute("type","text/javascript"),t.setAttribute("src",e),t.setAttribute("async",!0),t.setAttribute("defer",!0),t},createScriptFromText=e=>{var t=document.createElement("script"),e=document.createTextNode(e);return t.appendChild(e),t},addComponentToElem=(e,t,a,o,r)=>{var{jsStr:a,htmlStr:t}=replaceFuncAndVarName(a,t),t=replaceComponentDynamicValues(t,r),a=replaceComponentDynamicValues(a,r),r=(e&&(o.innerHTML+=`<style>${e}</style>`),null!==document.getElementById("dcmeta"));console.log("ðŸš€ ~ addComponentToElem ~ dcMetaExists:",r),t&&(o.innerHTML+=t,(e={})["nocode-html"]=t,r||addEventsScriptForSnippet(e,o)),a&&(t=createScriptFromText(a),o.appendChild(t),(e={})["nocode-html"]=a,r||addEventsScriptForSnippet(e,o))},getComponentItem=async(e,t,a)=>{var o={collectionId:"",collectionItemId:"",itemData:{},pageCollectionItem:{}},r=await getPageItemData();if(o.pageCollectionItem=r?.itemData||{},a)if(e.getAttribute("get-page-collection")){e=window.location.pathname.split("/"),e=e[e.length-2];if(e&&e!==a)return console.error("\n The collection linked to the custom component does not match the page's collection."),o;o.itemData=r?.itemData||{},o.collectionId=r?.collectionId||"",o.collectionItemId=r?.collectionItemId||""}else if(t){e=t,r=e?e.getAttribute("data-collection-id"):"",t=e?e.getAttribute("data-item-id"):"";if(r){e={collectionId:r,itemId:t};if(r!==a)return console.error("\n The collection linked to the custom component does not match the items' collection."),o;t=await getModalItemData(e,!1);o.itemData=t?.itemData||{},o.collectionId=t?.collectionId||"",o.collectionItemId=t?.collectionItemId||""}}return o},replaceComponentDynamicValues=(e,t)=>{var{collectionItem:t,projectConstant:a,environments:o,collectionConstants:r,utilities:s,previousActionResponse:n,previousActionFormData:i,user:l,userCollectionConstants:c,userUtilities:d}=t,{itemData:t,pageCollectionItem:u}=t;return e=e.replaceAll("https://{{APPLICATION_URL}}/",SERVER_URL),e=replaceFieldsValueIntoExpression(e,t,l,a,o,r,n,i,s,c,d,u)},replaceFuncAndVarName=(a,o)=>(getAllFuncAndVarNameFromStr(a).forEach(e=>{var t=e+(new Date).valueOf();a=a.replaceAll(e,t),o=o.replaceAll(e,t)}),{jsStr:a,htmlStr:o}),getAllFuncAndVarNameFromStr=e=>{var t=getRegexValueFromStr(/function\s+(\w+)\s*\(/g,e),a=getRegexValueFromStr(/(\w+)\s*=\s*\(.*\)\s*=>/g,e),o=getRegexValueFromStr(/async\s+function\s+(\w+)\s*\(/g,e),e=getRegexValueFromStr(/\b(?:const|let|var)\s+(\w+)\b/g,e);return[...new Set([...t,...a,...o,...e])]},getRegexValueFromStr=(e,t)=>{for(var a=[];null!==(o=e.exec(t));){var o=o[1];a.push(o)}return a},generatePdfFromSnippet=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ generatePdfFromSnippet ~ actionEnabled:",e),!e)return disabledActionResponse(a);new Promise(function(e,t){e(a)});var{targetElement:e,parameters:t}=a,{pdfTemplate:t,marginTop:o,marginBottom:r,marginLeft:s,marginRight:n,printBackground:i,format:l,saveToCollection:c,collection:d,collectionField:u}=t,p=localStorage.getItem("projectId"),m=localStorage.getItem("lang"),t=t||"";return t?(p=`projects/${p}/pdf-templates/${t}/download/`+(m?"?"+m:""),t={marginTop:o,marginBottom:r,marginLeft:s,marginRight:n,printBackground:i||!1,format:l},PDFfromTemplate(e,p,t,c,d,u)):void 0},generatePdfFromSection=async o=>{var r=isActionEnabled(o);if(console.log("ðŸš€ ~ generatePdfFromSection ~ actionEnabled:",r),!r)return disabledActionResponse(o);{new Promise(function(e,t){e(o)});var{targetElement:r,parameters:s}=o,{marginTop:s,marginBottom:n,marginLeft:i,marginRight:l,format:c,showComponents:d,source:u,saveToCollection:p,collection:m,collectionField:g}=s;let e=r?r.getAttribute("data-collection-id"):"";e||(f=r?r.closest("[data-collection-id]"):"")&&(e=f?f.getAttribute("data-collection-id"):"");var f=r?r.getAttribute("data-item-id"):"";let t="";d?(d=d.split(":")[1],d=document.getElementById(d),t=d.cloneNode(!0)):"MODAL"===u?(d=r.closest("[id^=modal-container-]").querySelector(".modal-body"),t=d.cloneNode(!0)):"SUB_PAGE"===u?(d=r.closest("[data-subpage-id]"),t=d.cloneNode(!0)):"PAGE"===u&&((r=document.body.cloneNode(!0)).querySelectorAll("script, iframe").forEach(e=>e.remove()),t=r);d=[s||0,i||0,n||0,l||0];let a=e+"_"+f;e||f||(a=window.location.pathname.split("/")[1]);var[,u,r]=(c=c||"A4:21.0:29.7").split(":");try{t.style.maxWidth=u+"cm",t.style.margin="0 auto",t.style.width=u+"cm";var S=document.createElement("div"),v=(S.style.maxWidth=u+"cm",S.appendChild(t),await addImagesForPDFUsingProxy(S),document.createElement("style"));if(v.innerHTML=` h1, h2, h3, p, img, table {
        break-inside: avoid;
        page-break-inside: avoid; /* Ensure compatibility */
      }
      .page-break {
        page-break-before: always;
      }
      div, section {
        break-inside: avoid;
      }`,S.appendChild(v),p){var y=await html2pdf().from(S).toPdf().outputPdf("arraybuffer"),h=new Blob([y],{type:"application/pdf"}),A=(a+=".pdf",new FormData);A.append("file",h,a);try{var E=`file/upload/${m}/`+g,I=await unSecuredPostCall(A,E);if(200===I.status&&I.data){var b=`open/collection-form/${m}/items/`+f,w={[g]:I.data};let e=await unSecuredPutCall(w,b);if(201===e.status||200===e.status)return toastr.success("PDF successfully saved to collection.","Success"),console.log("PDF successfully uploaded to collection."),e;console.error("Failed to save PDF metadata to collection.")}else console.error("Failed to upload PDF:",response.data)}catch(e){return console.error("Error saving PDF to collection:",e.message),toastr.error("Failed to save PDF to collection.","Error"),e}}else html2pdf().from(S).set({margin:d,filename:a,html2canvas:{scale:2,scrollX:0,scrollY:0,useCORS:!0},jsPDF:{unit:"cm",format:[u,r],orientation:"portrait",autoPaging:"text"}}).save()}catch(e){console.log("Error: ",e)}}},generatePdfFromAgreementTemplate=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ generatePdfFromAgreementTemplate ~ generatePdfFromAgreementTemplate:",e),!e)return disabledActionResponse(a);new Promise(function(e,t){e(a)});var{targetElement:e,parameters:t}=a,{agreementTemplate:t,marginTop:o,marginBottom:r,marginLeft:s,marginRight:n,format:i,saveToCollection:l,collection:c,collectionField:d}=t,u=localStorage.getItem("projectId"),t=t||"";return t?(u=`projects/${u}/agreement-templates/${t}/download`,t={marginTop:o,marginBottom:r,marginLeft:s,marginRight:n,format:i},PDFfromTemplate(e,u,t,l,c,d)):void 0},PDFfromTemplate=async(e,t,a,o=!1,r="",s="")=>{let n=e?e.getAttribute("data-collection-id"):"";n||(i=e?e.closest("[data-collection-id]"):"")&&(n=i?i.getAttribute("data-collection-id"):"");var i=e?e.getAttribute("data-item-id"):"";try{let e;return o?200===(e=await unSecuredPostCall({collectionName:n,itemId:i,pdfDownloadOptions:a,collection:r,collectionField:s,saveToCollection:o},t)).status?toastr.success("PDF successfully saved to collection.","Success"):toastr.error("Failed to save PDF to collection.","Error"):e=await downloadFile(t,{collectionName:n,itemId:i,pdfDownloadOptions:a}),e}catch(e){console.log("Error: ",e)}},fetchImagesAsBase64=async e=>{e=await fetch("/proxy-images",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrls:e})});if(e.ok)return e.json();throw new Error("Failed to fetch images")},addImagesForPDFUsingProxy=async e=>{let o=e.querySelectorAll("img");e=Array.from(o).map(e=>e.src);(await fetchImagesAsBase64(e)).forEach(({url:t,base64:e})=>{var a=Array.from(o).find(e=>e.src===t);a&&(a.src=e)})},pdfToText=async a=>{var t=isActionEnabled(a);if(console.log("ðŸš€ ~ pdfToText ~ actionEnabled:",t),t){new Promise(function(e,t){e(a)});var t=a.parameters,o=a.response,r={},s=sessionStorage.getItem("previousActionResponse"),s=s?JSON.parse(s):{};let e=a.targetElement.getAttribute("data-item-id");!(e=void 0!==e&&!["","undefined","null",void 0,null].includes(e)?e:"")&&o&&(n=o.collectionSaveOrUpdateResponse,n)&&(n=n.data,e=n.uuid);var n=Object.keys(s)[0],{collection:n,fieldForPdf:s,fieldForText:t,successMessage:i,errorMessage:l}=(!e&&n&&({[n]:s}=s,e=s.uuid),t);try{var c=`open/collection-form/${n}/items/${e}/pdf-text/${s}/`+t,d=await unSecuredPostCall({},c);"success"===d.status&&toastr.success(i||"Set Text in Field","Success"),r.data={...o,...d},r.data.collectionSaveOrUpdateResponse=d,r.data.pdfTotext=d,r.status="success"}catch(e){e.response&&(r.data=e.response,r.status="error",toastr.error(l||"Cannot Set Pdf's text now., Error "))}return r}return disabledActionResponse(a)},amazonTextract=async a=>{var t=isActionEnabled(a);if(console.log("ðŸš€ ~ amazonTextract ~ actionEnabled:",t),t){new Promise(function(e,t){e(a)});var t=a.parameters,o=a.response,r={},s=sessionStorage.getItem("previousActionResponse"),s=s?JSON.parse(s):{};let e=a.targetElement.getAttribute("data-item-id");!e&&o&&(n=o.collectionSaveOrUpdateResponse,n)&&(n=n.data,e=n.uuid);var n=Object.keys(s)[0],{collection:n,fieldForDocument:s,fieldForText:t,successMessage:i,errorMessage:l}=(!e&&n&&({[n]:s}=s,e=s.uuid),t);try{var c=`ocr-to-text/${n}/items/${e}/ocr-text/${s}/`+t,d=await unSecuredPostCall({},c);200===d.status&&toastr.success(i||"Set Text in Field","Success"),r.data={...o,...d},r.data.collectionSaveOrUpdateResponse=d,r.data.amazonTextract=d,r.status="success"}catch(e){e.response&&(r.data=e.response,r.status="error",toastr.error(l||"Cannot Set Pdf's text now., Error "))}return r}return disabledActionResponse(a)},referenceDropDownOnChange=async a=>{var e=isActionEnabled(a);if(console.log("ðŸš€ ~ referenceDropDownOnChange ~ actionEnabled:",e),e){new Promise(function(e,t){e(a)});let{element:r,parameters:e}=a,{collection:s,mapping:t}=e;s&&t.length&&t.forEach(async e=>{var{key:e,value:t,type:a,refField:o}=e,e=await getValueFromDropdown(r.value,s,e,a,o),[a,o]=t.split(":"),t=document.getElementById(o);e&&t&&setValueInElement(t,a,e)})}},setValueInElement=(e,t,a)=>{["input","select"].includes(t)?insertFormElementValue(a,e):"textarea"===t&&e.hasAttribute("data-show-editor")?e.summernote("reset"):e.innerHTML=a},getValueFromDropdown=async(e,t,a,o,r)=>{let s="";return s=e&&(t=await getCollectionItemById(t,e),s=parseValueFromData(t,a),"reference"===o)?parseValueFromData(s,r):s},createFormForPermission=async(e,t)=>{let o=t.querySelector(".form-container");t=t.attributes;let a=Object.values(t);a=a.filter(e=>e.name.includes("permission-")&&"load-permission-from"!==e.name);let r=[];var s=t["load-permission-from"].value,t=(console.log("loadPermissionFrom",s),r=await getPermissionsItemData(t,s,r,"permissions",o),a.forEach(e=>{var e=e.value,t=(console.log("attrKey VIJAY",e),console.log("permissions VIJAY",r),document.createElement("div")),a=(t.setAttribute("class","form-group col-12 col-md-12 d-flex flex-column"),document.createElement("input")),a=(a.setAttribute("class","form-check-input dc-checkbox"),a.setAttribute("id",e),a.setAttribute("value",e),a.setAttribute("type","checkbox"),a.setAttribute("name",e),r&&r.includes(e)&&a.setAttribute("checked",!0),t.appendChild(a),document.createElement("label"));a.setAttribute("class","form-check-label"),a.setAttribute("for",e),a.innerText=e,t.appendChild(a),o.appendChild(t)}),document.createElement("div")),s=(t.setAttribute("class","form-group p-t-10 no-border-bottom col-12 col-md-12"),document.createElement("button"));s.setAttribute("class","btn btn-primary"),s.setAttribute("type","submit"),s.innerText="Update Permission",t.appendChild(s),o.appendChild(t)},getPermissionsItemData=async(e,t,a,o="permissions",r="")=>{var s="",n=e["page-collection"];return(n=n?n?.value:"")&&"true"===n?(n=(n=e["tenant-collection"])?n?.value:"",s=(s=e["user-setting-collection"])?s?.value:"",{itemData:e,collectionId:r}=await getItemDataForElement(r),"tenant"===t?r===n?e[o]:[]:"user"===t?"user"===r?e[o]:[]:"user-settings"===t&&r===s?e[o]:[]):"tenant"===t?fetchCurrentTenantJson()[o]:"user"===t?fetchLoggedInUserJson()[o]:"user-settings"===t?fetchCurrentUserSettingsJson()[o]:[]},changePermissionInTenant=async a=>{var t=isActionEnabled(a);if(console.log("ðŸš€ ~ changePermissionInTenant ~ actionEnabled:",t),t){new Promise(function(e,t){e(a)});t={};try{var e,o,r=a.element,s=r.attributes,n=s["load-permission-from"].value,i=(e=(e=s["page-collection"])?e?.value:"",await getPermissionsItemData(s,n,"","uuid",r)),l=await serializeFormData(r.elements),c=(o=await securedPostCall(l,`auth/tenant/${i}/permissions`)).data;"true"!==e&&setJsonInLocalStorage("tenant",c),t.data=o,t.status="success"}catch(e){e.response&&(t.data=e.response,t.status="error")}return t}return disabledActionResponse(a)},changePermissionInUser=async a=>{var t=isActionEnabled(a);if(console.log("ðŸš€ ~ changePermissionInUser ~ actionEnabled:",t),t){new Promise(function(e,t){e(a)});t={};try{var e,o,r=a.element,s=r.attributes,n=s["load-permission-from"].value,i=(e=(e=s["page-collection"])?e?.value:"",await getPermissionsItemData(s,n,"","uuid",r)),l=await serializeFormData(r.elements),c=(o=await securedPostCall(l,`auth/user/${i}/permissions`)).data;"true"!==e&&setJsonInLocalStorage("user",c),t.data=o,t.status="success"}catch(e){e.response&&(t.data=e.response,t.status="error")}return t}return disabledActionResponse(a)},changePermissionInUserSettings=async a=>{var t=isActionEnabled(a);if(console.log("ðŸš€ ~ changePermissionInUserSettings ~ actionEnabled:",t),t){new Promise(function(e,t){e(a)});t={};try{var e,o,r=a.element,s=r.attributes,n=s["load-permission-from"].value,i=(e=(e=s["page-collection"])?e?.value:"",await getPermissionsItemData(s,n,"","uuid",r)),l=await serializeFormData(r.elements),c=(o=await securedPostCall(l,`auth/user-settings/${i}/permissions`)).data;"true"!==e&&(setJsonInLocalStorage("userSetting",c),await resetCurrentUserInLocalStorage()),t.data=o,t.status="success"}catch(e){e.response&&(t.data=e.response,t.status="error")}return t}return disabledActionResponse(a)},displayToolTip=async a=>{var t=isActionEnabled(a);if(console.log("ðŸš€ ~ displayToolTip ~ actionEnabled:",t),t){new Promise(function(e,t){e(a)});let{element:o,parameters:e}=a;var{toolTip:t,placement:s,theme:n,animation:i,interactive:l,followCursor:c,showDelay:d,hideDelay:u,maxWidth:p}=e,m=o.attributes;if(m["tooltip-active"])return"";t=await getToolTipContent(o,t);let r=[];t={allowHTML:!0,showOnCreate:!0,content:t,maxWidth:p||"none"};m.onclick&&(t.trigger="click"),s&&(t.placement=s),l&&(t.interactive=l),c&&(t.followCursor=c),(d||u)&&(t.delay=[d||null,u||null]),n&&(t.theme=n,document.body.querySelectorAll(`[id^='tippy-${n}']`).length||r.push({link:`https://unpkg.com/tippy.js@6/themes/${n}.css`,id:n})),i&&(t.animation=i,document.body.querySelectorAll(`[id^='tippy-${n}']`).length||r.push({link:`https://unpkg.com/tippy.js@6/animations/${i}.css`,id:i})),Promise.all(r.map(e=>fetch(e.link))).then(e=>Promise.all(e.map(e=>e.text()))).then(e=>{e.forEach((e,t)=>{var a=document.createElement("style");a.innerHTML=e,a.setAttribute("rel","stylesheet"),a.setAttribute("id","tippy-"+r[t].id),o.appendChild(a)})}),tippy(o,{...t,onShow(){o.setAttribute("tooltip-active",!0)},onHidden(e){o.removeAttribute("tooltip-active"),e.destroy()}})}},getToolTipContent=async(r,s)=>{let n="";if(s){s=await getToolTipComponent(s);let e=r.getAttribute("data-item"),t=(e=e?JSON.parse(e):"",r.getAttribute("data-collection-id"));t=t||"","svg"===r.tagName&&(t=r.parentElement.getAttribute("data-collection-id"),e=(e=r.parentElement.getAttribute("data-item"))?JSON.parse(e):"");r=fetchLoggedInUserJson();let a=[],o=[];var{constants:i,environments:l}=await getProjectDetail(),c=(t&&(c=await getCollectionDetails(t),a=c?.constants||[],o=c?.utilities||[]),await getCollectionDetails("user")),{constants:c,utilities:d}=c,u=(u=sessionStorage.getItem("previousActionResponse"))?JSON.parse(u):{},p=(p=sessionStorage.getItem("previousActionFormData"))?JSON.parse(p):{};n=replaceFieldsValueIntoExpression(s.content,e,r,i,l,a,u,p,o,c,d,{})}return n},getToolTipComponent=async e=>{let t={};var a="__DT_tooltip:"+e;if(e){if(!(t=(t=sessionStorage.getItem(a))?JSON.parse(t):"")){e="projects/template/"+e;try{var o=await publicGetCall(e);t=o.data,sessionStorage.setItem(a,JSON.stringify(t))}catch(e){console.log("Error: ",e)}}return populateBrowserStorageKeyToReset(a),t}},saveCollectionAssets=async a=>{var e,t,o,r,s,n=isActionEnabled(a);console.log("ðŸš€ ~ saveCollectionAssets ~ actionEnabled:",n),n&&(new Promise(function(e,t){e(a)}),{parameters:n,response:r}=a,{collection:n,collectionField:e,belongsToField:t,singleAssets:o}=n,{data:r,refCollectionFile:s}=r,await addingAssets(s,r,n,e,t,o))},updateCollectionAssets=async s=>{var n=isActionEnabled(s);if(console.log("ðŸš€ ~ updateCollectionAssets ~ actionEnabled:",n),n){new Promise(function(e,t){e(s)});var{parameters:n,response:i}=s;let{collection:e,collectionField:t,belongsToField:a}=n,{data:o,refCollectionFile:r}=i;n=`items/${e}/collection`,i=(await publicGetCall(n)).data,n=i.filter(e=>{e=e[a];return!(!e||"undefined"===e)&&!(!(e=e[0])||"undefined"===e)&&e&&e===o.uuid}),i=r.refField;if(i&&n&&0<n.length){let t=o[i];var i=n.filter(e=>!t.includes(e.uuid)),n=i&&0<i.length?i.map(e=>e.uuid):[];n&&n.length&&(i=`open/collection-form/${e}/items/bulkDelete`,n={ids:n},await unSecuredPostCall(n,i))}await addingAssets(r,o,e,t,a,!1)}},addingAssets=async(e,t,a,o,r,s)=>{if(e&&e.file&&e.file.length){var n=e.file||[],i=t.uuid||"",l=`open/collection-form/${a}/items`;if(!0===s){e={[o]:n,[r]:[i]};try{await unSecuredPostCall(e,l)}catch(e){console.error("error",e)}}else for(let t=0;t<n.length;t++){var c={[o]:n[t],[r]:[i]};try{await unSecuredPostCall(c,l)}catch(e){console.error(`API call ${t+1} failed`,e)}}}else console.log("No refCollectionFile present. Terminating function.")},fileActivityTracker=(e,t,a,o)=>{e={fileName:e,activity:t,collName:a,collField:o};try{unSecuredPostCall(e,"open/collection-form/file_activity_tracker/items")}catch(e){console.error("Activity Tracking failed",e)}},loginActivityTracker=async(e,t,a)=>{try{var o;await fetchInstalledPluginByCode("USER_ACTIVITY_TRACKER")&&(o={activity:e,userId:t||"",tenantId:a},await unSecuredPostCall(o,"open/collection-form/user_activity_tracker/items"))}catch(e){console.error("Login Activity Tracking failed",e)}},openPDFViewer=async e=>{e.preventDefault();let o=e.target;o.disabled=!0,console.log("==> openPDFViewer :>> ");var e=o?o.closest("[data-pdf-viewer-component]"):"",r=e?e.getAttribute("data-pdf-viewer-field"):"",s=r||"";const t=o.attributes["data-collection-id"],n=t?t.value:"";var i=o.attributes["data-item-id"],i=i?i.value:"",l=o.attributes["data-file-id"],l=l?l.value:"",c=o.attributes["data-file-original-name"],c=c?c.value:"",d=o.attributes["data-file-type"],d=d?d.value:"";if(r)if(s)if(l)if(t||e&&(t=e?e.getAttribute("data-collection-id"):"",n=t||""),"application/pdf"!==d)toastr.error("Only PDF type files can be viewed!","Error"),o.disabled=!1;else{toastr.info("Opening the PDF","Info");r=`
  <div id="pdfModal" class="modal" style="display: flex; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000;">
    <div class="modal-content" style="position: relative; width: 80%; height: 80%; background: white; overflow: hidden; padding: 20px;">
      <div class="modal-header" style="position: relative; padding-bottom: 10px; border-bottom: 1px solid #ddd;">
        <h2 style="margin: 0; font-size: 20px;">${c}</h2>
        <div class="modal-close" style="position: absolute; top: 10px; right: 10px; z-index: 1000; color: #333; font-size: 30px; cursor: pointer;">&times;</div>
      </div>
      <div id="pdfLoader" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
        <div class="spinner" style="border: 6px solid #f3f3f3; border-radius: 50%; border-top: 6px solid #3498db; width: 40px; height: 40px; animation: spin 2s linear infinite;"></div>
      </div>
      <iframe id="pdf-iframe" style="width: 100%; height: calc(100% - 50px);" frameborder="0" hidden></iframe>
    </div>
  </div>
`,e=document.createElement("style");e.type="text/css",e.innerText=`
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
`,document.head.appendChild(e),document.body.insertAdjacentHTML("beforeend",r);let t=document.getElementById("pdfModal");d=t.querySelector(".modal-close"),e=t.querySelector("#pdfLoader"),r=t.querySelector("#pdf-iframe");let a;try{var u=await fetchFile(i,l,n,s,c,!0),p=new Blob([u],{type:"application/pdf"});a=URL.createObjectURL(p),e.style.display="none",r.src=a,r.hidden=!1,d.onclick=function(){closePDFViewerModal(t,a,o)},window.onclick=function(e){e.target===t&&closePDFViewerModal(t,a,o)}}catch(e){console.error("Error fetching or rendering the PDF:",e),toastr.error("Failed to load PDF","Error"),closePDFViewerModal(t,a,o)}}else toastr.error(s+" has no PDF File","Error"),o.disabled=!1;else toastr.error("Collection Field is blank","Error"),o.disabled=!1;else toastr.error("Please bind Collection Field","Error"),o.disabled=!1},closePDFViewerModal=(e,t,a)=>{e.style.display="none",e.remove(),t&&URL.revokeObjectURL(t),a.disabled=!1},generateEmailOTP=async e=>{var t=isActionEnabled(e);if(console.log("ðŸš€ ~ generateEmailOTP ~ actionEnabled:",t),t){var{element:t,parameters:e}=e,{otpVerificationPage:e,successMessage:a,errorMessage:o,emailTemplate:r,otpAuthenticationType:s}=e;try{var n,i=t,l=await serializeFormData(i.elements),c=(l.emailTemplate=r,l.otpAuthenticationType=s||"login",await unSecuredPostCall(l,"auth/send-email-otp"));c&&200===c.status&&(console.log("OTP successfully sent to email."),n=c.data.emailOtpToken,window.location.href=e+"?emailOtpToken="+n,toastr.success(a||"OTP Sent to Email.","Success"))}catch(e){console.error("Error in generating Email OTP. Please Try Aagain",e),toastr.error(o||"OTP Generation Failed","Error")}}},verifyEmailOTP=async n=>{var e=isActionEnabled(n);if(console.log("ðŸš€ ~ verifyEmailOTP ~ actionEnabled:",e),e){var{element:e,parameters:n}=n,{successRedirectRules:n,successMessage:i,errorMessage:t,errorRedirectUrl:a}=n;try{var o=e,r=await serializeFormData(o.elements),l=await axios.post("/authorize-email-otp",r);if(l&&200===l.status){var c,d=l.data;console.log("OTP successfully verified."),await loginActivityTracker("Login",d?.userDetails?.userName,d?.tenant?.uuid);let{role:t,token:e,userDetails:a,tenant:o,userSetting:r,projectId:s}=d||{};setJsonInLocalStorage("user",a),localStorage.setItem("role",t),localStorage.setItem("token",e),localStorage.setItem("projectId",s),o?setJsonInLocalStorage("tenant",o):localStorage.removeItem("tenant"),r?setJsonInLocalStorage("userSetting",r):localStorage.removeItem("userSetting"),n&&(c=n.find(e=>Array.isArray(t)?t.includes(e.key):e.key===t),window.location.href=c?c.value:"/home",toastr.success(i||"Logged In Successfully","Success"))}}catch(e){console.error("Invalid OTP. Please Try Aagain",e),window.location.href=a||"/login",toastr.error(t||"Invalid OTP","Error")}}},generateSmsOTP=async e=>{var t=isActionEnabled(e);if(console.log("ðŸš€ ~ generateSmsOTP ~ actionEnabled:",t),t){var{element:t,parameters:e}=e,{otpVerificationPage:e,successMessage:a,errorMessage:o,smsTemplate:r,otpAuthenticationType:s}=e;try{var n,i=t,l=await serializeFormData(i.elements),c=(l.smsTemplate=r,l.otpAuthenticationType=s||"login",await unSecuredPostCall(l,"auth/send-sms-otp"));c&&200===c.status&&(console.log("OTP successfully sent to mobile number."),n=c.data.smsOtpToken,window.location.href=e+"?smsOtpToken="+n,toastr.success(a||"OTP Sent to Mobile Number.","Success"))}catch(e){console.error("Error in generating SMS OTP. Please Try Aagain",e),toastr.error(o||"OTP Generation Failed","Error")}}},verifySmsOTP=async n=>{var e=isActionEnabled(n);if(console.log("ðŸš€ ~ verifySmsOTP ~ actionEnabled:",e),e){var{element:e,parameters:n}=n,{successRedirectRules:n,successMessage:i,errorMessage:t,errorRedirectUrl:a}=n;try{var o=e,r=await serializeFormData(o.elements),l=await axios.post("/authorize-sms-otp",r);if(l&&200===l.status){var c,d=l.data;console.log("OTP successfully verified."),await loginActivityTracker("Login",d?.userDetails?.userName,d?.tenant?.uuid);let{role:t,token:e,userDetails:a,tenant:o,userSetting:r,projectId:s}=d||{};setJsonInLocalStorage("user",a),localStorage.setItem("role",t),localStorage.setItem("token",e),localStorage.setItem("projectId",s),o?setJsonInLocalStorage("tenant",o):localStorage.removeItem("tenant"),r?setJsonInLocalStorage("userSetting",r):localStorage.removeItem("userSetting"),n&&(c=n.find(e=>Array.isArray(t)?t.includes(e.key):e.key===t),window.location.href=c?c.value:"/home",toastr.success(i||"Logged In Successfully","Success"))}}catch(e){console.error("Invalid OTP. Please Try Aagain",e),window.location.href=a||"/login",toastr.error(t||"Invalid OTP","Error")}}},generateUserConsentEmailOTP=async e=>{var t=isActionEnabled(e);if(console.log("ðŸš€ ~ generateUserConsentEmailOTP ~ actionEnabled:",t),t){var{element:t,parameters:e}=e,{otpVerificationPage:e,userEmailField:a,successMessage:o,errorMessage:r,emailTemplate:s,collection:n}=e;try{var i,l=t,c=await serializeFormData(l.elements),d=(c.collection=n,setJsonInLocalStorage("tempData",c),{userEmailField:a,emailTemplate:s,collection:n}),u=await unSecuredPostCall(d,"user-consent/send-consent-email-otp");u&&200===u.status&&(console.log("OTP successfully sent to email."),i=u.data.emailOtpToken,window.location.href=e+"?emailOtpToken="+i,toastr.success(o||"OTP Sent to Email.","Success"))}catch(e){console.error("Error in generating OTP. Please Try Aagain",e),localStorage.removeItem("tempData"),toastr.error(r||"OTP Generation Failed","Error")}}},verifyUserConsentEmailOTP=async e=>{var t=isActionEnabled(e);if(console.log("ðŸš€ ~ verifyUserConsentEmailOTP ~ actionEnabled:",t),t){var{element:t,parameters:e}=e,{collection:e,successMessage:a,errorMessage:o,errorRedirectUrl:r,successRedirectUrl:s}=e;try{var n=t,i=await serializeFormData(n.elements),l=(i.collection=e,i.itemData=localStorage.getItem("tempData"),await unSecuredPostCall(i,"user-consent/verify-consent-email-otp"));l&&200===l.status&&(console.log("OTP successfully verified and data saved."),localStorage.removeItem("tempData"),window.location.href=s,toastr.success(a||"Data Saved","Success"))}catch(e){console.error("Invalid OTP. Please Try Aagain",e),localStorage.removeItem("tempData"),window.location.href=r,toastr.error(o||"Invalid OTP","Error")}}},generateUserConsentSmsOTP=async e=>{var t=isActionEnabled(e);if(console.log("ðŸš€ ~ generateUserConsentSmsOTP ~ actionEnabled:",t),t){var{element:t,parameters:e}=e,{otpVerificationPage:e,userMobileField:a,successMessage:o,errorMessage:r,smsTemplate:s,collection:n}=e;try{var i,l=t,c=await serializeFormData(l.elements),d=(c.collection=n,setJsonInLocalStorage("tempData",c),{userMobileField:a,smsTemplate:s,collection:n}),u=await unSecuredPostCall(d,"user-consent/send-consent-sms-otp");u&&200===u.status&&(console.log("OTP successfully sent to Phone number."),i=u.data.smsOtpToken,window.location.href=e+"?smsOtpToken="+i,toastr.success(o||"OTP Sent to Phone Number.","Success"))}catch(e){console.error("Error in generating OTP. Please Try Aagain",e),localStorage.removeItem("tempData"),toastr.error(r||"OTP Generation Failed","Error")}}},verifyUserConsentSmsOTP=async e=>{var t=isActionEnabled(e);if(console.log("ðŸš€ ~ verifyUserConsentSmsOTP ~ actionEnabled:",t),t){var{element:t,parameters:e}=e,{collection:e,successMessage:a,errorMessage:o,errorRedirectUrl:r,successRedirectUrl:s}=e;try{var n=t,i=await serializeFormData(n.elements),l=(i.collection=e,i.itemData=localStorage.getItem("tempData"),await unSecuredPostCall(i,"user-consent/verify-consent-sms-otp"));l&&200===l.status&&(console.log("OTP successfully verified and data saved."),localStorage.removeItem("tempData"),window.location.href=s,toastr.success(a||"Data Saved","Success"))}catch(e){console.error("Invalid OTP. Please Try Aagain",e),localStorage.removeItem("tempData"),window.location.href=r,toastr.error(o||"Invalid OTP","Error")}}},runOnce=t=>{let a=!1;return(...e)=>{if(!a)return a=!0,t(...e)}},handleLogoutAfterTokenExpire=runOnce(async e=>{toastr.error("User has been logged out!","Invalid Token"),await processLogoutUser(e)}),checkTokenExpiry=async o=>new Promise(async(e,t)=>{var a={status:"",message:"",error:""};if(console.log("token :>> ",o),!o)return a.message="Token is not provided.",e(a);if(console.log("Checking token split"),0<1e3*JSON.parse(atob(o.split(".")[1])).exp-Date.now())return a.status=200,a.message="Token is still active",e(a);try{return console.log("Handle token expiry"),await handleLogoutAfterTokenExpire("/login"),a.status=401,a.message="Logging out!",e(a)}catch(e){return console.log("error",e),a.status=500,a.message="Error",a.error=e,t(a)}}),openLinkInNewWindow=e=>{e=e.href;return window.open(e,"_blank","width="+screen.width+",height="+screen.height),!1},runJavaScriptCode=async e=>{var t=isActionEnabled(e);if(console.log("ðŸš€ ~ runJavaScriptCode ~ actionEnabled:",t),t){var t=e.parameters,{successMessage:a,errorMessage:o,runJavaScript:r}=t,s={};if(t&&"string"==typeof r&&r.trim())try{new Function(`(function() {
          "use strict";
          ${r}
        })();`)(),s.status="success",a&&toastr.success(a,"Success")}catch(e){s.status="error",console.error("Error executing JavaScript code:",e),toastr.error(o||"Error executing JavaScript code:","Error")}else console.warn("No valid JavaScript code provided."),toastr.error("No valid JavaScript code provided.","Error");return s}return disabledActionResponse(e)},renderTypesenseSearch=async(h,A,E,I,b,w,T,C,O,R)=>{try{if(!A||!I)return console.error("Typesense Collection or Redirect Page Missing."),void toastr.error("Typesense Collection or Redirect Page Missing.","Error");let e=document.getElementById("typesense-search"),o=document.getElementById("typesense-results"),r=document.getElementById("typesense-list"),s=document.getElementById("typesense-anchor"),n=document.getElementById("typesense-results-card"),i=document.getElementById("typesense-results-card-body"),l=document.getElementById("typesense-pagination"),c=document.getElementById("typesensePrevPage"),d=document.getElementById("typesenseNextPage"),u=document.getElementById("typesenseCurrentPage");if(o.style.display="none",o.innerHTML="",l.style.display="none",!e||!o)return void console.error("Typesense search elements not found");var D,F,P=(await unSecuredPostCall({typesenseCollection:A},"typesense-search/initialize")).data,N=P.collectionDetails;let p=N.fields,m=null,g=(E&&(D="projects/templates?uuid="+E,(F=await publicGetCall(D)).data)&&F.data.length&&F.data[0].content&&(m=F.data[0].content),h&&h.hasAttribute("data-typesense-results-limit")?parseInt(h.getAttribute("data-typesense-results-limit")):20),t=h&&h.hasAttribute("externalQueryParamKeys")?h.getAttribute("externalQueryParamKeys"):"";t=t&&t.split(",");var L=(await getItemDataForElement(h)).itemData;let f="typesense-search/search",S=(L&&(f=prepareItemDataAndExternalQueryParamForTable(t,f,L,h)),1),v=1,y="",a=async(e,t=1)=>{if(e.trim()&&""!==e){y=e.trim();try{var a=await unSecuredPostCall({typesenseCollection:A,searchQuery:e,typesenseFilter:T,resultsLimit:g,sortBy:O,sortOrder:R,page:t},f);e===y&&(a&&a.data&&a.data.data.length?(o.innerHTML="",o.style.display="block",renderResultsForTypesense(h,C,m,a.data.data,o,r,n,i,s,p,A,I,b,w),v=a.data.totalPages,S=t,u.textContent=`Page ${S} of `+v,c.disabled=S<=1,d.disabled=S>=v,l.style.display=1<v?"block":"none"):(o.innerHTML='<div class="alert alert-warning">No results found</div>',l.style.display="none"))}catch(e){console.error("Error in fetching results:",e),o.innerHTML='<div class="alert alert-danger">Error fetching results</div>',l.style.display="none"}}else y="",o.innerHTML="",o.style.display="none",l.style.display="none"};e.addEventListener("input",debounce(e=>{S=1,a(e.target.value.trim(),S)},100)),c.addEventListener("click",()=>{1<S&&a(e.value.trim(),S-1)}),d.addEventListener("click",()=>{S<v&&a(e.value.trim(),S+1)})}catch(e){console.error("Error in rendering Typesense Search",e),toastr.error("Error in rendering Typesense Search","Error")}},reindexDataForTypesenseCollection=async e=>{var t=isActionEnabled(e);if(console.log("ðŸš€ ~ reindexDataForTypesenseCollection ~ actionEnabled:",t),t){var t=e.parameters,{typesenseCollection:e,errorMessage:t,successMessage:a}=t;try{var o=await unSecuredPostCall({typesenseCollection:e},"typesense-search/reindex-data");o&&200===o.status?(console.log("Data Reindexed successfully."),a&&toastr.success(a,"Success")):(console.error("Error in reindexing data"),t&&toastr.error(t,"Error"))}catch(e){console.error("Error in reindexing data",e),t&&toastr.error(t,"Error")}}},deleteTypesenseCollection=async e=>{var t=isActionEnabled(e);if(console.log("ðŸš€ ~ deleteTypesenseCollection ~ actionEnabled:",t),t){var t=e.parameters,{typesenseCollection:e,errorMessage:t,successMessage:a}=t;try{var o="typesense-search/delete-collection/"+e,r=await unSecuredDeleteCall(o);r&&200===r.status?(console.log("Typesense Collection Deleted successfully."),a&&toastr.success(a,"Success")):(console.error("Error in deleting typesense collection"),t&&toastr.error(t,"Error"))}catch(e){console.error("Error in deleting typesense collection",e),t&&toastr.error(t,"Error")}}},renderImagesForTypesense=e=>e?Array.isArray(e)?e.map(e=>`<img id="typesense-image" class="typesense-results-image" src="${e}" alt="File">`).join("&nbsp;&nbsp;"):`<img id="typesense-image" class="typesense-results-image" src="${e}" alt="File">`:"",renderResultsForTypesense=(e,t,a,o,r,s,n,i,l,c,d,u,p,m)=>{let g=s?s.classList.value:"",f=l?l.classList.value:"",S=n?n.classList.value:"",v=i?i.classList.value:"";s=!!e&&e.hasAttribute("data-newtab"),l=e&&e.hasAttribute("data-typesense-recordsperrow")?parseInt(e.getAttribute("data-typesense-recordsperrow")):3;let y="col-md-"+Math.floor(12/l),h=s?"_blank":"_self",A=a?a.replace(/<\/?pre>/g,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&"):null;r.innerHTML="card"===t?'<div class="row g-3">'+o.map(o=>{var e=A?A.replace(/{{(.*?)}}/g,(e,t)=>{let a=t.trim();return c.some(e=>e.fieldName===a&&"file"===e.type)?renderImagesForTypesense(o[a]):o[a]||""}):`<h5 class="card-title">${o.uuid||"No data in uuid"}</h5>`;return`<div class="${y}">
                      <div class="${S}">
                        <div class="${v}">
                           <a href="${redirectLinkForTypesense(o,d,u,p,m)}" target="${h}" 
                             rel="noopener noreferrer" class="${f}">
                            ${e}
                          </a>
                        </div>
                      </div>
                    </div>`}).join("")+"</div>":'<ul class="list-group">'+o.map(o=>{var e=A?A.replace(/{{(.*?)}}/g,(e,t)=>{let a=t.trim();return c.some(e=>e.fieldName===a&&"file"===e.type)?renderImagesForTypesense(o[a]):o[a]||""}):o.uuid||"No data in uuid";return`<li class="${g}">
                      <a href="${redirectLinkForTypesense(o,d,u,p,m)}" target="${h}" 
                         rel="noopener noreferrer" class="${f}">
                        ${e}
                      </a>
                    </li>
                   `}).join("")+"</ul>"},redirectLinkForTypesense=(e,t,a,o,r)=>a+`/${o||t}/`+(Array.isArray(e[r])?e[r][0]:e[r]||e.uuid),debounce=(t,a)=>{let o;return(...e)=>{clearTimeout(o),o=setTimeout(()=>t(...e),a)}};
//# sourceMappingURL=drapcode.js.map