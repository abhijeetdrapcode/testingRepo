let paginationDataMap=new Map,replaceTextContent=!1,renderImgContent=!1,stylesMap=new Map,dataTablePaginationDataMap=new Map,dataTableStylesMap=new Map,externalAPIDataGroupDataMap=new Map,DEFAULT_PAGE_RANGE_NUMBER_PAGINATE=10,SESSION_RESPONSE_KEY="previousActionResponse",SESSION_FORM_DATA_KEY="previousActionFormData",SESSION_RESPONSE_ATTR_KEY="data-previous-action-response",SESSION_FORM_DATA_ATTR_KEY="data-previous-action-formdata",TEXT_COMPONENTS=["H1","H2","H3","H4","H5","H6","P"],DATA_SOURCE_DEFAULT="DEFAULT",DATA_SOURCE_SUPABASE="SUPABASE",DATA_SOURCE_DIRECTUS="DIRECTUS",truthyValues=[1,"1",!0,"true","True","TRUE","yes","Yes","YES","y","Y","t","T","on","On","ON","enable","Enable","ENABLE","enabled","Enabled","ENABLED"],falsyValues=[0,"0",!1,"false","False","FALSE","no","No","NO","n","N","f","F","off","Off","OFF","disable","Disable","DISABLE","disabled","Disabled","DISABLED","",null,void 0,NaN];function getNumberOfPages(e,t){return Math.ceil(e/t)}function uuidv4(t=8){let a="";for(let e=0;e<t;e++)a+="x";return a.replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function replaceSlashWithUnderscore(e){return e&&"string"==typeof e&&e.replace(/\//g,"____")}function replaceUnderscoreWithSlash(e){return e&&"string"==typeof e&&e.replace(/____/g,"/")}let findComponentIndex=(t,a)=>Object.keys(t).findIndex(e=>t[e].getAttribute("data-gjs")===a);function highlightSelectedTimeslot(e,t){e&&((e=(e=document.getElementById(e))?e.querySelectorAll("ul>li>a"):[])&&e.length&&e.forEach(e=>e.classList.remove("active")),t)&&t.classList.add("active")}function selectedTimeSlot(e,t,a,r,n,i,l,s){console.log("ðŸš€ ~ file: dataLoader.js:6353 ~ selectedTimeSlot ~ selectionInfo:",i," ~ slotTime:",l," ~ interval:",s," ~ collectionFormElem:",a," ~ eventStartTimeField:",r," ~ eventEndTimeField:",n),highlightSelectedTimeslot(t,e);t=r+"-"+a.id,e=n+"-"+a.id;let o=a.querySelector(`[id=${t}]`),d=a.querySelector(`[id=${e}]`);var c=document.getElementById("dateTimeFormat").innerText||"YYYY-MM-DD",c=getDateTimeFormat(c,!0),c=(console.log("ðŸš€ ~ file: dataLoader.js:64 ~ datenTime:",c),i.startStr+" "+l),i=(console.log("ðŸš€ ~ file: dataLoader.js:67 ~ startTimeWithSlotTime:",c),new Date(c)),l=(console.log("ðŸš€ ~ file: dataLoader.js:68 ~ newStartDatetimeObj:",i),flatpickr.formatDate(i,"Y-m-d h:i K")),c=(console.log("ðŸš€ ~ file: dataLoader.js:66 ~ startTimeSlot:",l),moment(i).add(s,"m").toDate()),i=(console.log("ðŸš€ ~ file: dataLoader.js:73 ~ newEndDatetimeObj:",c),flatpickr.formatDate(c,"Y-m-d h:i K"));console.log("ðŸš€ ~ file: dataLoader.js:75 ~ endTimeSlot:",i),o?o.value=l:((o=document.createElement("input")).type="hidden",o.id=t,o.name=r,o.value=l,o.setAttribute("flat-picker-date-type","datetime-local"),o.setAttribute("data-timeslot",""),a.appendChild(o)),d?d.value=i:((d=document.createElement("input")).type="hidden",d.id=e,d.name=n,d.value=i,d.setAttribute("flat-picker-date-type","datetime-local"),d.setAttribute("data-timeslot",""),a.appendChild(d))}let generateHoursInterval=(t,a,r)=>{var n=[];for(let e=0;t<1440&&!(a<t);e++){var i=Math.floor(t/60),l=t%60;n[e]=("0"+i%24).slice(-2)+":"+("0"+l).slice(-2),t+=r}return n},nthOrdinalNumber=e=>{if(3<e&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},createContentPlaceholder=(t,a,r)=>{let n="";var i=r.includes("list-group-item"),e=localStorage.getItem("loadingIconKey");if(e&&"PLACEHOLDER"!==e)"PLAIN_SPINNER"===e?n=`<div class="drapcode-spinner-plane ${a}-placeholder"></div>`:"CHASE_SPINNER"===e?n=`<div class="sk-chase ${a}-placeholder"><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div></div>`:"BAR_SPINNER"===e?n=`<div class="drapcode-spinner-bar ${a}-placeholder"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>`:"DOT_SPINNER"===e?n=`<div class="drapcode-spinner-dot ${a}-placeholder"><div class="dot1"></div><div class="dot2"></div></div>`:"FADING_CIRCLE_SPINNER"===e?n=`<div class="sk-fading-circle ${a}-placeholder"><div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div><div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div></div>`:"BOUNCE_SPINNER"===e?n=`<div class="drapcode-spinner-bounce ${a}-placeholder"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>`:"NONE"===e&&(n="");else for(let e=0;e<t;e++)n+=i?`<div class="${r} ${a}-placeholder"><div class="drapcode-col-12"><div class="drapcode-row"><div class="drapcode-col-4"></div><div class="drapcode-col-4"></div><div class="drapcode-col-6"></div></div></div></div>`:`<div class="drapcode-item ${r} ${a}-placeholder"><div class="drapcode-col-12"><div class="drapcode-picture"></div><div class="drapcode-row"><div class="drapcode-col-6 big"></div><div class="drapcode-col-4 empty big"></div><div class="drapcode-col-2 big"></div><div class="drapcode-col-4"></div><div class="drapcode-col-8 empty"></div><div class="drapcode-col-6"></div><div class="drapcode-col-6 empty"></div><div class="drapcode-col-12"></div></div></div></div>`;return n},loadBrowserStorageSetterItems=async(a,r)=>{var{finderId:n,collectionName:i,fieldName:e,dataGroupChildren:l,externalQueryParamKeys:s,searchString:o}=a,t=r.dataset,t=Object.assign({},t),d=findComponentIndex(l,"search-form"),c=l[d],u=l,u=(c&&c.length&&u[d].remove(),findComponentIndex(l,"date-range-filter")),d=l[u],u=(r.innerHTML="",document.createElement("div")),p=(u.classList.add("data-group-content"+elementAttribute(r,"id")),u.classList.add("row"),r.style.display="",findComponentIndex(l,"data-group-map")),p=l[p],c=(c&&r.appendChild(c),p&&r.appendChild(p),d&&r.appendChild(d),r.appendChild(u),findComponentIndex(l,"pagination")),p=l[c];p&&r.appendChild(p),a.replacedElement=u,a.originalDataGroup=r;let m=!1;d=(await getItemDataForElement(r)).itemData;if(n){let e=`collection-table/${i}/finder/${n}/items/count?`;l=getDataRangeQuery(a,"dataGroup",o);l&&(e+="&"+l),e=prepareItemDataAndExternalQueryParam(s,e,d,r);let t=await searchQueryStringFromUrl();void 0!==o&&o?e=t?(t.startsWith("?")&&(t=t.replace("?","&")),e+"&"+o+t):e+"&"+o:t&&(t.startsWith("?")&&(t=t.replace("?","&")),e+=t),e=await addEntityQueryToUrl(e,i,n);c=await securedGetCall(e);a.numberOfPages=getNumberOfPages(c.data,a.numberPerPage),m=c?c._$isPrivateFilter:null}else if(e){p=parseValueFromData(d,e);a.numberOfPages=1,a.filteredItemsUrl=`collection-table/${i}/itemList`,a.itemIds=p}else{u=Object.fromEntries(new URLSearchParams(window.location.search));console.log("::::::searchQuery11:::::::",u);let e="";"externalId"in u&&(e=u.externalId),console.log("::::::::externalApiMiddlewareId:::::",e),a.filteredItemsUrl=`external-api-middleware/${e}/collection-items`}a.finderId=n,loadBrowserStorageSetter(a,m,t)},loadBrowserStorageSetterFromExternalAPI=async(r,n)=>{let{dataGroup:e,externalApiId:t,dataGroupChildren:i}=r??"";var a={};let l;var s={};let o={},d={};let c="external-api";t&&(u=await publicGetCall(c+"/id/"+t))&&200===u.status&&(u=((o=u.data)??"").responseDataMapping,u=(u??"").selectedMapping,d=u);var{bodyDataFrom:u,uniqueKey:p,sendFormData:m}=o||"",u=u??"noDynamicData",p=p??"id",m=!!m,g=(e.innerHTML="",document.createElement("div")),b=(g.classList.add("data-group-content"+elementAttribute(e,"id")),g.classList.add("row"),g.innerHTML="",e.style.display="",e.appendChild(g),findComponentIndex(i,"pagination")),b=i[b];b&&e.appendChild(b),r.replacedElement=g,r.originalDataGroup=e,r.numberOfPages=1,u&&"NON_PERSISTENT_COLLECTION"===u?(g=(b=window.location.pathname.split("/"))[b.length-1],g=(b=b[b.length-2])?g:uuidv4(16),a.externalApiItem={id:g,uuid:g,_data_source_rest_api_primary_id:g,nonPersistentCollectionItemId:g,pageCollectionName:b,uniqueKey:p||"id"}):({collectionItemId:g,collectionId:b}=await getPageItemData(),a.externalApiItem={...a.externalApiItem,collectionItemId:g,pageCollectionName:b,uniqueKey:p||"id",id:g,uuid:g,_data_source_rest_api_primary_id:g}),a.externalApiItem&&(console.log("the data in line 676 ",a),{nonPersistentCollectionItemId:b,collectionItemId:p,pageCollectionName:g}=a.externalApiItem,g=!!g,console.log("%c==> DataGroup from External API sendPageCollectionItem :>> ","color:lime",g),g)&&(!p||u&&"collectionItem"!==u||m?b&&"NON_PERSISTENT_COLLECTION"===u&&!m&&(c=c+"/"+b):c=c+"/"+p);let f={},h={};g=sessionStorage.getItem("previousActionResponse"),g&&(g=JSON.parse(g),0<Object.keys(g).length)&&(f=getFinalSessionValues(f,g,o,"current_session"),console.log("%c==> DataGroup from External API session value :>> ","color:yellow",f)),u=sessionStorage.getItem("previousActionFormData"),u&&(u=JSON.parse(u),0<Object.keys(u).length)&&(h=getFinalSessionValues(h,u,o,"form_data_session"),console.log("%c==> DataGroup from External API session form data :>> ","color:yellow",h)),m={data:a,externalApiId:t,sessionValue:f,sessionFormValue:h};if(console.log("\n URL: ",c),console.log("\n Body: ",m),l=await unSecuredPostCall(m,c),s.data={...l},s.externalApiResponse=l,s.data.externalApiResponse=l,s.status="success",r.externalApiResponse=l.data,r.numberOfPages=1,200===l.status&&l.data){let a=createDataGroupResponseDataArr(l);a&&"undefined"!==a&&(removeDataGroupPlaceholder(i),Object.keys(a).forEach(e=>{var t;["externalApiMiddlewareId","totalRecords"].includes(e)||(t=a[e],renderExternalApiDataForBrowserStorage(!Array.isArray(t),l.data,i,e,r.replacedElement,d,n))}))}},loadDataGroupItems=async(a,r)=>{var{finderId:n,collectionName:i,fieldName:e,numberPerPage:t,dataGroupChildren:l,externalQueryParamKeys:s,searchString:o}=a,d=findComponentIndex(l,"search-form"),c=l[d],u=l,d=(c&&c.length&&u[d].remove(),findComponentIndex(l,"date-range-filter")),d=l[d],t=createContentPlaceholder(t||1,u[0].id,u[0].className),u=(r.innerHTML="",document.createElement("div")),t=(u.classList.add("data-group-content"+elementAttribute(r,"id")),u.classList.add("row"),u.innerHTML=t,r.style.display="",findComponentIndex(l,"data-group-map")),t=l[t],c=(c&&r.appendChild(c),t&&r.appendChild(t),d&&r.appendChild(d),r.appendChild(u),findComponentIndex(l,"pagination")),t=l[c];t&&r.appendChild(t),a.replacedElement=u,a.originalDataGroup=r;let p=!1;d=(await getItemDataForElement(r)).itemData;if(n){let e=`collection-table/${i}/finder/${n}/items/count?`;l=getDataRangeQuery(a,"dataGroup",o);l&&(e+="&"+l),e=prepareItemDataAndExternalQueryParam(s,e,d,r);let t=await searchQueryStringFromUrl();void 0!==o&&o?e=t?(t.startsWith("?")&&(t=t.replace("?","&")),e+"&"+o+t):e+"&"+o:t&&(t.startsWith("?")&&(t=t.replace("?","&")),e+=t),e=await addEntityQueryToUrl(e,i,n);c=await securedGetCall(e);a.numberOfPages=getNumberOfPages(c.data,a.numberPerPage),p=c?c._$isPrivateFilter:null}else if(e){t=parseValueFromData(d,e);a.numberOfPages=1,a.filteredItemsUrl=`collection-table/${i}/itemList`,a.itemIds=t}else{u=Object.fromEntries(new URLSearchParams(window.location.search));console.log("::::::searchQuery11:::::::",u);let e="";"externalId"in u&&(e=u.externalId),console.log("::::::::externalApiMiddlewareId:::::",e),a.filteredItemsUrl=`external-api-middleware/${e}/collection-items`}a.finderId=n,loadGroupData(a,p)},processAndRenderJsonData=(e,d,a,c,u)=>{e&&d&&"object"==typeof d&&Object.keys(a).forEach(async e=>{var t=a[e],l=elementAttribute(t,"data-gjs");if(!["pagination","search-form","data-group-map","external-api-fallback"].includes(l)){var s,l=t.cloneNode(!0),o=elementAttribute(l,"id");o&&l.setAttribute("id",o+"-"+e+c+"-"+uuidv4()),applyUserDefinedStyles(t,l,stylesMap);let a="data-json-field",r="data-link-json-field",n="data-form-element-previous-action-response",i="data-media-json-field";0<t.children.length&&(o=l.children,updateChildrenIds(o,l,stylesMap),e=l.querySelectorAll(`[${a}]`),t=l.querySelectorAll(`[${r}]`),o=l.querySelectorAll(`input[${n}]`),s=l.querySelectorAll(`[${i}]`),e.forEach(e=>{var t=elementAttribute(e,a),t=_.get(d,t)||"";e.innerHTML=t}),t.forEach(e=>{var t=elementAttribute(e,r),t=_.get(d,t)||"";e.href=t}),o.forEach(e=>{var t=elementAttribute(e,n),t=_.get(d,t)||"";e.value=t}),s.forEach(e=>{var t=elementAttribute(e,i),t=_.get(d,t)||"";e.src=t})),u.appendChild(l)}})},loadDataGroupExternalAPIItems=async e=>{let{dataGroupChildren:t,replacedElement:i,jsonDataPath:a,fallbackOnLoadEvent:r,dontRepeatFallbackEventElem:n}=e;e=window.sessionStorage.getItem("previousActionResponse"),e=JSON.parse(e);if(e&&"undefined"!==e){let n=t;if(200===(result=await unSecuredPostCall({apiResponseData:e,itemsPath:a},"external-api/process/response-data/")).status&&result.data){let r=[];Array.isArray(result.data)?r=[...result.data]:Object.keys(result.data).forEach(async e=>{r.push(result.data[e])}),r&&"undefined"!==r&&(document.querySelectorAll(`.${n[0]&&"undefined"!==n[0]?n[0].id:""}-placeholder`).forEach(e=>e.remove()),Object.keys(r).forEach(async e=>{var t,a;["externalApiMiddlewareId","totalRecords"].includes(e)||(t=r[e],a=!Array.isArray(t),processAndRenderJsonData(a,t,n,e,i))}))}}else r&&window.addEventListener("load",function(){n.click()})},loadDataGroupExternalAPI=async(e,t)=>{var a=t.attributes["json-data-path"],a=a&&a.value?a.value:"",r=t.attributes["data-load-event"],r=r?r.value:null,n=e.dataGroupChildren,i=createContentPlaceholder(1,n[0].id,n[0].className),l=(t.innerHTML="",document.createElement("div")),i=(l.classList.add("data-group-content"+elementAttribute(t,"id")),l.classList.add("row"),l.innerHTML=i,t.style.display="",t.appendChild(l),findComponentIndex(n,"pagination")),i=n[i],i=(i&&t.appendChild(i),findComponentIndex(n,"external-api-fallback")),n=n[i];n&&(n.setAttribute("onclick",r),t.appendChild(n)),e.replacedElement=l,e.originalDataGroup=t,e.numberOfPages=1,e.jsonDataPath=a,e.fallbackOnLoadEvent=r,e.dontRepeatFallbackEventElem=n,addExternalAPIDataGroupDataToDataMap(e,t),await loadDataGroupExternalAPIItems(e)},loadDataGroupFromExternalAPI=async r=>{let{dataGroup:e,externalApiId:t,dataGroupChildren:n}=r??"";var a={},i={};let l={},s={},o="",d="external-api";t&&(c=await publicGetCall(d+"/id/"+t))&&200===c.status&&(c=((l=c.data)??"").responseDataMapping,c=(c??"").selectedMapping,s=c);var{bodyDataFrom:c,uniqueKey:u,sendFormData:p}=l||"",c=c??"noDynamicData",u=u??"id",p=!!p,m=(e.innerHTML="",o=createContentPlaceholder(1,n[0].id,n[0].className),document.createElement("div")),g=(m.classList.add("data-group-content"+elementAttribute(e,"id")),m.classList.add("row"),m.innerHTML=o,e.style.display="",e.appendChild(m),findComponentIndex(n,"pagination")),g=n[g];g&&e.appendChild(g),r.replacedElement=m,r.originalDataGroup=e,r.numberOfPages=1,c&&"NON_PERSISTENT_COLLECTION"===c?(m=(g=window.location.pathname.split("/"))[g.length-1],m=(g=g[g.length-2])?m:uuidv4(16),a.externalApiItem={id:m,uuid:m,_data_source_rest_api_primary_id:m,nonPersistentCollectionItemId:m,pageCollectionName:g,uniqueKey:u||"id"}):({collectionItemId:m,collectionId:g}=await getPageItemData(),a.externalApiItem={...a.externalApiItem,collectionItemId:m,pageCollectionName:g,uniqueKey:u||"id",id:m,uuid:m,_data_source_rest_api_primary_id:m}),a.externalApiItem&&({nonPersistentCollectionItemId:g,collectionItemId:u,pageCollectionName:m}=a.externalApiItem,m=!!m,console.log("%c==> DataGroup from External API sendPageCollectionItem :>> ","color:lime",m),m)&&(!u||c&&"collectionItem"!==c||p?g&&"NON_PERSISTENT_COLLECTION"===c&&!p&&(d=d+"/"+g):d=d+"/"+u);let b={},f={};m=sessionStorage.getItem("previousActionResponse"),m&&(m=JSON.parse(m),0<Object.keys(m).length)&&(b=getFinalSessionValues(b,m,l,"current_session"),console.log("%c==> DataGroup from External API session value :>> ","color:yellow",b)),c=sessionStorage.getItem("previousActionFormData"),c&&(c=JSON.parse(c),0<Object.keys(c).length)&&(f=getFinalSessionValues(f,c,l,"form_data_session"),console.log("%c==> DataGroup from External API session form data :>> ","color:yellow",f)),p={data:a,externalApiId:t,sessionValue:b,sessionFormValue:f};if(console.log("\n URL: ",d),console.log("\n Body: ",p),g=await unSecuredPostCall(p,d),i.data={...g},i.externalApiResponse=g,i.data.externalApiResponse=g,i.status="success",r.externalApiResponse=g.data,r.numberOfPages=1,200===g.status&&g.data){let a=createDataGroupResponseDataArr(g);a&&"undefined"!==a&&(removeDataGroupPlaceholder(n),Object.keys(a).forEach(e=>{var t;["externalApiMiddlewareId","totalRecords"].includes(e)||(t=a[e],renderExternalApiDataForDataGroup(!Array.isArray(t),t,n,e,r.replacedElement,s))}))}},loadDataGroupFromBrowserSession=n=>{console.log("%c==> loadDataGroupFromBrowserSession paginationData :>> ","color:cyan",n);let{browserSessionDataPath:a,dataGroup:t,dataGroupChildren:i}=n??"";if(n.loadFromBrowserSession=!0,a){let e="";t.innerHTML="",e=createContentPlaceholder(1,i[0].id,i[0].className);var l=document.createElement("div"),r=(l.classList.add("data-group-content"+elementAttribute(t,"id")),l.classList.add("row"),l.innerHTML=e,t.style.display="",t.appendChild(l),findComponentIndex(i,"pagination")),r=i[r];r&&t.appendChild(r),n.replacedElement=l,n.originalDataGroup=t,n.numberOfPages=1;r=window.sessionStorage.getItem(SESSION_RESPONSE_KEY),l=r?JSON.parse(r):"";if(l&&"undefined"!==l){let t=getContentFromSessionObject(l,a),r=(console.log("%c==> loadDataGroupFromBrowserSession sessionContent :>> ","color:cyan",t),[]);t&&Array.isArray(t)?r=[...t]:t&&Object.keys(t).forEach(e=>{t[e]&&r.push(t[e])}),r&&"undefined"!==r&&(removeDataGroupPlaceholder(i),console.log("%c==> loadDataGroupFromBrowserSession sessionDataArr :>> ","color:cyan",r),Object.keys(r).forEach(e=>{var t=r[e],a=!Array.isArray(t);console.log("%c==> loadDataGroupFromBrowserSession processedApiResponseData key :>> ","color:cyan",e),console.log("%c==> loadDataGroupFromBrowserSession processedApiResponseData browserSessionData :>> ","color:cyan",t),console.log("%c==> loadDataGroupFromBrowserSession processedApiResponseData validTextBasedData :>> ","color:cyan",a),renderBrowserSessionDataForDataGroup(a,t,i,e,n.replacedElement)}))}}else toastr.error("Data Path is required!","Error");for(var[e,s]of dataTableStylesMap)selectorExists(`[id^="${e}"]`)||(e=`*[id^="${e}"] `+s,addStyle(e))};function createDataGroupResponseDataArr(t){let a=[];return console.log("*** create DataGroup response arr ~ result data is array:",Array.isArray(t.data)),Array.isArray(t.data)?a=[...t.data]:(console.log("*** create DataGroup response arr ~ result data has data:",t.data.hasOwnProperty("data")),t.data.hasOwnProperty("data")?Object.keys(t.data.data).forEach(e=>{t.data.data[e]&&a.push(t.data.data[e])}):Object.keys(t.data).forEach(e=>{t.data[e]&&a.push(t.data[e])})),a}function removeDataGroupPlaceholder(e){document.querySelectorAll(`.${e[0]&&"undefined"!==e[0]?e[0].id:""}-placeholder`).forEach(e=>e.remove())}function renderExternalApiDataForBrowserStorage(e,t,a,r,n,i,l){var l=l.dataset,s=Object.assign({},l);if(s&&t){let e;switch(console.log(s,t),s.browserstorage){case"LOCAL_STORAGE":e=localStorage;break;case"SESSION_STORAGE":e=sessionStorage;break;case"COOKIES":return void(document.cookie=s.storageKey+"="+JSON.stringify(t));default:return void console.error("Invalid storage type")}e.setItem(s.storagekey,JSON.stringify(t))}}function renderExternalApiDataForDataGroup(e,c,a,u,p,m){e&&c&&"object"==typeof c&&Object.keys(a).forEach(e=>{var t=a[e],l=elementAttribute(t,"data-gjs");if(!["pagination","search-form","data-group-map","external-api-fallback"].includes(l)){var l=t.cloneNode(!0),s=elementAttribute(l,"id");s&&l.setAttribute("id",s+"-"+e+u+"-"+uuidv4()),applyUserDefinedStyles(t,l,stylesMap);let a="data-text-content",r="data-href-content";let n="data-img-src";var o,d;let i="data-url-field";0<t.children.length&&(s=l.children,updateChildrenIds(s,l,stylesMap),e=l.querySelectorAll(`[${a}]`),t=l.querySelectorAll(`[${r}]`),s=l.querySelectorAll("[data-path-collection-item-id-from]"),o=l.querySelectorAll(`[${n}][data-field-type='file']`),d=l.querySelectorAll(`[${i}]`),e.forEach(e=>{var t=elementAttribute(e,a),t=extractNameFromExternalApiResponseMapping(m,t),t=_.get(c,t)||"";e.innerHTML=t}),d.forEach(e=>{var t=elementAttribute(e,i),t=extractNameFromExternalApiResponseMapping(m,t),t=_.get(c,t)||"";e.href=t}),t.forEach(e=>{var t=elementAttribute(e,r),t=extractNameFromExternalApiResponseMapping(m,t),t=_.get(c,t)||"";e.href=t}),s.forEach(e=>{var t=elementAttribute(e,"data-path-field-name"),t=extractNameFromExternalApiResponseMapping(m,t);let a=_.get(c,t)||"";a||"uuid"!==t||(r=extractNameFromExternalApiResponseMapping(m,"_data_source_rest_api_primary_id"),a=_.get(c,r)||"");var r=e.href.replace(t,a);e.href=r}),o.forEach(e=>{var t=elementAttribute(e,n),t=extractNameFromExternalApiResponseMapping(m,t),t=_.get(c,t)||"";e.src=t})),p.appendChild(l)}})}function renderBrowserSessionDataForDataGroup(e,n,i,l,s){e&&n&&"object"==typeof n&&Object.keys(i).forEach(async e=>{var t,a=i[e],r=elementAttribute(a,"data-gjs");["pagination","search-form","data-group-map"].includes(r)||(r=a.cloneNode(!0),(t=elementAttribute(r,"id"))&&r.setAttribute("id",t+"-"+e+l+"-"+uuidv4()),applyUserDefinedStyles(a,r,stylesMap),0<a.children.length&&(t=r.children,updateChildrenIds(t,r,stylesMap),r.querySelectorAll(`[${SESSION_RESPONSE_ATTR_KEY}]`).forEach(e=>{var t=elementAttribute(e,SESSION_RESPONSE_ATTR_KEY),t=(console.log("%c==> TEXT fieldName :>> ","color:yellow",l+" -> "+t),_.get(n,t)||"");e.innerHTML=t})),s.appendChild(r))})}function extractNameFromExternalApiResponseMapping(e,t){return t=e&&e.hasOwnProperty(t)?e[t]??t:t}async function loadBrowserStorageSetter(e,t,a){var r,n,i,{numberPerPage:l,filteredItemsUrl:s,dataGroupChildren:o,replacedElement:d,currentPage:c,searchString:u,originalDataGroup:p,itemIds:m,fieldName:g,collectionName:b,externalQueryParamKeys:f,finderId:h}=e;let v=await searchQueryStringFromUrl(),y=s,A="";g||(g=(c-1)*l,A=g,y=s+`?offset=${g}&limit=`+l,s=((c=getDataRangeQuery(e,"dataGroup",u))&&(y+="&"+c),void 0!==u&&""!==u?y=y+"&"+u:v&&(v.startsWith("?")&&(v=v.replace("?","&")),y+=v),await getItemDataForElement(p)).itemData,y=prepareItemDataAndExternalQueryParam(f,y,s,p)),y=await addEntityQueryToUrl(y,b,h),elementSelector(p,"[data-gjs=date-range-filter]")&&(d.innerHTML=""),await renderBrowserStorageSetterItem(b,y,o,d,p,m,A,stylesMap,t,a),$(".child-data-group-file[data-field-type=image]").each(function(){let e=this;var t=e.tagName;(e="IMG"!==t?elementSelector(this,"img"):e)&&e.hasAttribute("data-enable-popup")&&!!e.closest("A")&&$(this).magnificPopup({delegate:"a",type:"image",gallery:{enabled:!0}})});for([r,n]of stylesMap)selectorExists(`[id^="${r}"]`)||(i=`*[id^="${r}"] `+n,addStyle(i))}async function loadGroupData(e,t){var a,r,n,{numberPerPage:i,numberOfPages:l,filteredItemsUrl:s,dataGroupChildren:o,replacedElement:d,currentPage:c,searchString:u,originalDataGroup:p,itemIds:m,fieldName:g,collectionName:b,externalQueryParamKeys:f,finderId:h}=e;addPaginationDataToDataMap(e,p);let v=await searchQueryStringFromUrl(),y=s,A="";g||(g=(c-1)*i,A=g,y=s+`?offset=${g}&limit=`+i,g=((s=getDataRangeQuery(e,"dataGroup",u))&&(y+="&"+s),void 0!==u&&""!==u?y=y+"&"+u:v&&(v.startsWith("?")&&(v=v.replace("?","&")),y+=v),await getItemDataForElement(p)).itemData,y=prepareItemDataAndExternalQueryParam(f,y,g,p)),y=await addEntityQueryToUrl(y,b,h),elementSelector(p,"[data-gjs=date-range-filter]")&&(d.innerHTML=""),await renderDataGroupItem(b,y,o,d,p,m,A,stylesMap,t),validatePaginationButton(l,c,p),$(".child-data-group-file[data-field-type=image]").each(function(){let e=this;var t=e.tagName;(e="IMG"!==t?elementSelector(this,"img"):e)&&e.hasAttribute("data-enable-popup")&&!!e.closest("A")&&$(this).magnificPopup({delegate:"a",type:"image",gallery:{enabled:!0}})});for([a,r]of stylesMap)selectorExists(`[id^="${a}"]`)||(n=`*[id^="${a}"] `+r,addStyle(n))}let addPaginationDataToDataMap=async(e,t)=>{paginationDataMap.set("pdata_"+t.id,e)},addExternalAPIDataGroupDataToDataMap=async(e,t)=>{externalAPIDataGroupDataMap.set("apiDgData_"+t.id,e)},renderBrowserStorageSetterItem=async(e,t,a,r,n,i,l=0,s,o,d)=>{let c=[];if(console.log("browser storage",d.browserstorage),t)if(0<(c=i?Array.isArray(i)?i:0<Object.keys(i).length?[i]:[]:(await securedGetCall(t)).data).length){console.log("items data in collection is stored in browser storage ");let e;switch(d.browserstorage){case"LOCAL_STORAGE":e=localStorage;break;case"SESSION_STORAGE":e=sessionStorage;break;case"COOKIES":return void(document.cookie=d.storagekey+"="+JSON.stringify(c));default:return void console.error("Invalid storage type")}e.setItem(d.storagekey,JSON.stringify(c))}else r.innerHTML=o?"<div class='col-md-12 text-center'>This data is private hence cannot be displayed</div>":"<div class='col-md-12 text-center'></div>"},renderDataGroupItem=async(e,t,a,r,n,i,l="",s,o)=>{let d=[];t&&(0<(d=i?Array.isArray(i)?i:0<Object.keys(i).length?[i]:[]:(await securedGetCall(t)).data).length?(renderMapData(d,n),await renderData(e,d,a,r,l,s)):r.innerHTML=o?"<div class='col-md-12 text-center'>This data is private hence cannot be displayed</div>":"<div class='col-md-12 text-center'></div>")},elementSelector=(e,t)=>e.querySelector(t),validatePaginationButton=(e,t,a)=>{var r=elementSelector(a,".loadMore"),n=elementSelector(a,".next"),i=elementSelector(a,".previous"),l=elementSelector(a,".first"),a=elementSelector(a,".last");r&&(r.disabled=t===e),n&&(n.disabled=t===e),i&&(i.disabled=1===t),l&&(l.disabled=1===t),a&&(a.disabled=t===e)},renderMapData=(l,s)=>{Object.keys(s.children).forEach(e=>{var t,a,r,n,i,e=s.children[e];"data-group-map"===elementAttribute(e,"data-gjs")&&(t=elementAttribute(e,"data-group-map-lat"),a=elementAttribute(e,"data-group-map-long"),r=elementAttribute(e,"data-group-map-header"),n=elementAttribute(e,"data-group-map-description"),i=e.id,e.innerHTML=`<div id="map-${i}" class="map"></div> <style>.map{
      height:100%;width:100%;
       }</style>`,e=new google.maps.Map(document.getElementById("map-"+i),{zoom:15,center:new google.maps.LatLng(Number(l[0][t]),Number(l[0][a]))}),0<l.length)&&addMarkerInfo(l,e,t,a,r,n)})},renderData=async(a,e,t,r,n="",i)=>{let l=t;t=t[0]&&"undefined"!==t[0]?t[0].id:"";document.querySelectorAll(`.${t}-placeholder`).forEach(e=>e.remove());let{constants:s,environments:o}=await getProjectDetail(),d=(await getCollectionDetails(a)).constants;return e.forEach((e,t)=>{replaceContentOfItem(a,e,l,r,t,n,i,s,o,d)})},addMarkerInfo=(e,n,i,l,s,o)=>{let d=[];e.map(e=>{let t=new google.maps.Marker({position:new google.maps.LatLng({lat:Number(e[i]),lng:Number(e[l])}),map:n}),a="<div>",r=(e[s]&&(a+=`<h6>${e[s]}</h6>`),e[o]&&(a+=`<p>${e[o]}</p>`),a+="</div>",new google.maps.InfoWindow({content:a}));t.addListener("click",function(){clearInfoClickReference(d),r.open(t.get("map"),t),d[0]=r})})},replaceContentOfItem=(I,P,t,N,x="",w="",L,F,O,_)=>{Object.keys(t).forEach(async l=>{new Promise(function(e,t){e(l)});let s=t[l].cloneNode(!0);var e=s.querySelectorAll("[data-vis-condition]");if(e&&e.length){console.log("ðŸš€ ~ file: dataLoader.js:1585 ~ Process Component Visibility...");let t={itemData:{...P}};e.forEach(e=>{processComponentVisibilityCondition(e,t)})}e=elementAttribute(s,"data-gjs");if(!["pagination","search-form","data-group-map","date-range-filter"].includes(e)){var e=s.cloneNode(!0),o=elementAttribute(e,"id");o&&(x||w)&&(x&&e.setAttribute("id",o+"-"+l+x+"-"+uuidv4()),w)&&(o=elementAttribute(e,"id"),e.setAttribute("id",o+"-"+w)),applyUserDefinedStyles(s,e,L);let{itemData:a,collectionId:t,collectionItemId:r}=await getPageItemData(),n="data-"+t,i="data-url-"+t;var d,c,u,p,m,g,b,f,h,v,y,A,S,E,T,C,D;0<s.children.length?(o=e.children,updateChildrenIds(o,e,L),o=e.querySelectorAll("[data-text-content]"),d=e.querySelectorAll("[data-img-src]"),c=e.querySelectorAll("[data-path-collection-name]"),u=e.querySelectorAll('[data-gjs="marketplace-form"]'),p=e.querySelectorAll('[data-gjs="child-data-list"]'),m=e.querySelectorAll("[data-progress-value]"),g=e.querySelectorAll("a, button"),b=e.querySelectorAll("[data-href-content]"),f=e.querySelectorAll("form"),h=e.querySelectorAll("[data-ref-field]"),v=e.querySelectorAll(`[${n}], [data-filter-id]`),y=e.querySelectorAll(`[${i}]`),A=e.querySelectorAll('[data-text-content][data-field-type="file"][data-href-content]'),S=e.querySelectorAll("[data-file-field]"),E=e.querySelectorAll("[data-url-field]"),T=e.querySelectorAll('[data-js="drapcode-icons"]'),C=e.querySelectorAll("img"),D=e.querySelectorAll("[data-pdf-viewer-component]"),h.forEach(e=>{replaceInnerGroup(I,P,e,L,F,O,_)}),S.forEach(e=>{replaceInnerGroupFile(I,P,e,L,F,O,_)}),d.forEach(e=>{e.closest("[data-ref-field]")||renderImageFromDB(P,e,L)}),p.forEach(e=>{replaceContentOfStaticDynamic(P,e,L)}),Object.values(o).map(e=>{e.closest("[data-ref-field]")||replaceContentOfTextContent(P,e,L,F,O,_)}),m.forEach(e=>{replaceContentOfProgressBarFromDatagroup(P,e)}),c.forEach(e=>{e.closest("[data-ref-field]")||replaceHrefOfHyperLinks(P,e)}),g.forEach(e=>{e.closest("[data-ref-field]")||addItemUuidIntoButtonAndLink(I,P,e)}),b.forEach(e=>{e.closest("[data-ref-field]")||replaceContentOfFieldURL(P,e)}),f.forEach(e=>{e.closest("[data-ref-field]")||replaceContentOfFormElements(P,e)}),u.forEach(e=>{addValueToMarketplaceCheck(I,P,e)}),v.forEach(e=>{getTextContentFieldValue(e,n,a)}),y.forEach(e=>{var t=elementAttribute(e,i),t=elementAttribute(e,i).replace(t,a[t]);e.setAttribute("href",t)}),A.forEach(e=>{e.closest("[data-ref-field]")||replaceContentOfFileLinkElements(P,e)}),E.forEach(e=>{s.closest("[data-ref-field]")||replaceCollectionFieldLink(e,P)}),D.forEach(e=>{var t=e.getAttribute("data-pdf-viewer-field"),t=t?parseValueFromData(P,t):"";renderPdfViewerElements(e,t,P?.uuid)}),[...T,...C].forEach(e=>{e.setAttribute("data-item-id",P.uuid),e.setAttribute("data-collection-id",I),e.setAttribute("data-item",JSON.stringify(P))}),f.forEach(e=>{P&&e.setAttribute("data-item",JSON.stringify(P)),r&&e.setAttribute("data-item-id",r),t&&e.setAttribute("data-collection-id",t)})):(replaceContentOfTextContent(P,e,L,F,O,_),renderImageFromDB(P,e,L),replaceHrefOfHyperLinks(P,e),replaceContentOfFieldURL(P,e),replaceContentOfFormElements(P,e)),N.appendChild(e),addDynamicDataIntoFormElements(null,!1,N)}})},getTextContentFieldValue=(e,t,a)=>{const r=elementAttribute(e,t);var t=e.getAttribute("type");r&&(r.includes('"')&&"functionType"in JSON.parse(r)?e.innerHTML=getDerivedFieldData(r,a):(["reference","multi_reference","belongsTo"].includes(t)&&(t=JSON.parse(e.getAttribute("metaData")).nestedFieldName,r.includes(".")||(r=r+"."+t)),t=elementAttribute(e,"data-field-type"),!!(a=parseValueFromData(a,r)||"")&&htmlRegex.test(a)?e.innerHTML=a:e.textContent="boolean"===t?a?"Yes":"No":"number"===t?a||0:a)),e.style.display="block"},replaceContentOfArrayItem=(e,n,i,l,s="",o="",d,t,a,r)=>{Object.keys(i).forEach(async e=>{var t,a=i[e],r=elementAttribute(a,"data-gjs");["pagination","search-form","data-group-map"].includes(r)||(r=a.cloneNode(!0),(t=elementAttribute(r,"id"))&&(s||o)&&(s&&r.setAttribute("id",t+"-"+e+s+"-"+uuidv4()),o)&&(t=elementAttribute(r,"id"),r.setAttribute("id",t+"-"+o)),applyUserDefinedStyles(a,r,d),renderImageFromItem(n,r,l,d),renderFileFromItem(n,r,l,d),l.appendChild(r))})},clearInfoClickReference=e=>{e.map(e=>{e.set("marker",null),e.close()})},applyUserDefinedStyles=(e,t,a)=>{var r=elementAttribute(e,"id"),n="#"+r,i=(elementAttribute(t,"id"),Array.from(document.styleSheets).filter(e=>!e.href||e.href.startsWith(window.location.origin)));for(let e=0;e<i.length;e++){var l=i[e].cssRules||i[e].rules;for(let e=0;e<l.length;e++){var s=l[e];if(s)if(s.selectorText===n){let t="";for(let e=0;e<s.style.length;e++)t+=`${s.style[e]}: ${s.style[s.style[e]]} !important;`;a.set(r,`{ ${t} }`)}}}},updateChildrenIds=(e,t,a)=>{var r;e[0].hasAttribute("id")&&(r=e[0].getAttribute("id"),applyUserDefinedStyles(e[0],t,a),e[0].setAttribute("id",r+"-"+uuidv4())),e[0].childNodes.forEach(e=>{e.attributes&&e.hasAttribute("id")&&updateInnerChildIds(e,t,a)})},replaceInnerGroup=(t,e,a,r,n,i,l)=>{let s=a.cloneNode(!0);a.innerHTML="";var o=elementAttribute(s,"data-ref-field"),e=(elementAttribute(s,"data-ref-collection"),o?parseValueFromData(e,o):[]);e&&Array.isArray(e)?e.forEach(e=>{renderItemOfReferenceField(t,e,s,a,r,n,i,l)}):renderItemOfReferenceField(t,e,s,a,r,n,i,l)},replaceInnerGroupFile=(r,e,n,i,l,s,o)=>{var t=n.cloneNode(!0),a=(n.innerHTML="",elementAttribute(t,"data-file-field")),e=a?parseValueFromData(e,a):[];if(e&&Array.isArray(e)){let a=t.children;e.forEach((e,t)=>{replaceContentOfArrayItem(r,e,a,n,"","",i,l,s,o)})}else{a=t.children;replaceContentOfArrayItem(r,e,a,n,"","",i,l,s,o)}},fetchFile=async(e,t,a,r,n,i=!1,l=!1)=>{try{var s,o,d,c,u,p,m,g={itemId:e,fileId:t,collectionName:a,collectionField:r},b=(l&&(g.isSignedUrl=l),validateCookieToken());if(b)return s=(await getHeaderForServerForPublicRequest(b)).headers,o=SERVER_URL+"file/fetch",d={headers:s},l||(d.responseType="blob"),c=await axios.post(o,g,d),extractCookieToken(c.headers),l?c:i?await c.data.arrayBuffer():(u=new Blob([c.data]),p=window.URL.createObjectURL(u),(m=document.createElement("a")).href=p,m.download=n,document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(p),document.body.removeChild(m),void(await fetchInstalledPluginByCode("FILE_ACTIVITY_TRACKER")&&fileActivityTracker(n,"Download",a,r)))}catch(e){console.error("Error downloading file:",e)}},renderImageFromDB=(a,r,e)=>{var n=elementAttribute(r,"data-img-src"),i=(elementAttribute(r,"data-field-type"),elementAttribute(r,"data-preview-icon"));if(n){let e=r.src,t=n?parseValueFromData(a,n):"";(t=Array.isArray(t)?t[0]:t)&&("object"==typeof t?(n=t.key,e=i?t[i]:t.isExternalUrl?t.url:!0===t.isPrivate?"https://drapcode-static.s3.amazonaws.com/img/placeholder-img.png":n?imageServerUrl()+n:e):"string"==typeof t&&t.startsWith("http")&&(e=t),r.src=e,!0===t.isPrivate&&addDownloadAttributeForPrivateFiles(r,t,a.uuid),i=r.closest("A"))&&!i.getAttribute("href")&&(!0===t.isPrivate?addDownloadAttributeForPrivateFiles(i,t,a.uuid):i.setAttribute("href",e),i.setAttribute("target","_blank"),i.setAttribute("title",t.originalName))}},renderImageFromItem=(t,a,r,e)=>{var n=a.tagName;let i=a;var l=elementAttribute(a,"data-preview-icon");let s=(i="IMG"!==n?elementSelector(a,"img"):i)?elementAttribute(i,"data-img-src"):"";if(s=s||(r?elementAttribute(r,"data-file-field"):""),i&&s){let e=i.src;(t=Array.isArray(t)?t[0]:t)&&("object"==typeof t?(n=t.key,e=l?t[l]:t.isExternalUrl?t.url:!0===t.isPrivate?"https://drapcode-static.s3.amazonaws.com/img/placeholder-img.png":n?imageServerUrl()+n:e):"string"==typeof t&&t.startsWith("http")&&(e=t),i.src=e,i.alt=t.originalName,!0===t.isPrivate&&addDownloadAttributeForPrivateFiles(i,t,t.uuid),!!(a=i.closest("A")))&&(a.getAttribute("href")||(!0===t.isPrivate?addDownloadAttributeForPrivateFiles(a,t,t.uuid):a.setAttribute("href",e)),a.setAttribute("target","_blank"),a.setAttribute("title",t.originalName),a.setAttribute("data-item-id",t.uuid),a.setAttribute("data-collection-id",t.collectionName),r=a.querySelector("DIV"),l=a.querySelector("p"),n=a.querySelector("h1, h2, h3, h4, h5, h6"),r&&(r.textContent=t.originalName),n&&(n.textContent=t.originalName),l)&&(l.textContent=t.originalName)}},renderFileFromItem=(t,a,r,e)=>{var n=a.tagName;let i=a,l=(i="A"!==n?elementSelector(a,"a"):i)?elementAttribute(i,"data-file-src"):"";if(l=l||(r?elementAttribute(r,"data-file-field"):""),i&&l){let e="";(t=Array.isArray(t)?t[0]:t)&&("object"==typeof t?(n=t.key,e=t.isExternalUrl?t.url:n?imageServerUrl()+n:e):"string"==typeof t&&t.startsWith("http")&&(e=t),e=e||"#",!!i.getAttribute("href")||(!0===t.isPrivate?addDownloadAttributeForPrivateFiles(i,t,t.uuid):i.setAttribute("href",e)),i.setAttribute("data-item-id",t.uuid),i.setAttribute("data-collection-id",t.collectionName),i.setAttribute("title",t.originalName),a=i.querySelector("DIV"),r=i.querySelector("p"),n=i.querySelector("h1, h2, h3, h4, h5, h6"),a&&(a.textContent=t.originalName),n&&(n.textContent=t.originalName),r)&&(r.textContent=t.originalName)}},replaceContentOfStaticDynamic=(e,t,a)=>{var r=elementAttribute(t,"data-option-field");return getColorBadges(t,r,e)},replaceContentOfTextContent=(t,n,a,r,e,i)=>{replaceTextContent?(o=n.cloneNode(!0),s=elementAttribute(n,"id"),n.setAttribute("id",s),applyUserDefinedStyles(o,n,a)):replaceTextContent=!0;let l=elementAttribute(n,"data-text-content");var s=elementAttribute(n,"data-field-type");if(l)if(l.includes('"')&&"functionType"in JSON.parse(l)){console.log("replaceContentOfTextContent 2");var o=getDerivedFieldData(l,t,r,e,i);/<\/?[a-z][\s\S]*>/i.test(o)?n.innerHTML=o:n.textContent=o}else{if(["reference","multi_reference","belongsTo"].includes(s)){let e=(JSON.parse(elementAttribute(n,"metaData"))||{}).nestedFieldName;e||(r=((a=t._$belongsToMetaData)?a.refCollection:{}).collectionField,e=r||void 0),l.includes(".")||(l=l+"."+e)}e=parseValueFromData(t,l);if(console.log("%c value replaceContentOfTextContent","color:yellow",e),["static_option","dynamic_option"].includes(s)){i=e&&!Array.isArray(e)?e.split(","):[];let a=[],r=n.cloneNode(!0);i.forEach(e=>{var t=r.cloneNode(!0);t.setAttribute("id",t.getAttribute("id")+"-"+e),t.textContent=e,a.push(t)}),n.innerHTML="",a.forEach(e=>{n.parentNode.insertBefore(e,n)}),n.classList.add("d-none")}else!(!e||"large_text"!==s)&&htmlRegex.test(e)?n.innerHTML=e:n.textContent="boolean"===s?e?"Yes":"No":"number"!==s||e?e:"0"}},replaceContentOfProgressBarContent=(e,t,a,r,n)=>{t=t.parentElement;var i,l=elementAttribute(t,"data-progress-now"),s=elementAttribute(t,"data-progress-min"),o=elementAttribute(t,"data-progress-max"),d=t.children[0];l&&e[l]&&(l.includes('"')&&"functionType"in JSON.parse(l)?(i=getDerivedFieldData(l,e,a,r,n),t.setAttribute("data-progress-now",i),d.setAttribute("aria-valuenow",i),d.style.nowWidth=i+"%"):(t.setAttribute("data-progress-now",e[l]),d.setAttribute("aria-valuenow",e[l]),d.style.width=e[l]+"%")),s&&e[s]&&(s.includes('"')&&"functionType"in JSON.parse(s)?(i=getDerivedFieldData(s,e,a,r,n),t.setAttribute("data-progress-min",i),d.setAttribute("aria-valuemin",i),d.style.minWidth=i+"%"):(t.setAttribute("data-progress-min",e[s]),d.setAttribute("aria-valuemin",e[s]),d.style.minWidth=e[s]+"%")),o&&e[o]&&(o.includes('"')&&"functionType"in JSON.parse(o)?(l=getDerivedFieldData(o,e,a,r,n),t.setAttribute("data-progress-max",l),d.setAttribute("aria-valuemax",l),d.style.maxWidth=l+"%"):(t.setAttribute("data-progress-max",e[o]),d.setAttribute("aria-valuemax",e[o]),d.style.maxWidth=e[o]+"%"))},replaceContentOfProgressBarFromDatagroup=(e,t)=>{var a=elementAttribute(t,"data-progress-value"),r=elementAttribute(t,"data-progress-total"),n=elementAttribute(t,"progress-total");let i,l="";e&&(i=a?e[a]:"",r?l=e[r]:n&&(l=n)),replaceContentOfProgressBar(t,i,l)},replaceHrefOfHyperLinks=async(a,r)=>{var n=elementAttribute(r,"data-path-field-name"),i=elementAttribute(r,"data-path-field-seo"),l=(elementAttribute(r,"id"),elementAttribute(r,"data-path-collection-item-id-from"));if(["pageCollection","session"].includes(l)&&("session"===l?(a="",(l=localStorage.getItem("user"))&&"undefined"!==l&&(a=parseLSJSONStrToJSON("user"))):(l=(await getPageItemData()).itemData,a=l)),n){var l=elementAttribute(r,"href");let e=n?parseValueFromData(a,n):"",t=(e=(e=e&&e.length?e.split(", "):"")[0],l.replace(n,e));i&&(l=i?parseValueFromData(a,i):"",l=slugify(l),t=t.replace(i,l)),r.setAttribute("href",t)}},addItemUuidIntoButtonAndLink=(e,t,a)=>{a.setAttribute("data-item-id",t.uuid),a.setAttribute("data-collection-id",e);e=window.document.getElementById("snipcart");void 0!==e&&null!=e&&a.classList.contains("snipcart-add-item")&&loadSnipcartItemData(a,t)},replaceContentOfFieldURL=(e,t)=>{var a,r,n,i=elementAttribute(t,"data-href-content"),l=(elementAttribute(t,"id"),elementAttribute(t,"data-field-type"));i&&"file"!==l&&(a=parseValueFromData(e,i),i=i.replace(i,a),!l&&a&&"object"==typeof a&&0<Object.keys(a).length&&!Array.isArray(a)?(n=l="",r=!!elementAttribute(t,"data-text-content"),l=imageServerUrl()+a.key,n=a.originalName,!0===a.isPrivate?addDownloadAttributeForPrivateFiles(t,a,e.uuid):t.href=l||"",r||(t.innerText=n||l)):!0===a.isPrivate?addDownloadAttributeForPrivateFiles(t,a,e.uuid):t.setAttribute("href",i))},replaceContentOfFormElements=(a,e)=>{e.querySelectorAll("[data-form-element-data-group]").forEach(e=>{var t=elementAttribute(e,"data-form-element-data-group"),t=parseValueFromData(a,t);insertFormElementValue(t,e)})},replaceCollectionFieldLink=(e,t)=>{var a=elementAttribute(e,"data-url-field"),t=parseValueFromData(t,a);e.href=t},addValueToMarketplaceCheck=(e,t,a)=>{var r=elementAttribute(a,"quantityfield"),n=elementAttribute(a,"pricefield"),i=elementAttribute(a,"namefield"),l=elementAttribute(a,"descriptionfield");a.elements["quantity-field"].value=r,a.elements["price-field"].value=n,a.elements.productId.value=t.uuid,a.elements.collectionName.value=e,a.elements["name-field"].value=i,a.elements["description-field"].value=l},updateInnerChildIds=(e,t,a)=>{var r;elementAttribute(e,"id")&&(r=elementAttribute(e,"id"),applyUserDefinedStyles(e,t,a),e.setAttribute("id",r+"-"+uuidv4())),e.childNodes.forEach(e=>{e.attributes&&e.hasAttribute("id")&&updateInnerChildIds(e,t,a)})},renderItemOfReferenceField=(e,t,a,r,n,i,l)=>{a=a.children;replaceContentOfItem(e,t,a,r,"","",stylesMap,n,i,l)},getDerivedFieldData=(e,t,a,r,n)=>{let i=JSON.parse(e);e=i.parentFieldName;let l="";return l=e?t[e]&&t[e].map(e=>prepareFunction(i,e,a,r,n)).join(", "):prepareFunction(i,t,a,r,n)},getArgsFromKey=(e,t,r,a,n,i,l,s)=>{let o="";if(e.includes("current_user.")){var d=e.split(".")[1];o=parseValueFromData(r,d)}else if(e.includes("current_user_reference_field.")){var[d,c]=e.replace("current_user_reference_field.","").split("."),r=r?.[d];o=r?r[0]?.[c]:""}else if(e.includes("createdBy.")){d=e.split(".")[1],r=t?.createdBy;o=r[0]?.[d]}else if(e.includes("environment_variable.")){c=document.getElementById("project-timezone");let t=c&&c.getAttribute("data-projectenv"),a=e.split("environment_variable.")[1];r=n.find(e=>e.envType===t).constants.find(e=>e.name===a);o=r?.value}else if(e.includes("RF::")){d=e.replace("RF::","");o=parseValueFromData(t,d)}else if(e.includes("PC::")){let t=e.split("PC::")[1];c=a.find(e=>e.name===t);o=c?.value}else if(e.includes("CC::")){let t=e.split("CC::")[1];n=i.find(e=>e.name===t);o=n?.value}else o=e.includes("current_session.")?(r=e.replace("current_session.",""),parseValueFromData(l,r)):e.includes("form_data_session.")?(t=e.replace("form_data_session.",""),parseValueFromData(s,t)):"";return o},prepareFunction=(e,r,n,i,l)=>{let s,o,d,c,u,p,m,g,b,f,h,v,y,A,S,E,T,C,D,I,P,N,x,w,L,F,O,U,$,B,G,H,V,j,J="",_=[],q=!1;let k=parseLSJSONStrToJSON("user"),R=sessionStorage.getItem("previousActionResponse"),M=(R=R?JSON.parse(R):{},sessionStorage.getItem("previousActionFormData"));M=M?JSON.parse(M):{},e.args.forEach(e=>{var{name:e,key:t}=e;"formatType"===e?s=t:"restToLower"===e?o=t:"whitespace"===e?d=t:"type"===e?u=t:"noSplitopt"===e?c=t:"length"===e?p=t:"endopt"===e?m=t:"startLength"===e?S=t:"endLength"===e?E=t:"startString"===e?g=t:"endString"===e?b=t:"separator"===e?f=t:"expression"===e?v=t:"unixType"===e?h=t:"currency"===e?y=t:"position"===e?L=t:"maxFraction"===e?A=t:"refField"===e?C=t:"condition"===e?T=t:"match"===e?D=t:"refFieldType"===e?I=t:"index"===e?P=t:"positionOfRecords"===e?N=t:"numberOfRecords"===e?x=t:"elementToRender"===e?w=t:"indexNum"===e?F=t:"tableRefernceFields"===e?V=t:"tableStyle"===e?O=t:"theadStyle"===e?U=t:"tbodyStyle"===e?$=t:"trStyle"===e?B=t:"tdStyle"===e?G=t:"thStyle"===e?H=t:"unitToAdd"===e?j=t:"unitTypeToAdd"===e&&(J=t);let a=[];["formatType","restToLower","whitespace","type","noSplitopt","length","endopt","startLength","endLength","startString","endString","separator","expression","unixType","currency","maxFraction","position","refField","condition","match","refFieldType","index","positionOfRecords","numberOfRecords","elementToRender","indexNum","tableStyle","theadStyle","tbodyStyle","trStyle","tdStyle","thStyle","tableRefernceFields","unitToAdd","unitTypeToAdd"].includes(e)||(Array.isArray(t)?(t.forEach(e=>{e=e.includes(".")?getArgsFromKey(e,r,k,n,i,l,R,M):r[e];a.push(e)}),_.push(a)):"CURRENT_DATE_TIME"===t?_.push(t):t.includes(".")?(e=getArgsFromKey(t,r,k,n,i,l,R,M),_.push(e)):(["updatedAt","createdAt"].includes(t)&&(q=!0),_.push(r[t])))});var t=+document.getElementById("project-timezone").innerText||0;switch(e.functionType){case"CAPITALIZE":return capitalize(_[0],o);case"LOWER_CASE":return lowerCase(_[0]);case"UPPER_CASE":return upperCase(_[0]);case"SLUGIFY":return slugify(_[0]);case"TRIM":return trim(_[0],d,u);case"TITLE_CASE":return titleCase(_[0],c);case"TRUNCATE":return truncate(_[0],p,m);case"SUB_STRING":return substr(_[0],S,E);case"STRING_JOIN":return strJoin(_[0],f,g,b);case"SPLIT_STRING":return splitString(_[0],f,P,F);case"CUSTOM_SENTENCE":return evaluateCustomSentence(v,r,k,n,i,l,R,M);case"ADDITION":return addition(s,{numbers:_[0]});case"AVERAGE":return average(s,{numbers:_[0]});case"MULTIPLY":return multiply(s,{numbers:_[0]});case"DIVIDE":return divide(s,{number1:_[0],number2:_[1]});case"CUSTOM_CALCULATION":return evaluateExpression(v,r,k,s,n,i,l,R,M);case"CUSTOM_JS_LOGIC":case"CUSTOM_JAVASCRIPT_LOGIC":return evaluateJSLogic(v,r,k,n,i,l,R,M);case"SUBSTRACTION":return substraction(s,{numbers1:_[0],numbers2:_[1]});case"COUNT":return count(_[0],T,C,D,I);case"PERCENTAGE":return percentage(_[0],T,C,D,I,s);case"FIND_RECORD":return findRecord(_[0],C,P);case"FORMAT_DATE":return formatDate(s.replace(/#SPACE#/g," "),_[0],t,h,q);case"DATE_DIFFERENCE":return dateDifference(s,_[0],_[1],t);case"DATE_ADD":return dateAdd(_[0],j,J,s);case"CURRENCY_FORMAT":return evaluateCurrency(s,_[0],y,L,A);case"BEAUTIFY_LIST":return beautifyList(_[0],N,x,w);case"MARKDOWN_TO_HTML":return markdownToHtml(_[0]);case"TABLE_FORMAT":return formatDataOnTable(_[0],O,U,$,B,G,H,V);default:return""}};async function searchInDataGroup(e,t=!1){let a="";void 0!==e.event&&({target:i,submitter:n}=e.event,a=n?n.value:"",e.searchString=convertQueryStringFromFormElements(i,e));var r,{searchString:n,finderId:i,collectionName:l,externalQueryParamKeys:s,originalDataGroup:o}=e,d=(await getPageItemData()).itemData;a&&"export"===a?(r=`collection-table/${l}/finder/${i}/export-data?`+n,r=await addEntityQueryToUrl(r,l,i),r=prepareItemDataAndExternalQueryParam(s,r,d,o),t||await downloadFile(r)):t||(r=`collection-table/${l}/finder/${i}/items/count?`+n,r=prepareItemDataAndExternalQueryParam(s,r,d,o),r=await addEntityQueryToUrl(r,l,i),s=(t=await securedGetCall(r))?t._$isPrivateFilter:null,d=(e.numberOfPages=getNumberOfPages(t.data,e.numberPerPage),e.currentPage=1,e.replacedElement.innerHTML="",e.finderId=i,loadGroupData(e,s),e||"").event,o=(d||"").target,o&&o.hasAttribute("data-enableSearchHistory")&&sendDataToSearchHistory(l,n))}let sendDataToSearchHistory=async(e,t)=>{e={name:e,query:queryStringToJson(t)};isLoggedInUser()&&(t=fetchLoggedInUserJson(),e.createdBy=t.uuid),await unSecuredPostCall(e,"open/collection-form/search_history/items")},queryStringToJson=e=>{e=e.split("&");let a={};return e.forEach(e=>{var[e,t]=e.split("=");a[e]=decodeURIComponent(t)}),a},convertQueryStringFromFormElements=(e,t=null)=>{let{responseDataMapping:r,bodyDataFrom:a}=t||{},n=!!a&&"NON_PERSISTENT_COLLECTION"===a,i=DATA_SOURCE_DEFAULT;t=e?e.dataset:"";return t&&t.hasOwnProperty("datasource")&&(i=t.datasource),Object.values(e).map(t=>{if(t&&"select-multiple"===t.type){var a=t.selectedOptions;let e=Array.from(a).map(({value:e})=>e);return e=e.join(","),prepareQuerySearchString(t.name,e,i,n,r)}if(t&&t.name&&t.value)return prepareQuerySearchString(t.name,t.value,i,n,r)}).filter(Boolean).join("&")};function prepareQuerySearchString(e,t,a,r,n){let i=e;switch(r&&n&&(i=n.hasOwnProperty(e)?n[e]:e),a){case DATA_SOURCE_SUPABASE:return encodeURIComponent(i)+"=eq."+encodeURIComponent(t);case DATA_SOURCE_DIRECTUS:return`filter[${encodeURIComponent(i)}]`+"[_eq]="+encodeURIComponent(t);default:return encodeURIComponent(i)+"="+encodeURIComponent(t)}}function nextDataGroupPage(e){e.replacedElement.innerHTML="",e.currentPage+=1,loadGroupData(e)}function firstDataGroupPage(e){e.replacedElement.innerHTML="",e.currentPage=1,loadGroupData(e)}function lastDataGroupPage(e){e.replacedElement.innerHTML="",e.currentPage=e.numberOfPages,loadGroupData(e)}function previousDataGroupPage(e){e.replacedElement.innerHTML="",--e.currentPage,loadGroupData(e)}function loadMoreRecords(e){e.currentPage+=1,loadGroupData(e)}let prepareItemDataAndExternalQueryParam=(e,t,a,r)=>{let n="";var i=t.includes("?");return e&&0<e.length&&(i||(t+="?"),e.forEach(e=>{var t=r.getAttribute(e);t&&a?(t=a[t])&&(n+=`&${e}=`+t):console.log("I do not have page item param or param key :>> ",e)})),t=i?""+t+n:""+t+n.substr(1,n.length+1)},prepareItemDataAndExternalQueryParamForTable=(e,t,a,r)=>{var n=t.includes("?");let i="";return n||(t+="?"),e&&0<e.length&&e.forEach(e=>{var t=r.getAttribute(e);t&&a&&(t=parseValueFromData(a,t))&&(i+=`&${e}=`+t)}),t=n?""+t+i:""+t+i.substr(1,i.length+1)},isEntityInCondition=e=>{let t=!1;return e&&Array.isArray(e)?e.forEach(e=>{("string"==typeof e||e instanceof String)&&(t=e.startsWith("ENTITY::"))}):e&&("string"==typeof e||e instanceof String)&&(t=e.startsWith("ENTITY::")),t},getDerivedFieldJSON=(e,t)=>{var e=e.find(e=>e.name===t),a={args:e.args,functionType:e.functionType};let r=JSON.stringify({args:e.args,functionType:e.functionType}).split('"').join("'");return r="FORMAT_DATE"===e.functionType?JSON.stringify(a).split('"').join("'").replace(/ /g,"#SPACE#"):r},addEntityQueryToUrl=async(e,t,a)=>{var r=e.includes("?");let n="",{finders:i,utilities:l}=(r||(e+="?"),await getCollectionDetails(t));return i.find(e=>e.uuid===a)?.conditions.forEach(e=>{var t,a;isEntityInCondition(e?.query?.value)&&(t=e.query.value.replace("ENTITY::",""),e="entity_"+e.query?.customEntityKey,e=parseLSJSONStrToJSON(e),a=t.startsWith("DF::")?getDerivedFieldJSON(l,t.replace("DF::","")):t,e=parseValueFromData(e,a),n+=e?`&${t}=`+e:"")}),e=r?""+e+n:""+e+n.substr(1,n.length+1),console.log("\n endpoint In :>> ",e),e},addDataGroupMarkerInfo=(e,n,i,l,s,o)=>{let d=[];e.map(e=>{let t=new google.maps.Marker({position:new google.maps.LatLng({lat:Number(e[i]),lng:Number(e[l])}),map:n}),a="<div>",r=(e[s]&&(a+=`<h6>${e[s]}</h6>`),e[o]&&(a+=`<p>${e[o]}</p>`),a+="</div>",new google.maps.InfoWindow({content:a}));t.addListener("click",function(){clearInfoClickReference(d),r.open(t.get("map"),t),d[0]=r})})};async function searchInDataTable(a,e="",t=!1){let r="";if(void 0!==a.event){let{target:e,submitter:t}=a.event;r=t?t.value:"",a.searchString=convertQueryStringFromFormElements(e,a)}void 0!==a.searchString&&a.searchString&&e?(e.startsWith("?")&&(e=e.replace("?","&")),a.searchString=a.searchString+"&"+a.searchString+e):void 0===a.searchString&&e&&(e.startsWith("?")&&(e=e.replace("?","")),a.searchString=e);var{dataTable:e,searchString:n,finderId:i,collectionName:l,tbodyElement:s,externalQueryParamKeys:o}=a,d=(await getItemDataForElement(e)).itemData;if(r&&"export"===r){var c=`collection-table/${l}/finder/${i}/export-data?`+n,c=await addEntityQueryToUrl(c,l,i);c=prepareItemDataAndExternalQueryParamForTable(o,c,d,e),t?(u={},p=a.isPaginated,await loadExternalApiResponseDataList(a,u,p||!1,!0)):await downloadFile(c)}else if(t){var u={};await loadExternalApiResponseDataList(a,u,!1)}else{var p=e.querySelector("thead").rows[0].cells.length;if(validateDataTableProps(i,l,p,s)){c=`collection-table/${l}/finder/${i}/items/count?`+n,c=prepareItemDataAndExternalQueryParamForTable(o,c,d,e),t=(c=await addEntityQueryToUrl(c,l,i),await securedGetCall(c)),u=t?t._$isPrivateFilter:null;if(t&&0<t.data)a.numberOfPages=getNumberOfPages(t.data,a.numberPerPage),a.currentPage=1,a.finderId=i,loadDataList(a);else{if(u)return s.innerHTML=`<tr><td  class="text-center" colspan="${p}">This data is private hence cannot be displayed</td></tr>`,void validatePaginationButton(1,1,e);s.innerHTML=`<tr><td  class="text-center" colspan="${p}"></td></tr>`,validatePaginationButton(1,1,e)}}else validatePaginationButton(1,1,e)}o=(a||"").event;let m=(o||"").target;m&&m.hasAttribute("data-enableSearchHistory")&&sendDataToSearchHistory(l,n)}let autoSearchInDataSearch=(e,l)=>{if(e){let r=l.querySelector('[type=submit]:not([value="export"]');r||((e=document.createElement("button")).role="button",e.type="submit",e.style.cssText+="height:1px !important;width: 1px !important;overflow: hidden !important;padding: 0 !important;position: absolute !important;border: 0 !important",l.appendChild(e),r=e);let n=["INPUT","SELECT","DIV"],i=[16,17,18,33,34,35,36,37,38,39,40,224,229];r&&(e=[],loadElementChildList(l,e),e)&&0<e.length&&e.forEach(t=>{var e=t.tagName,a=t.id;n.includes(e)&&("INPUT"===e&&(findModalParent(l)&&(checkForDateType("[id^=modal-container]"),checkForDateType("[data-subpage-id]")),t.hasAttribute("flat-picker-date-type")?t.addEventListener("change",function(e){e.preventDefault(),r&&r.click(),t.blur()}):t.addEventListener("keyup",function(e){e.preventDefault(),e.isComposing||i.includes(e.keyCode)||r&&r.click()})),"SELECT"===e&&a&&$("#"+a).on("select2:select",function(e){e.preventDefault(),r&&r.click()}),"DIV"===e)&&t.querySelector("[class*=iti--allow-dropdown] input[type=tel]")&&t.addEventListener("keyup",function(e){e.preventDefault(),e.isComposing||i.includes(e.keyCode)||r&&r.click()})})}},validateDataTableProps=(e,t,a,r,n)=>{let i=!0;return t||(n.innerHTML=`<tr><td  class="text-center" colspan="${r}"> Please select a valid collection</td></tr>`,i=!1),i};async function loadDataList(e,t=!1){var{numberPerPage:a,filteredItemsUrl:r,fieldName:n,searchString:i,externalQueryParamKeys:l,dataTable:s,persistentPagination:o}=e;let d=e.currentPage,c=r,u=await searchQueryStringFromUrl();n||(r=(await getItemDataForElement(s)).itemData,t=((d=t&&o&&(n=o.sessionCurrentPage,n)?n:d)-1)*a,c=c+`?offset=${t}&limit=`+a,(o=getDataRangeQuery(e,"dataTable",i))&&(c+="&"+o),c=prepareItemDataAndExternalQueryParamForTable(l,c,r,s),""!==i&&void 0!==i?c+="&"+i:u&&(u.startsWith("?")&&(u=u.replace("?","&")),c+=u));try{await renderDataTable(c,e)}catch(e){console.error("*** loadDataList ~ renderDataTable error:",e)}validatePaginationButton(e.numberOfPages,d,e.dataTable),validateNumberPaginationNav(e),showPaginationNumbersByCurrentPage(e)}function processComponentVisibilityCondition(e,t){var a=(t||"").itemData,r=parseVisibilityCondition(e),t=r.visThenCondition,n=r.visWhenUserStatus,i=r.visWhenCollectionFrom,l=r.visWhenCollection,s=r.visThenAddClass,o=r.visThenRemoveClass;let d=!0;var c=[];if(n)switch(n){case"LOGGED_IN":isLoggedInUser()?c.push(!0):c.push(!1);break;case"NOT_LOGGED_IN":isLoggedInUser()?c.push(!1):c.push(!0)}if(i&&l){var n=!!e.closest("[data-snippet-id]"),u=!!e.closest("[data-subpage-id]"),p=!!findModalParent(e),m=n||u||p;switch(i){case"PARENT_CMS_COMPONENT":processComponentVisibilityConditionExp(r,c,a);break;case"SNIPPET_COLLECTION":m&&processComponentVisibilityConditionExp(r,c,a);break;case"CURRENT_LOGGEDIN_USER":processComponentVisibilityConditionExp(r,c,fetchLoggedInUserJson());break;case"CURRENT_LOGGEDIN_TENANT":processComponentVisibilityConditionExp(r,c,fetchCurrentTenantJson());break;case"CURRENT_LOGGEDIN_USER_SETTINGS":processComponentVisibilityConditionExp(r,c,fetchCurrentUserSettingsJson());break;case"BROWSER_STORAGE":"BROWSER_STORAGE"===l&&processComponentVisibilityConditionExp(r,c,a)}}!(d=!c||!c.length||c.includes(!1)?!1:d)&&"SHOW"!==t||renderComponentVisibility(t,e,d,s,o),e.removeAttribute("data-vis-condition")}let processComponentVisibilityConditionExp=(e,t,a)=>{e.visWhenCollection;var r=e.visWhenCollectionField,n=e.visWhenCollectionFieldType,i=e.visWhenCondition,l=e.visWhenCollectionFieldValue,s=e.visWhenCollectionFieldFixedValue,o=e.visWhenCollectionFrom,d=e.visWhenBsl,c=e.visWhenBslKey,e=e.visWhenBslFixedValue;i&&a&&Object.keys(a).length&&processVisWhenConditionForItem(a,{visWhenCondition:i,visWhenCollectionField:r,visWhenCollectionFieldFixedValue:s,visWhenCollectionFieldValue:l,visWhenCollectionFieldType:n,visWhenCollectionFrom:o,visWhenBsl:d,visWhenBslKey:c,visWhenBslFixedValue:e},t)};function getReferenceFieldValue(e,t){t=t.split(".");if(1<t.length){var a=t[0],t=t[1];if(Array.isArray(e[a]))return 0<e[a].length?e[a][0][t]:null;if("object"==typeof e[a]&&null!==e[a])return e[a][t]}return null}function processVisWhenConditionForItem(e,t,a){var{visWhenCondition:t,visWhenCollectionField:r,visWhenCollectionFieldFixedValue:n,visWhenCollectionFieldValue:i,visWhenCollectionFieldType:l,visWhenCollectionFrom:s,visWhenBslKey:o,visWhenBslFixedValue:d}=t||{};let c=!1;var u=l&&["static_option","dynamic_option"].includes(l),p=l&&"number"===l,m=l&&"boolean"===l,g="BROWSER_STORAGE"===s?_.get(e,o):r&&r.includes(".")?getReferenceFieldValue(e,r):_.get(e,r);let b="";switch(b="number"===l?Number(n||i||0):"BROWSER_STORAGE"===s?d||"":n||i||"",t){case"EQUALS":c=u&&g&&Array.isArray(g)?g.includes(b):g&&g===b,c=Boolean(c);break;case"NOT_EQUALS":c=u&&g&&Array.isArray(g)?!g.includes(b):g&&g!==b,c=Boolean(c);break;case"IN_LIST":u&&g&&Array.isArray(g)&&(c=g.includes(b)),c=Boolean(c);break;case"NOT_IN_LIST":u&&g&&Array.isArray(g)&&(c=!g.includes(b)),c=Boolean(c);break;case"IS_NULL":c=Array.isArray(g)?0===g.length:void 0===g||_.isNull(g)||_.isEmpty(g),c=Boolean(c);break;case"IS_NOT_NULL":c=Array.isArray(g)?0<g.length:!(void 0===g||_.isNull(g)||_.isEmpty(g)),c=Boolean(c);break;case"IS_BOOLEAN_FALSE":c=m&&(void 0===g||_.isNull(g)||_.isEmpty(g))&&falsyValues.includes(g),c=Boolean(c);break;case"IS_BOOLEAN_TRUE":c=m&&truthyValues.includes(g),c=Boolean(c);break;case"LESS_THAN":c=!u&&p&&g&&g<b,c=Boolean(c);break;case"GREATER_THAN":c=!u&&p&&g&&g>b,c=Boolean(c);break;case"LESS_THAN_EQUALS_TO":c=!u&&p&&g&&g<=b,c=Boolean(c);break;case"GREATER_THAN_EQUALS_TO":c=!u&&p&&g&&g>=b,c=Boolean(c)}a.push(c)}function renderComponentVisibility(e,t,a,r,n){switch(e){case"SHOW":var i;a?(t.classList.remove("d-none"),t.classList.remove("hide"),t.classList.remove("hidden"),(i=t.style.display)&&!["none","none !important"].includes(i)?t.style.display=i:t.style.setProperty("display","inline-block","important"),t.style.visibility="visible"):(t.setAttribute("data-vis-removed",!0),t.remove()),handleClassChanges(t,r,n);break;case"HIDE":case"DONT_SHOW":handleClassChanges(t,r,n),t.setAttribute("data-vis-removed",!0),t.remove();break;case"DISABLED":case"SHOW_DISABLED":t.classList.add("disabled"),t.setAttribute("disabled",!0),handleClassChanges(t,r,n);break;case"READ_ONLY":case"SHOW_READ_ONLY":t.setAttribute("readonly",!0),handleClassChanges(t,r,n);break;default:handleClassChanges(t,r,n)}}function parseVisibilityCondition(e){let t=e.getAttribute("data-vis-condition");return(t=t?t.replaceAll("'",'"'):"")?JSON.parse(t):""}function handleClassChanges(t,e,a){e&&(e=e.split(",").map(e=>e.trim()).filter(Boolean),t.classList.add(...e)),a&&a.split(",").map(e=>e.trim()).filter(Boolean).forEach(e=>{t.classList.contains(e)&&t.classList.remove(e)})}let renderDataTable=async(t,a)=>{var e,r,n,{columnsMap:i,firstRowElements:l,tbodyElement:s,itemIds:o,collectionName:d,dataTable:c,finderId:u}=a,p=c.querySelector("thead");let m=[];if([...p.rows[0].cells].forEach((e,t)=>{["reference","belongsTo"].includes(elementAttribute(e,"type"))&&m.push({fieldName:elementAttribute(e,"data-selected-column"),index:t})}),s){p="";s.innerHTML="",addTablePlaceholder(a.numberPerPage||1,l,s);let e=[];i&&(e=o||(t=await addEntityQueryToUrl(t,d,u),(await securedGetCall(t)).data),p+=await createTableRecords(e,i,l,d,!1,"",m),s.innerHTML=p)}$(`#${c.id}[data-js=data-table] [data-js=table-body] TR`).each(function(){var e=this.querySelector("IMG");e&&e.hasAttribute("data-enable-popup")&&!!e.closest("A")&&(e=e.closest("TD"),$(e).magnificPopup({delegate:"a",type:"image",gallery:{enabled:!0}}))});for([e,r]of dataTableStylesMap)selectorExists(`[id^="${e}"]`)||(n=`*[id^="${e}"] `+r,addStyle(n))},createTableRecords=async function(e,n,i,l="",s=!1,o="",d){if(!e||!Array.isArray(e)||0===e.length)return`<tr class="no-record-data-table"><td class="text-center" colspan="${Object.keys(n).length}">No Records</td></tr>`;let{constants:c,environments:u}=await getProjectDetail(),p=(await getCollectionDetails(l)).constants;e=e.map(e=>{var t,e=getTableColumns(e,n,i,l,s,o,d,c,u,p),a="TR"===i.tagName?i:"";let r="";return a&&(t=a.cloneNode(!0),r=elementAttribute(a,"id"),applyUserDefinedStyles(t,a,dataTableStylesMap)),`<tr ${setIdAttribute(r)}>${e}</tr>`});return(await Promise.all(e)).join("")},selectorExists=t=>{var a=getAllSelectors();for(let e=0;e<a.length;e++)if(a[e]==t)return!0;return!1},addStyle=e=>{var t=document.createElement("style");t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t)},getTableColumns=(o,d,c,u="",p=!1,m="",g,b,f,h)=>{var e=Object.keys(d).map(a=>{var r=c.cells;let e=Object.values(r).find(e=>elementAttribute(e,"data-selected-column")===a);var t=(e=void 0!==e?e:null)&&"TD"===e.tagName?e:"",n=e&&"TH"===e.tagName?e:"";let i="";t?(l=t.cloneNode(!0),i=elementAttribute(t,"id"),applyUserDefinedStyles(l,t,dataTableStylesMap)):n&&(l=n.cloneNode(!0),elementAttribute(n,"id"),applyUserDefinedStyles(l,n,dataTableStylesMap));(e?e.querySelectorAll('[data-js="drapcode-icons"], img'):[]).forEach(e=>{e.setAttribute("data-item-id",o.uuid),e.setAttribute("data-collection-id",u),e.setAttribute("data-item",JSON.stringify(o))});var t=e?e.querySelector("[data-pdf-viewer-component]"):null,l=e?e.children:"",n=d[a];if(a.includes('"')&&"functionType"in JSON.parse(a))return s=getDerivedFieldData(a,o,b,f,h),`<td ${setIdAttribute(i)}>${setColumnDataIntoHtmlElement(s,l[0])}</td>`;if(a.includes(".")){let t=l[0];if(g&&g.length){var s=g.find(e=>e.fieldName===a).index;let e=Object.values(r)[s];t=e?e.children[0]:t}return renderReferenceTypeData(o,n,a,t,p)}return["static_option","dynamic_option"].includes(n)?`<td ${setIdAttribute(i)}>${renderStaticAndDynamicData(o,n,a,l[0])}</td>`:"boolean"===n?a in o?(r=o[a]?"Yes":"No",`<td ${setIdAttribute(i)}>${setColumnDataIntoHtmlElement(r,l[0])}</td>`):`<td ${setIdAttribute(i)}>${setColumnDataIntoHtmlElement(null,l[0])}</td>`:"image"===n||"file"===n?(t?renderPdfViewerInDataTable:renderFileColumnData)(o,a,l[0]):"multi_image"===n||"multi_file"===n?(t?renderPdfViewerInDataTable:renderMultiFileColumnData)(o,a,l[0]):["updatedAt","createdAt"].includes(n)?renderTimestampColumnData(o,a,l[0],!0):["date","time_slot"].includes(n)?renderTimestampColumnData(o,a,l[0]):"object"==typeof n?!!(s=l[0])&&s.attributes["data-gjs"]?(r=getColorBadges(s,a,o),`<td ${setIdAttribute(i)}>${r}</td>`):renderReferenceTypeData(o,n,a,l[0]):"action"===n?`<td ${setIdAttribute(i)}>${renderActionColumnData(o,a,l,u,p,m)}</td>`:"large_text"===n?renderTableLargeTextColumn(o,a,l[0],i):"action_select_checkbox_all"===n?`<td ${setIdAttribute(i)}>${renderCheckboxColumnData(o,a,l,u)}</td>`:"url"===n?renderUrlColumnData(o,a,l[0]):renderTableBodyColumn(o,a,l[0],i,n)});let t=[];return e&&e.map(n=>{var e=(new DOMParser).parseFromString(n,"text/html").body.querySelectorAll("[data-vis-condition]");if(e&&e.length){console.log("ðŸš€ ~ file: dataLoader.js:3686 ~ Processing Component Visibility...");let r={itemData:{...o}};e.forEach(e=>{var t=e.cloneNode(!0),a=(processComponentVisibilityCondition(t,r),t.hasAttribute("data-vis-removed"));t.removeAttribute("data-vis-condition"),n=n.replace(e.outerHTML,a?"":t.outerHTML)})}t.push(n)}),t?t.join(""):""},setIdAttribute=e=>e?`id=${e}-`+uuidv4():"",setColumnDataIntoHtmlElement=(t,e,a=!1)=>{if(e)return setAttributeInColumnData(e),a?e.innerHTML=t||"":e.textContent=t||"",e.outerHTML;{let e=t;return e=e||0===e?e:""}},renderFileColumnData=(l,e,s)=>{var t,a,r,e=e?l[e]:"";let o=s?elementAttribute(s,"data-preview-icon"):"",n="",i="",d="";return e?(e&&"object"==typeof e&&!Array.isArray(e)?("object"==typeof e?(t=e.key,n=o?e[o]:e.isExternalUrl?e.url:!0===e.isPrivate?"https://drapcode-static.s3.amazonaws.com/img/placeholder-img.png":t?imageServerUrl()+t:n,i=e.originalName):"string"==typeof e&&e.startsWith("http")&&(n=e,i=e),t=s?s.tagName:"",d=t&&"IMG"===t?((t=s.cloneNode(!0)).src=n||t.src,!0===e.isPrivate&&addDownloadAttributeForPrivateFiles(t,e,l.uuid),[t.outerHTML]):(t=document.createElement("a"),!0===e.isPrivate?addDownloadAttributeForPrivateFiles(t,e,l.uuid):t.href=n,t.innerText=i||n,s?(r=s.querySelector("IMG"),a=s.querySelector("[data-js=drapcode-icons]"),!0===e.isPrivate?addDownloadAttributeForPrivateFiles(s,e,l.uuid):s.href=t.href,s.innerText=t.innerText,s.title=i,r&&(r=r.cloneNode(!0),n?r.src=n:r.src,r.alt=i,s.innerHTML=r.outerHTML),a&&((r=a.cloneNode(!0)).title=i,s.innerHTML=r.outerHTML),[s.outerHTML]):[t.outerHTML])):e&&Array.isArray(e)&&(d=e.map(e=>{var t,a,r=e.key,r=o?e[o]:e.isExternalUrl?e.url:!0===e.isPrivate?"https://drapcode-static.s3.amazonaws.com/img/placeholder-img.png":r?imageServerUrl()+r:"",n=e&&e.originalName?e.originalName:"",i=s?s.tagName:"";return(i&&"IMG"===i?(i=s.cloneNode(!0),r?i.src=r:i.src,!0===e.isPrivate&&addDownloadAttributeForPrivateFiles(i,e,l.uuid),i):(i=document.createElement("a"),!0===e.isPrivate?addDownloadAttributeForPrivateFiles(i,e,l.uuid):i.href=r,i.innerText=n||r,s?(a=s.querySelector("IMG"),t=s.querySelector("[data-js=drapcode-icons]"),!0===e.isPrivate?addDownloadAttributeForPrivateFiles(s,e,l.uuid):s.href=i.href,s.innerText=i.innerText,s.title=n,a&&(e=a.cloneNode(!0),r?e.src=r:e.src,e.alt=n,s.innerHTML=e.outerHTML),t&&((a=t.cloneNode(!0)).title=n,s.innerHTML=a.outerHTML),s):i)).outerHTML})),`<td>${d?d.join(" "):""} </td>`):"<td></td>"},renderMultiFileColumnData=(n,e,i)=>{let t="",l=i?elementAttribute(i,"data-preview-icon"):"";return`<td>${(t=n[e]&&Array.isArray(n[e])?n[e].map(e=>{var t=e&&l?e[l]:e&&!0===e.isPrivate?"https://drapcode-static.s3.amazonaws.com/img/placeholder-img.png":e&&e.key?imageServerUrl()+e.key:"",a=e&&e.originalName?e.originalName:"",r=i?i.tagName:"";return(r&&"IMG"===r?(r=i.cloneNode(!0),t?r.src=t:r.src,!0===e.isPrivate&&addDownloadAttributeForPrivateFiles(r,e,n.uuid),r):(r=document.createElement("a"),!0===e.isPrivate?addDownloadAttributeForPrivateFiles(r,e,n.uuid):r.href=t,r.innerText=a||t,i?(i.innerHTML=r.outerHTML,i):r)).outerHTML}):t)?t.join(" "):""} </td>`},renderTimestampColumnData=(e,t,a,r)=>{e=e[t]?convertTimeStampToDate(e[t],r):"";return`<td>${setColumnDataIntoHtmlElement(e,a)}</td>`},createFileAnchorTag=(e,t,a)=>{var r=e&&e.key?imageServerUrl()+e.key:"",n=e&&e.originalName?e.originalName:"",i=e.isPrivate,l=document.createElement("a");return!0===i?addDownloadAttributeForPrivateFiles(l,e,a.uuid):l.href=r,l.innerText=n||r,(t?(t.innerHTML=l.outerHTML,t):l).outerHTML},renderReferenceTypeFileData=(a,r,n)=>{let i="";var l=elementAttribute(r,"data-preview-icon");if(!a)return"<td></td>";if(Array.isArray(a))return`<td>${(i=a.map(e=>e&&Array.isArray(e)?e.map(e=>createFileAnchorTag(e,r,n)).join(" "):createFileAnchorTag(e,r,n)))?i.join(" "):""} </td>`;{let e="",t="";if("object"==typeof a){var s=a.key;e=l?a[l]:a.isExternalUrl?a.url:!0===a.isPrivate?"https://drapcode-static.s3.amazonaws.com/img/placeholder-img.png":s?imageServerUrl()+s:"",t=a.originalName}else{if("string"!=typeof a||!a.startsWith("http"))return"<td></td>";e=a,t=a}var l=r?r.tagName:"";return i=l&&"IMG"===l?((s=r.cloneNode(!0)).src=e||s.src,!0===a.isPrivate&&addDownloadAttributeForPrivateFiles(s,a,n.uuid),[s.outerHTML]):(l=document.createElement("a"),!0===a.isPrivate?addDownloadAttributeForPrivateFiles(l,a,n.uuid):l.href=e,l.innerText=t||e,r?(r.innerHTML=l.outerHTML,[r.outerHTML]):[l.outerHTML]),console.log("Data \n",i),`<td>${i}</td>`}},renderReferenceTypeData=(e,t,a,r,n=!1)=>{let{nestedFieldName:i,fieldType:l,hasBelongsToParentData:s}=t.metaData||{};var o;i||(o=((o=e._$belongsToMetaData)?o.refCollection:{}).collectionField,i=o||void 0,"createdBy"===t.type&&(i="userName")),a.includes(".")||s||(a=a+"."+i),s&&t.metaData&&(e=t.metaData,a.includes("."))&&(a=a.split(".").splice(1).join("."));let d=n?_.get(e,a):parseValueFromData(e,a);return!d||"file"!==l&&"image"!==l?(d="boolean"===l?d&&"boolean"==typeof d?"Yes":"No":d)?containsHTML(d)?`<td>${setColumnDataIntoHtmlElement(d,r,!0)}</td>`:`<td>${setColumnDataIntoHtmlElement(d,r)}</td>`:"<td></td>":renderReferenceTypeFileData(d,r,e)},renderStaticAndDynamicData=(e,t,a,r)=>{var n=parseValueFromData(e,a);return!!r&&r.attributes["data-gjs"]?getColorBadges(r,a,e):setColumnDataIntoHtmlElement(n,r)},renderLinkColumnData=(a,r,n="",i=!1,l="")=>{var s=r.cloneNode(!0),o=elementAttribute(r,"id"),o=(o&&(o=a.uuid?o+"-"+a.uuid:o+"-item",s.setAttribute("id",o),applyUserDefinedStyles(r,s,dataTableStylesMap)),a.uuid&&s.setAttribute("data-item-id",replaceSlashWithUnderscore(a.uuid)),s.setAttribute("data-collection-item",JSON.stringify(a)),s.setAttribute("data-collection-id",n),window.document.getElementById("snipcart")),r=(void 0!==o&&null!=o&&s.classList.contains("snipcart-add-item")&&loadSnipcartItemData(s,a),i&&l?l._data_source_rest_api_primary_id.trim():elementAttribute(s,"data-path-field-name")),n=elementAttribute(s,"data-path-field-seo");if(r&&(i&&s.setAttribute("data-item-id",replaceSlashWithUnderscore(_.get(a,r))),"A"===s.tagName)){o=elementAttribute(s,"href");let e=r?parseValueFromData(a,r):"",t=(e=i?(e=e&&"number"==typeof e?e.toString():e)&&"string"==typeof e?replaceSlashWithUnderscore(e):e:(e=e&&e.length?e.split(", "):"")&&e.length?e[0]:"",o.replace(r,e));t=i&&r&&o.endsWith("uuid")?o.replace("uuid",e):o.replace(r,e),n&&(l=n?parseValueFromData(a,n):"",l=slugify(l),t=t.replace(n,l)),s.setAttribute("href",t)}return s},renderNestedActionColumnData=(a,r,n="",i=!1,e="")=>{let l="";var s=r?r.querySelector('[data-gjs="data-table-link"]'):"",o=r?r.querySelector("button"):"",r=r?r.querySelector("a.link-box"):"";if(s?l=s:o?l=o:r&&(l=r),l){a.uuid&&l.setAttribute("data-item-id",a.uuid),l.setAttribute("data-collection-item",JSON.stringify(a)),l.setAttribute("data-collection-id",n);s=window.document.getElementById("snipcart"),o=(void 0!==s&&null!=s&&l.classList.contains("snipcart-add-item")&&loadSnipcartItemData(l,a),i&&e?e._data_source_rest_api_primary_id.trim():elementAttribute(l,"data-path-field-name")),r=elementAttribute(l,"data-path-field-seo");if(o){i&&l.setAttribute("data-item-id",_.get(a,o));n=elementAttribute(l,"href");let e=o?parseValueFromData(a,o):"",t=(e=i?e&&"number"==typeof e?e.toString():e:(e=e&&e.length?e.split(", "):"")&&e.length?e[0]:"","");t=i&&o&&n.endsWith("uuid")?n.replace("uuid",e):n.replace(o,e),r&&(s=r?parseValueFromData(a,r):"",s=slugify(s),t=t.replace(r,s)),l.setAttribute("href",t)}}},renderCheckboxColumnData=(e,t,a,r="")=>{var n="action-select-item-"+e.uuid;return`<div data-gjs="checkbox-item">
  <input
    type="checkbox"
    value=""
    data-gjs="dt-item-check"
    id=${n}
    data-item-id=${e.uuid}
    data-collection-id=${r}
    />
  <label class="form-check-label" for=${n}></label>
</div>`},renderActionColumnData=(r,e,t,n="",i=!1,l="")=>{let s=document.createElement("div");return Object.values(t).map(t=>{if(["pageCollection","session"].includes(t.getAttribute("data-path-collection-item-id-from")))s.appendChild(t.cloneNode(!0));else{var a;let e="";t.getAttribute("data-url-field")?(a=t.cloneNode(!0),replaceCollectionFieldLink(a,r),e=a):(e=renderLinkColumnData(r,t,n,i,l),renderNestedActionColumnData(r,e,n,i,l)),s.appendChild(e)}}),s.innerHTML},renderTableLargeTextColumn=(e,t,a,r)=>{var n=!!e[t]&&htmlRegex.test(e[t]),e=e[t]||"";return`<td ${setIdAttribute(r)}>${setColumnDataIntoHtmlElement(e,a,n)}</td>`},renderTableBodyColumn=(e,t,a,r,n)=>{var i=a?.tagName;i&&"A"===i&&!["pageCollection","session"].includes(element.getAttribute("data-path-collection-item-id-from"))&&(a=renderLinkColumnData(e,a));let l=e[t]||"";return"number"===n&&(l=l||"0"),`<td ${setIdAttribute(r)}>${setColumnDataIntoHtmlElement(l,a)}</td>`},setAttributeInColumnData=e=>{var t=e.cloneNode(!0),a=elementAttribute(e,"id")||uuidv4();return applyUserDefinedStyles(t,e,dataTableStylesMap),e.hasAttribute("data-org-id")?e.setAttribute("id",elementAttribute(e,"data-org-id")+"-"+uuidv4()):(e.setAttribute("id",a+"-"+uuidv4()),e.setAttribute("data-org-id",a)),e},loadDataTable=async(n,i,l)=>{var{dataTable:s,fieldName:e,externalQueryParamKeys:o}=l,t=s.hasAttribute("hidewhenempty"),d=s.querySelector("thead").rows[0].cells.length,c=s.querySelector("[data-js=table-body]");if(validateDataTableProps(n,i,e,d,c)){let a=0,r=!1;var u=(await getItemDataForElement(s)).itemData;if(n){let e=`collection-table/${i}/finder/${n}/items/count`;var p=getDataRangeQuery(l,"dataTable");p&&(e+="?"+p),e=prepareItemDataAndExternalQueryParamForTable(o,e,u,s);let t=await searchQueryStringFromUrl();"undefined"!=typeof searchString&&searchString?e=t?(t.startsWith("?")&&!e.endsWith("/")&&(t=t.replace("?","&")),e+"&"+searchString+t):e+"&"+searchString:t&&(t.startsWith("?")&&!e.endsWith("/")&&(t=t.replace("?","&")),e+=t),e=await addEntityQueryToUrl(e,i,n);p=await securedGetCall(e);a=p.data,l.numberOfPages=getNumberOfPages(a,l.numberPerPage),r=p?p._$isPrivateFilter:null}else e&&(o=parseValueFromData(u,e),o=Array.isArray(o)?o:0<Object.keys(o).length?[o]:[],a=o.length,l.numberOfPages=1,l.filteredItemsUrl=`collection-table/${i}/itemList`,l.itemIds=o);if(l.tbodyElement=c,await setTableMetaData(l,u,e),numberPaginationNav(l),dateRangePaginationNav(l),processPaginationPersist(l),l.finderId=n,t&&0===a)console.log("ðŸš€ ~ Removing data table:",s),s.remove();else{if(0<a){p=await searchQueryStringFromUrl();p?searchInDataTable(l,p):loadDataList(l,!0)}else{if(r)return c.innerHTML=`<tr><td class="text-center" colspan="${d}">This data is private hence cannot be displayed</td></tr>`,void validatePaginationButton(1,1,s);c.innerHTML=`<tr class="no-record-data-table"><td class="text-center" colspan="${d}"></td></tr>`,validatePaginationButton(1,1,s)}addDataTableDataToMap(l,l.dataTable)}}else validatePaginationButton(1,1,s),numberPaginationNav(l),dateRangePaginationNav(l)},getItemDataForElement=async a=>{new Promise(function(e,t){e(a)});var e=findModalParent(a);let r="",n="";if(e){let t=e?e.getAttribute("data-collection-id"):"",a=e?e.getAttribute("data-item-id"):"";a=replaceSlashWithUnderscore(a),[null,void 0,"null","undefined"].some(e=>[t,a].includes(e))||(e={collectionId:t,itemId:a},e=(await getModalItemData(e)).itemData,r=e),n=t}else{var{itemData:e,collectionId:t}=await getPageItemData();r=e,n=t}return{itemData:r,collectionId:n}},findModalParent=e=>{let t=e.parentElement;for(;t;){if(t.id&&t.id.startsWith("modal-container")||t.hasAttribute("data-subpage-id"))return t;t=t.parentElement}return null},loadDataTableFromExternalAPI=async e=>{var t,{externalApiId:a,dataTable:r}=e,n=(e.loadFromExternalAPI=!0,{});try{a&&(r.querySelector("thead").rows[0].cells.length,t=r.querySelector("[data-js=table-body]"),e.tbodyElement=t,await setTableMetaData(e),processExternalApiDataTablePaginationPersist(e),await loadExternalApiResponseDataList(e,n,!1))}catch(e){e.response&&(a=e.response.data,r=a?a.message||a:"Failed",toastr.error(r,"Error"),n.data=e.response,n.data.externalApiResponse=e.response,n.externalApiResponse=e.response,n.status="error")}return n},loadExternalApiResponseDataList=async(l,a,e=!1,t=!1)=>{var{externalApiId:r,dataTable:s,searchString:n,tbodyElement:o}=l;let i={};let d={},c="external-api",u=DATA_SOURCE_DEFAULT;o.innerHTML="";try{r&&(p=await publicGetCall(c+"/id/"+r),console.log("%c==> DataTable from External API externalAPIResult :>> ","color:yellow",p),p)&&200===p.status&&(d=p.data)}catch(t){if(console.log("%c==> DataTable from External API error :>> ","color:red",t),t.response){let e=t.response.data;var p=e?e.message||e:"Failed";toastr.error(p,"Error"),a.data=t.response,a.data.externalApiResponse=t.response,a.status="error"}}var{bodyDataFrom:p,uniqueKey:m,sendFormData:g}=d||"",p=p??"noDynamicData",m=m??"id",g=!!g;if(t||addTablePlaceholder(l.numberPerPage||1,l.firstRowElements,o),console.log("*** is paginated:",e),!e){l.numberPerPage=Number(l.numberPerPage);var o=elementSelector(s,".pagination"),b=elementSelector(s,".pagination-number");l.paginationElem=b||o,console.log("*** pagination element:",l.paginationElem);let e="",t="",a="";b?(e=b.attributes["data-offset-key"],t=b.attributes["data-page-offset-key"],a=b.attributes["data-limit-key"]):o&&(e=o.attributes["data-offset-key"],t=o.attributes["data-page-offset-key"],a=o.attributes["data-limit-key"]);var b=l.paginationElem?l.paginationElem.dataset:"";b&&b.hasOwnProperty("datasource")&&(u=b.datasource),console.log("*** pagination data source:",u);let r=e?e.value:"",n=t?t.value:"",i=a?a.value:"";switch(u){case DATA_SOURCE_SUPABASE:case DATA_SOURCE_DIRECTUS:r=r||"offset",n=n||"page",i=i||"limit"}r||n?(l.enablePagination=!0,r?(l.offsetKey=r,l.offsetValue=0):n&&(l.pageOffsetKey=n,l.pageOffsetValue=0)):l.enablePagination=!1,i&&(l.overrideLimitKey=i)}n&&(i.externalApiItem?i.externalApiItem.searchString=n:i.externalApiItem={searchString:n}),p&&"NON_PERSISTENT_COLLECTION"===p?(b=(o=window.location.pathname.split("/"))[o.length-1],b=replaceSlashWithUnderscore(b=(o=o[o.length-2])?b:uuidv4(16)),i.externalApiItem={...i.externalApiItem,nonPersistentCollectionItemId:b,pageCollectionName:o,uniqueKey:m||"id",id:b,uuid:b,_data_source_rest_api_primary_id:b}):({collectionItemId:o,collectionId:b}=await getPageItemData(),o=replaceSlashWithUnderscore(o),i.externalApiItem={...i.externalApiItem,collectionItemId:o,pageCollectionName:b,uniqueKey:m||"id",id:o,uuid:o,_data_source_rest_api_primary_id:o}),l.enablePagination?((b=l.paginationElem?l.paginationElem.dataset:"")&&b.hasOwnProperty("datasource")&&(u=b.datasource),console.log("*** pagination data source #2:",u),i.externalApiItem?(i.externalApiItem.recordsOffset={offsetKey:l.offsetKey||"",offsetValue:e?l.offsetValue:0},i.externalApiItem.pageOffset={pageOffsetKey:l.pageOffsetKey||"",pageOffsetValue:e?l.pageOffsetValue:0},i.externalApiItem.recordsLimit={limitKey:l.overrideLimitKey||"limit",limitValue:l.numberPerPage},i.externalApiItem.dataSource=u):i.externalApiItem={recordsOffset:{offsetKey:l.offsetKey||"",offsetValue:e?l.offsetValue:0},pageOffset:{pageOffsetKey:l.pageOffsetKey||"",pageOffsetValue:e?l.pageOffsetValue:0},recordsLimit:{limitKey:l.overrideLimitKey||"limit",limitValue:l.numberPerPage},dataSource:u}):hidePaginationButton(s),processDataForPersistentPagination(l,e,i),t&&(!!(m=elementSelector(s,"[data-gjs=search-form]"))&&m.hasAttribute("data-downloadAllRecords")&&l.enablePagination&&(i.externalApiItem={recordsOffset:{offsetKey:l.offsetKey||"",offsetValue:0},pageOffset:{pageOffsetKey:l.pageOffsetKey||"",pageOffsetValue:0},recordsLimit:{limitKey:l.overrideLimitKey||"limit",limitValue:"ALL"}},n)&&i.externalApiItem&&(i.externalApiItem.searchString=n),i.externalApiItem?i.externalApiItem.exportNonPersistentReponse=t:i.externalApiItem={exportNonPersistentReponse:t});o=elementSelector(s,"[data-gjs=pagination-number]");o&&(b=o?o.getAttribute("data-totalrecordspath"):"")&&(i.externalApiItem?i.externalApiItem.totalRecordsPath=b:i.externalApiItem={totalRecordsPath:b}),i.externalApiItem&&({nonPersistentCollectionItemId:m,collectionItemId:n,pageCollectionName:s}=i.externalApiItem,o=!!s,console.log("%c==> DataTable from External API sendPageCollectionItem :>> ","color:lime",o),o)&&(!n||p&&"collectionItem"!==p||g?m&&"NON_PERSISTENT_COLLECTION"===p&&!g&&(c=c+"/"+m):c=c+"/"+n);let f={},h={};b={},s={},o={},p=window.sessionStorage,g=p.getItem("previousActionResponse"),g&&(g=JSON.parse(g),0<Object.keys(g).length)&&(f=getFinalSessionValues(f,g,d,"current_session"),console.log("%c==> DataTable from External API session value :>> ","color:yellow",f)),m=p.getItem("previousActionFormData"),m&&(m=JSON.parse(m),0<Object.keys(m).length)&&(h=getFinalSessionValues(h,m,d,"form_data_session"),console.log("%c==> DataTable from External API session form data :>> ","color:yellow",h)),n={sessionStorageData:getBrowserStorageValuesForExternalAPI(b,d,"SESSION_STORAGE"),localStorageData:getBrowserStorageValuesForExternalAPI(s,d,"LOCAL_STORAGE"),cookiesData:getBrowserStorageValuesForExternalAPI(o,d,"COOKIES")},g={data:i,externalApiId:r,sessionValue:f,sessionFormValue:h,browserStorageDTO:n};if(console.log("\n URL: ",c),console.log("\n Body: ",g),t)await downloadFile(c,g);else if(p=await unSecuredPostCall(g,c),a.data={...p},a.externalApiResponse=p,a.data.externalApiResponse=p,a.status="success",l.externalApiResponse=p.data,l.numberOfPages=1,await renderDataTableForExternalAPI(l,e),validateNumberPaginationNav(l),showPaginationNumbersByCurrentPage(l),e)return a},loadDynamicDataTable=async a=>{console.log("%c==> loadDynamicDataTable dataTable :>> ","color:lime",a);let r="",n="",i="",l=[],s=[];var o=[];let d=100;let t=[];let c="",u="";var p="table-"+a.id,m=a.children[0],g=(m.setAttribute("id",p),a.dataset);g&&(r=g.csCollectionname??"",n=g.csFinderuuid??"",recordsPerPage=g.csNumberperpage?Number(g.csNumberperpage):"",Object.entries(g).map(([e,t],a)=>{e.startsWith("csColumn")&&(e=e.replace(/csColumn-(.*?)/g,"$1"),l.push({order:Number(e),column:t}))})),recordsPerPage&&(d=recordsPerPage);try{r&&(i=await fetchCollectionByName(r))}catch(e){if(e.response)return g={},b=e.response.data,b=b?b.message||b:"Failed",toastr.error(b,"Error"),g.data=e.response,g.status="error",g}if(i&&l&&l.length&&l.map(t=>{var e=i.fields.find(e=>e.fieldName===t.column);e&&s.push({order:t.order,field:e})}),s){var b=(await getItemDataForElement(a)).itemData;if(s.sort((e,t)=>e.order-t.order).map(e=>{c+=`<th data-selected-column=${e.field.fieldName} type=${e.field.type}><div data-gjs-type="text" title=${e.field.fieldTitle.en}>${e.field.fieldTitle.en}</div></th>`,u+=` <td data-selected-column=${e.field.fieldName}><div>${e.field.fieldTitle.en}'s value</div></td>`}),m.innerHTML=`<thead>${c}</thead><tbody>${u}</tbody>`,n){let e=`collection-table/${r}/finder/${n}/items/count`,t=(e=prepareItemDataAndExternalQueryParamForTable(o,e,b,a),await searchQueryStringFromUrl());t&&(t.startsWith("?")&&!e.endsWith("/")&&(t=t.replace("?","&")),e+=t),e=await addEntityQueryToUrl(e,r,n),getNumberOfPages((g=await securedGetCall(e)).data,d),!g||g._$isPrivateFilter}if(r&&n){let e=`collection-table/${r}/finder/${n}/items`;g=0*d,g=(e=e+`?offset=${g}&limit=`+d,e=prepareItemDataAndExternalQueryParamForTable(o,e,b,a),await securedGetCall(e));t=g.data}collectionItemEndpoint=await addEntityQueryToUrl(collectionItemEndpoint,r,n);let e=a.querySelector("thead");t&&(m.innerHTML="",u="",t.map(a=>{let r,n;u+="<tr>",[...e.rows[0].cells].forEach((e,t)=>{r=elementAttribute(e,"data-selected-column"),n=a[r]??"",u+=` <td data-selected-column=${r}><div>${n}</div></td>`}),u+="</tr>"})),m.innerHTML=`<thead>${c}</thead><tbody>${u}</tbody>`,t&&u&&$("#"+p).DataTable({responsive:!0})}},renderDataTableForExternalAPI=async(e,t=!1)=>{var a,r,n,{columnsMap:i,firstRowElements:l,tbodyElement:s,collectionName:o,externalApiResponse:d,responseDataMapping:c,dataTable:u}=e;if(s){let r=[];var p=(d.data?r=[...d.data]:Object.entries(d).map(([e,t])=>{!["externalApiMiddlewareId","totalRecords"].includes(e)&&t&&r.push(t)}),e.numberOfPages=e.enablePagination&&r&&r.length?getNumberOfPages(r.length,e.numberPerPage):1,e.responseDataLength=r&&r.length?r.length:0,validatePaginationButtonForNonPersistent(e,u),e).numberPerPage,d=(d||"").totalRecords,d=(e.numberOfPages=p&&d?getNumberOfPages(d,p):e.numberOfPages,t||(numberPaginationNav(e),await addDataTableDataToMap(e,u,!0,!t)),"");s.innerHTML="",addTablePlaceholder(e.numberPerPage||1,l,s);if(i){p=r,t=u.querySelector("thead");let a=[];[...t.rows[0].cells].forEach((e,t)=>{["reference","belongsTo"].includes(elementAttribute(e,"type"))&&a.push({fieldName:elementAttribute(e,"data-selected-column"),index:t})}),d+=await createTableRecords(p,i,l,o,!0,c,a),s.innerHTML=d}}for([a,r]of dataTableStylesMap)selectorExists(`[id^="${a}"]`)||(n=`*[id^="${a}"] `+r,addStyle(n))},hidePaginationButton=e=>{var t=elementSelector(e,".loadMore"),a=elementSelector(e,".next"),r=elementSelector(e,".previous"),n=elementSelector(e,".first"),e=elementSelector(e,".last");t&&(t.disabled=!0),t&&(t.hidden=!0),t&&(t.style.display="none"),a&&(a.disabled=!0),a&&(a.hidden=!0),a&&(a.style.display="none"),r&&(r.disabled=!0),r&&(r.hidden=!0),r&&(r.style.display="none"),n&&(n.disabled=!0),n&&(n.hidden=!0),n&&(n.style.display="none"),e&&(e.disabled=!0),e&&(e.hidden=!0),e&&(e.style.display="none")},validatePaginationButtonForNonPersistent=(e,t)=>{var{numberPerPage:e,responseDataLength:a,currentPage:r}=e,n=elementSelector(t,".next"),i=elementSelector(t,".previous"),l=elementSelector(t,".first"),t=elementSelector(t,".last");n&&(n.disabled=!a||a<e),i&&(i.disabled=1===r),l&&(l.disabled=1===r),t&&(t.disabled=!0),n&&n.disabled&&(n.style.cursor="default"),i&&i.disabled&&(i.style.cursor="default"),l&&l.disabled&&(l.style.cursor="default"),t&&t.disabled&&(t.style.cursor="default")},dateRangeDataGroupNav=e=>{let{dataGroup:t,externalApiId:a}=e||"";var r,n=elementSelector(t,"[data-gjs=date-range-filter]");return n&&(r=elementSelector(n,".prev-date-range"),n=elementSelector(n,".next-date-range"),r)&&(r.addEventListener("click",async()=>{--e.currentDateRange,a?await loadDataGroupExternalAPI(e):loadGroupData(e)}),n)?void n.addEventListener("click",async()=>{e.currentDateRange+=1,a?await loadDataGroupExternalAPI(e):loadGroupData(e)}):""},dateRangePaginationNav=e=>{let{dataTable:t,externalApiId:a}=e||"";var r,n=elementSelector(t,"[data-gjs=date-range-filter]");return n&&(r=elementSelector(n,".prev-date-range"),n=elementSelector(n,".next-date-range"),r)&&(r.addEventListener("click",async()=>{--e.currentDateRange,a?await loadExternalApiResponseDataList(e,{},!0):loadDataList(e)}),n)?void n.addEventListener("click",async()=>{e.currentDateRange+=1,a?await loadExternalApiResponseDataList(e,{},!0):loadDataList(e)}):""},getDataRangeQuery=(e,t,a="")=>{if(!e)return"";var r=document.getElementById("dateTimeFormat").innerText||"YYYY-MM-DD",n=e.currentDateRange,e=e[t],t=elementSelector(e,"[data-gjs=date-range-filter]");if(!t)return"";var e=t.getAttribute("date-field"),i=t.getAttribute("date-range-type"),t=elementSelector(t,".date-range-div");if(!e)return"";if(!i)return"";if(a)return t.innerText="";let l="",s="",o=moment();return o=o.add(n,i+"s"),l=(l=o.startOf(i)).format(r),s=(s=o.endOf(i)).format(r),l===s?t.innerText=l:t.innerText=l+" - "+s,`start_${e}=`+l+"&"+(`end_${e}=`+s)},numberPaginationNav=a=>{var{dataTable:e,numberOfPages:r}=a||"",t=elementSelector(e,"[data-gjs=pagination-number]"),n=elementSelector(e,"[data-gjs=pagination-number-nav]"),i=elementSelector(e,".pagination-number-nav-list");if(i){var l=elementSelector(e,".page-item-prev"),e=elementSelector(e,".page-item-next"),s=t.hasAttribute("data-showpagepaginationdropdown"),o=(t.hasAttribute("data-persistpagination"),l?l.children[0]:""),d=e?e.children[0]:"";if(i.innerHTML="",1<r){n.style.display="revert",n.classList.remove("d-none"),i&&i.appendChild(l);for(let t=0;t<r;t++){let e=t+1;var c=document.createElement("li"),u=(c.classList.add("page-item"),document.createElement("a"));u.href="javascript:void(0)",u.classList.add("page-link"),u.classList.add("link-"+e),u.textContent=e,s&&e>DEFAULT_PAGE_RANGE_NUMBER_PAGINATE&&(c.classList.add("d-none"),u.classList.add("d-none")),c.appendChild(u),u.addEventListener("click",()=>{specificDataTablePage(a,e)}),i.appendChild(c)}createEllipses(s,r,i),e&&i.appendChild(e),addPageNumberDropdown(s,r,t,i,a),o&&o.addEventListener("click",()=>{previousDataTablePage(a)}),d&&d.addEventListener("click",()=>{nextDataTablePage(a)}),processNumberedPaginationPersist(a)}else{n.style.display="none",n.classList.add("d-none"),l&&i.appendChild(l);t=document.createElement("li"),o=(t.classList.add("page-item"),document.createElement("a"));o.href="javascript:void(0)",o.classList.add("page-link"),o.classList.add("link-1"),o.textContent=1,t.classList.add("d-none"),o.classList.add("d-none"),t.appendChild(o),i.appendChild(t),e&&i.appendChild(e)}}},createEllipses=(e,t,a)=>{e&&t>DEFAULT_PAGE_RANGE_NUMBER_PAGINATE&&((e=document.createElement("li")).classList.add("page-item"),e.classList.add("item-ellipses-last"),e.classList.add("disabled"),e.setAttribute("disabled",!0),(t=document.createElement("span")).classList.add("page-link"),t.classList.add("span-ellipses"),t.setAttribute("disabled",!0),t.style.cursor="default",t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="10" height="2" viewBox="0 0 10 2" focusable="false" aria-hidden="true"><path d="M9 2c-.608 0-1-.425-1-1s.392-1 1-1 1 .448 1 1c0 .575-.392 1-1 1zM5 2c-.608 0-1-.425-1-1s.392-1 1-1 1 .448 1 1c0 .575-.392 1-1 1zM1 2c-.608 0-1-.425-1-1s.392-1 1-1 1 .448 1 1c0 .575-.392 1-1 1z"></path>...</svg>',e.appendChild(t),a.appendChild(e))},addPageNumberDropdown=(e,a,r,n,i)=>{if(e&&a>DEFAULT_PAGE_RANGE_NUMBER_PAGINATE){var e=document.createElement("li"),l=(e.classList.add("page-item"),e.classList.add("item-page-select-last"),e.classList.add("dc-pagination-select"),e.style.display="inline-block",document.createElement("select")),s=r.id+"-pageSelect",r=r.id+"-pageSelect";l.id=s,l.name=r,l.classList.add("page-link"),l.classList.add("select"),l.classList.add("form-control");let t=['<option value="">Pages</option>'];for(let e=0;e<a;e++){var o=e+1;t=t.concat(`<option value="${o}">${o}</option>`)}l.innerHTML=t.join(""),e.appendChild(l),n.appendChild(e),$("#"+s).select2({selectionCssClass:":all:",width:"resolve"}).trigger("change"),specificDataTablePageFromSelect(s,i)}},validateNumberPaginationNav=e=>{let{dataTable:t,numberOfPages:a,currentPage:r}=e||"";var e=elementSelector(t,".pagination-number-nav-list"),n=elementSelector(t,".pagination-number-info");n&&(1<a?n.textContent=`Page ${r} of `+a:n.innerHTML=""),e&&e.childNodes.forEach((e,t)=>{e.classList.contains("item-ellipses-last")||e.classList.contains("item-page-select-last")||(t<=1&&(1===r?(e.disabled=!0,e.classList.add("disabled"),e.setAttribute("disabled",!0),e.children[0].disabled=!0,e.children[0].classList.add("disabled")):(e.disabled=!1,e.classList.remove("disabled"),e.setAttribute("disabled",!1),e.children[0].disabled=!1,e.children[0].classList.remove("disabled"))),1<t&&t<a&&(r===t?(e.disabled=!0,e.classList.add("disabled"),e.setAttribute("disabled",!0),e.children[0].disabled=!0):(e.disabled=!1,e.classList.remove("disabled"),e.setAttribute("disabled",!1),e.children[0].disabled=!1)),r===a?(t===a||t>a)&&(e.disabled=!0,e.classList.add("disabled"),e.setAttribute("disabled",!0),e.children[0].disabled=!0):(t===a||t>a)&&(e.disabled=!1,e.classList.remove("disabled"),e.setAttribute("disabled",!1),e.children[0].disabled=!1))})},showPaginationNumbersByCurrentPage=t=>{var{dataTable:t,currentPage:i}=t||"",e=elementSelector(t,"[data-gjs=pagination-number]");if(e){t=elementSelector(t,".pagination-number-nav-list");if(e.hasAttribute("data-showpagepaginationdropdown")){let e=-1,a=!1,r=-1,n=-1;-1<(e=i>=DEFAULT_PAGE_RANGE_NUMBER_PAGINATE?i-DEFAULT_PAGE_RANGE_NUMBER_PAGINATE:e)&&(a=!0,r=e+1,n=DEFAULT_PAGE_RANGE_NUMBER_PAGINATE+e+1),t&&t.childNodes.forEach((e,t)=>{e.classList.contains("item-ellipses-last")||e.classList.contains("item-page-select-last")||e.classList.contains("page-item-prev")||e.classList.contains("page-item-next")||(a?!(t<=r)&&t>r&&t<=n?(e.classList.remove("d-none"),e.children[0].classList.remove("d-none")):(e.classList.add("d-none"),e.children[0].classList.add("d-none")):t<=DEFAULT_PAGE_RANGE_NUMBER_PAGINATE?(e.classList.remove("d-none"),e.children[0].classList.remove("d-none")):t>DEFAULT_PAGE_RANGE_NUMBER_PAGINATE&&(e.classList.add("d-none"),e.children[0].classList.add("d-none")))})}}},processNumberedPaginationPersist=e=>{var t,a=e.dataTable,a=elementSelector(a,"[data-gjs=pagination-number]"),r=a?a.hasAttribute("data-persistpagination"):"";a&&(r?(r=(r=sessionStorage.getItem("previousActionResponse"))?JSON.parse(r):"",e.externalApiId?r&&"undefined"!==r&&(t=r["dtPage-"+a.id])&&(t=t.pageNumber,specificDataTablePage(e,t)):r&&"undefined"!==r&&(t=r["dtPage-"+a.id])&&specificDataTablePage(e,t)):(r=sessionStorage.getItem("previousActionResponse"))&&(e=r=JSON.parse(r),t="dtPage-"+a.id,e=_.omit(r,t),sessionStorage.setItem("previousActionResponse",JSON.stringify(e))))},processPaginationPersist=e=>{var t=e.dataTable,t=elementSelector(t,"[data-gjs=pagination]"),a=t?t.hasAttribute("data-persistpagination"):"";t&&(a?(a=(a=sessionStorage.getItem("previousActionResponse"))?JSON.parse(a):"")&&"undefined"!==a&&(a=a["dtPage-"+t.id])&&loadPersistentPagination(e,a):(e=sessionStorage.getItem("previousActionResponse"))&&(a=e=JSON.parse(e),t="dtPage-"+t.id,a=_.omit(e,t),sessionStorage.setItem("previousActionResponse",JSON.stringify(a))))},processExternalApiDataTablePaginationPersist=e=>{var t,a=e.dataTable,r=elementSelector(a,"[data-gjs=pagination]"),n=r?r.hasAttribute("data-persistpagination"):"",a=elementSelector(a,"[data-gjs=pagination-number]"),i=a?a.hasAttribute("data-persistpagination"):"";r&&(n?(n=(n=sessionStorage.getItem("previousActionResponse"))?JSON.parse(n):"")&&"undefined"!==n&&(n=n["dtPage-"+r.id])&&loadExternalApiPersistentPagination(e,n):(n=sessionStorage.getItem("previousActionResponse"))&&(t=n=JSON.parse(n),r="dtPage-"+r.id,t=_.omit(n,r),sessionStorage.setItem("previousActionResponse",JSON.stringify(t)))),a&&(i?(r=(n=sessionStorage.getItem("previousActionResponse"))?JSON.parse(n):"")&&"undefined"!==r&&(t=r["dtPage-"+a.id])&&loadExternalApiPersistentPagination(e,t):(i=sessionStorage.getItem("previousActionResponse"))&&(n=i=JSON.parse(i),r="dtPage-"+a.id,n=_.omit(i,r),sessionStorage.setItem("previousActionResponse",JSON.stringify(n))))},addTablePlaceholder=(t,e,a)=>{var r=localStorage.getItem("loadingIconKey");if("PLACEHOLDER"===r){var n=e.cells.length;for(let e=0;e<t;e++){var i=a.insertRow();for(let e=0;e<n;e++)i.insertCell().innerHTML='<div class="drapcode-item-table"><div class="drapcode-col-12"><div class="drapcode-row"><div class="drapcode-col-12"></div></div></div></div>'}}else{var l=e.cells.length,s=a.insertRow();for(let e=0;e<l;e++){var o=s.insertCell();o.innerHTML="PLAIN_SPINNER"===r?'<div class="drapcode-spinner-plane drapcode-item-table"></div>':"CHASE_SPINNER"===r?'<div class="sk-chase drapcode-item-table"><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div></div>':"BAR_SPINNER"===r?'<div class="drapcode-spinner-bar drapcode-item-table"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>':"DOT_SPINNER"===r?'<div class="drapcode-spinner-dot drapcode-item-table"><div class="dot1"></div><div class="dot2"></div></div>':"FADING_CIRCLE_SPINNER"===r?'<div class="sk-fading-circle drapcode-item-table"><div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div><div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div></div>':"BOUNCE_SPINNER"===r?'<div class="drapcode-spinner-bounce drapcode-item-table"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>':""}}},setTableMetaData=async(e,t={},a="")=>{var{dataTable:r,tbodyElement:n}=e,n=n.rows[0].cloneNode(!0);e.firstRowElements=n,e.columnsMap=getColumnsMetaData(r,t,a,e)},getColumnsMetaData=(e,i={},l="",t={})=>{let{loadFromExternalAPI:s,loadFromBrowserSession:o}=t||"",d=[];t=e.querySelector("[data-custom-js-row=collection-row]");return t&&(e=t?t.cells:[],Object.values(e).map(t=>{let a=elementAttribute(t,"data-selected-column");var e=elementAttribute(t,"data-selected-response-map-column"),r=elementAttribute(t,"data-session-field"),n=(a.includes('"')&&(a=a.split("'").join('"')),elementAttribute(t,"type"));if(a&&(s?d[e||a]=n:o?d[r||a]=n:d[a]=n,"reference"===n||"multi_reference"===n||"createdBy"===n||"belongsTo"===n)){let e=elementAttribute(t,"metadata");!(e="createdBy"===n?e||null:e)&&i&&l&&i[l]?(i.hasBelongsToParentData=!0,d[a]={metaData:i,type:n}):d[a]={metaData:JSON.parse(e),type:n}}})),d},addDataTableDataToMap=async(e,t,a=!1,r=!1)=>{a?r&&dataTablePaginationDataMap.set("nonpersist_ptdata_"+t.id,e):dataTablePaginationDataMap.set("ptdata_"+t.id,e)},nextDataTablePage=async e=>{var t,a,r;e.currentPage+=1,e.externalApiId?({numberPerPage:t,offsetKey:a}=e,dataTablePaginationDataMap.get("nonpersist_ptdata_"+e.dataTable.id),e.enablePagination&&(r={},e.offsetValue+=a?t:"",e.pageOffsetValue=e.currentPage-1,e.isPaginated=!0,persistExternalApiDataTablePagination(e),persistDataTableNumberedPagination(e,e.currentPage),resetPaginationPageDropdownValue(e,e.currentPage),await loadExternalApiResponseDataList(e,r,!0))):(persistDataTablePagination(e,e.currentPage),persistDataTableNumberedPagination(e,e.currentPage),resetPaginationPageDropdownValue(e,e.currentPage),loadDataList(e))},firstDataTablePage=async e=>{var t,a;e.currentPage=1,e.externalApiId?(t=e.offsetKey,dataTablePaginationDataMap.get("nonpersist_ptdata_"+e.dataTable.id),e.enablePagination&&(a={},e.pageOffsetValue=e.currentPage-1,e.offsetValue=t?0:"",e.isPaginated=!0,persistExternalApiDataTablePagination(e),persistDataTableNumberedPagination(e,e.currentPage),resetPaginationPageDropdownValue(e,e.currentPage),await loadExternalApiResponseDataList(e,a,!0))):(persistDataTablePagination(e,e.currentPage),persistDataTableNumberedPagination(e,e.currentPage),resetPaginationPageDropdownValue(e,e.currentPage),loadDataList(e))},lastDataTablePage=async e=>{var t,a,r;e.currentPage=e.numberOfPages,e.externalApiId?({numberPerPage:t,offsetKey:a}=e,dataTablePaginationDataMap.get("nonpersist_ptdata_"+e.dataTable.id),e.enablePagination&&(r={},e.pageOffsetValue=e.currentPage,e.offsetValue=a?t:"",e.isPaginated=!0,persistExternalApiDataTablePagination(e),persistDataTableNumberedPagination(e,e.currentPage),resetPaginationPageDropdownValue(e,e.currentPage),await loadExternalApiResponseDataList(e,r,!0))):(persistDataTablePagination(e,e.currentPage),persistDataTableNumberedPagination(e,e.currentPage),resetPaginationPageDropdownValue(e,e.currentPage),loadDataList(e))},previousDataTablePage=async e=>{var t,a,r;--e.currentPage,e.externalApiId?({numberPerPage:t,offsetKey:a}=e,dataTablePaginationDataMap.get("nonpersist_ptdata_"+e.dataTable.id),e.enablePagination&&(r={},e.pageOffsetValue=e.currentPage-1,e.offsetValue-=a?t:"",e.isPaginated=!0,persistExternalApiDataTablePagination(e),persistDataTableNumberedPagination(e,e.currentPage),resetPaginationPageDropdownValue(e,e.currentPage),await loadExternalApiResponseDataList(e,r,!0))):(persistDataTablePagination(e,e.currentPage),persistDataTableNumberedPagination(e,e.currentPage),resetPaginationPageDropdownValue(e,e.currentPage),loadDataList(e))},specificDataTablePage=async(e,t)=>{var a,r,n;e.externalApiId?e.enablePagination&&({numberPerPage:a,offsetKey:r}=e,n={},e.currentPage=t,e.pageOffsetValue=t?t-1:0,e.offsetValue=r?e.pageOffsetValue*a:"",e.isPaginated=!0,persistDataTableNumberedPagination(e,t),resetPaginationPageDropdownValue(e,t),await loadExternalApiResponseDataList(e,n,!0)):(persistDataTableNumberedPagination(e,t),resetPaginationPageDropdownValue(e,t),e.currentPage=t,loadDataList(e))},specificDataTablePageFromSelect=(e,t)=>{e&&t&&$("#"+e).on("select2:select",function(e){e=e.params.data;e&&e.id?specificDataTablePage(t,Number(e.id)):specificDataTablePage(t,1)})},loadExternalApiPersistentPagination=(e,t)=>{var a,r,n;t&&({pageNumber:t,offsetValue:a,pageOffsetValue:r}=t,n={currentPage:t,offsetValue:a,pageOffsetValue:r,numberOfPages:1},e.currentPage=t,e.offsetValue=a,e.pageOffsetValue=r,e.numberOfPages=1,e.externalApiPersistentPagination={...n})},loadPersistentPagination=(e,t)=>{t&&(t=t.sessionCurrentPage,t)&&(e.persistentPagination={...{sessionCurrentPage:t}},e.currentPage=t)},resetPaginationPageDropdownValue=(e,t)=>{var e=(e||"").dataTable,e=elementSelector(e,"[data-gjs=pagination-number]");e&&e.hasAttribute("data-showpagepaginationdropdown")&&(e=e.id+"-pageSelect",$("#"+e).select2({selectionCssClass:":all:",width:"resolve"}).val(1===t?"":t).trigger("change"))},persistDataTableNumberedPagination=(t,a)=>{var r=(t||"").dataTable,r=elementSelector(r,"[data-gjs=pagination-number]");if(r){var n=r.hasAttribute("data-persistpagination"),r="dtPage-"+r.id;if(n){let e=sessionStorage.getItem("previousActionResponse");t.externalApiId?(n={pageNumber:t.currentPage||1,offsetValue:t.offsetValue||0,pageOffsetValue:t.pageOffsetValue||0},e?(e=JSON.parse(e),sessionStorage.setItem("previousActionResponse",JSON.stringify({...e,[r]:{...n}}))):sessionStorage.setItem("previousActionResponse",JSON.stringify({[r]:{...n}}))):e?(e=JSON.parse(e),sessionStorage.setItem("previousActionResponse",JSON.stringify({...e,[r]:a}))):sessionStorage.setItem("previousActionResponse",JSON.stringify({[r]:a}))}}},persistDataTablePagination=(e,t)=>{var a,e=(e||"").dataTable,e=elementSelector(e,"[data-gjs=pagination]");e&&(a=e.hasAttribute("data-persistpagination"),e="dtPage-"+e.id,a)&&(a={sessionCurrentPage:t},(t=sessionStorage.getItem("previousActionResponse"))?(t=JSON.parse(t),sessionStorage.setItem("previousActionResponse",JSON.stringify({...t,[e]:{...a}}))):sessionStorage.setItem("previousActionResponse",JSON.stringify({[e]:{...a}})))},persistExternalApiDataTablePagination=e=>{var t,a=(e||"").dataTable,a=elementSelector(a,"[data-gjs=pagination]");a&&(t=a.hasAttribute("data-persistpagination"),a="dtPage-"+a.id,t)&&(t=sessionStorage.getItem("previousActionResponse"),e.offsetValue+=e.numberPerPage,e={pageNumber:e.currentPage||1,offsetValue:e.offsetValue||0,pageOffsetValue:e.pageOffsetValue||0},t?(t=JSON.parse(t),sessionStorage.setItem("previousActionResponse",JSON.stringify({...t,[a]:{...e}}))):sessionStorage.setItem("previousActionResponse",JSON.stringify({[a]:{...e}})))},getAllSelectors=()=>{var t=[],a=Array.from(document.styleSheets).filter(e=>!e.href||e.href.startsWith(window.location.origin));for(let e=0;e<a.length;e++){var r,n=a[e].rules||a[e].cssRules;for(r in n)"string"==typeof n[r].selectorText&&t.push(n[r].selectorText)}return t},elementAttribute=(e,t)=>e.getAttribute(t),renderLineChart=async(r,n,t,a)=>{r.innerHTML="",r.children=[];let i=elementAttribute(r,"data-series"),l=elementAttribute(r,"data-xaxis"),s=elementAttribute(r,"externalQueryParamKeys");s=s&&s.split(",");var o=n.chartHeight||"350",d=parseFloat(elementAttribute(r,"data-y-axis-min"))||0,c=parseFloat(elementAttribute(r,"data-y-axis-max"))||void 0,u=elementAttribute(r,"data-x-axis-label-rotate"),p=elementAttribute(r,"data-y-axis-range1"),m=elementAttribute(r,"data-y-axis-range2"),g=elementAttribute(r,"data-background-color-range1"),b=elementAttribute(r,"data-background-color-range2"),g=convertColorForChartJs(g),b=convertColorForChartJs(b),f=n.strokeCurve||"straight",p=parseRange(p),m=parseRange(m),h=[];if(p&&g&&h.push({type:"box",yMin:p.y,yMax:p.y2,backgroundColor:g,borderWidth:0}),m&&b&&h.push({type:"box",yMin:m.y,yMax:m.y2,backgroundColor:b,borderWidth:0}),t&&a){p=(await getItemDataForElement(r)).itemData;let e=`collection-table/${t}/finder/${a}/items`;p&&(e=prepareItemDataAndExternalQueryParamForTable(s,e,p,r)),e=await addEntityQueryToUrl(e,t,a);g=await securedGetCall(e);if(0<g.data.length){let t=[],a=[];g.data.forEach(e=>{t.push(e[i]),a.push(e[l])});m=document.createElement("canvas"),b=(m.style.height=o+"px",r.appendChild(m),{type:"line",data:{labels:a,datasets:[{label:n.dataSeriesLabel||"Data",data:t,fill:!1,borderColor:"blue",backgroundColor:null}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:n.title||"Chart"},legend:{display:!1},tooltip:{mode:"index",intersect:!1},annotation:{annotations:h.reduce((e,t,a)=>(e["annotation"+a]={type:t.type,yMin:t.yMin,yMax:t.yMax,backgroundColor:t.backgroundColor,borderWidth:0},e),{})}},scales:{x:{title:{display:!0,text:n.xAxisTitle||""},ticks:{autoSkip:!1,maxRotation:u?parseInt(u):0,minRotation:u?parseInt(u):0}},y:{position:"left",title:{display:!0,text:n.yAxisTitle||""},min:d?parseFloat(d):0,max:c?parseFloat(c):void 0}}}});let e={};switch(f){case"smooth":case"spline":e={tension:.4,stepped:!1};break;case"straight":e={tension:0,stepped:!1};break;case"stepline":e={tension:0,stepped:"middle"};break;default:e={tension:.4,stepped:!1}}b.data.datasets[0]={...b.data.datasets[0],...e},new Chart(m,b)}}},renderAreaChart=async(r,n,t,a)=>{r.innerHTML="",r.children=[];let i=elementAttribute(r,"data-series"),l=elementAttribute(r,"data-xaxis"),s=elementAttribute(r,"externalQueryParamKeys");s=s&&s.split(",");var o=parseFloat(elementAttribute(r,"data-y-axis-min"))||0,d=parseFloat(elementAttribute(r,"data-y-axis-max"))||void 0,c=elementAttribute(r,"data-x-axis-label-rotate"),u=n.chartHeight||"350",p=elementAttribute(r,"data-y-axis-range1"),m=elementAttribute(r,"data-y-axis-range2"),g=elementAttribute(r,"data-background-color-range1"),b=elementAttribute(r,"data-background-color-range2"),g=convertColorForChartJs(g),b=convertColorForChartJs(b),f=n.strokeCurve||"straight",p=parseRange(p),m=parseRange(m),h=[];if(p&&g&&h.push({type:"box",yMin:p.y,yMax:p.y2,backgroundColor:g,borderWidth:0}),m&&b&&h.push({type:"box",yMin:m.y,yMax:m.y2,backgroundColor:b,borderWidth:0}),t&&a){p=(await getItemDataForElement(r)).itemData;let e=`collection-table/${t}/finder/${a}/items`;p&&(e=prepareItemDataAndExternalQueryParamForTable(s,e,p,r)),e=await addEntityQueryToUrl(e,t,a);g=await securedGetCall(e);if(0<g.data.length){let t=[],a=[];g.data.map(e=>{t.push(e[i]),a.push(e[l])});m=document.createElement("canvas"),b=(m.style.height=u+"px",r.appendChild(m),{type:"line",data:{labels:a,datasets:[{label:n.dataSeriesLabel||"Data",data:t,fill:!0,borderColor:"blue",backgroundColor:"rgba(0, 0, 255, 0.2)"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:n.title||"Chart"},legend:{display:!1},tooltip:{mode:"index",intersect:!1},annotation:{annotations:h.reduce((e,t,a)=>(e["annotation"+a]={type:t.type,yMin:t.yMin,yMax:t.yMax,backgroundColor:t.backgroundColor,borderWidth:0},e),{})}},scales:{x:{title:{display:!0,text:n.xAxisTitle||""},ticks:{autoSkip:!1,maxRotation:c?parseInt(c):0,minRotation:c?parseInt(c):0}},y:{position:"right",title:{display:!0,text:n.yAxisTitle||""},min:o?parseFloat(o):0,max:d?parseFloat(d):void 0}}}});let e={};switch(f){case"smooth":case"spline":e={tension:.4,stepped:!1};break;case"straight":e={tension:0,stepped:!1};break;case"stepline":e={tension:0,stepped:"middle"};break;default:e={tension:.4,stepped:!1}}b.data.datasets[0]={...b.data.datasets[0],...e},new Chart(m,b)}}},loadDataMapItems=async(e,t,a,r)=>{var n,i=elementAttribute(r,"data-map-lat"),l=elementAttribute(r,"data-map-long"),s=elementAttribute(r,"data-map-header"),o=elementAttribute(r,"data-map-description");r.innerHTML=`<div id="map-${r.id}" class="map"></div> <style>.map{
      height:100%;width:100%;
  }</style>`,t&&e&&(n=`collection-table/${t}/finder/${e}/items`,n=await addEntityQueryToUrl(n,t,e),t=await securedGetCall(n),e=new google.maps.Map(document.getElementById("map-"+r.id),{zoom:Number(a),center:new google.maps.LatLng(Number(t.data[0][i]),Number(t.data[0][l]))}),0<t.data.length)&&addMarkerInfo(t.data,e,i,l,s,o)},renderUrlColumnData=(e,t,a)=>{let r=t?e[t]:"";t=elementAttribute(a,"data-preview-icon");let n="",i="";if(!r)return"<td></td>";"object"==typeof(r="string"!=typeof r||r.startsWith("http")?r:"https://"+r)?(n=t?r[t]:!0===r.isPrivate?"https://drapcode-static.s3.amazonaws.com/img/placeholder-img.png":imageServerUrl()+r.key,i=r.originalName):"string"==typeof r&&r.startsWith("http")&&(n=r,i=r);var l,s,o,d,t=a?a.tagName:"";return t&&"IMG"===t?((l=a.cloneNode(!0)).src=n||l.src,!0===r.isPrivate&&addDownloadAttributeForPrivateFiles(l,r,e.uuid),`<td>${l.outerHTML}</td>`):t&&"A"===t?(l=document.createElement("a"),!0===r.isPrivate?addDownloadAttributeForPrivateFiles(l,r,e.uuid):l.href=n,l.innerText=i||n,a?((e=a.cloneNode(!0)).href=n,a.classList&&a.classList.contains("link-box")&&(d=(s=a.children?a.children[0]:"")?s.tagName:"")?"I"!==d&&(TEXT_COMPONENTS.includes(d)?((o=s.cloneNode(!0)).innerText=i||n,e.innerHTML=o.outerHTML):"IMG"===d?((o=s.cloneNode(!0)).src=n||o.src,e.innerHTML=o.outerHTML):e.innerText=i||n):e.innerText=i||n,`<td>${e.outerHTML}</td>`):`<td>${l.outerHTML}</td>`):t&&TEXT_COMPONENTS.includes(t)?((d=a.cloneNode(!0)).innerText=n||d.src,`<td>${d.outerHTML}</td>`):`<td>${n}</td>`},loadDataTableLocalStorage=async e=>{var{dataTable:t,fieldName:a,localStorageKey:r}=e,n=(console.log(`
 loadDataTableLocalStorage : ${r} 
`),t.querySelector("thead")),n=n.rows[0].cells.length,i=t.querySelector("[data-js=table-body]");e.tbodyElement=i,await setTableMetaData(e),hidePaginationButton(t),await loadLocalStorageDataList(r,a,e,i,n)},loadLocalStorageDataList=async(l,s,o,e,t)=>{var d="",l=(e.innerHTML="",addTablePlaceholder(o.numberPerPage||1,o.firstRowElements,e),parseLSJSONStrToJSON(l));if(l){let{columnsMap:e,firstRowElements:t,tbodyElement:a,collectionName:r,dataTable:n}=o;o=_.get(l,s),l=n.querySelector("thead");let i=[];[...l.rows[0].cells].forEach((e,t)=>{["reference","belongsTo"].includes(elementAttribute(e,"type"))&&i.push({fieldName:elementAttribute(e,"data-selected-column"),index:t})}),d+=await createTableRecords(o,e,t,r,!1,"",i),a.innerHTML=d}else e.innerHTML=`<tr class="no-record-data-table"><td class="text-center" colspan="${t}"></td></tr>`},loadDataTableFromBrowserSession=async(e,t)=>{var a,r,n,i,l,{browserSessionDataPath:s,dataTable:o}=t;t.loadFromBrowserSession=!0,s?(a=o.querySelector("thead").rows[0].cells.length,r=o.querySelector("[data-js=table-body]"),t.tbodyElement=r,await setTableMetaData(t),hidePaginationButton(o),await loadBrowserSessionDataList(s,t,r,a)):toastr.error("Data Path is required!","Error");for([n,i]of dataTableStylesMap)selectorExists(`[id^="${n}"]`)||(l=`*[id^="${n}"] `+i,addStyle(l))},loadBrowserSessionDataList=async(l,s,e,t)=>{var o="";e.innerHTML="",addTablePlaceholder(s.numberPerPage||1,s.firstRowElements,e);var d=window.sessionStorage.getItem("previousActionResponse"),d=d?JSON.parse(d):"";if(d&&"undefined"!==d){let{columnsMap:e,firstRowElements:t,tbodyElement:a,collectionName:r,dataTable:n}=s;s=getContentFromSessionObject(d,l),d=n.querySelector("thead");let i=[];[...d.rows[0].cells].forEach((e,t)=>{["reference","belongsTo"].includes(elementAttribute(e,"type"))&&i.push({fieldName:elementAttribute(e,"data-selected-column"),index:t})}),o+=await createTableRecords(s,e,t,r,!1,"",i),a.innerHTML=o}else e.innerHTML=`<tr class="no-record-data-table"><td class="text-center" colspan="${t}"></td></tr>`},processDataForPersistentPagination=(e,t,a)=>{var r=(e||"").externalApiPersistentPagination;!t&&r&&({offsetValue:t,pageOffsetValue:r}=r,a.externalApiItem?(a.externalApiItem.recordsOffset={offsetValue:t||0},a.externalApiItem.pageOffset={pageOffsetKey:e.pageOffsetKey||"",pageOffsetValue:r||0}):a.externalApiItem={recordsOffset:{offsetValue:t||0},pageOffset:{pageOffsetValue:r||0}})},loadUserTenantDropdown=(e,l)=>{if(e){var t=e.attributes["data-tenant-action"];let r=t?t.value:null,n=(e.removeAttribute("data-tenant-action"),e.querySelector("ul.dropdown-menu")),i=n?n.querySelector("a.dropdown-item"):"";isLoggedInUser()&&(t=fetchLoggedInUserJson()).tenantId&&t.tenantId.length&&(n.innerHTML="",t.tenantId.forEach((e,t)=>{var a=i.cloneNode(!0);a.text=l?e[l]:e.uuid,a.setAttribute("id",""+i.id+(t+1)),a.setAttribute("data-tenant-id",e.uuid),a.setAttribute("onclick",r),n.appendChild(a)}))}},loadCalendarComponent=async(e,t)=>{var{collectionName:a,finderId:r,searchComponent:n,externalQueryParamKeys:i}=t||"";let l=(t||"").calendarChildren;l=l||e.children;var s=findComponentIndex(l,"search-form");let o=findComponentIndex(l,"calendar-placeholder");(!o||o<0)&&(o=!n||s?0:1);var d=e.id,c=(e.children[o].setAttribute("id","calendar-"+d),e.dataset);let u="",p="",m="",g="",b="",f="",h="",v="",y="",A="",S="",E="";switch(c&&(u=c.onclick??"",p=c.eventTitle??"",g=c.eventDate??"",m=c.eventStarttime??"",b=c.eventEndtime??"",f=c.eventUrl??"",h=c.eventDuration??"",y=c.calendarView??"",A=c.eventTextColor??"",S=c.eventBgColor??"",E=c.eventBorderColor??""),h){case"15_MINS":v="00:15";break;case"30_MINS":v="00:30";break;case"60_MINS":v="01:00"}e.children[o]&&e.children[o].remove();c=(await getItemDataForElement(e)).itemData;r&&a&&r&&(C=`collection-table/${a}/finder/${r}/items/count`,console.log("ðŸš€ ~ loadCalendarComponent ~ collectionItemEndpoint #1:",C),C=prepareItemDataAndExternalQueryParam(i,C,c,e),console.log("ðŸš€ ~ loadCalendarComponent ~ collectionItemEndpoint #2:",C),e=await securedGetCall(C),console.log("ðŸš€ ~ loadCalendarComponent ~ response:",e));let T="dayGridMonth";y&&(T=y);var C=document.getElementById(d);let D=!1;try{new FullCalendar.Calendar(C,{}),D=!0}catch(e){console.log("ðŸš€ ~ file: dataLoader.js:6230 ~ loadCalendarComponent ~ error:",e)}e={eventTitleField:p,eventStartTimeField:m,eventEndTimeField:b,eventUrlField:f,onClickEvent:u,eventDateField:g,eventTextColorField:A,eventBgColorField:S,eventBorderColorField:E};console.log("ðŸš€ ~ loadCalendarComponent ~ isFullCalendarScriptExist:",D),D&&(loadCalendarComponentInDOM(C,t,T,v,a,r,e,i,c),n)&&(0<s?C.insertBefore(n,null):C.insertBefore(n,C.children[0]))};function loadCalendarComponentInDOM(t,r,e,a,n,i,l,s,o){let d=(l||{}).onClickEvent,c=(r||"").searchComponent,u=new FullCalendar.Calendar(t,{initialView:e,slotDuration:a||"00:15",overlap:!0,interactive:!0,events:async function(e,t,a){e=await loadCalendarEvents(e,r,n,i,l,s,o);console.log("ðŸš€ ~ file: dataLoader.js:6324 ~ calendarEvents:",e),e?t(e):a("No events!")},eventDisplay:"block",dayMaxEvents:!0,navLinks:!0,customButtons:{customSearch:{text:"Search",click:function(){console.log("ðŸš€ ~ loadCalendarComponent ~ clicked customSearch..."),u.refetchEvents()}}},headerToolbar:{left:`prev,next ${c?"customSearch ":""}today`,center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},eventTimeFormat:{hour:"numeric",minute:"2-digit",meridiem:"short"},viewDidMount:function(e){c&&t.querySelectorAll(".fc-button").forEach(e=>{"Search"===e.innerText&&(e.classList.add("d-none"),e.setAttribute("style","display:none"))})},eventDidMount:function(e){var{backgroundColor:t,borderColor:a}=e||"";let r="";t&&(r+=`background-color:${t};`),a&&(r+=`border-color:${a};`),n&&e.event.id&&(e.el.setAttribute("data-collection-id",n),e.el.setAttribute("data-item-id",e.event.id)),d?(r+="cursor:pointer;",e.el.setAttribute("title",`Click to view ${e.event.title||""} details`),e.el.setAttribute("style",r)):e.event.title&&(e.el.setAttribute("title",e.event.title),r)&&e.el.setAttribute("style",r)},eventClick:function(e){d&&(e.jsEvent.preventDefault(),new Function("return "+d)())}});u.render()}async function loadCalendarEvents(a,r,l,s,o,d,c){let{eventTitleField:u,eventStartTimeField:p,eventEndTimeField:m,eventUrlField:g,eventDateField:b,eventTextColorField:f,eventBgColorField:h,eventBorderColorField:v}=o||{},y=[];if(l&&s){let e=[];var{searchComponent:o,event:A,originalCalendar:S}=r||"";console.log("ðŸš€ ~ loadCalendarEvents searchComponent:",o," ~ event:",A);let t=`collection-table/${l}/finder/${s}/items`;console.log("ðŸš€ ~ loadCalendarEvents endpoint #1:",t),t=prepareItemDataAndExternalQueryParam(d,t,c,S),console.log("ðŸš€ ~ loadCalendarEvents endpoint #2:",t);A=t.includes("?");console.log("ðŸš€ ~ loadCalendarEvents hasParam:",A);let n=document.getElementById("dateTimeFormat").innerText||"YYYY-MM-DD",i=(console.log("ðŸš€ ~ loadCalendarEvents ~ dateFormat:",n),n+"THH:mm:ss");console.log("ðŸš€ ~ loadCalendarEvents ~ dateTimeFormat:",i);var{start:d,end:c}=a,S=moment(d).format(n),a=moment(c).format(n),d=(b?(S&&(t+=A?`&start_${b}=`+S:`?start_${b}=`+S),a&&(t+=`&end_${b}=`+a)):(p&&S&&(t+=A?`&start_${p}=`+S:`?start_${p}=`+S),p&&a&&(m?t+=`&end_${m}=`+a:t+=`&end_${p}=`+a)),o&&(r.searchString=convertQueryStringFromFormElements(o),console.log("ðŸš€ ~ loadCalendarEvents calendarDataObj:",r),r.searchString)&&(t+="&"+r.searchString),t=await addEntityQueryToUrl(t,l,s),console.log("ðŸš€ ~ loadCalendarEvents endpoint #3:",t),await securedGetCall(t));(e=d&&200===d.status?d.data:e)&&e.map(e=>{var t,a,r={};r.id=e.uuid,u&&(u.includes('"')&&"functionType"in JSON.parse(u)?r.title=getDerivedFieldData(u,e):r.title=e[u]||""),b&&e[b]?(r.start=e[b],r.end=e[b],r.start&&!r.start.includes("T")&&p&&e[p]&&((a=e[p])&&a.includes("T")?(t=a.split("T"),r.start=r.start+"T"+t[1]):a&&a.includes(":")&&(r.start=r.start+"T"+a)),r.end&&!r.end.includes("T")&&m&&e[m]&&((t=e[m])&&t.includes("T")?(a=t.split("T"),r.end=r.end+"T"+a[1]):t&&t.includes(":")&&(r.end=r.end+"T"+t))):(p&&e[p]&&(r.start=e[p]),m&&e[m]&&(r.end=e[m])),g&&e[g]&&(r.url=e[g]),r.start&&(r.start.includes("T")?r.start=moment(r.start,i).toDate().getTime():r.start=moment(r.start,n).toDate().getTime()),r.end&&(r.end.includes("T")?r.end=moment(r.end,i).toDate().getTime():r.end=moment(r.end,n).toDate().getTime()),f&&(f.includes('"')&&"functionType"in JSON.parse(f)?r.textColor=getDerivedFieldData(f,e):r.textColor=e[f]||""),h&&(h.includes('"')&&"functionType"in JSON.parse(h)?r.backgroundColor=getDerivedFieldData(h,e):r.backgroundColor=e[h]||""),v&&(v.includes('"')&&"functionType"in JSON.parse(v)?r.borderColor=getDerivedFieldData(v,e):r.borderColor=e[v]||""),y.push(r)})}return y}async function searchInCalendar(e){var t=(void 0!==e.event&&(t=e.event.target,e.searchString=convertQueryStringFromFormElements(t)),e).searchComponent;let a="";(a=t?t.closest('[data-js="calendar"]'):a)&&(e=a.querySelector(".fc-customSearch-button"))&&e.click()}let autoSearchInCalendarDataSearch=(e,l)=>{if(console.log("ðŸš€ ~ autoSearchInCalendarDataSearch ~ search:",l),console.log("ðŸš€ ~ autoSearchInCalendarDataSearch ~ enableAutoSearch:",e),e){let r=l.querySelector('[type=submit]:not([value="export"]');console.log("ðŸš€ ~ autoSearchInCalendarDataSearch ~ searchFormSubmitBtn:",r),r||((e=document.createElement("button")).role="button",e.type="submit",e.style.cssText+="height:1px !important;width: 1px !important;overflow: hidden !important;padding: 0 !important;position: absolute !important;border: 0 !important",l.appendChild(e),r=e);let n=["INPUT","SELECT","DIV"],i=[16,17,18,33,34,35,36,37,38,39,40,224,229];console.log("ðŸš€ ~ autoSearchInCalendarDataSearch ~ searchFormSubmitBtn:",r),r&&0<l.childNodes.length&&l.childNodes.forEach(t=>{console.log("ðŸš€ ~ autoSearchInCalendarDataSearch ~ search.childNodes.forEach ~ searchChildNode:",t);var e=t.tagName,a=t.id;n.includes(e)&&("INPUT"===e&&(findModalParent(l)&&(checkForDateType("[id^=modal-container]"),checkForDateType("[data-subpage-id]")),t.hasAttribute("flat-picker-date-type")?t.addEventListener("change",function(e){e.preventDefault(),r&&r.click(),t.blur()}):t.addEventListener("keyup",function(e){e.preventDefault(),e.isComposing||i.includes(e.keyCode)||r&&r.click()})),"SELECT"===e&&a&&$("#"+a).on("select2:select",function(e){e.preventDefault(),r&&r.click()}),"DIV"===e)&&t.querySelector("[class*=iti--allow-dropdown] input[type=tel]")&&t.addEventListener("keyup",function(e){e.preventDefault(),e.isComposing||i.includes(e.keyCode)||r&&r.click()})})}},loadTimeslotComponent=async(m,e)=>{console.log("ðŸš€ ~ file: dataLoader.js:6251 ~ loadTimeslotComponent ~ timeslotComp:",m),console.log("ðŸš€ ~ file: dataLoader.js:6251 ~ loadTimeslotComponent ~ timeslotDataObj:",e);let g=m.id;var t="timeslot-"+g,a="timeslot-col-"+g;m.children[0].setAttribute("id",t);let b=m.closest("form");var f=m.dataset;let h="",v="",y="",r="",A="",S="",E=!1;var t=window.sessionStorage,n=t.getItem(SESSION_RESPONSE_KEY),t=t.getItem(SESSION_FORM_DATA_KEY),T=n?JSON.parse(n):"",C=t?JSON.parse(t):"";let{collectionName:D,finderId:I,timeSlotMetaFieldFrom:i}=e||"";switch(f&&(h=f.eventStarttime??"",v=f.eventEndtime??"",y=f.eventDuration??"",E=f.hasOwnProperty("overlapSlots")),i){case"sessionUser":let e="",t="";f&&(e=f.sessionUserStart??"",t=f.sessionUserEnd??""),isLoggedInUser()&&(N=fetchLoggedInUserJson(),P=_.get(N,e),N=_.get(N,t),A=P?Number(P):10,S=N?Number(N):22);break;case"sessionTenant":let a="",r="";f&&(a=f.sessionTenantStart??"",r=f.sessionTenantEnd??""),isLoggedInUser()&&(P=fetchCurrentTenantJson(),N=_.get(P,a),P=_.get(P,r),A=N?Number(N):10,S=P?Number(P):22);break;case"sessionUserSettings":let n="",i="";f&&(n=f.sessionUserSettingsStart??"",i=f.sessionUserSettingsEnd??""),isLoggedInUser()&&(N=fetchCurrentUserSettingsJson(),P=_.get(N,n),N=_.get(N,i),A=P?Number(P):10,S=N?Number(N):22);break;case"collection":let l="",s="";f&&(l=f.collectionFieldStart??"",s=f.collectionFieldEnd??"");var P=(await getPageItemData()).itemData,N=_.get(P,l),P=_.get(P,s);A=N?Number(N):10,S=P?Number(P):22;break;case"previousActionResponse":let o="",d="";f&&(o=f.previousActionResponseStart??"",d=f.previousActionResponseEnd??""),T&&"undefined"!==T&&(N=getContentFromSessionObject(T,o),P=getContentFromSessionObject(T,d),A=N?Number(N):10,S=P?Number(P):22);break;case"previousActionFormData":let c="",u="";f&&(c=f.previousActionFormdataStart??"",u=f.previousActionFormdataEnd??""),C&&"undefined"!==C&&(N=getContentFromSessionObject(C,c),P=getContentFromSessionObject(C,u),A=N?Number(N):10,S=P?Number(P):22);break;case"browserStorage":let p="",m="",g="";f&&(p=f.storageKey??"",m=f.browserStorageStart??"",g=f.browserStorageEnd??"");N=parseLSJSONStrToJSON(p),P=N?parseValueFromData(N,m):"",N=N?parseValueFromData(N,g):"";A=P?Number(P):10,S=N?Number(N):22;break;default:A=f&&f.fixedDayStartAt?Number(f.fixedDayStartAt):10,S=f&&f.fixedDayEndAt?Number(f.fixedDayEndAt):22}switch(y){case"15_MINS":r="00:15";break;case"30_MINS":r="00:30";break;case"60_MINS":r="01:00"}n=document.createElement("div");n.id=a,n.classList.add("w-75","p-0"),m.innerHTML="",m.appendChild(n);let x="",l=(I&&D&&I&&(x=`collection-table/${D}/finder/${I}/items/count`,t=await securedGetCall(x),console.log("ðŸš€ ~ file: dataLoader.js:6201 ~ loadTimeslotComponent ~ response:",t)),createLoggerDateFormat());e=document.getElementById(a);let w=new FullCalendar.Calendar(e,{initialView:"dayGridMonth",height:"auto",slotDuration:r||"00:15",timezone:"local",overlap:E,interactive:!0,events:[],eventDisplay:"block",dayMaxEvents:!0,nowIndicator:!0,selectable:!0,headerToolbar:{left:"prev,next",center:"title",right:"today"},unselectAuto:!1,unselectCancel:".timeslot-link",validRange:{start:l},select:async function(a){let r=[];if(I){let e=[];D&&I&&(x=`collection-table/${D}/finder/${I}/items`,a.startStr&&(x+=`?${h}=`+a.startStr),x=await addEntityQueryToUrl(x,D,I),console.log("ðŸš€ ~ file: dataLoader.js:6425 ~ collectionItemEndpoint:",x),t=await securedGetCall(x),console.log("ðŸš€ ~ file: dataLoader.js:6425 ~ SELECT response:",t),(e=t&&200===t.status?t.data:e).forEach(e=>{var t={};t.id=e.uuid,h&&e[h]&&(t.start=e[h]),v&&e[v]&&(t.end=e[v]),r.push(t)}))}console.log("ðŸš€ ~ file: dataLoader.js:6449 ~ SELECT calendarEvents:",r);var t=a.start.getDate(),e=a.start.toLocaleDateString("en-US",{weekday:"short"});let n="timeslots-container-"+g,i=document.getElementById(n);var l=document.createElement("hr"),s=(l.classList.add("my-1"),document.createElement("h6")),o=(s.innerHTML=`<span>${e},</span> <span class='text-black-50' style='font-size: medium;'>${t}${nthOrdinalNumber(t)}</span>`,i?i.innerHTML="":((i=document.createElement("div")).id=n,i.classList.add("timeslots-container","w-25","mt-1","fc","fc-media-screen","fc-direction-ltr","pr-0","pl-2","pe-0","ps-2")),i.appendChild(s),i.appendChild(l),document.createElement("ul"));o.classList.add("list-unstyled","mt-4","px-2"),o.style.maxHeight="20em",o.style.overflow="auto";let d=30;switch(y){case"15_MINS":d=15;break;case"30_MINS":d=30;break;case"60_MINS":d=60}e=60*A,t=60*S,s=generateHoursInterval(e,t,d),l=r.filter(e=>e.start.includes(a.startStr));let c=l&&l.length?l.map(e=>{let t=moment(e.start);return t=t.format("HH:mm")}):[];e=E?s:s.filter(e=>!c.includes(e)),t=h+"-"+b.id,l=v+"-"+b.id,s=b.querySelector(`[id=${t}]`),t=b.querySelector(`[id=${l}]`);if(s&&s.remove(),t&&t.remove(),e&&e.length){for(let t of e){var u=document.createElement("li"),p=(u.classList.add("timeslot","py-1"),document.createElement("a"));p.href="javascript:void(0)",p.classList.add("timeslot-link","timeslot-link-1","btn","btn-outline-dark","btn-sm","w-100"),p.textContent=t,u.appendChild(p),p.addEventListener("click",e=>{e.preventDefault(),selectedTimeSlot(e.target,n,b,h,v,a,t,d)}),o.appendChild(u)}i.appendChild(o),m.appendChild(i),w.updateSize()}},unselect:function(e){e=(e||"").jsEvent;let t=(e||"").srcElement;t&&"td"!==t.tagName&&(t=t.closest("td"));var a,r,n,e="timeslots-container-"+g,e=document.getElementById(e);t&&({dataset:a,outerText:r}=t||"",n=t.classList.contains("timeslot-link"),!e||a.date||n)||w.select(l)}});w.render(),w.select(l)},loadChatComponent=async(t,a)=>{var{nameField:a,imageField:r,finderUuid:n}=a,a={nameField:a,avatarField:r,messageField:"message",currentUser:fetchLoggedInUserJson()};let i=[];r=await securedGetCall(`collection-table/user/finder/${n}/items`);if((i=r&&200===r.status?r.data:i)&&0!==i.lenght){var n=document.createElement("div"),r=(n.setAttribute("class","list-group"),n.setAttribute("id","chat-rooms"),document.createElement("div")),l=(r.setAttribute("class","chat-messages p-4"),r.setAttribute("id","chat-messages-container"),document.createElement("div")),s=(l.setAttribute("class","flex-grow-1 my-3"),await prepareSearchList(l,i,a),document.createElement("div")),l=(s.setAttribute("class","d-flex align-items-center"),s.appendChild(l),document.createElement("div")),s=(l.setAttribute("class","px-4 d-none d-md-block"),l.appendChild(s),document.createElement("div")),l=(s.setAttribute("class","col-12 col-lg-5 col-xl-3 border-end"),s.appendChild(l),s.appendChild(n),document.createElement("hr")),n=(l.setAttribute("class","d-block d-lg-none mt-1 mb-0"),s.appendChild(l),document.createElement("div")),l=(n.setAttribute("class","position-relative"),n.appendChild(r),document.createElement("div")),r=(l.setAttribute("class","flex-grow-0 py-3 px-4 border-top"),await prepareMessageInput(l,i,a),document.createElement("div")),o=(r.setAttribute("class","py-2 px-4 border-bottom d-none d-lg-block"),document.createElement("div")),o=(o.setAttribute("class","d-flex align-items-center py-1"),o.setAttribute("id","current-room-user"),r.appendChild(o),document.createElement("div")),r=(o.setAttribute("class","col-12 col-lg-7 col-xl-9"),o.appendChild(r),o.appendChild(n),o.appendChild(l),document.createElement("div")),n=(r.setAttribute("class","row g-0"),r.appendChild(s),r.appendChild(o),document.createElement("div")),l=(n.setAttribute("class","card"),n.appendChild(r),t.replaceChild(n,t.children[0]),document.getElementById("chat-rooms"));l.innerHTML='<div class="drapcode-item placeholder"><div class="drapcode-col-12"><div class="drapcode-row"><div class="drapcode-col-2 big"></div><div class="drapcode-col-2 empty big"></div><div class="drapcode-col-8 big"></div></div></div></div><div class="drapcode-item placeholder"><div class="drapcode-col-12"><div class="drapcode-row"><div class="drapcode-col-2 big"></div><div class="drapcode-col-2 empty big"></div><div class="drapcode-col-8 big"></div></div></div></div>';let e=[];s=await securedGetCall("chats/load-rooms");e=(e=s&&200===s.status?s.data:e)||[],l.innerHTML="",await prepareChatList(e,i,a),$("#chat-user-list").select2({placeholder:"Select User"}),setInterval(loadRoomMessages,15e3,i,a)}},loadRoomMessages=async(t,a)=>{let e=[];var r="chats/load-messages/"+parseLSJSONStrToJSON("selected-room").uuid,r=await securedGetCall(r);0<(e=(e=r&&200===r.status?r.data:e)||[]).length&&(document.getElementById("chat-messages-container").innerHTML=""),e.forEach(async e=>prepareMessage(e,t,a))},prepareSearchList=async(e,t,a)=>{var{nameField:r,currentUser:n}=a,i=document.createElement("select"),l=(i.setAttribute("class","form-control"),i.setAttribute("id","chat-user-list"),document.createElement("option"));l.value="",l.text="Search User",i.appendChild(l);for(var s=0;s<t.length;s++){var o=document.createElement("option"),d=t[s];n.uuid!==d.uuid&&(o.value=d.uuid,o.text=d[r],i.appendChild(o))}i.onchange=function(){var e={type:"user",value:this.value};createOrLoadMessagesOfRooms(e,t,a)},e.appendChild(i)},prepareChatList=async(e,t,a)=>{e.forEach(async e=>prepareRoom(e,t,a))},prepareRoom=async(n,i,l)=>{if(n){var s,o,d,c=n.recipients;if(c&&0!==c.length){let{nameField:e,avatarField:t,currentUser:a}=l,r=c.filter(e=>e!=a.uuid);r&&0!==r.length&&(c=i.find(e=>e.uuid===r[0]),o=document.createTextNode(c[e]),(s=document.createElement("div")).setAttribute("class","flex-grow-1 ms-3"),s.appendChild(o),o=imageServerUrl()+c[t].key,(d=document.createElement("IMG")).setAttribute("src",o),d.setAttribute("alt",c[e]),d.setAttribute("width","40"),d.setAttribute("height","40"),d.setAttribute("class","rounded-circle me-1"),(o=document.createElement("div")).setAttribute("class","d-flex align-items-start"),o.appendChild(d),o.appendChild(s),(c=document.createElement("A")).setAttribute("href","javascript:void(0)"),c.setAttribute("class","list-group-item list-group-item-action border-0"),c.appendChild(o),c.onclick=function(){setJsonInLocalStorage("selected-room",n),processSelectedChatRoom(i,l),getSiblings(this).forEach(e=>e.classList.remove("active")),this.classList.add("active")},(d=parseLSJSONStrToJSON("selected-room"))&&d.uuid===n.uuid&&c.onclick(),document.getElementById("chat-rooms").appendChild(c))}}},getSiblings=t=>{var a=[];if(t.parentNode){let e=t.parentNode.firstChild;for(;e;)1===e.nodeType&&e!==t&&a.push(e),e=e.nextSibling}return a},processSelectedChatRoom=async(t,a)=>{await prepareCurrentUserProfile(t,a);document.getElementById("chat-messages-container").innerHTML="";var e=parseLSJSONStrToJSON("selected-room");let r=[];e="chats/load-messages/"+e.uuid,e=await securedGetCall(e);(r=(r=e&&200===e.status?e.data:r)||[]).forEach(async e=>prepareMessage(e,t,a))},createOrLoadMessagesOfRooms=async(e,t,a)=>{let r=null,n=!1;var i;"user"===e.type?(i=e.value,(i=await securedPostCall({userId:i},"chats/create-rooms"))&&200===i.status&&(r=i.data.room,n=i.data.isNew),n&&await prepareRoom(r,t,a)):"room"===type&&(i="chats/load-room/"+e.value,t=await securedGetCall(i))&&200===t.status&&(r=t.data),console.log("selectedRoom",r),r},prepareCurrentUserProfile=async(e,a)=>{let{avatarField:r,nameField:n,currentUser:i}=a;a=document.createElement("div");if(a.setAttribute("class","position-relative"),e&&0!==e.length){var l=parseLSJSONStrToJSON("selected-room");if(console.log("selectedRoom",l),l){let t=l.recipients.filter(e=>e!==i.uuid);t=t[0];var l=e.filter(e=>e.uuid===t)[0],e=document.createElement("IMG"),s=imageServerUrl()+l[r].key,s=(e.setAttribute("src",s),e.setAttribute("alt",l[n]),e.setAttribute("width","40"),e.setAttribute("height","40"),e.setAttribute("class","rounded-circle me-1"),document.createElement("div")),o=(s.setAttribute("class","flex-grow-1 pl-3"),document.createElement("strong")),l=document.createTextNode(l[n]),l=(o.appendChild(l),s.appendChild(o),a.appendChild(e),document.getElementById("current-room-user"));l.innerHTML="",l.appendChild(a),l.appendChild(s)}}},prepareMessage=async(a,r,n)=>{var{avatarField:n,nameField:i,currentUser:l}=n,r=r.find(e=>e.uuid===a.createdBy);let s,o,d="chat-message-left";if(r){let e=r[i],t=imageServerUrl()+r[n].key;l.uuid===a.createdBy&&(d="chat-message-right",e="You",t=imageServerUrl()+l[n].key),s=document.createTextNode(e),(o=document.createElement("IMG")).setAttribute("src",t),o.setAttribute("alt",e),o.setAttribute("width","40"),o.setAttribute("height","40"),o.setAttribute("class","rounded-circle me-1"),l.uuid===a.createdBy&&(d="chat-message-right")}i=document.createElement("div"),i.setAttribute("class","font-weight-bold mb-1"),i.appendChild(s),r=document.createTextNode(a.message),n=document.createElement("div"),n.setAttribute("class","flex-shrink-1 bg-light rounded py-2 px-3 mr-3"),n.appendChild(i),n.appendChild(r),l=document.createElement("div"),l.setAttribute("class",d+" pb-4"),i=document.createElement("div"),o&&(i.appendChild(o),l.appendChild(i)),l.appendChild(n),r=document.getElementById("chat-messages-container");r.appendChild(l),r.scrollTop=r.scrollHeight},prepareMessageInput=async(e,t,a)=>{let r=document.createElement("input");r.setAttribute("class","form-control"),r.setAttribute("type","text"),r.setAttribute("placeholder","Type your message");var n=document.createTextNode("Send"),i=document.createElement("button"),n=(i.setAttribute("class","btn btn-primary"),i.appendChild(n),i.onclick=async function(){await sendMessageToServer(r,t,a)},document.createElement("div"));n.setAttribute("class","input-group"),n.appendChild(r),n.appendChild(i),e.appendChild(n)},sendMessageToServer=async(e,t,a)=>{let r={message:e.value,roomId:parseLSJSONStrToJSON("selected-room").uuid};var n=await securedPostCall(r,"chats/save-message");n&&200===n.status&&(r=n.data),await prepareMessage(r,t,a),e.value=""},getColorBadges=(a,s,o)=>{if(a){var d=elementAttribute(a,"data-sort-field"),c=elementAttribute(a,"data-allowed-field"),u=elementAttribute(a,"data-field-type");let e=elementAttribute(a,"data-color-field");var p=elementAttribute(a,"data-reference-field"),u=("reference"===u&&(e=s+"."+e,s=s+"."+p),s?parseValueFromData(o,s):""),p=e?parseValueFromData(o,e):"",s=a.cloneNode(!0),o=(a.innerHTML="",s.children);let t=[],r,n=(t=u?Array.isArray(u)?u:u.split(","):"",r=p?Array.isArray(p)?p:p.split(","):"",d&&("ALPHABETICALLY"===d?t=t.sort():"REVERSE_ALPHABETICALLY"===d?t=t.sort().reverse():"RANDOM"===d&&(t=_.shuffle(t))),c&&0<+c&&t.length>c&&(t=t.slice(0,+c)),/^#(?:[0-9a-fA-F]{3}){1,2}$/),i="",l=o&&o[0]?o[0].cloneNode(!0):document.createElement("span");return t.forEach((e,t)=>{var a=!!r&&n.test(r[t]);"none"===l.style.display&&(l.style.display=""),a&&(l.style.backgroundColor=r[t]),i+=setColumnDataIntoHtmlElement(e,l)}),i||(l.style.display="none",l.textContent="",i+=l.outerHTML),setColumnDataIntoHtmlElement(i,a,!0)}return""},loadChatBotMessageComponent=async(n,i)=>{console.log("loadChatBotMessageComponent");var{}=i;let{itemData:e,collectionId:t,collectionItemId:l}=await getPageItemData();if("chatgpt_chatbot"===t&&e){var i=document.createElement("div"),s=(i.setAttribute("class","chatbox-wrapper"),document.createElement("div"));s.setAttribute("class","chatbox-toggle"),s.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-gjs="drapcode-icons-svg" draggable="false" class="feather feather-message-square"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z">
  </path></svg>`;let e=document.createElement("div");e.setAttribute("class","chatbox-message-wrapper");var o=document.createElement("div"),d=(o.setAttribute("class","d-flex align-items-center justify-content-between chatbox-message-header"),document.createElement("h4")),c=(d.setAttribute("class","chatbox-message-name"),d.textContent="Send your message",document.createElement("div")),u=(c.setAttribute("class","chatbox-message-dropdown"),c.innerHTML='<svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',document.createElement("button")),p=(u.setAttribute("class","btn btn-danger btn-sm chatbox-btn-danger"),u.textContent="End Chat",localStorage.getItem("selected-chatbot-room")),p=(p||(u.style.display="none"),o.append(d),o.append(u),o.append(c),document.createElement("div"));p.setAttribute("class","chatbox-message-content");let t=document.createElement("div");t.setAttribute("class","chatbox-message-content"),await loadChatBotMessages(t,!0),p.append(t),u.addEventListener("click",function(){cleanChatBotRoomAndClearMessage(t),this.style.display="none"});d=document.createElement("div");d.setAttribute("class","chatbox-message-bottom");let a=document.createElement("form"),r=(a.setAttribute("class","chatbox-message-form"),document.createElement("textarea"));r.setAttribute("class","chatbox-message-input"),r.setAttribute("rows","1"),r.setAttribute("placeholder","Type message.."),r.addEventListener("input",function(){var e=r.value.split("\n").length;(r.rows<6||e<6)&&(r.rows=e),1<r.rows?a.style.alignItems="flex-end":a.style.alignItems="center"}),a.append(r);u=document.createElement("button");u.setAttribute("class","chatbox-message-submit"),u.setAttribute("type","submit"),u.innerHTML='<svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>',a.append(u),a.addEventListener("submit",async function(e){e.preventDefault(),isValid(r.value)&&(await sendChatBotMessageToServer(l,t,r.value),a.style.alignItems="center",r.rows=1,r.focus(),r.value="")}),d.append(a),e.append(o),e.append(p),e.append(d),s.addEventListener("click",function(){e.classList.toggle("show")}),c.addEventListener("click",function(){e.classList.toggle("show")}),i.append(s),i.append(e),n.replaceChild(i,n.children[0]),setInterval(loadChatBotMessages,3e4,t,!1)}},cleanChatBotRoomAndClearMessage=async e=>{e.innerHTML="",localStorage.removeItem("selected-chatbot-room")},loadChatBotMessages=async(t,a)=>{if(localStorage.getItem("selected-chatbot-room")){var r=parseLSJSONStrToJSON("selected-chatbot-room"),n=localStorage.getItem("last-message-time");if(n||a){n=moment(n);if(moment(moment().format()).diff(n)/1e3<120||a){let e=[];n="chatbot/chats/load-messages/"+r.uuid,a=await securedGetCall(n);a&&200===a.status&&(e=a.data),console.log("messages",e),t.innerHTML="",e.forEach(e=>createMessageForChatBot(t,e))}else console.log("No new message from user in last 2 mins")}else console.log("no message is sent")}},sendChatBotMessageToServer=async(e,t,a)=>{let r=localStorage.getItem("selected-chatbot-room");r?r=parseLSJSONStrToJSON("selected-chatbot-room"):(r=await createChatBotRoom(e),setJsonInLocalStorage("selected-chatbot-room",r),document.getElementsByClassName("chatbox-btn-danger")[0].style.display="block");let n={message:a,roomId:r.uuid};e=await securedPostCall(n,"chatbot/chats/save-message");e&&200===e.status&&(n=e.data),localStorage.setItem("last-message-time",moment().format()),createMessageForChatBot(t,n)},createChatBotRoom=async e=>{e=await securedPostCall({chatBotId:e},"chatbot/chats/create-room");let t=null;return(t=e&&200===e.status?e.data:t).room},isValid=e=>{let t=e.replace(/\n/g,"");return 0<(t=t.replace(/\s/g,"")).length},createMessageForChatBot=(e,t)=>{var{message:t,createdAt:a,message_from:r}=t,r="USER"===r,n=document.createElement("div"),r=(n.setAttribute("class","chatbox-message-item "+(r?"sent":"received")),document.createElement("span")),t=(r.setAttribute("class","chatbox-message-item-text"),r.textContent=t,document.createElement("span"));t.setAttribute("class","chatbox-message-item-time"),a&&(a=moment(a).fromNow(),t.textContent=a),n.append(r),n.append(t),e.append(n),e.scrollTop=e.scrollHeight},loadTOTPComponent=async(e,t)=>{var a,r,n;isLoggedInUser()&&(a=fetchLoggedInUserJson())&&(r=a.is_secret_code_verify,r?showResetSecurityButton(e,a):(r=await axios.get("/generate-secret-code",{}))&&200===r.status&&(n=((r=r.data).user||"").userDetails,n&&(delete n._id,delete n.password,delete n.secret_code,n={...a,...n},setJsonInLocalStorage("user",n)),createFormForSecurityVerification(e,r.url,a)))},showResetSecurityButton=(a,r)=>{var e=document.createElement("form"),t=(e.setAttribute("class","form-container"),document.createElement("button"));t.setAttribute("class","btn btn-danger"),t.setAttribute("type","submit"),t.innerText="Reset Authentication",e.appendChild(t),e.addEventListener("submit",async function(e){e.preventDefault();var t,e=await axios.post("/reset-secret-code",{},{});e&&200===e.status&&(e=e.data,console.log("check after reset resData",e),e.success)&&(delete(t=e.user.userDetails)._id,delete t.password,t={...r,...t},setJsonInLocalStorage("user",t),createFormForSecurityVerification(a,e.url,r))}),a.replaceChild(e,a.children[0])},createFormForSecurityVerification=(a,e,r)=>{document.createElement("div");var t=document.createElement("form"),n=(t.setAttribute("class","form-container"),document.createElement("p"));n.innerText=`Scan the QR Code in the Authenticator app then enter the code that you
  see in the app in the text field and click Submit.`,t.appendChild(n);let i=document.createElement("img");i.setAttribute("src",e),i.setAttribute("id","secure-code"),t.appendChild(i);n=document.createElement("div"),n.setAttribute("class","mb-3"),e=document.createElement("label");e.setAttribute("class","form-label"),e.innerText="Security Code",n.appendChild(e);let l=document.createElement("input"),s=(l.setAttribute("type","text"),l.setAttribute("class","form-control"),l.setAttribute("placeholder","Security Code"),l.setAttribute("name","code"),l.setAttribute("id","code"),n.appendChild(l),document.createElement("div"));s.setAttribute("class","text-danger"),s.setAttribute("id","qr-code-error"),n.appendChild(s),t.appendChild(n);e=document.createElement("button");e.setAttribute("class","btn btn-primary"),e.setAttribute("type","submit"),e.innerText="Submit",t.appendChild(e),t.addEventListener("submit",async function(e){var t;e.preventDefault(),l.value?(e=await axios.post("/verify-secret-code",{code:l.value},{}))&&200===e.status&&(e=e.data,console.log("check after register resData",e),e.success?(delete(t=e.user.userDetails)._id,delete t.password,t={...r,...t},setJsonInLocalStorage("user",t),showResetSecurityButton(a,r)):(s.innerText="Authentication Code is wrong. Please check and try again.",i.setAttribute("src",e.url),l.value="")):s.innerText="Please enter code."}),a.replaceChild(t,a.children[0])},renderPdfViewerElements=(t,e,a)=>{let r=t.firstChild?t.firstChild.className:"";for(;t.firstChild;)t.removeChild(t.firstChild);if(Array.isArray(e)&&0<e.length)e.forEach(e=>{e=createButtonForPdfViewer(e,a,r);return t.appendChild(e),t});else if(e&&"object"==typeof e)return e=createButtonForPdfViewer(e,a,r),t.appendChild(e),t},createButtonForPdfViewer=(e,t,a="")=>{var r=document.createElement("button");return r.className=a||"btn btn-outline-primary btn-sm mx-2",r.setAttribute("data-item-id",t),r.setAttribute("data-collection-id",e.collectionName||""),r.setAttribute("data-file-id",e.uuid||""),r.setAttribute("data-file-original-name",e.originalName||""),r.setAttribute("data-file-type",e.mimeType||""),r.setAttribute("title",e.originalName||""),r.textContent=e.originalName||"Open PDF",r.setAttribute("onclick","openPDFViewer(event)"),r},renderPdfViewerInDataTable=(e,t,a)=>{t=t?e[t]:"";let r="";return t?(a&&(renderPdfViewerElements(a,t,e?.uuid),r=`<td>${a.outerHTML}</td>`),r):"<td></td>"},addDownloadAttributeForPrivateFiles=(e,t,a)=>{var{uuid:t,collectionName:r,collectionField:n="",originalName:i}=t;e.setAttribute("onclick",`fetchFile("${a}","${t}","${r}","${n}","${i}")`)},parseRange=e=>{var t;return!e||!e.includes("-")||([e,t]=e.split("-").map(parseFloat),isNaN(e))||isNaN(t)?null:{y2:e,y:t}},convertColorForChartJs=e=>{e=tinycolor(e);return e.isValid()?e.setAlpha(.3).toString():"rgba(255, 255, 255 ,0.3)"};
//# sourceMappingURL=dataLoader.js.map